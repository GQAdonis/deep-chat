/*! For license information please see common.bf87a5f3.js.LICENSE.txt */
"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8592],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>f});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=c(n),h=i,f=d["".concat(l,".").concat(h)]||d[h]||p[h]||a;return n?r.createElement(f,s(s({ref:t},u),{},{components:n})):r.createElement(f,s({ref:t},u))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,s=new Array(a);s[0]=h;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[d]="string"==typeof e?e:i,s[1]=o;for(var c=2;c<a;c++)s[c]=n[c];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},1262:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(7294),i=n(2389);function a(e){let{children:t,fallback:n}=e;return(0,i.Z)()?r.createElement(r.Fragment,null,t?.()):n??null}},4602:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(1262),i=n(7294);function a(e){return i.createElement(r.Z,null,(()=>{const t=n(4925).DeepChat;return i.createElement(t,e,e.children)}))}},4925:(e,t,n)=>{n.r(t),n.d(t,{DeepChat:()=>c});var r=n(7694);const i=new Set(["children","localName","ref","style","className"]),a=new WeakMap,s=(e,t,n,r,i)=>{const s=null==i?void 0:i[t];void 0===s||n===r?null==n&&t in HTMLElement.prototype?e.removeAttribute(t):e[t]=n:((e,t,n)=>{let r=a.get(e);void 0===r&&a.set(e,r=new Map);let i=r.get(t);void 0!==n?void 0===i?(r.set(t,i={handleEvent:n}),e.addEventListener(t,i)):i.handleEvent=n:void 0!==i&&(r.delete(t),e.removeEventListener(t,i))})(e,s,n)};var o=n(7294),l=n.t(o,2);const c=function(e=window.React,t,n,r,a){let o,l,c;if(void 0===t){const t=e;({tagName:l,elementClass:c,events:r,displayName:a}=t),o=t.react}else o=e,c=n,l=t;const u=o.Component,d=o.createElement,p=new Set(Object.keys(null!=r?r:{}));class h extends u{constructor(){super(...arguments),this.o=null}t(e){if(null!==this.o)for(const t in this.i)s(this.o,t,this.props[t],e?e[t]:void 0,r)}componentDidMount(){var e;this.t(),null===(e=this.o)||void 0===e||e.removeAttribute("defer-hydration")}componentDidUpdate(e){this.t(e)}render(){const{_$Gl:e,...t}=this.props;this.h!==e&&(this.u=t=>{null!==e&&((e,t)=>{"function"==typeof e?e(t):e.current=t})(e,t),this.o=t,this.h=e}),this.i={};const n={ref:this.u};for(const[r,a]of Object.entries(t))i.has(r)?n["className"===r?"class":r]=a:p.has(r)||r in c.prototype?this.i[r]=a:n[r]=a;return n.suppressHydrationWarning=!0,d(l,n)}}h.displayName=null!=a?a:c.name;const f=o.forwardRef(((e,t)=>d(h,{...e,_$Gl:t},null==e?void 0:e.children)));return f.displayName=h.displayName,f}({tagName:"deep-chat",elementClass:r.S,react:l,events:{onactivate:"activate",onchange:"change"}})},7694:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,e)},_wrapNativeSuper(e)}function _construct(e,t,n){return _construct=_isNativeReflectConstruct()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&_setPrototypeOf(i,n.prototype),i},_construct.apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _regeneratorRuntime(){_regeneratorRuntime=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var a=t&&t.prototype instanceof g?t:g,s=Object.create(a.prototype),o=new M(r||[]);return i(s,"_invoke",{value:E(e,n,o)}),s}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var p="suspendedStart",h="suspendedYield",f="executing",m="completed",v={};function g(){}function y(){}function _(){}var b={};c(b,s,(function(){return this}));var k=Object.getPrototypeOf,C=k&&k(k(R([])));C&&C!==n&&r.call(C,s)&&(b=C);var S=_.prototype=g.prototype=Object.create(b);function x(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function n(i,a,s,o){var l=d(e[i],e,a);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==_typeof(u)&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,s,o)}),(function(e){n("throw",e,s,o)})):t.resolve(u).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,o)}))}o(l.arg)}var a;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return a=a?a.then(i,i):i()}})}function E(t,n,r){var i=p;return function(a,s){if(i===f)throw new Error("Generator is already running");if(i===m){if("throw"===a)throw s;return{value:e,done:!0}}for(r.method=a,r.arg=s;;){var o=r.delegate;if(o){var l=T(o,r);if(l){if(l===v)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===p)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=f;var c=d(t,n,r);if("normal"===c.type){if(i=r.done?m:h,c.arg===v)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=m,r.method="throw",r.arg=c.arg)}}}function T(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,T(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var a=d(i,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,v;var s=a.arg;return s?s.done?(n[t.resultName]=s.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function R(t){if(t||""===t){var n=t[s];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(_typeof(t)+" is not iterable")}return y.prototype=_,i(S,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:y,configurable:!0}),y.displayName=c(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,c(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},x(w.prototype),c(w.prototype,o,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var s=new w(u(e,n,r,i),a);return t.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},x(S),c(S,l,"Generator"),c(S,s,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=R,M.prototype={constructor:M,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return o.type="throw",o.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],o=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var l=r.call(s,"catchLoc"),c=r.call(s,"finallyLoc");if(l&&c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;A(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:R(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),v}},t}function asyncGeneratorStep(e,t,n,r,i,a,s){try{var o=e[a](s),l=o.value}catch(c){return void n(c)}o.done?t(l):Promise.resolve(l).then(r,i)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function s(e){asyncGeneratorStep(a,r,i,s,o,"next",e)}function o(e){asyncGeneratorStep(a,r,i,s,o,"throw",e)}s(void 0)}))}}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}__webpack_require__.d(__webpack_exports__,{S:()=>DeepChat});var ErrorView=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"render",value:function(e,t){var n=document.createElement("div");n.id="error-view",n.innerText=t,e.replaceChildren(n)}}]),e}(),ValidateKeyPropertyView=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"onLoad",value:function(e){e.innerHTML='<div id="large-loading-ring"></div>'}},{key:"createElements",value:function(){var e=document.createElement("div");return e.id="validate-property-key-view",e}},{key:"render",value:function(t,n,r){var i=e.createElements(),a={onSuccess:n,onFail:ErrorView.render.bind(this,t,"Your 'key' has failed authentication"),onLoad:e.onLoad.bind(this,i)};r.key&&r.verifyKey(r.key,a),t.replaceChildren(i)}}]),e}(),WebComponentStyleUtils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"apply",value:function(t,n){if(n)try{e.applyStyleSheet(t,n)}catch(r){e.addStyleElement(t,n)}}},{key:"applyStyleSheet",value:function(e,t){var n=new CSSStyleSheet;n.replaceSync(e),t.adoptedStyleSheets.push(n)}},{key:"addStyleElement",value:function(e,t){var n=document.createElement("style");n.innerHTML=e,t.appendChild(n)}}]),e}(),KEYBOARD_KEY=function(e){return e.ESCAPE="Escape",e.ENTER="Enter",e.TAB="Tab",e.ARROW_UP="ArrowUp",e.ARROW_DOWN="ArrowDown",e.ARROW_RIGHT="ArrowRight",e.ARROW_LEFT="ArrowLeft",e.BACKSPACE="Backspace",e.DELETE="Delete",e.META="Meta",e.CONTROL="Control",e}(KEYBOARD_KEY||{}),StyleUtils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"unsetStyle",value:function(e,t){var n=Object.keys(t).reduce((function(e,t){return e[t]="",e}),{});Object.assign(e.style,n)}},{key:"unsetActivityCSSMouseStates",value:function(t,n){n.click&&e.unsetStyle(t,n.click),n.hover&&e.unsetStyle(t,n.hover)}},{key:"unsetAllCSSMouseStates",value:function(t,n){e.unsetActivityCSSMouseStates(t,n),n.default&&e.unsetStyle(t,n.default)}},{key:"generateStateful",value:function(e,t,n){var r=e.default||{},i=Object.assign(JSON.parse(JSON.stringify(_objectSpread(_objectSpread({},r),t))),null==e?void 0:e.hover);return{default:r,hover:i,click:Object.assign(JSON.parse(JSON.stringify(_objectSpread(_objectSpread({},i),n))),null==e?void 0:e.click)}}}]),e}(),Browser$1=_createClass((function e(){_classCallCheck(this,e)}));Browser$1.IS_SAFARI=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),Browser$1.IS_CHROMIUM=window.chrome;var PasteUtils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"sanitizePastedTextContent",value:function(e){var t,n;e.preventDefault();var r=null==(t=e.clipboardData)?void 0:t.getData("text/plain");null==(n=document.execCommand)||n.call(document,"insertHTML",!1,r)}}]),e}(),_InputLimit=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"add",value:function(t,n){t.addEventListener("keydown",e.onKeyDown.bind(this,n)),t.oninput=e.onInput.bind(this,n)}},{key:"onKeyDown",value:function(t,n){var r=n.target.textContent;r&&r.length>=t&&!e.PERMITTED_KEYS.has(n.key)&&!e.isKeyCombinationPermitted(n)&&n.preventDefault()}},{key:"isKeyCombinationPermitted",value:function(e){return"a"===e.key&&(e.ctrlKey||e.metaKey)}},{key:"onInput",value:function(e,t){var n=t.target,r=n.textContent;r&&r.length>e&&(n.textContent=r.substring(0,e),FocusUtils.focusEndOfInput(n))}}]),e}();_InputLimit.PERMITTED_KEYS=new Set([KEYBOARD_KEY.BACKSPACE,KEYBOARD_KEY.DELETE,KEYBOARD_KEY.ARROW_RIGHT,KEYBOARD_KEY.ARROW_LEFT,KEYBOARD_KEY.ARROW_DOWN,KEYBOARD_KEY.ARROW_UP,KEYBOARD_KEY.META,KEYBOARD_KEY.CONTROL,KEYBOARD_KEY.ENTER]);var InputLimit=_InputLimit,_TextInputEl=function(){function e(t,n){var r;_classCallCheck(this,e);var i=e.processConfig(t,n);this.elementRef=e.createContainerElement(null==(r=null==i?void 0:i.styles)?void 0:r.container),this.inputElementRef=this.createInputElement(i),this._config=i,this.elementRef.appendChild(this.inputElementRef),null!=n&&n.characterLimit&&InputLimit.add(this.inputElementRef,null==n?void 0:n.characterLimit)}return _createClass(e,[{key:"createInputElement",value:function(t){var n,r,i,a=document.createElement("div");return a.id=e.TEXT_INPUT_ID,a.classList.add("text-input-styling","text-input-placeholder"),a.innerText=(null==(n=null==t?void 0:t.placeholder)?void 0:n.text)||"Ask me anything!",Browser$1.IS_CHROMIUM&&e.preventAutomaticScrollUpOnNewLine(a),"boolean"==typeof(null==t?void 0:t.disabled)&&!0===t.disabled?(a.contentEditable="false",a.classList.add("text-input-disabled")):(a.contentEditable="true",this.addEventListeners(a,t)),Object.assign(a.style,null==(r=null==t?void 0:t.styles)?void 0:r.text),Object.assign(a.style,null==(i=null==t?void 0:t.placeholder)?void 0:i.style),a}},{key:"removeTextIfPlaceholder",value:function(){var t,n,r,i;this.inputElementRef.classList.contains("text-input-placeholder")&&!this.inputElementRef.classList.contains("text-input-disabled")&&(null!=(t=this._config.placeholder)&&t.style&&(StyleUtils.unsetStyle(this.inputElementRef,null==(n=this._config.placeholder)?void 0:n.style),Object.assign(this.inputElementRef.style,null==(i=null==(r=this._config)?void 0:r.styles)?void 0:i.text)),e.clear(this.inputElementRef),this.inputElementRef.classList.remove("text-input-placeholder"))}},{key:"addEventListeners",value:function(e,t){var n,r,i;e.onfocus=this.onFocus.bind(this,null==(n=null==t?void 0:t.styles)?void 0:n.focus),null!=(r=null==t?void 0:t.styles)&&r.focus&&(e.onblur=this.onBlur.bind(this,t.styles.focus,null==(i=null==t?void 0:t.styles)?void 0:i.container)),e.addEventListener("keydown",this.onKeydown.bind(this)),e.onpaste=PasteUtils.sanitizePastedTextContent}},{key:"onFocus",value:function(e){var t=this;Browser$1.IS_SAFARI?setTimeout((function(){t.removeTextIfPlaceholder()})):this.removeTextIfPlaceholder(),Object.assign(this.elementRef.style,e)}},{key:"onBlur",value:function(e,t){StyleUtils.unsetStyle(this.elementRef,e),t&&Object.assign(this.elementRef.style,t)}},{key:"onKeydown",value:function(e){var t;e.key===KEYBOARD_KEY.ENTER&&!e.ctrlKey&&!e.shiftKey&&(e.preventDefault(),null==(t=this.submit)||t.call(this))}}],[{key:"processConfig",value:function(e,t){var n,r,i,a,s;return null!==(n=t)&&void 0!==n||(t={}),null!==(r=t.disabled)&&void 0!==r||(t.disabled=e.isTextInputDisabled),null!==(i=t.placeholder)&&void 0!==i||(t.placeholder={}),null!==(a=(s=t.placeholder).text)&&void 0!==a||(s.text=e.textInputPlaceholderText),t}},{key:"preventAutomaticScrollUpOnNewLine",value:function(e){var t;e.addEventListener("keydown",(function(){t=window.scrollY})),e.addEventListener("input",(function(){t!==window.scrollY&&window.scrollTo({top:t})}))}},{key:"clear",value:function(e){var t=window.scrollY;e.classList.contains("text-input-disabled")||(e.textContent=""),Browser$1.IS_CHROMIUM&&window.scrollTo({top:t})}},{key:"toggleEditability",value:function(e,t){e.contentEditable=t?"true":"false"}},{key:"createContainerElement",value:function(e){var t=document.createElement("div");return t.id="text-input-container",Object.assign(t.style,e),t}}]),e}();_TextInputEl.TEXT_INPUT_ID="text-input";var TextInputEl=_TextInputEl,FocusUtils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"focusEndOfInput",value:function(e){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=window.getSelection();null==n||n.removeAllRanges(),null==n||n.addRange(t)}},{key:"focusFromParentElement",value:function(t){var n=t.querySelector("#".concat(TextInputEl.TEXT_INPUT_ID));n&&e.focusEndOfInput(n)}}]),e}();function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function getInterceptorMessage(e){return e&&JSON.stringify(e)}function getInvalidResponseMessage(e,t,n,r){var i="\n".concat(capitalizeFirstLetter(t)," message: ").concat(JSON.stringify(e)," \n"),a=n?"".concat(capitalizeFirstLetter(t)," message after interceptor: ").concat(getInterceptorMessage(r)," \n"):"";return"".concat(i+a,"Make sure the ").concat(t," message is using the Result format: https://deepchat.dev/docs/connect/#Result \n You can also augment it using the responseInterceptor property: https://deepchat.dev/docs/interceptors#responseInterceptor")}var ErrorMessages={INVALID_KEY:"Invalid API Key",CONNECTION_FAILED:"Failed to connect",INVALID_RESPONSE:getInvalidResponseMessage,INVALID_STREAM_RESPONSE:"Make sure the events are using the Result format: https://deepchat.dev/docs/connect/#Result \nYou can also augment them using the responseInterceptor property: https://deepchat.dev/docs/interceptors#responseInterceptor"},_RequestUtils=function(){function e(){_classCallCheck(this,e)}var t,n;return _createClass(e,null,[{key:"temporarilyRemoveHeader",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function t(n,r,i){var a;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=n&&n.headers){t.next=2;break}throw new Error("Request settings have not been set up");case 2:return a=n.headers[e.CONTENT_TYPE],delete n.headers[e.CONTENT_TYPE],t.next=6,r(i);case 6:n.headers[e.CONTENT_TYPE]=a;case 7:case"end":return t.stop()}}),t)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"displayError",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Service error, please try again.";if(console.error(t),"object"==_typeof(t))return 0===Object.keys(t).length?e.addNewErrorMessage("service",n):e.addNewErrorMessage("service",JSON.stringify(t));e.addNewErrorMessage("service",t)}},{key:"processResponseByType",value:function(e){var t=e.headers.get("content-type");return null!=t&&t.includes("application/json")?e.json():null!=t&&t.includes("text/plain")||!t?e:e.blob()}},{key:"processResponseInterceptor",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r,i,a,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==(r=t.requestInterceptor)?void 0:r.call(t,n);case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0=n;case 5:return i=e.t0,a=i,s=i,e.abrupt("return",{body:a.body,headers:a.headers,error:s.error});case 9:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})}]),e}();_RequestUtils.CONTENT_TYPE="Content-Type";var RequestUtils=_RequestUtils;function getBytes(e,t){return _getBytes.apply(this,arguments)}function _getBytes(){return(_getBytes=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.getReader();case 1:return e.next=3,r.read();case 3:if((i=e.sent).done){e.next=7;break}n(i.value);case 5:e.next=1;break;case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function getLines(e){var t,n,r,i=!1;return function(a){void 0===t?(t=a,n=0,r=-1):t=concat(t,a);for(var s=t.length,o=0;n<s;){i&&(10===t[n]&&(o=++n),i=!1);for(var l=-1;n<s&&-1===l;++n)switch(t[n]){case 58:-1===r&&(r=n-o);break;case 13:i=!0;case 10:l=n}if(-1===l)break;e(t.subarray(o,l),r),o=n,r=-1}o===s?t=void 0:0!==o&&(t=t.subarray(o),n-=o)}}function getMessages(e,t,n){var r=newMessage(),i=new TextDecoder;return function(a,s){if(0===a.length)null==n||n(r),r=newMessage();else if(s>0){var o=i.decode(a.subarray(0,s)),l=s+(32===a[s+1]?2:1),c=i.decode(a.subarray(l));switch(o){case"data":r.data=r.data?r.data+"\n"+c:c;break;case"event":r.event=c;break;case"id":e(r.id=c);break;case"retry":var u=parseInt(c,10);isNaN(u)||t(r.retry=u)}}}}function concat(e,t){var n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function newMessage(){return{data:"",event:"",id:"",retry:void 0}}var __rest=globalThis&&globalThis.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},EventStreamContentType="text/event-stream",DefaultRetryInterval=1e3,LastEventId="last-event-id";function fetchEventSource(e,t){var n=t.signal,r=t.headers,i=t.onopen,a=t.onmessage,s=t.onclose,o=t.onerror,l=t.openWhenHidden,c=t.fetch,u=__rest(t,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((function(t,d){var p,h=Object.assign({},r);function f(){p.abort(),document.hidden||b()}h.accept||(h.accept=EventStreamContentType),l||document.addEventListener("visibilitychange",f);var m=DefaultRetryInterval,v=0;function g(){document.removeEventListener("visibilitychange",f),window.clearTimeout(v),p.abort()}null==n||n.addEventListener("abort",(function(){g(),t()}));var y=null!=c?c:window.fetch,_=null!=i?i:defaultOnOpen;function b(){return k.apply(this,arguments)}function k(){return(k=_asyncToGenerator(_regeneratorRuntime().mark((function n(){var r,i,l;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return p=new AbortController,n.prev=1,n.next=4,y(e,Object.assign(Object.assign({},u),{headers:h,signal:p.signal}));case 4:return i=n.sent,n.next=7,_(i);case 7:return n.next=9,getBytes(i.body,getLines(getMessages((function(e){e?h[LastEventId]=e:delete h[LastEventId]}),(function(e){m=e}),a)));case 9:null==s||s(),g(),t(),n.next=17;break;case 14:if(n.prev=14,n.t0=n.catch(1),!p.signal.aborted)try{l=null!==(r=null==o?void 0:o(n.t0))&&void 0!==r?r:m,window.clearTimeout(v),v=window.setTimeout(b,l)}catch(l){g(),d(l)}case 17:case"end":return n.stop()}}),n,null,[[1,14]])})))).apply(this,arguments)}b()}))}function defaultOnOpen(e){var t=e.headers.get("content-type");if(null==t||!t.startsWith(EventStreamContentType))throw new Error("Expected content-type to be ".concat(EventStreamContentType,", Actual: ").concat(t))}var Stream=function(){function e(){_classCallCheck(this,e)}var t;return _createClass(e,null,[{key:"request",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function t(n,r,i){var a,s,o,l,c,u,d,p,h,f,m,v,g,y,_,b=arguments;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=!(b.length>3&&void 0!==b[3])||b[3],u={body:r,headers:null==(s=n.requestSettings)?void 0:s.headers},t.next=4,RequestUtils.processResponseInterceptor(n.deepChat,u);case 4:if(d=t.sent,p=d.body,h=d.headers,f=d.error,m=n.streamHandlers,v=m.onOpen,g=m.onClose,y=m.abortStream,!f){t.next=14;break}return t.abrupt("return",e.onInterceptorError(i,f,g));case 14:if((null==(o=n.requestSettings)?void 0:o.url)!==Demo.URL){t.next=16;break}return t.abrupt("return",Demo.requestStream(i,n.streamHandlers));case 16:_=null,fetchEventSource((null==(l=n.requestSettings)?void 0:l.url)||n.url||"",{method:(null==(c=n.requestSettings)?void 0:c.method)||"POST",headers:h,body:a?JSON.stringify(p):p,openWhenHidden:!0,onopen:function(e){return _asyncToGenerator(_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.ok){t.next=2;break}return t.abrupt("return",(_=i.addNewStreamedMessage(),v()));case 2:return t.next=4,RequestUtils.processResponseByType(e);case 4:throw t.sent;case 5:case"end":return t.stop()}}),t)})))()},onmessage:function(e){var t;if(JSON.stringify(e.data)!==JSON.stringify("[DONE]")){var r=JSON.parse(e.data);null==(t=n.extractResultData)||t.call(n,r).then((function(t){void 0===(null==t?void 0:t.text)?console.error("Response data: ".concat(e.data," \n ").concat(ErrorMessages.INVALID_STREAM_RESPONSE)):_&&i.updateStreamedMessage(t.text,_)})).catch((function(e){return RequestUtils.displayError(i,e)}))}},onerror:function(e){throw g(),e},onclose:function(){i.finaliseStreamedMessage(),g()},signal:y.signal}).catch((function(e){var t;null==(t=n.extractResultData)||t.call(n,e).then((function(){RequestUtils.displayError(i,e)})).catch((function(e){RequestUtils.displayError(i,e)}))}));case 18:case"end":return t.stop()}}),t)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"onInterceptorError",value:function(e,t,n){e.addNewErrorMessage("service",t),null==n||n()}},{key:"simulate",value:function(t,n,r){var i=n,a=(null==r?void 0:r.split(" "))||[],s=t.addNewStreamedMessage();n.onOpen(),e.populateMessages(s,a,t,i)}},{key:"populateMessages",value:function(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=n[a];if(s){r.updateStreamedMessage("".concat(s," "),t);var o=setTimeout((function(){e.populateMessages(t,n,r,i,a+1)}),i.simulationInterim||70);i.abortStream.abort=function(){return e.abort(o,r,i.onClose)}}else r.finaliseStreamedMessage(),i.onClose()}},{key:"abort",value:function(e,t,n){clearTimeout(e),t.finaliseStreamedMessage(),n()}}]),e}(),_Demo=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"generateResponseForOneMessage",value:function(e){if(e.file)return"image"===e.file.type?"That is a nice image!":"audio"===e.file.type?"I like the sound of that!":"gif"===e.file.type?"That is a nice gif!":"That is an interesting file!";if(e.text){if("?"===e.text.charAt(e.text.length-1))return"I'm sorry but I can't answer that question...";if(e.text.includes("updog"))return"What's updog?"}return"Hi there! This is a demo response!"}},{key:"generateResponse",value:function(t){for(var n=[],r=t.messages.length-1;r>=0&&"ai"!==t.messages[r].role;r-=1)n.push(t.messages[r]);if(1===n.length)return e.generateResponseForOneMessage(t.messages[t.messages.length-1]);var i=t.messages.findIndex((function(e){return e.text}));return-1!==i&&n.splice(i,1),1===n.length?e.generateResponseForOneMessage(t.messages[t.messages.length-1]):"Wow, very cool files!"}},{key:"getCustomResponse",value:function(e,t){return"function"==typeof e?e(t):e}},{key:"getResponse",value:function(t){return t.customDemoResponse?e.getCustomResponse(t.customDemoResponse,t.messages[t.messages.length-1]):{result:{text:e.generateResponse(t)}}}},{key:"request",value:function(t,n,r){var i=e.getResponse(t);setTimeout(_asyncToGenerator(_regeneratorRuntime().mark((function e(){var a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==r?void 0:r(i);case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0=i;case 5:(a=e.t0).error?t.addNewErrorMessage("service",a.error):a.result&&t.addNewMessage(a.result,!0,!0),n();case 7:case"end":return e.stop()}}),e)}))),400)}},{key:"requestStream",value:function(t,n){setTimeout((function(){var r,i,a=null==(i=null==(r=e.getResponse(t))?void 0:r.result)?void 0:i.text;Stream.simulate(t,n,a)}),400)}}]),e}();_Demo.URL="deep-chat-demo";var Demo=_Demo,HTTPRequest=function(){function e(){_classCallCheck(this,e)}var t,n;return _createClass(e,null,[{key:"request",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function t(n,r,i){var a,s,o,l,c,u,d,p,h,f,m,v,g=arguments;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=!(g.length>3&&void 0!==g[3])||g[3],u={body:r,headers:null==(s=n.requestSettings)?void 0:s.headers},t.next=4,RequestUtils.processResponseInterceptor(n.deepChat,u);case 4:if(d=t.sent,p=d.body,h=d.headers,f=d.error,m=n.completionsHandlers.onFinish,!f){t.next=11;break}return t.abrupt("return",e.onInterceptorError(i,f,m));case 11:if((null==(o=n.requestSettings)?void 0:o.url)!==Demo.URL){t.next=13;break}return t.abrupt("return",Demo.request(i,m,n.deepChat.responseInterceptor));case 13:v=!0,fetch((null==(l=n.requestSettings)?void 0:l.url)||n.url||"",{method:(null==(c=n.requestSettings)?void 0:c.method)||"POST",headers:h,body:a?JSON.stringify(p):p}).then((function(e){return v=!!e.ok,e})).then((function(e){return RequestUtils.processResponseByType(e)})).then(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,a,s,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.extractResultData){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,null==(a=(r=n.deepChat).responseInterceptor)?void 0:a.call(r,t);case 4:if(e.t0=e.sent,e.t0){e.next=7;break}e.t0=t;case 7:return s=e.t0,e.next=10,n.extractResultData(s);case 10:if(o=e.sent,v){e.next=13;break}throw t;case 13:if(o&&"object"==_typeof(o)){e.next=15;break}throw Error(ErrorMessages.INVALID_RESPONSE(t,"response",!!n.deepChat.responseInterceptor,s));case 15:o.pollingInAnotherRequest||(n.deepChat.stream&&o.text?Stream.simulate(i,n.streamHandlers,o.text):(i.addNewMessage(o,!0,!0),m()));case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){RequestUtils.displayError(i,e),m()}));case 15:case"end":return t.stop()}}),t)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"executePollRequest",value:function(t,n,r,i){console.log("polling");var a=t.completionsHandlers.onFinish;fetch(n,r).then((function(e){return e.json()})).then(function(){var s=_asyncToGenerator(_regeneratorRuntime().mark((function s(o){var l,c,u;return _regeneratorRuntime().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(t.extractPollResultData){s.next=2;break}return s.abrupt("return");case 2:return s.t0=t,s.next=5,null==(c=(l=t.deepChat).responseInterceptor)?void 0:c.call(l,o);case 5:if(s.t1=s.sent,s.t1){s.next=8;break}s.t1=o;case 8:return s.t2=s.t1,s.next=11,s.t0.extractPollResultData.call(s.t0,s.t2);case 11:(u=s.sent).timeoutMS?setTimeout((function(){e.executePollRequest(t,n,r,i)}),u.timeoutMS):(console.log("finished polling"),i.addNewMessage(u,!0,!0),a());case 13:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}()).catch((function(e){RequestUtils.displayError(i,e),a()}))}},{key:"poll",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function t(n,r,i){var a,s,o,l,c,u,d,p,h,f,m,v,g,y=arguments;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=!(y.length>3&&void 0!==y[3])||y[3],c={body:r,headers:null==(s=n.requestSettings)?void 0:s.headers},t.next=4,RequestUtils.processResponseInterceptor(n.deepChat,c);case 4:if(u=t.sent,d=u.body,p=u.headers,!(h=u.error)){t.next=10;break}return t.abrupt("return",e.onInterceptorError(i,h));case 10:f=(null==(o=n.requestSettings)?void 0:o.url)||n.url||"",m=(null==(l=n.requestSettings)?void 0:l.method)||"POST",v=a?JSON.stringify(d):d,g={method:m,body:v,headers:p},e.executePollRequest(n,f,g,i);case 12:case"end":return t.stop()}}),t)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"onInterceptorError",value:function(e,t,n){e.addNewErrorMessage("service",t),null==n||n()}},{key:"verifyKey",value:function(e,t,n,r,i,a,s,o,l){if(""===e)return a(ErrorMessages.INVALID_KEY);s(),fetch(t,{method:r,headers:n,body:l||null}).then((function(e){return RequestUtils.processResponseByType(e)})).then((function(t){o(t,e,i,a)})).catch((function(e){a(ErrorMessages.CONNECTION_FAILED),console.error(e)}))}}]),e}(),MessageLimitUtils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getCharacterLimitMessages",value:function(e,t){for(var n,r=0,i=e.length-1;i>=0;i-=1){var a=null==(n=e[i])?void 0:n.text;if(void 0!==a&&(r+=a.length)>t){e[i].text=a.substring(0,a.length-(r-t));break}}return e.slice(Math.max(i,0))}},{key:"getRequestMessages",value:function(e,t){for(var n,r=[],i=(null==(n=e.files)?void 0:n.length)||0,a=!!e.text,s=t.length-1;s>=0;s-=1){var o=t[s];if(r.push(o),o.file?i-=1:o.text&&(a=!1),0===i&&!a)break}return r}},{key:"getMaxMessages",value:function(e,t){return e.slice(Math.max(e.length-t,0))}},{key:"processMessages",value:function(t,n,r,i){return void 0!==r?r>0&&(n=e.getMaxMessages(n,r)):n=e.getRequestMessages(t,n),void 0===i?n:e.getCharacterLimitMessages(n,i)}}]),e}(),Websocket=function(){function e(){_classCallCheck(this,e)}var t;return _createClass(e,null,[{key:"setup",value:function(t,n){if(t.requestSettings.url!==Demo.URL){var r="boolean"!=typeof n?n:void 0;t.websocket=e.connect(t.requestSettings.url,r),t.permittedErrorPrefixes=["Connection error","Error in server message"]}}},{key:"connect",value:function(e,t){return new WebSocket(e||"",t)}},{key:"assignListeners",value:function(e,t){e.websocket&&(e.websocket.onmessage=function(){var n=_asyncToGenerator(_regeneratorRuntime().mark((function n(r){var i,a,s,o,l;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.extractResultData){n.next=20;break}return n.prev=1,s=JSON.parse(r.data),n.next=5,null==(a=(i=e.deepChat).responseInterceptor)?void 0:a.call(i,s);case 5:if(n.t0=n.sent,n.t0){n.next=8;break}n.t0=s;case 8:return o=n.t0,n.next=11,e.extractResultData(o);case 11:if((l=n.sent)&&"object"==_typeof(l)){n.next=14;break}throw Error(ErrorMessages.INVALID_RESPONSE(s,"server",!!e.deepChat.responseInterceptor,o));case 14:e.deepChat.stream&&l.text?Stream.simulate(t,e.streamHandlers,l.text):t.addNewMessage(l,!0,!0),n.next=20;break;case 17:n.prev=17,n.t1=n.catch(1),RequestUtils.displayError(t,n.t1,"Error in server message");case 20:case"end":return n.stop()}}),n,null,[[1,17]])})));return function(e){return n.apply(this,arguments)}}(),e.websocket.onerror=function(e){console.error(e),t.addNewErrorMessage("service","Connection error")},e.websocket.onclose=function(){console.error("Connection closed"),t.isLastMessageError()||t.addNewErrorMessage("service","Connection error")})}},{key:"sendWebsocket",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n,r,i){var a,s,o,l,c,u,d,p,h=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!(h.length>4&&void 0!==h[4])||h[4],l={body:r,headers:null==(s=n.requestSettings)?void 0:s.headers},e.next=4,RequestUtils.processResponseInterceptor(n.deepChat,l);case 4:if(c=e.sent,u=c.body,!(d=c.error)){e.next=9;break}return e.abrupt("return",i.addNewErrorMessage("service",d));case 9:if(p=a?JSON.stringify(u):u,(null==(o=n.requestSettings)?void 0:o.url)!==Demo.URL){e.next=12;break}return e.abrupt("return",Demo.request(i,n.completionsHandlers.onFinish,n.deepChat.responseInterceptor));case 12:t.readyState!==t.OPEN?(console.error("Connection is not open"),i.addNewErrorMessage("service","Connection error")):t.send(JSON.stringify(p));case 13:case"end":return e.stop()}}),e)}))),function(e,n,r,i){return t.apply(this,arguments)})}]),e}(),textarea;function decodeEntity(e){return(textarea=textarea||document.createElement("textarea")).innerHTML="&"+e+";",textarea.value}var hasOwn=Object.prototype.hasOwnProperty;function has(e,t){return!!e&&hasOwn.call(e,t)}function assign(e){return[].slice.call(arguments,1).forEach((function(t){if(t){if("object"!=_typeof(t))throw new TypeError(t+"must be object");Object.keys(t).forEach((function(n){e[n]=t[n]}))}})),e}var UNESCAPE_MD_RE=/\\([\\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;function unescapeMd(e){return e.indexOf("\\")<0?e:e.replace(UNESCAPE_MD_RE,"$1")}function isValidEntityCode(e){return!(e>=55296&&e<=57343||e>=64976&&e<=65007||65535==(65535&e)||65534==(65535&e)||e>=0&&e<=8||11===e||e>=14&&e<=31||e>=127&&e<=159||e>1114111)}function fromCodePoint(e){if(e>65535){var t=55296+((e-=65536)>>10),n=56320+(1023&e);return String.fromCharCode(t,n)}return String.fromCharCode(e)}var NAMED_ENTITY_RE=/&([a-z#][a-z0-9]{1,31});/gi,DIGITAL_ENTITY_TEST_RE=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))/i;function replaceEntityPattern(e,t){var n=0,r=decodeEntity(t);return t!==r?r:35===t.charCodeAt(0)&&DIGITAL_ENTITY_TEST_RE.test(t)&&isValidEntityCode(n="x"===t[1].toLowerCase()?parseInt(t.slice(2),16):parseInt(t.slice(1),10))?fromCodePoint(n):e}function replaceEntities(e){return e.indexOf("&")<0?e:e.replace(NAMED_ENTITY_RE,replaceEntityPattern)}var HTML_ESCAPE_TEST_RE=/[&<>"]/,HTML_ESCAPE_REPLACE_RE=/[&<>"]/g,HTML_REPLACEMENTS={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function replaceUnsafeChar(e){return HTML_REPLACEMENTS[e]}function escapeHtml(e){return HTML_ESCAPE_TEST_RE.test(e)?e.replace(HTML_ESCAPE_REPLACE_RE,replaceUnsafeChar):e}var rules={};function nextToken(e,t){return++t>=e.length-2?t:"paragraph_open"===e[t].type&&e[t].tight&&"inline"===e[t+1].type&&0===e[t+1].content.length&&"paragraph_close"===e[t+2].type&&e[t+2].tight?nextToken(e,t+2):t}rules.blockquote_open=function(){return"<blockquote>\n"},rules.blockquote_close=function(e,t){return"</blockquote>"+getBreak(e,t)},rules.code=function(e,t){return e[t].block?"<pre><code>"+escapeHtml(e[t].content)+"</code></pre>"+getBreak(e,t):"<code>"+escapeHtml(e[t].content)+"</code>"},rules.fence=function(e,t,n,r,i){var a,s,o=e[t],l="",c=n.langPrefix;if(o.params){if(s=(a=o.params.split(/\s+/g)).join(" "),has(i.rules.fence_custom,a[0]))return i.rules.fence_custom[a[0]](e,t,n,r,i);l=' class="'+c+escapeHtml(replaceEntities(unescapeMd(s)))+'"'}return"<pre><code"+l+">"+(n.highlight&&n.highlight.apply(n.highlight,[o.content].concat(a))||escapeHtml(o.content))+"</code></pre>"+getBreak(e,t)},rules.fence_custom={},rules.heading_open=function(e,t){return"<h"+e[t].hLevel+">"},rules.heading_close=function(e,t){return"</h"+e[t].hLevel+">\n"},rules.hr=function(e,t,n){return(n.xhtmlOut?"<hr />":"<hr>")+getBreak(e,t)},rules.bullet_list_open=function(){return"<ul>\n"},rules.bullet_list_close=function(e,t){return"</ul>"+getBreak(e,t)},rules.list_item_open=function(){return"<li>"},rules.list_item_close=function(){return"</li>\n"},rules.ordered_list_open=function(e,t){var n=e[t];return"<ol"+(n.order>1?' start="'+n.order+'"':"")+">\n"},rules.ordered_list_close=function(e,t){return"</ol>"+getBreak(e,t)},rules.paragraph_open=function(e,t){return e[t].tight?"":"<p>"},rules.paragraph_close=function(e,t){var n=!(e[t].tight&&t&&"inline"===e[t-1].type&&!e[t-1].content);return(e[t].tight?"":"</p>")+(n?getBreak(e,t):"")},rules.link_open=function(e,t,n){var r=e[t].title?' title="'+escapeHtml(replaceEntities(e[t].title))+'"':"",i=n.linkTarget?' target="'+n.linkTarget+'"':"";return'<a href="'+escapeHtml(e[t].href)+'"'+r+i+">"},rules.link_close=function(){return"</a>"},rules.image=function(e,t,n){var r=' src="'+escapeHtml(e[t].src)+'"',i=e[t].title?' title="'+escapeHtml(replaceEntities(e[t].title))+'"':"";return"<img"+r+(' alt="'+(e[t].alt?escapeHtml(replaceEntities(unescapeMd(e[t].alt))):"")+'"')+i+(n.xhtmlOut?" /":"")+">"},rules.table_open=function(){return"<table>\n"},rules.table_close=function(){return"</table>\n"},rules.thead_open=function(){return"<thead>\n"},rules.thead_close=function(){return"</thead>\n"},rules.tbody_open=function(){return"<tbody>\n"},rules.tbody_close=function(){return"</tbody>\n"},rules.tr_open=function(){return"<tr>"},rules.tr_close=function(){return"</tr>\n"},rules.th_open=function(e,t){var n=e[t];return"<th"+(n.align?' style="text-align:'+n.align+'"':"")+">"},rules.th_close=function(){return"</th>"},rules.td_open=function(e,t){var n=e[t];return"<td"+(n.align?' style="text-align:'+n.align+'"':"")+">"},rules.td_close=function(){return"</td>"},rules.strong_open=function(){return"<strong>"},rules.strong_close=function(){return"</strong>"},rules.em_open=function(){return"<em>"},rules.em_close=function(){return"</em>"},rules.del_open=function(){return"<del>"},rules.del_close=function(){return"</del>"},rules.ins_open=function(){return"<ins>"},rules.ins_close=function(){return"</ins>"},rules.mark_open=function(){return"<mark>"},rules.mark_close=function(){return"</mark>"},rules.sub=function(e,t){return"<sub>"+escapeHtml(e[t].content)+"</sub>"},rules.sup=function(e,t){return"<sup>"+escapeHtml(e[t].content)+"</sup>"},rules.hardbreak=function(e,t,n){return n.xhtmlOut?"<br />\n":"<br>\n"},rules.softbreak=function(e,t,n){return n.breaks?n.xhtmlOut?"<br />\n":"<br>\n":"\n"},rules.text=function(e,t){return escapeHtml(e[t].content)},rules.htmlblock=function(e,t){return e[t].content},rules.htmltag=function(e,t){return e[t].content},rules.abbr_open=function(e,t){return'<abbr title="'+escapeHtml(replaceEntities(e[t].title))+'">'},rules.abbr_close=function(){return"</abbr>"},rules.footnote_ref=function(e,t){var n=Number(e[t].id+1).toString(),r="fnref"+n;return e[t].subId>0&&(r+=":"+e[t].subId),'<sup class="footnote-ref"><a href="#fn'+n+'" id="'+r+'">['+n+"]</a></sup>"},rules.footnote_block_open=function(e,t,n){return(n.xhtmlOut?'<hr class="footnotes-sep" />\n':'<hr class="footnotes-sep">\n')+'<section class="footnotes">\n<ol class="footnotes-list">\n'},rules.footnote_block_close=function(){return"</ol>\n</section>\n"},rules.footnote_open=function(e,t){return'<li id="fn'+Number(e[t].id+1).toString()+'"  class="footnote-item">'},rules.footnote_close=function(){return"</li>\n"},rules.footnote_anchor=function(e,t){var n="fnref"+Number(e[t].id+1).toString();return e[t].subId>0&&(n+=":"+e[t].subId),' <a href="#'+n+'" class="footnote-backref">\u21a9</a>'},rules.dl_open=function(){return"<dl>\n"},rules.dt_open=function(){return"<dt>"},rules.dd_open=function(){return"<dd>"},rules.dl_close=function(){return"</dl>\n"},rules.dt_close=function(){return"</dt>\n"},rules.dd_close=function(){return"</dd>\n"};var getBreak=rules.getBreak=function(e,t){return(t=nextToken(e,t))<e.length&&"list_item_close"===e[t].type?"":"\n"};function Renderer(){this.rules=assign({},rules),this.getBreak=rules.getBreak}function Ruler(){this.__rules__=[],this.__cache__=null}function block(e){e.inlineMode?e.tokens.push({type:"inline",content:e.src.replace(/\n/g," ").trim(),level:0,lines:[0,1],children:[]}):e.block.parse(e.src,e.options,e.env,e.tokens)}function StateInline(e,t,n,r,i){this.src=e,this.env=r,this.options=n,this.parser=t,this.tokens=i,this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache=[],this.isInLabel=!1,this.linkLevel=0,this.linkContent="",this.labelUnmatchedScopes=0}function parseLinkLabel(e,t){var n,r,i,a=-1,s=e.posMax,o=e.pos,l=e.isInLabel;if(e.isInLabel)return-1;if(e.labelUnmatchedScopes)return e.labelUnmatchedScopes--,-1;for(e.pos=t+1,e.isInLabel=!0,n=1;e.pos<s;){if(91===(i=e.src.charCodeAt(e.pos)))n++;else if(93===i&&0===--n){r=!0;break}e.parser.skipToken(e)}return r?(a=e.pos,e.labelUnmatchedScopes=0):e.labelUnmatchedScopes=n-1,e.pos=o,e.isInLabel=l,a}function parseAbbr(e,t,n,r){var i,a,s,o,l,c;if(42!==e.charCodeAt(0)||91!==e.charCodeAt(1)||-1===e.indexOf("]:")||((a=parseLinkLabel(i=new StateInline(e,t,n,r,[]),1))<0||58!==e.charCodeAt(a+1)))return-1;for(o=i.posMax,s=a+2;s<o&&10!==i.src.charCodeAt(s);s++);return l=e.slice(2,a),0===(c=e.slice(a+2,s).trim()).length?-1:(r.abbreviations||(r.abbreviations={}),_typeof(r.abbreviations[":"+l])>"u"&&(r.abbreviations[":"+l]=c),s)}function abbr(e){var t,n,r,i,a=e.tokens;if(!e.inlineMode)for(t=1,n=a.length-1;t<n;t++)if("paragraph_open"===a[t-1].type&&"inline"===a[t].type&&"paragraph_close"===a[t+1].type){for(r=a[t].content;r.length&&!((i=parseAbbr(r,e.inline,e.options,e.env))<0);)r=r.slice(i).trim();a[t].content=r,r.length||(a[t-1].tight=!0,a[t+1].tight=!0)}}function normalizeLink(e){var t=replaceEntities(e);try{t=decodeURI(t)}catch(n){}return encodeURI(t)}function parseLinkDestination(e,t){var n,r,i,a=t,s=e.posMax;if(60===e.src.charCodeAt(t)){for(t++;t<s;){if(10===(n=e.src.charCodeAt(t)))return!1;if(62===n)return i=normalizeLink(unescapeMd(e.src.slice(a+1,t))),!!e.parser.validateLink(i)&&(e.pos=t+1,e.linkContent=i,!0);92===n&&t+1<s?t+=2:t++}return!1}for(r=0;t<s&&!(32===(n=e.src.charCodeAt(t))||n<32||127===n);)if(92===n&&t+1<s)t+=2;else{if(40===n&&++r>1||41===n&&--r<0)break;t++}return!(a===t||(i=unescapeMd(e.src.slice(a,t)),!e.parser.validateLink(i)))&&(e.linkContent=i,e.pos=t,!0)}function parseLinkTitle(e,t){var n,r=t,i=e.posMax,a=e.src.charCodeAt(t);if(34!==a&&39!==a&&40!==a)return!1;for(t++,40===a&&(a=41);t<i;){if((n=e.src.charCodeAt(t))===a)return e.pos=t+1,e.linkContent=unescapeMd(e.src.slice(r+1,t)),!0;92===n&&t+1<i?t+=2:t++}return!1}function normalizeReference(e){return e.trim().replace(/\s+/g," ").toUpperCase()}function parseReference(e,t,n,r){var i,a,s,o,l,c,u,d,p;if(91!==e.charCodeAt(0)||-1===e.indexOf("]:")||((a=parseLinkLabel(i=new StateInline(e,t,n,r,[]),0))<0||58!==e.charCodeAt(a+1)))return-1;for(o=i.posMax,s=a+2;s<o&&(32===(l=i.src.charCodeAt(s))||10===l);s++);if(!parseLinkDestination(i,s))return-1;for(u=i.linkContent,c=s=i.pos,s+=1;s<o&&(32===(l=i.src.charCodeAt(s))||10===l);s++);for(s<o&&c!==s&&parseLinkTitle(i,s)?(d=i.linkContent,s=i.pos):(d="",s=c);s<o&&32===i.src.charCodeAt(s);)s++;return s<o&&10!==i.src.charCodeAt(s)?-1:(p=normalizeReference(e.slice(1,a)),_typeof(r.references[p])>"u"&&(r.references[p]={title:d,href:u}),s)}function references(e){var t,n,r,i,a=e.tokens;if(e.env.references=e.env.references||{},!e.inlineMode)for(t=1,n=a.length-1;t<n;t++)if("inline"===a[t].type&&"paragraph_open"===a[t-1].type&&"paragraph_close"===a[t+1].type){for(r=a[t].content;r.length&&!((i=parseReference(r,e.inline,e.options,e.env))<0);)r=r.slice(i).trim();a[t].content=r,r.length||(a[t-1].tight=!0,a[t+1].tight=!0)}}function inline(e){var t,n,r,i=e.tokens;for(n=0,r=i.length;n<r;n++)"inline"===(t=i[n]).type&&e.inline.parse(t.content,e.options,e.env,t.children)}function footnote_block(e){var t,n,r,i,a,s,o,l,c,u=0,d=!1,p={};if(e.env.footnotes&&(e.tokens=e.tokens.filter((function(e){return"footnote_reference_open"===e.type?(d=!0,l=[],c=e.label,!1):"footnote_reference_close"===e.type?(d=!1,p[":"+c]=l,!1):(d&&l.push(e),!d)})),e.env.footnotes.list)){for(s=e.env.footnotes.list,e.tokens.push({type:"footnote_block_open",level:u++}),t=0,n=s.length;t<n;t++){for(e.tokens.push({type:"footnote_open",id:t,level:u++}),s[t].tokens?((o=[]).push({type:"paragraph_open",tight:!1,level:u++}),o.push({type:"inline",content:"",level:u,children:s[t].tokens}),o.push({type:"paragraph_close",tight:!1,level:--u})):s[t].label&&(o=p[":"+s[t].label]),e.tokens=e.tokens.concat(o),a="paragraph_close"===e.tokens[e.tokens.length-1].type?e.tokens.pop():null,i=s[t].count>0?s[t].count:1,r=0;r<i;r++)e.tokens.push({type:"footnote_anchor",id:t,subId:r,level:u});a&&e.tokens.push(a),e.tokens.push({type:"footnote_close",level:--u})}e.tokens.push({type:"footnote_block_close",level:--u})}}Renderer.prototype.renderInline=function(e,t,n){for(var r=this.rules,i=e.length,a=0,s="";i--;)s+=r[e[a].type](e,a++,t,n,this);return s},Renderer.prototype.render=function(e,t,n){for(var r=this.rules,i=e.length,a=-1,s="";++a<i;)"inline"===e[a].type?s+=this.renderInline(e[a].children,t,n):s+=r[e[a].type](e,a,t,n,this);return s},Ruler.prototype.__find__=function(e){for(var t=this.__rules__.length,n=-1;t--;)if(this.__rules__[++n].name===e)return n;return-1},Ruler.prototype.__compile__=function(){var e=this,t=[""];e.__rules__.forEach((function(e){e.enabled&&e.alt.forEach((function(e){t.indexOf(e)<0&&t.push(e)}))})),e.__cache__={},t.forEach((function(t){e.__cache__[t]=[],e.__rules__.forEach((function(n){n.enabled&&(t&&n.alt.indexOf(t)<0||e.__cache__[t].push(n.fn))}))}))},Ruler.prototype.at=function(e,t,n){var r=this.__find__(e),i=n||{};if(-1===r)throw new Error("Parser rule not found: "+e);this.__rules__[r].fn=t,this.__rules__[r].alt=i.alt||[],this.__cache__=null},Ruler.prototype.before=function(e,t,n,r){var i=this.__find__(e),a=r||{};if(-1===i)throw new Error("Parser rule not found: "+e);this.__rules__.splice(i,0,{name:t,enabled:!0,fn:n,alt:a.alt||[]}),this.__cache__=null},Ruler.prototype.after=function(e,t,n,r){var i=this.__find__(e),a=r||{};if(-1===i)throw new Error("Parser rule not found: "+e);this.__rules__.splice(i+1,0,{name:t,enabled:!0,fn:n,alt:a.alt||[]}),this.__cache__=null},Ruler.prototype.push=function(e,t,n){var r=n||{};this.__rules__.push({name:e,enabled:!0,fn:t,alt:r.alt||[]}),this.__cache__=null},Ruler.prototype.enable=function(e,t){e=Array.isArray(e)?e:[e],t&&this.__rules__.forEach((function(e){e.enabled=!1})),e.forEach((function(e){var t=this.__find__(e);if(t<0)throw new Error("Rules manager: invalid rule name "+e);this.__rules__[t].enabled=!0}),this),this.__cache__=null},Ruler.prototype.disable=function(e){(e=Array.isArray(e)?e:[e]).forEach((function(e){var t=this.__find__(e);if(t<0)throw new Error("Rules manager: invalid rule name "+e);this.__rules__[t].enabled=!1}),this),this.__cache__=null},Ruler.prototype.getRules=function(e){return null===this.__cache__&&this.__compile__(),this.__cache__[e]||[]},StateInline.prototype.pushPending=function(){this.tokens.push({type:"text",content:this.pending,level:this.pendingLevel}),this.pending=""},StateInline.prototype.push=function(e){this.pending&&this.pushPending(),this.tokens.push(e),this.pendingLevel=this.level},StateInline.prototype.cacheSet=function(e,t){for(var n=this.cache.length;n<=e;n++)this.cache.push(0);this.cache[e]=t},StateInline.prototype.cacheGet=function(e){return e<this.cache.length?this.cache[e]:0};var PUNCT_CHARS=" \n()[]'\".,!?-";function regEscape(e){return e.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1")}function abbr2(e){var t,n,r,i,a,s,o,l,c,u,d,p,h=e.tokens;if(e.env.abbreviations)for(e.env.abbrRegExp||(p="(^|["+PUNCT_CHARS.split("").map(regEscape).join("")+"])("+Object.keys(e.env.abbreviations).map((function(e){return e.substr(1)})).sort((function(e,t){return t.length-e.length})).map(regEscape).join("|")+")($|["+PUNCT_CHARS.split("").map(regEscape).join("")+"])",e.env.abbrRegExp=new RegExp(p,"g")),u=e.env.abbrRegExp,n=0,r=h.length;n<r;n++)if("inline"===h[n].type)for(t=(i=h[n].children).length-1;t>=0;t--)if("text"===(a=i[t]).type){for(l=0,s=a.content,u.lastIndex=0,c=a.level,o=[];d=u.exec(s);)u.lastIndex>l&&o.push({type:"text",content:s.slice(l,d.index+d[1].length),level:c}),o.push({type:"abbr_open",title:e.env.abbreviations[":"+d[2]],level:c++}),o.push({type:"text",content:d[2],level:c}),o.push({type:"abbr_close",level:--c}),l=u.lastIndex-d[3].length;o.length&&(l<s.length&&o.push({type:"text",content:s.slice(l),level:c}),h[n].children=i=[].concat(i.slice(0,t),o,i.slice(t+1)))}}var RARE_RE=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/,SCOPED_ABBR_RE=/\((c|tm|r|p)\)/gi,SCOPED_ABBR={c:"\xa9",r:"\xae",p:"\xa7",tm:"\u2122"};function replaceScopedAbbr(e){return e.indexOf("(")<0?e:e.replace(SCOPED_ABBR_RE,(function(e,t){return SCOPED_ABBR[t.toLowerCase()]}))}function replace(e){var t,n,r,i,a;if(e.options.typographer)for(a=e.tokens.length-1;a>=0;a--)if("inline"===e.tokens[a].type)for(t=(i=e.tokens[a].children).length-1;t>=0;t--)"text"===(n=i[t]).type&&(r=replaceScopedAbbr(r=n.content),RARE_RE.test(r)&&(r=r.replace(/\+-/g,"\xb1").replace(/\.{2,}/g,"\u2026").replace(/([?!])\u2026/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---([^-]|$)/gm,"$1\u2014$2").replace(/(^|\s)--(\s|$)/gm,"$1\u2013$2").replace(/(^|[^-\s])--([^-\s]|$)/gm,"$1\u2013$2")),n.content=r)}var QUOTE_TEST_RE=/['"]/,QUOTE_RE=/['"]/g,PUNCT_RE=/[-\s()\[\]]/,APOSTROPHE="\u2019";function isLetter(e,t){return!(t<0||t>=e.length)&&!PUNCT_RE.test(e[t])}function replaceAt(e,t,n){return e.substr(0,t)+n+e.substr(t+1)}function smartquotes(e){var t,n,r,i,a,s,o,l,c,u,d,p,h,f,m,v,g;if(e.options.typographer)for(g=[],m=e.tokens.length-1;m>=0;m--)if("inline"===e.tokens[m].type)for(v=e.tokens[m].children,g.length=0,t=0;t<v.length;t++)if("text"===(n=v[t]).type&&!QUOTE_TEST_RE.test(n.text)){for(o=v[t].level,h=g.length-1;h>=0&&!(g[h].level<=o);h--);g.length=h+1,a=0,s=(r=n.content).length;e:for(;a<s&&(QUOTE_RE.lastIndex=a,i=QUOTE_RE.exec(r),i);)if(l=!isLetter(r,i.index-1),a=i.index+1,f="'"===i[0],(c=!isLetter(r,a))||l){if(d=!c,p=!l)for(h=g.length-1;h>=0&&(u=g[h],!(g[h].level<o));h--)if(u.single===f&&g[h].level===o){u=g[h],f?(v[u.token].content=replaceAt(v[u.token].content,u.pos,e.options.quotes[2]),n.content=replaceAt(n.content,i.index,e.options.quotes[3])):(v[u.token].content=replaceAt(v[u.token].content,u.pos,e.options.quotes[0]),n.content=replaceAt(n.content,i.index,e.options.quotes[1])),g.length=h;continue e}d?g.push({token:t,pos:i.index,single:f,level:o}):p&&f&&(n.content=replaceAt(n.content,i.index,APOSTROPHE))}else f&&(n.content=replaceAt(n.content,i.index,APOSTROPHE))}}var _rules=[["block",block],["abbr",abbr],["references",references],["inline",inline],["footnote_tail",footnote_block],["abbr2",abbr2],["replacements",replace],["smartquotes",smartquotes]];function Core(){this.options={},this.ruler=new Ruler;for(var e=0;e<_rules.length;e++)this.ruler.push(_rules[e][0],_rules[e][1])}function StateBlock(e,t,n,r,i){var a,s,o,l,c,u,d;for(this.src=e,this.parser=t,this.options=n,this.env=r,this.tokens=i,this.bMarks=[],this.eMarks=[],this.tShift=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.parentType="root",this.ddIndent=-1,this.level=0,this.result="",u=0,d=!1,o=l=u=0,c=(s=this.src).length;l<c;l++){if(a=s.charCodeAt(l),!d){if(32===a){u++;continue}d=!0}(10===a||l===c-1)&&(10!==a&&l++,this.bMarks.push(o),this.eMarks.push(l),this.tShift.push(u),d=!1,u=0,o=l+1)}this.bMarks.push(s.length),this.eMarks.push(s.length),this.tShift.push(0),this.lineMax=this.bMarks.length-1}function code(e,t,n){var r,i;if(e.tShift[t]-e.blkIndent<4)return!1;for(i=r=t+1;r<n;)if(e.isEmpty(r))r++;else{if(!(e.tShift[r]-e.blkIndent>=4))break;i=++r}return e.line=r,e.tokens.push({type:"code",content:e.getLines(t,i,4+e.blkIndent,!0),block:!0,lines:[t,e.line],level:e.level}),!0}function fences(e,t,n,r){var i,a,s,o,l,c=!1,u=e.bMarks[t]+e.tShift[t],d=e.eMarks[t];if(u+3>d||126!==(i=e.src.charCodeAt(u))&&96!==i||(l=u,(a=(u=e.skipChars(u,i))-l)<3)||(s=e.src.slice(u,d).trim()).indexOf("`")>=0)return!1;if(r)return!0;for(o=t;!(++o>=n||(u=l=e.bMarks[o]+e.tShift[o],d=e.eMarks[o],u<d&&e.tShift[o]<e.blkIndent));)if(!(e.src.charCodeAt(u)!==i||e.tShift[o]-e.blkIndent>=4||(u=e.skipChars(u,i),u-l<a||(u=e.skipSpaces(u),u<d)))){c=!0;break}return a=e.tShift[t],e.line=o+(c?1:0),e.tokens.push({type:"fence",params:s,content:e.getLines(t+1,o,a,!0),lines:[t,e.line],level:e.level}),!0}function blockquote(e,t,n,r){var i,a,s,o,l,c,u,d,p,h,f,m=e.bMarks[t]+e.tShift[t],v=e.eMarks[t];if(m>v||62!==e.src.charCodeAt(m++)||e.level>=e.options.maxNesting)return!1;if(r)return!0;for(32===e.src.charCodeAt(m)&&m++,l=e.blkIndent,e.blkIndent=0,o=[e.bMarks[t]],e.bMarks[t]=m,a=(m=m<v?e.skipSpaces(m):m)>=v,s=[e.tShift[t]],e.tShift[t]=m-e.bMarks[t],d=e.parser.ruler.getRules("blockquote"),i=t+1;i<n&&!((m=e.bMarks[i]+e.tShift[i])>=(v=e.eMarks[i]));i++)if(62!==e.src.charCodeAt(m++)){if(a)break;for(f=!1,p=0,h=d.length;p<h;p++)if(d[p](e,i,n,!0)){f=!0;break}if(f)break;o.push(e.bMarks[i]),s.push(e.tShift[i]),e.tShift[i]=-1337}else 32===e.src.charCodeAt(m)&&m++,o.push(e.bMarks[i]),e.bMarks[i]=m,a=(m=m<v?e.skipSpaces(m):m)>=v,s.push(e.tShift[i]),e.tShift[i]=m-e.bMarks[i];for(c=e.parentType,e.parentType="blockquote",e.tokens.push({type:"blockquote_open",lines:u=[t,0],level:e.level++}),e.parser.tokenize(e,t,i),e.tokens.push({type:"blockquote_close",level:--e.level}),e.parentType=c,u[1]=e.line,p=0;p<s.length;p++)e.bMarks[p+t]=o[p],e.tShift[p+t]=s[p];return e.blkIndent=l,!0}function hr(e,t,n,r){var i,a,s,o=e.bMarks[t],l=e.eMarks[t];if((o+=e.tShift[t])>l||42!==(i=e.src.charCodeAt(o++))&&45!==i&&95!==i)return!1;for(a=1;o<l;){if((s=e.src.charCodeAt(o++))!==i&&32!==s)return!1;s===i&&a++}return!(a<3)&&(r||(e.line=t+1,e.tokens.push({type:"hr",lines:[t,e.line],level:e.level})),!0)}function skipBulletListMarker(e,t){var n,r,i;return(r=e.bMarks[t]+e.tShift[t])>=(i=e.eMarks[t])||42!==(n=e.src.charCodeAt(r++))&&45!==n&&43!==n||r<i&&32!==e.src.charCodeAt(r)?-1:r}function skipOrderedListMarker(e,t){var n,r=e.bMarks[t]+e.tShift[t],i=e.eMarks[t];if(r+1>=i||((n=e.src.charCodeAt(r++))<48||n>57))return-1;for(;;){if(r>=i)return-1;if(!((n=e.src.charCodeAt(r++))>=48&&n<=57)){if(41===n||46===n)break;return-1}}return r<i&&32!==e.src.charCodeAt(r)?-1:r}function markTightParagraphs(e,t){var n,r,i=e.level+2;for(n=t+2,r=e.tokens.length-2;n<r;n++)e.tokens[n].level===i&&"paragraph_open"===e.tokens[n].type&&(e.tokens[n+2].tight=!0,e.tokens[n].tight=!0,n+=2)}function list(e,t,n,r){var i,a,s,o,l,c,u,d,p,h,f,m,v,g,y,_,b,k,C,S,x,w=!0;if((d=skipOrderedListMarker(e,t))>=0)m=!0;else{if(!((d=skipBulletListMarker(e,t))>=0))return!1;m=!1}if(e.level>=e.options.maxNesting)return!1;if(f=e.src.charCodeAt(d-1),r)return!0;for(g=e.tokens.length,m?(u=e.bMarks[t]+e.tShift[t],h=Number(e.src.substr(u,d-u-1)),e.tokens.push({type:"ordered_list_open",order:h,lines:_=[t,0],level:e.level++})):e.tokens.push({type:"bullet_list_open",lines:_=[t,0],level:e.level++}),i=t,y=!1,k=e.parser.ruler.getRules("list");i<n&&((p=(v=e.skipSpaces(d))>=e.eMarks[i]?1:v-d)>4&&(p=1),p<1&&(p=1),a=d-e.bMarks[i]+p,e.tokens.push({type:"list_item_open",lines:b=[t,0],level:e.level++}),o=e.blkIndent,l=e.tight,s=e.tShift[t],c=e.parentType,e.tShift[t]=v-e.bMarks[t],e.blkIndent=a,e.tight=!0,e.parentType="list",e.parser.tokenize(e,t,n,!0),(!e.tight||y)&&(w=!1),y=e.line-t>1&&e.isEmpty(e.line-1),e.blkIndent=o,e.tShift[t]=s,e.tight=l,e.parentType=c,e.tokens.push({type:"list_item_close",level:--e.level}),i=t=e.line,b[1]=i,v=e.bMarks[t],!(i>=n||e.isEmpty(i)||e.tShift[i]<e.blkIndent));){for(x=!1,C=0,S=k.length;C<S;C++)if(k[C](e,i,n,!0)){x=!0;break}if(x)break;if(m){if((d=skipOrderedListMarker(e,i))<0)break}else if((d=skipBulletListMarker(e,i))<0)break;if(f!==e.src.charCodeAt(d-1))break}return e.tokens.push({type:m?"ordered_list_close":"bullet_list_close",level:--e.level}),_[1]=i,e.line=i,w&&markTightParagraphs(e,g),!0}function footnote(e,t,n,r){var i,a,s,o,l,c=e.bMarks[t]+e.tShift[t],u=e.eMarks[t];if(c+4>u||91!==e.src.charCodeAt(c)||94!==e.src.charCodeAt(c+1)||e.level>=e.options.maxNesting)return!1;for(o=c+2;o<u;o++){if(32===e.src.charCodeAt(o))return!1;if(93===e.src.charCodeAt(o))break}return!(o===c+2||o+1>=u||58!==e.src.charCodeAt(++o))&&(r||(o++,e.env.footnotes||(e.env.footnotes={}),e.env.footnotes.refs||(e.env.footnotes.refs={}),l=e.src.slice(c+2,o-2),e.env.footnotes.refs[":"+l]=-1,e.tokens.push({type:"footnote_reference_open",label:l,level:e.level++}),i=e.bMarks[t],a=e.tShift[t],s=e.parentType,e.tShift[t]=e.skipSpaces(o)-o,e.bMarks[t]=o,e.blkIndent+=4,e.parentType="footnote",e.tShift[t]<e.blkIndent&&(e.tShift[t]+=e.blkIndent,e.bMarks[t]-=e.blkIndent),e.parser.tokenize(e,t,n,!0),e.parentType=s,e.blkIndent-=4,e.tShift[t]=a,e.bMarks[t]=i,e.tokens.push({type:"footnote_reference_close",level:--e.level})),!0)}function heading(e,t,n,r){var i,a,s,o=e.bMarks[t]+e.tShift[t],l=e.eMarks[t];if(o>=l||(35!==(i=e.src.charCodeAt(o))||o>=l))return!1;for(a=1,i=e.src.charCodeAt(++o);35===i&&o<l&&a<=6;)a++,i=e.src.charCodeAt(++o);return!(a>6||o<l&&32!==i)&&(r||(l=e.skipCharsBack(l,32,o),(s=e.skipCharsBack(l,35,o))>o&&32===e.src.charCodeAt(s-1)&&(l=s),e.line=t+1,e.tokens.push({type:"heading_open",hLevel:a,lines:[t,e.line],level:e.level}),o<l&&e.tokens.push({type:"inline",content:e.src.slice(o,l).trim(),level:e.level+1,lines:[t,e.line],children:[]}),e.tokens.push({type:"heading_close",hLevel:a,level:e.level})),!0)}function lheading(e,t,n){var r,i,a,s=t+1;return!(s>=n||e.tShift[s]<e.blkIndent||e.tShift[s]-e.blkIndent>3||(i=e.bMarks[s]+e.tShift[s],a=e.eMarks[s],i>=a)||(r=e.src.charCodeAt(i),45!==r&&61!==r)||(i=e.skipChars(i,r),i=e.skipSpaces(i),i<a))&&(i=e.bMarks[t]+e.tShift[t],e.line=s+1,e.tokens.push({type:"heading_open",hLevel:61===r?1:2,lines:[t,e.line],level:e.level}),e.tokens.push({type:"inline",content:e.src.slice(i,e.eMarks[t]).trim(),level:e.level+1,lines:[t,e.line-1],children:[]}),e.tokens.push({type:"heading_close",hLevel:61===r?1:2,level:e.level}),!0)}Core.prototype.process=function(e){var t,n,r;for(t=0,n=(r=this.ruler.getRules("")).length;t<n;t++)r[t](e)},StateBlock.prototype.isEmpty=function(e){return this.bMarks[e]+this.tShift[e]>=this.eMarks[e]},StateBlock.prototype.skipEmptyLines=function(e){for(var t=this.lineMax;e<t&&!(this.bMarks[e]+this.tShift[e]<this.eMarks[e]);e++);return e},StateBlock.prototype.skipSpaces=function(e){for(var t=this.src.length;e<t&&32===this.src.charCodeAt(e);e++);return e},StateBlock.prototype.skipChars=function(e,t){for(var n=this.src.length;e<n&&this.src.charCodeAt(e)===t;e++);return e},StateBlock.prototype.skipCharsBack=function(e,t,n){if(e<=n)return e;for(;e>n;)if(t!==this.src.charCodeAt(--e))return e+1;return e},StateBlock.prototype.getLines=function(e,t,n,r){var i,a,s,o,l,c=e;if(e>=t)return"";if(c+1===t)return a=this.bMarks[c]+Math.min(this.tShift[c],n),s=r?this.eMarks[c]+1:this.eMarks[c],this.src.slice(a,s);for(o=new Array(t-e),i=0;c<t;c++,i++)(l=this.tShift[c])>n&&(l=n),l<0&&(l=0),a=this.bMarks[c]+l,s=c+1<t||r?this.eMarks[c]+1:this.eMarks[c],o[i]=this.src.slice(a,s);return o.join("")};var html_blocks={};["article","aside","button","blockquote","body","canvas","caption","col","colgroup","dd","div","dl","dt","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","iframe","li","map","object","ol","output","p","pre","progress","script","section","style","table","tbody","td","textarea","tfoot","th","tr","thead","ul","video"].forEach((function(e){html_blocks[e]=!0}));var HTML_TAG_OPEN_RE=/^<([a-zA-Z]{1,15})[\s\/>]/,HTML_TAG_CLOSE_RE=/^<\/([a-zA-Z]{1,15})[\s>]/;function isLetter$1(e){var t=32|e;return t>=97&&t<=122}function htmlblock(e,t,n,r){var i,a,s,o=e.bMarks[t],l=e.eMarks[t],c=e.tShift[t];if(o+=c,!e.options.html||c>3||o+2>=l||60!==e.src.charCodeAt(o))return!1;if(33===(i=e.src.charCodeAt(o+1))||63===i){if(r)return!0}else{if(47!==i&&!isLetter$1(i))return!1;if(47===i){if(!(a=e.src.slice(o,l).match(HTML_TAG_CLOSE_RE)))return!1}else if(!(a=e.src.slice(o,l).match(HTML_TAG_OPEN_RE)))return!1;if(!0!==html_blocks[a[1].toLowerCase()])return!1;if(r)return!0}for(s=t+1;s<e.lineMax&&!e.isEmpty(s);)s++;return e.line=s,e.tokens.push({type:"htmlblock",level:e.level,lines:[t,e.line],content:e.getLines(t,s,0,!0)}),!0}function getLine(e,t){var n=e.bMarks[t]+e.blkIndent,r=e.eMarks[t];return e.src.substr(n,r-n)}function table(e,t,n,r){var i,a,s,o,l,c,u,d,p,h,f;if(t+2>n||(l=t+1,e.tShift[l]<e.blkIndent)||(s=e.bMarks[l]+e.tShift[l])>=e.eMarks[l]||124!==(i=e.src.charCodeAt(s))&&45!==i&&58!==i||(a=getLine(e,t+1),!/^[-:| ]+$/.test(a))||(c=a.split("|"))<=2)return!1;for(d=[],o=0;o<c.length;o++){if(!(p=c[o].trim())){if(0===o||o===c.length-1)continue;return!1}if(!/^:?-+:?$/.test(p))return!1;58===p.charCodeAt(p.length-1)?d.push(58===p.charCodeAt(0)?"center":"right"):58===p.charCodeAt(0)?d.push("left"):d.push("")}if(-1===(a=getLine(e,t).trim()).indexOf("|")||(c=a.replace(/^\||\|$/g,"").split("|"),d.length!==c.length))return!1;if(r)return!0;for(e.tokens.push({type:"table_open",lines:h=[t,0],level:e.level++}),e.tokens.push({type:"thead_open",lines:[t,t+1],level:e.level++}),e.tokens.push({type:"tr_open",lines:[t,t+1],level:e.level++}),o=0;o<c.length;o++)e.tokens.push({type:"th_open",align:d[o],lines:[t,t+1],level:e.level++}),e.tokens.push({type:"inline",content:c[o].trim(),lines:[t,t+1],level:e.level,children:[]}),e.tokens.push({type:"th_close",level:--e.level});for(e.tokens.push({type:"tr_close",level:--e.level}),e.tokens.push({type:"thead_close",level:--e.level}),e.tokens.push({type:"tbody_open",lines:f=[t+2,0],level:e.level++}),l=t+2;l<n&&!(e.tShift[l]<e.blkIndent||(a=getLine(e,l).trim(),-1===a.indexOf("|")));l++){for(c=a.replace(/^\||\|$/g,"").split("|"),e.tokens.push({type:"tr_open",level:e.level++}),o=0;o<c.length;o++)e.tokens.push({type:"td_open",align:d[o],level:e.level++}),u=c[o].substring(124===c[o].charCodeAt(0)?1:0,124===c[o].charCodeAt(c[o].length-1)?c[o].length-1:c[o].length).trim(),e.tokens.push({type:"inline",content:u,level:e.level,children:[]}),e.tokens.push({type:"td_close",level:--e.level});e.tokens.push({type:"tr_close",level:--e.level})}return e.tokens.push({type:"tbody_close",level:--e.level}),e.tokens.push({type:"table_close",level:--e.level}),h[1]=f[1]=l,e.line=l,!0}function skipMarker(e,t){var n,r,i=e.bMarks[t]+e.tShift[t],a=e.eMarks[t];return i>=a||126!==(r=e.src.charCodeAt(i++))&&58!==r||i===(n=e.skipSpaces(i))||n>=a?-1:n}function markTightParagraphs$1(e,t){var n,r,i=e.level+2;for(n=t+2,r=e.tokens.length-2;n<r;n++)e.tokens[n].level===i&&"paragraph_open"===e.tokens[n].type&&(e.tokens[n+2].tight=!0,e.tokens[n].tight=!0,n+=2)}function deflist(e,t,n,r){var i,a,s,o,l,c,u,d,p,h,f,m,v,g;if(r)return!(e.ddIndent<0)&&skipMarker(e,t)>=0;if(u=t+1,e.isEmpty(u)&&++u>n||e.tShift[u]<e.blkIndent||(i=skipMarker(e,u))<0||e.level>=e.options.maxNesting)return!1;c=e.tokens.length,e.tokens.push({type:"dl_open",lines:l=[t,0],level:e.level++}),s=t,a=u;e:for(;;){for(g=!0,v=!1,e.tokens.push({type:"dt_open",lines:[s,s],level:e.level++}),e.tokens.push({type:"inline",content:e.getLines(s,s+1,e.blkIndent,!1).trim(),level:e.level+1,lines:[s,s],children:[]}),e.tokens.push({type:"dt_close",level:--e.level});;){if(e.tokens.push({type:"dd_open",lines:o=[u,0],level:e.level++}),m=e.tight,p=e.ddIndent,d=e.blkIndent,f=e.tShift[a],h=e.parentType,e.blkIndent=e.ddIndent=e.tShift[a]+2,e.tShift[a]=i-e.bMarks[a],e.tight=!0,e.parentType="deflist",e.parser.tokenize(e,a,n,!0),(!e.tight||v)&&(g=!1),v=e.line-a>1&&e.isEmpty(e.line-1),e.tShift[a]=f,e.tight=m,e.parentType=h,e.blkIndent=d,e.ddIndent=p,e.tokens.push({type:"dd_close",level:--e.level}),o[1]=u=e.line,u>=n||e.tShift[u]<e.blkIndent)break e;if((i=skipMarker(e,u))<0)break;a=u}if(u>=n||(s=u,e.isEmpty(s))||e.tShift[s]<e.blkIndent||(a=s+1)>=n||(e.isEmpty(a)&&a++,a>=n)||e.tShift[a]<e.blkIndent||(i=skipMarker(e,a))<0)break}return e.tokens.push({type:"dl_close",level:--e.level}),l[1]=u,e.line=u,g&&markTightParagraphs$1(e,c),!0}function paragraph(e,t){var n,r,i,a,s,o,l=t+1;if(l<(n=e.lineMax)&&!e.isEmpty(l))for(o=e.parser.ruler.getRules("paragraph");l<n&&!e.isEmpty(l);l++)if(!(e.tShift[l]-e.blkIndent>3)){for(i=!1,a=0,s=o.length;a<s;a++)if(o[a](e,l,n,!0)){i=!0;break}if(i)break}return r=e.getLines(t,l,e.blkIndent,!1).trim(),e.line=l,r.length&&(e.tokens.push({type:"paragraph_open",tight:!1,lines:[t,e.line],level:e.level}),e.tokens.push({type:"inline",content:r,level:e.level+1,lines:[t,e.line],children:[]}),e.tokens.push({type:"paragraph_close",tight:!1,level:e.level})),!0}var _rules$1=[["code",code],["fences",fences,["paragraph","blockquote","list"]],["blockquote",blockquote,["paragraph","blockquote","list"]],["hr",hr,["paragraph","blockquote","list"]],["list",list,["paragraph","blockquote"]],["footnote",footnote,["paragraph"]],["heading",heading,["paragraph","blockquote"]],["lheading",lheading],["htmlblock",htmlblock,["paragraph","blockquote"]],["table",table,["paragraph"]],["deflist",deflist,["paragraph"]],["paragraph",paragraph]];function ParserBlock(){this.ruler=new Ruler;for(var e=0;e<_rules$1.length;e++)this.ruler.push(_rules$1[e][0],_rules$1[e][1],{alt:(_rules$1[e][2]||[]).slice()})}ParserBlock.prototype.tokenize=function(e,t,n){for(var r,i=this.ruler.getRules(""),a=i.length,s=t,o=!1;s<n&&(e.line=s=e.skipEmptyLines(s),!(s>=n||e.tShift[s]<e.blkIndent));){for(r=0;r<a&&!i[r](e,s,n,!1);r++);if(e.tight=!o,e.isEmpty(e.line-1)&&(o=!0),(s=e.line)<n&&e.isEmpty(s)){if(o=!0,++s<n&&"list"===e.parentType&&e.isEmpty(s))break;e.line=s}}};var TABS_SCAN_RE=/[\n\t]/g,NEWLINES_RE=/\r[\n\u0085]|[\u2424\u2028\u0085]/g,SPACES_RE=/\u00a0/g;function isTerminatorChar(e){switch(e){case 10:case 92:case 96:case 42:case 95:case 94:case 91:case 93:case 33:case 38:case 60:case 62:case 123:case 125:case 36:case 37:case 64:case 126:case 43:case 61:case 58:return!0;default:return!1}}function text$1(e,t){for(var n=e.pos;n<e.posMax&&!isTerminatorChar(e.src.charCodeAt(n));)n++;return n!==e.pos&&(t||(e.pending+=e.src.slice(e.pos,n)),e.pos=n,!0)}function newline(e,t){var n,r,i=e.pos;if(10!==e.src.charCodeAt(i))return!1;if(n=e.pending.length-1,r=e.posMax,!t)if(n>=0&&32===e.pending.charCodeAt(n))if(n>=1&&32===e.pending.charCodeAt(n-1)){for(var a=n-2;a>=0;a--)if(32!==e.pending.charCodeAt(a)){e.pending=e.pending.substring(0,a+1);break}e.push({type:"hardbreak",level:e.level})}else e.pending=e.pending.slice(0,-1),e.push({type:"softbreak",level:e.level});else e.push({type:"softbreak",level:e.level});for(i++;i<r&&32===e.src.charCodeAt(i);)i++;return e.pos=i,!0}ParserBlock.prototype.parse=function(e,t,n,r){var i,a=0,s=0;if(!e)return[];(e=(e=e.replace(SPACES_RE," ")).replace(NEWLINES_RE,"\n")).indexOf("\t")>=0&&(e=e.replace(TABS_SCAN_RE,(function(t,n){var r;return 10===e.charCodeAt(n)?(a=n+1,s=0,t):(r="    ".slice((n-a-s)%4),s=n-a+1,r)}))),i=new StateBlock(e,this,t,n,r),this.tokenize(i,i.line,i.lineMax)};for(var ESCAPED=[],i=0;i<256;i++)ESCAPED.push(0);function escape(e,t){var n,r=e.pos,i=e.posMax;if(92!==e.src.charCodeAt(r))return!1;if(++r<i){if((n=e.src.charCodeAt(r))<256&&0!==ESCAPED[n])return t||(e.pending+=e.src[r]),e.pos+=2,!0;if(10===n){for(t||e.push({type:"hardbreak",level:e.level}),r++;r<i&&32===e.src.charCodeAt(r);)r++;return e.pos=r,!0}}return t||(e.pending+="\\"),e.pos++,!0}function backticks(e,t){var n,r,i,a,s,o=e.pos;if(96!==e.src.charCodeAt(o))return!1;for(n=o,o++,r=e.posMax;o<r&&96===e.src.charCodeAt(o);)o++;for(i=e.src.slice(n,o),a=s=o;-1!==(a=e.src.indexOf("`",s));){for(s=a+1;s<r&&96===e.src.charCodeAt(s);)s++;if(s-a===i.length)return t||e.push({type:"code",content:e.src.slice(o,a).replace(/[ \n]+/g," ").trim(),block:!1,level:e.level}),e.pos=s,!0}return t||(e.pending+=i),e.pos+=i.length,!0}function del(e,t){var n,r,i,a,s,o=e.posMax,l=e.pos;if(126!==e.src.charCodeAt(l)||t||l+4>=o||126!==e.src.charCodeAt(l+1)||e.level>=e.options.maxNesting||(a=l>0?e.src.charCodeAt(l-1):-1,s=e.src.charCodeAt(l+2),126===a)||126===s||32===s||10===s)return!1;for(r=l+2;r<o&&126===e.src.charCodeAt(r);)r++;if(r>l+3)return e.pos+=r-l,t||(e.pending+=e.src.slice(l,r)),!0;for(e.pos=l+2,i=1;e.pos+1<o;){if(126===e.src.charCodeAt(e.pos)&&126===e.src.charCodeAt(e.pos+1)&&(a=e.src.charCodeAt(e.pos-1),126!==(s=e.pos+2<o?e.src.charCodeAt(e.pos+2):-1)&&126!==a&&(32!==a&&10!==a?i--:32!==s&&10!==s&&i++,i<=0))){n=!0;break}e.parser.skipToken(e)}return n?(e.posMax=e.pos,e.pos=l+2,t||(e.push({type:"del_open",level:e.level++}),e.parser.tokenize(e),e.push({type:"del_close",level:--e.level})),e.pos=e.posMax+2,e.posMax=o,!0):(e.pos=l,!1)}function ins(e,t){var n,r,i,a,s,o=e.posMax,l=e.pos;if(43!==e.src.charCodeAt(l)||t||l+4>=o||43!==e.src.charCodeAt(l+1)||e.level>=e.options.maxNesting||(a=l>0?e.src.charCodeAt(l-1):-1,s=e.src.charCodeAt(l+2),43===a)||43===s||32===s||10===s)return!1;for(r=l+2;r<o&&43===e.src.charCodeAt(r);)r++;if(r!==l+2)return e.pos+=r-l,t||(e.pending+=e.src.slice(l,r)),!0;for(e.pos=l+2,i=1;e.pos+1<o;){if(43===e.src.charCodeAt(e.pos)&&43===e.src.charCodeAt(e.pos+1)&&(a=e.src.charCodeAt(e.pos-1),43!==(s=e.pos+2<o?e.src.charCodeAt(e.pos+2):-1)&&43!==a&&(32!==a&&10!==a?i--:32!==s&&10!==s&&i++,i<=0))){n=!0;break}e.parser.skipToken(e)}return n?(e.posMax=e.pos,e.pos=l+2,t||(e.push({type:"ins_open",level:e.level++}),e.parser.tokenize(e),e.push({type:"ins_close",level:--e.level})),e.pos=e.posMax+2,e.posMax=o,!0):(e.pos=l,!1)}function mark(e,t){var n,r,i,a,s,o=e.posMax,l=e.pos;if(61!==e.src.charCodeAt(l)||t||l+4>=o||61!==e.src.charCodeAt(l+1)||e.level>=e.options.maxNesting||(a=l>0?e.src.charCodeAt(l-1):-1,s=e.src.charCodeAt(l+2),61===a)||61===s||32===s||10===s)return!1;for(r=l+2;r<o&&61===e.src.charCodeAt(r);)r++;if(r!==l+2)return e.pos+=r-l,t||(e.pending+=e.src.slice(l,r)),!0;for(e.pos=l+2,i=1;e.pos+1<o;){if(61===e.src.charCodeAt(e.pos)&&61===e.src.charCodeAt(e.pos+1)&&(a=e.src.charCodeAt(e.pos-1),61!==(s=e.pos+2<o?e.src.charCodeAt(e.pos+2):-1)&&61!==a&&(32!==a&&10!==a?i--:32!==s&&10!==s&&i++,i<=0))){n=!0;break}e.parser.skipToken(e)}return n?(e.posMax=e.pos,e.pos=l+2,t||(e.push({type:"mark_open",level:e.level++}),e.parser.tokenize(e),e.push({type:"mark_close",level:--e.level})),e.pos=e.posMax+2,e.posMax=o,!0):(e.pos=l,!1)}function isAlphaNum(e){return e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122}function scanDelims(e,t){var n,r,i,a=t,s=!0,o=!0,l=e.posMax,c=e.src.charCodeAt(t);for(n=t>0?e.src.charCodeAt(t-1):-1;a<l&&e.src.charCodeAt(a)===c;)a++;return a>=l&&(s=!1),(i=a-t)>=4?s=o=!1:((32===(r=a<l?e.src.charCodeAt(a):-1)||10===r)&&(s=!1),(32===n||10===n)&&(o=!1),95===c&&(isAlphaNum(n)&&(s=!1),isAlphaNum(r)&&(o=!1))),{can_open:s,can_close:o,delims:i}}function emphasis(e,t){var n,r,i,a,s,o,l,c=e.posMax,u=e.pos,d=e.src.charCodeAt(u);if(95!==d&&42!==d||t)return!1;if(n=(l=scanDelims(e,u)).delims,!l.can_open)return e.pos+=n,t||(e.pending+=e.src.slice(u,e.pos)),!0;if(e.level>=e.options.maxNesting)return!1;for(e.pos=u+n,o=[n];e.pos<c;)if(e.src.charCodeAt(e.pos)!==d)e.parser.skipToken(e);else{if(r=(l=scanDelims(e,e.pos)).delims,l.can_close){for(a=o.pop(),s=r;a!==s;){if(s<a){o.push(a-s);break}if(s-=a,0===o.length)break;e.pos+=a,a=o.pop()}if(0===o.length){n=a,i=!0;break}e.pos+=r;continue}l.can_open&&o.push(r),e.pos+=r}return i?(e.posMax=e.pos,e.pos=u+n,t||((2===n||3===n)&&e.push({type:"strong_open",level:e.level++}),(1===n||3===n)&&e.push({type:"em_open",level:e.level++}),e.parser.tokenize(e),(1===n||3===n)&&e.push({type:"em_close",level:--e.level}),(2===n||3===n)&&e.push({type:"strong_close",level:--e.level})),e.pos=e.posMax+n,e.posMax=c,!0):(e.pos=u,!1)}"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach((function(e){ESCAPED[e.charCodeAt(0)]=1}));var UNESCAPE_RE=/\\([ \\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;function sub(e,t){var n,r,i=e.posMax,a=e.pos;if(126!==e.src.charCodeAt(a)||t||a+2>=i||e.level>=e.options.maxNesting)return!1;for(e.pos=a+1;e.pos<i;){if(126===e.src.charCodeAt(e.pos)){n=!0;break}e.parser.skipToken(e)}return!n||a+1===e.pos||(r=e.src.slice(a+1,e.pos)).match(/(^|[^\\])(\\\\)*\s/)?(e.pos=a,!1):(e.posMax=e.pos,e.pos=a+1,t||e.push({type:"sub",level:e.level,content:r.replace(UNESCAPE_RE,"$1")}),e.pos=e.posMax+1,e.posMax=i,!0)}var UNESCAPE_RE$1=/\\([ \\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;function sup(e,t){var n,r,i=e.posMax,a=e.pos;if(94!==e.src.charCodeAt(a)||t||a+2>=i||e.level>=e.options.maxNesting)return!1;for(e.pos=a+1;e.pos<i;){if(94===e.src.charCodeAt(e.pos)){n=!0;break}e.parser.skipToken(e)}return!n||a+1===e.pos||(r=e.src.slice(a+1,e.pos)).match(/(^|[^\\])(\\\\)*\s/)?(e.pos=a,!1):(e.posMax=e.pos,e.pos=a+1,t||e.push({type:"sup",level:e.level,content:r.replace(UNESCAPE_RE$1,"$1")}),e.pos=e.posMax+1,e.posMax=i,!0)}function links(e,t){var n,r,i,a,s,o,l,c,u=!1,d=e.pos,p=e.posMax,h=e.pos,f=e.src.charCodeAt(h);if(33===f&&(u=!0,f=e.src.charCodeAt(++h)),91!==f||e.level>=e.options.maxNesting||(n=h+1,(r=parseLinkLabel(e,h))<0))return!1;if((o=r+1)<p&&40===e.src.charCodeAt(o)){for(o++;o<p&&(32===(c=e.src.charCodeAt(o))||10===c);o++);if(o>=p)return!1;for(h=o,parseLinkDestination(e,o)?(a=e.linkContent,o=e.pos):a="",h=o;o<p&&(32===(c=e.src.charCodeAt(o))||10===c);o++);if(o<p&&h!==o&&parseLinkTitle(e,o))for(s=e.linkContent,o=e.pos;o<p&&(32===(c=e.src.charCodeAt(o))||10===c);o++);else s="";if(o>=p||41!==e.src.charCodeAt(o))return e.pos=d,!1;o++}else{if(e.linkLevel>0)return!1;for(;o<p&&(32===(c=e.src.charCodeAt(o))||10===c);o++);if(o<p&&91===e.src.charCodeAt(o)&&(h=o+1,(o=parseLinkLabel(e,o))>=0?i=e.src.slice(h,o++):o=h-1),i||(_typeof(i)>"u"&&(o=r+1),i=e.src.slice(n,r)),!(l=e.env.references[normalizeReference(i)]))return e.pos=d,!1;a=l.href,s=l.title}return t||(e.pos=n,e.posMax=r,u?e.push({type:"image",src:a,title:s,alt:e.src.substr(n,r-n),level:e.level}):(e.push({type:"link_open",href:a,title:s,level:e.level++}),e.linkLevel++,e.parser.tokenize(e),e.linkLevel--,e.push({type:"link_close",level:--e.level}))),e.pos=o,e.posMax=p,!0}function footnote_inline(e,t){var n,r,i,a,s=e.posMax,o=e.pos;return!(o+2>=s||94!==e.src.charCodeAt(o)||91!==e.src.charCodeAt(o+1)||e.level>=e.options.maxNesting||(n=o+2,r=parseLinkLabel(e,o+1),r<0))&&(t||(e.env.footnotes||(e.env.footnotes={}),e.env.footnotes.list||(e.env.footnotes.list=[]),i=e.env.footnotes.list.length,e.pos=n,e.posMax=r,e.push({type:"footnote_ref",id:i,level:e.level}),e.linkLevel++,a=e.tokens.length,e.parser.tokenize(e),e.env.footnotes.list[i]={tokens:e.tokens.splice(a)},e.linkLevel--),e.pos=r+1,e.posMax=s,!0)}function footnote_ref(e,t){var n,r,i,a,s=e.posMax,o=e.pos;if(o+3>s||!e.env.footnotes||!e.env.footnotes.refs||91!==e.src.charCodeAt(o)||94!==e.src.charCodeAt(o+1)||e.level>=e.options.maxNesting)return!1;for(r=o+2;r<s;r++){if(32===e.src.charCodeAt(r)||10===e.src.charCodeAt(r))return!1;if(93===e.src.charCodeAt(r))break}return!(r===o+2||r>=s||(r++,n=e.src.slice(o+2,r-1),_typeof(e.env.footnotes.refs[":"+n])>"u"))&&(t||(e.env.footnotes.list||(e.env.footnotes.list=[]),e.env.footnotes.refs[":"+n]<0?(i=e.env.footnotes.list.length,e.env.footnotes.list[i]={label:n,count:0},e.env.footnotes.refs[":"+n]=i):i=e.env.footnotes.refs[":"+n],a=e.env.footnotes.list[i].count,e.env.footnotes.list[i].count++,e.push({type:"footnote_ref",id:i,subId:a,level:e.level})),e.pos=r,e.posMax=s,!0)}var url_schemas=["coap","doi","javascript","aaa","aaas","about","acap","cap","cid","crid","data","dav","dict","dns","file","ftp","geo","go","gopher","h323","http","https","iax","icap","im","imap","info","ipp","iris","iris.beep","iris.xpc","iris.xpcs","iris.lwz","ldap","mailto","mid","msrp","msrps","mtqp","mupdate","news","nfs","ni","nih","nntp","opaquelocktoken","pop","pres","rtsp","service","session","shttp","sieve","sip","sips","sms","snmp","soap.beep","soap.beeps","tag","tel","telnet","tftp","thismessage","tn3270","tip","tv","urn","vemmi","ws","wss","xcon","xcon-userid","xmlrpc.beep","xmlrpc.beeps","xmpp","z39.50r","z39.50s","adiumxtra","afp","afs","aim","apt","attachment","aw","beshare","bitcoin","bolo","callto","chrome","chrome-extension","com-eventbrite-attendee","content","cvs","dlna-playsingle","dlna-playcontainer","dtn","dvb","ed2k","facetime","feed","finger","fish","gg","git","gizmoproject","gtalk","hcp","icon","ipn","irc","irc6","ircs","itms","jar","jms","keyparc","lastfm","ldaps","magnet","maps","market","message","mms","ms-help","msnim","mumble","mvn","notes","oid","palm","paparazzi","platform","proxy","psyc","query","res","resource","rmi","rsync","rtmp","secondlife","sftp","sgn","skype","smb","soldat","spotify","ssh","steam","svn","teamspeak","things","udp","unreal","ut2004","ventrilo","view-source","webcal","wtai","wyciwyg","xfire","xri","ymsgr"],EMAIL_RE=/^<([a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)>/,AUTOLINK_RE=/^<([a-zA-Z.\-]{1,25}):([^<>\x00-\x20]*)>/;function autolink(e,t){var n,r,i,a,s,o=e.pos;return!(60!==e.src.charCodeAt(o)||(n=e.src.slice(o),n.indexOf(">")<0))&&((r=n.match(AUTOLINK_RE))?!(url_schemas.indexOf(r[1].toLowerCase())<0||(a=r[0].slice(1,-1),s=normalizeLink(a),!e.parser.validateLink(a)))&&(t||(e.push({type:"link_open",href:s,level:e.level}),e.push({type:"text",content:a,level:e.level+1}),e.push({type:"link_close",level:e.level})),e.pos+=r[0].length,!0):!!(i=n.match(EMAIL_RE))&&(s=normalizeLink("mailto:"+(a=i[0].slice(1,-1))),!!e.parser.validateLink(s)&&(t||(e.push({type:"link_open",href:s,level:e.level}),e.push({type:"text",content:a,level:e.level+1}),e.push({type:"link_close",level:e.level})),e.pos+=i[0].length,!0)))}function replace$1(e,t){return e=e.source,t=t||"",function n(r,i){return r?(i=i.source||i,e=e.replace(r,i),n):new RegExp(e,t)}}var attr_name=/[a-zA-Z_:][a-zA-Z0-9:._-]*/,unquoted=/[^"'=<>`\x00-\x20]+/,single_quoted=/'[^']*'/,double_quoted=/"[^"]*"/,attr_value=replace$1(/(?:unquoted|single_quoted|double_quoted)/)("unquoted",unquoted)("single_quoted",single_quoted)("double_quoted",double_quoted)(),attribute=replace$1(/(?:\s+attr_name(?:\s*=\s*attr_value)?)/)("attr_name",attr_name)("attr_value",attr_value)(),open_tag=replace$1(/<[A-Za-z][A-Za-z0-9]*attribute*\s*\/?>/)("attribute",attribute)(),close_tag=/<\/[A-Za-z][A-Za-z0-9]*\s*>/,comment=/<!---->|<!--(?:-?[^>-])(?:-?[^-])*-->/,processing=/<[?].*?[?]>/,declaration=/<![A-Z]+\s+[^>]*>/,cdata=/<!\[CDATA\[[\s\S]*?\]\]>/,HTML_TAG_RE=replace$1(/^(?:open_tag|close_tag|comment|processing|declaration|cdata)/)("open_tag",open_tag)("close_tag",close_tag)("comment",comment)("processing",processing)("declaration",declaration)("cdata",cdata)();function isLetter$2(e){var t=32|e;return t>=97&&t<=122}function htmltag(e,t){var n,r,i,a=e.pos;return!(!e.options.html||(i=e.posMax,60!==e.src.charCodeAt(a)||a+2>=i)||(n=e.src.charCodeAt(a+1),33!==n&&63!==n&&47!==n&&!isLetter$2(n))||(r=e.src.slice(a).match(HTML_TAG_RE),!r))&&(t||e.push({type:"htmltag",content:e.src.slice(a,a+r[0].length),level:e.level}),e.pos+=r[0].length,!0)}var DIGITAL_RE=/^&#((?:x[a-f0-9]{1,8}|[0-9]{1,8}));/i,NAMED_RE=/^&([a-z][a-z0-9]{1,31});/i;function entity(e,t){var n,r,i=e.pos,a=e.posMax;if(38!==e.src.charCodeAt(i))return!1;if(i+1<a)if(35===e.src.charCodeAt(i+1)){if(r=e.src.slice(i).match(DIGITAL_RE))return t||(n="x"===r[1][0].toLowerCase()?parseInt(r[1].slice(1),16):parseInt(r[1],10),e.pending+=isValidEntityCode(n)?fromCodePoint(n):fromCodePoint(65533)),e.pos+=r[0].length,!0}else if(r=e.src.slice(i).match(NAMED_RE)){var s=decodeEntity(r[1]);if(r[1]!==s)return t||(e.pending+=s),e.pos+=r[0].length,!0}return t||(e.pending+="&"),e.pos++,!0}var _rules$2=[["text",text$1],["newline",newline],["escape",escape],["backticks",backticks],["del",del],["ins",ins],["mark",mark],["emphasis",emphasis],["sub",sub],["sup",sup],["links",links],["footnote_inline",footnote_inline],["footnote_ref",footnote_ref],["autolink",autolink],["htmltag",htmltag],["entity",entity]];function ParserInline(){this.ruler=new Ruler;for(var e=0;e<_rules$2.length;e++)this.ruler.push(_rules$2[e][0],_rules$2[e][1]);this.validateLink=validateLink}function validateLink(e){var t=e.trim().toLowerCase();return!(-1!==(t=replaceEntities(t)).indexOf(":")&&-1!==["vbscript","javascript","file","data"].indexOf(t.split(":")[0]))}ParserInline.prototype.skipToken=function(e){var t,n,r=this.ruler.getRules(""),i=r.length,a=e.pos;if((n=e.cacheGet(a))>0)e.pos=n;else{for(t=0;t<i;t++)if(r[t](e,!0))return void e.cacheSet(a,e.pos);e.pos++,e.cacheSet(a,e.pos)}},ParserInline.prototype.tokenize=function(e){for(var t,n,r=this.ruler.getRules(""),i=r.length,a=e.posMax;e.pos<a;){for(n=0;n<i&&!(t=r[n](e,!1));n++);if(t){if(e.pos>=a)break}else e.pending+=e.src[e.pos++]}e.pending&&e.pushPending()},ParserInline.prototype.parse=function(e,t,n,r){var i=new StateInline(e,this,t,n,r);this.tokenize(i)};var defaultConfig={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"\u201c\u201d\u2018\u2019",highlight:null,maxNesting:20},components:{core:{rules:["block","inline","references","replacements","smartquotes","references","abbr2","footnote_tail"]},block:{rules:["blockquote","code","fences","footnote","heading","hr","htmlblock","lheading","list","paragraph","table"]},inline:{rules:["autolink","backticks","del","emphasis","entity","escape","footnote_ref","htmltag","links","newline","text"]}}},fullConfig={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"\u201c\u201d\u2018\u2019",highlight:null,maxNesting:20},components:{core:{},block:{},inline:{}}},commonmarkConfig={options:{html:!0,xhtmlOut:!0,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"\u201c\u201d\u2018\u2019",highlight:null,maxNesting:20},components:{core:{rules:["block","inline","references","abbr2"]},block:{rules:["blockquote","code","fences","heading","hr","htmlblock","lheading","list","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","htmltag","links","newline","text"]}}},config={default:defaultConfig,full:fullConfig,commonmark:commonmarkConfig};function StateCore(e,t,n){this.src=t,this.env=n,this.options=e.options,this.tokens=[],this.inlineMode=!1,this.inline=e.inline,this.block=e.block,this.renderer=e.renderer,this.typographer=e.typographer}function Remarkable(e,t){"string"!=typeof e&&(t=e,e="default"),t&&null!=t.linkify&&console.warn("linkify option is removed. Use linkify plugin instead:\n\nimport Remarkable from 'remarkable';\nimport linkify from 'remarkable/linkify';\nnew Remarkable().use(linkify)\n"),this.inline=new ParserInline,this.block=new ParserBlock,this.core=new Core,this.renderer=new Renderer,this.ruler=new Ruler,this.options={},this.configure(config[e]),this.set(t||{})}Remarkable.prototype.set=function(e){assign(this.options,e)},Remarkable.prototype.configure=function(e){var t=this;if(!e)throw new Error("Wrong `remarkable` preset, check name/content");e.options&&t.set(e.options),e.components&&Object.keys(e.components).forEach((function(n){e.components[n].rules&&t[n].ruler.enable(e.components[n].rules,!0)}))},Remarkable.prototype.use=function(e,t){return e(this,t),this},Remarkable.prototype.parse=function(e,t){var n=new StateCore(this,e,t);return this.core.process(n),n.tokens},Remarkable.prototype.render=function(e,t){return t=t||{},this.renderer.render(this.parse(e,t),this.options,t)},Remarkable.prototype.parseInline=function(e,t){var n=new StateCore(this,e,t);return n.inlineMode=!0,this.core.process(n),n.tokens},Remarkable.prototype.renderInline=function(e,t){return t=t||{},this.renderer.render(this.parseInline(e,t),this.options,t)};var RemarkableConfig=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"createNew",value:function(){var e=window.hljs;return e?new Remarkable({highlight:function(t,n){if(n&&e.getLanguage(n))try{return e.highlight(n,t).value}catch(r){console.error("failed to setup the highlight dependency")}try{return e.highlightAuto(t).value}catch(i){console.error("failed to automatically highlight messages")}return""},html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!0}):new Remarkable}}]),e}(),SetFileTypes=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"parseConfig",value:function(e,t,n,r){var i,a={files:t};if("object"==_typeof(r)){var s=r.files,o=r.request,l=r.button;s&&(s.infoModal&&(a.files.infoModal=s.infoModal,null!=(i=s.infoModal)&&i.textMarkDown&&(a.infoModalTextMarkUp=n.render(s.infoModal.textMarkDown))),s.acceptedFormats&&(a.files.acceptedFormats=s.acceptedFormats),s.maxNumberOfFiles&&(a.files.maxNumberOfFiles=s.maxNumberOfFiles)),a.button=l,o&&(o.headers||o.method||o.url||e.headers||e.method||e.url)&&(a.request={headers:(null==o?void 0:o.headers)||e.headers,method:(null==o?void 0:o.method)||e.method,url:(null==o?void 0:o.url)||e.url})}return a}},{key:"processMixedFiles",value:function(t,n,r){if(r){t.fileTypes.mixedFiles=e.parseConfig(t.requestSettings,{acceptedFormats:""},n,r)}}},{key:"processMicrophone",value:function(t,n,r,i){var a,s,o,l,c,u,d,p,h=_objectSpread({acceptedFormats:"audio/*"},(null==(o=t.fileTypes.audio)?void 0:o.files)||{});r&&(void 0!==navigator.mediaDevices.getUserMedia?(t.recordAudio=e.parseConfig(t.requestSettings,h,n,r),"object"==_typeof(r)&&r.files&&(null!==(a=(l=t.recordAudio).files)&&void 0!==a||(l.files={}),t.recordAudio.files.format=null==(c=r.files)?void 0:c.format,t.recordAudio.files.maxDurationSeconds=null==(u=r.files)?void 0:u.maxDurationSeconds,null!=(d=t.fileTypes.audio)&&d.files&&(null!==(s=(p=t.fileTypes.audio.files).maxNumberOfFiles)&&void 0!==s||(p.maxNumberOfFiles=r.files.maxNumberOfFiles)))):i||(t.fileTypes.audio=e.parseConfig(t.requestSettings,h,n,r)))}},{key:"processAudioConfig",value:function(t,n,r,i){if(r||i){var a=_objectSpread({acceptedFormats:"audio/*"},(null==i?void 0:i.files)||{});t.fileTypes.audio=e.parseConfig(t.requestSettings,a,n,r)}}},{key:"processGifConfig",value:function(t,n,r,i){if(r||i){var a=_objectSpread({acceptedFormats:"image/gif"},(null==i?void 0:i.files)||{});t.fileTypes.gifs=e.parseConfig(t.requestSettings,a,n,r)}}},{key:"processCamera",value:function(t,n,r,i){var a,s,o,l,c,u=_objectSpread({acceptedFormats:"image/*"},(null==(s=t.fileTypes.images)?void 0:s.files)||{});r&&(void 0!==navigator.mediaDevices.getUserMedia?(t.camera=e.parseConfig(t.requestSettings,u,n,r),"object"==_typeof(r)&&(t.camera.modalContainerStyle=r.modalContainerStyle,r.files&&(null!==(a=(o=t.camera).files)&&void 0!==a||(o.files={}),t.camera.files.format=null==(l=r.files)?void 0:l.format,t.camera.files.dimensions=null==(c=r.files)?void 0:c.dimensions))):i||(t.fileTypes.images=e.parseConfig(t.requestSettings,u,n,r)))}},{key:"processImagesConfig",value:function(t,n,r,i){if(r||i){var a=_objectSpread({acceptedFormats:"image/*"},(null==i?void 0:i.files)||{});t.fileTypes.images=e.parseConfig(t.requestSettings,a,n,r)}}},{key:"populateDefaultFileIO",value:function(e,t){var n,r,i,a,s;e&&(null!==(n=e.files)&&void 0!==n||(e.files={}),null!==(r=(a=e.files).acceptedFormats)&&void 0!==r||(a.acceptedFormats=t),null!==(i=(s=e.files).maxNumberOfFiles)&&void 0!==i||(s.maxNumberOfFiles=1))}},{key:"set",value:function(t,n,r){e.populateDefaultFileIO(null==r?void 0:r.audio,".4a,.mp3,.webm,.mp4,.mpga,.wav,.mpeg,.m4a"),e.populateDefaultFileIO(null==r?void 0:r.images,".png,.jpg");var i=RemarkableConfig.createNew();e.processImagesConfig(n,i,t.images,null==r?void 0:r.images),e.processCamera(n,i,t.camera,t.images),e.processGifConfig(n,i,t.gifs,null==r?void 0:r.gifs),e.processAudioConfig(n,i,t.audio,null==r?void 0:r.audio),e.processMicrophone(n,i,t.microphone,t.audio),e.processMixedFiles(n,i,t.mixedFiles)}}]),e}(),BaseServiceIO=function(){function e(t,n,r){var i,a,s,o,l;_classCallCheck(this,e),this.rawBody={},this.validateConfigKey=!1,this.canSendMessage=e.canSendMessage,this.requestSettings={},this.fileTypes={},this.completionsHandlers={},this.streamHandlers={},this.deepChat=t,this.demo=r,Object.assign(this.rawBody,null==(a=t.request)?void 0:a.additionalBodyProps),this.totalMessagesMaxCharLength=null==(s=null==t?void 0:t.requestBodyLimits)?void 0:s.totalMessagesMaxCharLength,this.maxMessages=null==(o=null==t?void 0:t.requestBodyLimits)?void 0:o.maxMessages,SetFileTypes.set(t,this,n),t.request&&(this.requestSettings=t.request),this.demo&&(null!==(i=(l=this.requestSettings).url)&&void 0!==i||(l.url=Demo.URL)),this._directServiceRequiresFiles=!!n&&Object.keys(n).length>0,this.requestSettings.websocket&&Websocket.setup(this,this.requestSettings.websocket)}var t,n,r,i;return _createClass(e,[{key:"verifyKey",value:function(e,t){}},{key:"getServiceIOByType",value:function(e){if(e.type.startsWith("audio")&&this.fileTypes.audio)return this.fileTypes.audio;if(e.type.startsWith("image")){if(this.fileTypes.gifs&&e.type.endsWith("/gif"))return this.fileTypes.gifs;if(this.fileTypes.images)return this.fileTypes.images;if(this.camera)return this.camera}return this.fileTypes.mixedFiles}},{key:"callServiceAPI",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n,r){var i,a,s,o,l,c,u,d,p;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=_objectSpread({messages:n},this.rawBody),d=!1,null!=(s=this.requestSettings.headers)&&s["Content-Type"]||(null!==(i=(o=this.requestSettings).headers)&&void 0!==i||(o.headers={}),null!==(a=(l=this.requestSettings.headers)["Content-Type"])&&void 0!==a||(l["Content-Type"]="application/json"),d=!0),!(p=this.deepChat.stream)||!this.demo&&"object"==_typeof(p)&&p.simulation){e.next=9;break}return e.next=7,Stream.request(this,u,t);case 7:e.next=11;break;case 9:return e.next=11,HTTPRequest.request(this,u,t);case 11:d&&(null==(c=this.requestSettings.headers)||delete c["Content-Type"]);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"callApiWithFiles",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function t(n,r,i,a){var s,o,l;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=e.createCustomFormDataBody(n,i,a),o=this.requestSettings,l=this.getServiceIOByType(a[0]),this.requestSettings=(null==l?void 0:l.request)||this.requestSettings,t.next=4,HTTPRequest.request(this,s,r,!1);case 4:this.requestSettings=o;case 5:case"end":return t.stop()}}),t,this)}))),function(e,t,n,i){return r.apply(this,arguments)})},{key:"callAPI",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.requestSettings){e.next=2;break}throw new Error("Request settings have not been set up");case 2:r=MessageLimitUtils.processMessages(t,n.messages,this.maxMessages,this.totalMessagesMaxCharLength),this.websocket?(i=_objectSpread({messages:r},this.rawBody),Websocket.sendWebsocket(this.websocket,this,i,n,!1)):t.files&&!this._directServiceRequiresFiles?this.callApiWithFiles(this.rawBody,n,r,t.files):this.callServiceAPI(n,r,t.files);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.error){e.next=2;break}throw t.error;case 2:return e.abrupt("return",t.result);case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}],[{key:"canSendMessage",value:function(e,t){return!(!e||""===e.trim())||!!(t&&t.length>0)}},{key:"createCustomFormDataBody",value:function(e,t,n){var r=new FormData;n.forEach((function(e){return r.append("files",e)})),Object.keys(e).forEach((function(t){return r.append(t,String(e[t]))}));var i=0;return t.forEach((function(e){e.text&&r.append("message".concat(i+=1),JSON.stringify(e))})),r}}]),e}(),DirectServiceIO=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,a,s){var o,l;return _classCallCheck(this,n),(o=t.call(this,e,s)).insertKeyPlaceholderText="API Key",o.getKeyLink="",Object.assign(o.rawBody,null==(l=e.request)?void 0:l.additionalBodyProps),o.keyVerificationDetails=r,o.buildHeadersFunc=i,a&&o.setApiKeyProperties(a),o.requestSettings=o.buildRequestSettings(o.key||"",e.request),o}return _createClass(n,[{key:"setApiKeyProperties",value:function(e){this.key=e.key,e.validateKeyProperty&&(this.validateConfigKey=e.validateKeyProperty)}},{key:"buildRequestSettings",value:function(e,t){var n=null!=t?t:{};return n.headers=this.buildHeadersFunc(e),n}},{key:"keyAuthenticated",value:function(e,t){this.requestSettings=this.buildRequestSettings(t,this.requestSettings),this.key=t,e()}},{key:"verifyKey",value:function(e,t){var n=this.keyVerificationDetails,r=n.url,i=n.method,a=n.handleVerificationResult,s=n.createHeaders,o=n.body,l=(null==s?void 0:s(e))||this.buildHeadersFunc(e);HTTPRequest.verifyKey(e,r,l,i,this.keyAuthenticated.bind(this,t.onSuccess),t.onFail,t.onLoad,a,o)}}]),n}(BaseServiceIO),RenderControl=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"waitForPropertiesToBeUpdatedBeforeRender",value:function(t){t._propUpdated_=!1,setTimeout((function(){t._propUpdated_?e.waitForPropertiesToBeUpdatedBeforeRender(t):(t._waitingToRender_=!1,t.onRender())}))}},{key:"attemptRender",value:function(t){t._propUpdated_=!0,t._waitingToRender_||(t._waitingToRender_=!0,e.waitForPropertiesToBeUpdatedBeforeRender(t))}}]),e}(),_InternalHTML=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this))._waitingToRender_=!1,e._propUpdated_=!1,Object.keys(n._attributeToProperty_).forEach((function(t){var r=n._attributeToProperty_[t];e.constructPropertyAccessors(r),e.hasOwnProperty(t)||e.constructPropertyAccessors(r,t)})),e}return _createClass(n,[{key:"constructPropertyAccessors",value:function(e,t){var n;Object.defineProperty(this,t||e,{get:function(){return n},set:function(r){n=r,t?this[e]=r:RenderControl.attemptRender(this)}})}},{key:"attributeChangedCallback",value:function(e,t,r){if(t!==r){var i=n._attributes_[e](r);this[n._attributeToProperty_[e]]=i}}},{key:"onRender",value:function(){}}],[{key:"observedAttributes",get:function(){return Object.keys(n._attributes_)||[]}}]),n}(_wrapNativeSuper(HTMLElement));_InternalHTML._attributes_={},_InternalHTML._attributeToProperty_={};var InternalHTML=_InternalHTML,NOT_VISIBLE_ICON_STRING='<?xml version="1.0" standalone="no"?>\n<svg version="1.1"\n\txmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n\txmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="0.9em" height="0.9em"\n\tviewBox="0 0 1200 1200" enable-background="new 0 0 1200 1200">\n\t\t<path d="\n\t\t\tM669.727,273.516c-22.891-2.476-46.15-3.895-69.727-4.248c-103.025,0.457-209.823,25.517-310.913,73.536\n\t\t\tc-75.058,37.122-148.173,89.529-211.67,154.174C46.232,529.978,6.431,577.76,0,628.74c0.76,44.162,48.153,98.67,77.417,131.764\n\t\t\tc59.543,62.106,130.754,113.013,211.67,154.174c2.75,1.335,5.51,2.654,8.276,3.955l-75.072,131.102l102.005,60.286l551.416-960.033\n\t\t\tl-98.186-60.008L669.727,273.516z M902.563,338.995l-74.927,129.857c34.47,44.782,54.932,100.006,54.932,159.888\n\t\t\tc0,149.257-126.522,270.264-282.642,270.264c-6.749,0-13.29-0.728-19.922-1.172l-49.585,85.84c22.868,2.449,45.99,4.233,69.58,4.541\n\t\t\tc103.123-0.463,209.861-25.812,310.84-73.535c75.058-37.122,148.246-89.529,211.743-154.174\n\t\t\tc31.186-32.999,70.985-80.782,77.417-131.764c-0.76-44.161-48.153-98.669-77.417-131.763\n\t\t\tc-59.543-62.106-130.827-113.013-211.743-154.175C908.108,341.478,905.312,340.287,902.563,338.995L902.563,338.995z\n\t\t\tM599.927,358.478c6.846,0,13.638,0.274,20.361,0.732l-58.081,100.561c-81.514,16.526-142.676,85.88-142.676,168.897\n\t\t\tc0,20.854,3.841,40.819,10.913,59.325c0.008,0.021-0.008,0.053,0,0.074l-58.228,100.854\n\t\t\tc-34.551-44.823-54.932-100.229-54.932-160.182C317.285,479.484,443.808,358.477,599.927,358.478L599.927,358.478z M768.896,570.513\n\t\t\tL638.013,797.271c81.076-16.837,141.797-85.875,141.797-168.603C779.81,608.194,775.724,588.729,768.896,570.513L768.896,570.513z"\n\t\t\t/>\n</svg>\n',VISIBLE_ICON_STRING='<?xml version="1.0" standalone="no"?>\n<svg version="1.1"\n\txmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n\txmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="0.9em" height="0.9em"\n\tviewBox="0 0 1200 1200" enable-background="new 0 0 1200 1200">\n\t\t<path id="path6686" inkscape:connector-curvature="0" d="M779.843,599.925c0,95.331-80.664,172.612-180.169,172.612\n\t\t\tc-99.504,0-180.168-77.281-180.168-172.612c0-95.332,80.664-172.612,180.168-172.612\n\t\t\tC699.179,427.312,779.843,504.594,779.843,599.925z M600,240.521c-103.025,0.457-209.814,25.538-310.904,73.557\n\t\t\tc-75.058,37.122-148.206,89.496-211.702,154.141C46.208,501.218,6.431,549,0,599.981c0.76,44.161,48.13,98.669,77.394,131.763\n\t\t\tc59.543,62.106,130.786,113.018,211.702,154.179c94.271,45.751,198.616,72.092,310.904,73.557\n\t\t\tc103.123-0.464,209.888-25.834,310.866-73.557c75.058-37.122,148.243-89.534,211.74-154.179\n\t\t\tc31.185-32.999,70.962-80.782,77.394-131.763c-0.76-44.161-48.13-98.671-77.394-131.764\n\t\t\tc-59.543-62.106-130.824-112.979-211.74-154.141C816.644,268.36,712.042,242.2,600,240.521z M599.924,329.769\n\t\t\tc156.119,0,282.675,120.994,282.675,270.251c0,149.256-126.556,270.25-282.675,270.25S317.249,749.275,317.249,600.02\n\t\t\tC317.249,450.763,443.805,329.769,599.924,329.769L599.924,329.769z"/>\n</svg>\n',SVGIconUtils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"createSVGElement",value:function(e){return(new DOMParser).parseFromString(e,"image/svg+xml").documentElement}}]),e}(),_VisibilityIcon=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"changeVisibility",value:function(t,n,r,i){i.target.id===e.VISIBLE_ICON_ID?(n.style.display="none",r.style.display="block",t.type="password"):(n.style.display="block",r.style.display="none",t.type="text")}},{key:"createIconElement",value:function(e,t){var n=SVGIconUtils.createSVGElement(e);return n.id=t,n.classList.add("visibility-icon"),n}},{key:"create",value:function(t){var n=document.createElement("div");n.id="visibility-icon-container";var r=e.createIconElement(VISIBLE_ICON_STRING,e.VISIBLE_ICON_ID);r.style.display="none",n.appendChild(r);var i=e.createIconElement(NOT_VISIBLE_ICON_STRING,"not-visible-icon");return n.appendChild(i),n.onclick=e.changeVisibility.bind(this,t,r,i),n}}]),e}();_VisibilityIcon.VISIBLE_ICON_ID="visible-icon";var VisibilityIcon=_VisibilityIcon,InsertKeyView=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"createCautionText",value:function(){var e=document.createElement("a");return e.classList.add("insert-key-input-help-text"),e.innerText="Please exercise CAUTION when inserting your API key outside of deepchat.dev or localhost!!",e}},{key:"createHelpLink",value:function(e){var t=document.createElement("a");return t.classList.add("insert-key-input-help-text"),t.href=e,t.innerText="Find more info here",t.target="_blank",t}},{key:"createFailText",value:function(){var e=document.createElement("div");return e.id="insert-key-input-invalid-text",e.style.display="none",e}},{key:"createHelpTextContainer",value:function(t){var n=document.createElement("div");n.id="insert-key-help-text-container";var r=document.createElement("div");r.id="insert-key-help-text-contents";var i=e.createFailText();if(r.appendChild(i),t){var a=e.createHelpLink(t);r.appendChild(a)}var s=e.createCautionText();return r.appendChild(s),n.appendChild(r),{helpTextContainerElement:n,failTextElement:i}}},{key:"onFail",value:function(e,t,n,r){e.classList.replace("insert-key-input-valid","insert-key-input-invalid"),n.innerText=r,n.style.display="block",t.innerText="Start",e.classList.remove("loading")}},{key:"onLoad",value:function(e,t){e.classList.add("loading"),t.innerHTML='<div id="loading-ring"></div>'}},{key:"verifyKey",value:function(e,t,n){var r=e.value.trim();n.verifyKey(r,t)}},{key:"addVerificationEvents",value:function(t,n,r,i,a){var s={onSuccess:i,onFail:e.onFail.bind(this,t,n,r),onLoad:e.onLoad.bind(this,t,n)},o=e.verifyKey.bind(this,t,s,a);n.onclick=o,t.onkeydown=function(e){!t.classList.contains("loading")&&e.key===KEYBOARD_KEY.ENTER&&o()}}},{key:"createStartButton",value:function(){var e=document.createElement("div");return e.id="start-button",e.innerText="Start",e}},{key:"onInputFocus",value:function(e){e.target.classList.replace("insert-key-input-invalid","insert-key-input-valid")}},{key:"createInput",value:function(t){var n=document.createElement("div");n.id="insert-key-input-container";var r=document.createElement("input");return r.id="insert-key-input",r.placeholder=t||"API Key",r.type="password",r.classList.add("insert-key-input-valid"),r.onfocus=e.onInputFocus,n.appendChild(r),n}},{key:"createContents",value:function(t,n){var r=document.createElement("div");r.id="insert-key-contents";var i=e.createInput(n.insertKeyPlaceholderText),a=i.children[0],s=VisibilityIcon.create(a);i.appendChild(s),r.appendChild(i);var o=e.createStartButton(),l=e.createHelpTextContainer(n.getKeyLink),c=l.helpTextContainerElement,u=l.failTextElement;return r.appendChild(o),r.appendChild(c),e.addVerificationEvents(a,o,u,t,n),r}},{key:"createElements",value:function(t,n){var r=document.createElement("div");r.id="insert-key-view";var i=e.createContents(t,n);return r.appendChild(i),r}},{key:"render",value:function(t,n,r){var i=e.createElements(n,r);t.replaceChildren(i)}}]),e}(),HuggingFaceUtils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"buildHeaders",value:function(e){return{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}},{key:"handleVerificationResult",value:function(e,t,n,r){var i=e;Array.isArray(i.error)&&"Error in `parameters`: field required"===i.error[0]?n(t):r(ErrorMessages.INVALID_KEY)}},{key:"buildKeyVerificationDetails",value:function(){return{url:"https://api-inference.huggingface.co/models/gpt2",method:"POST",handleVerificationResult:e.handleVerificationResult}}}]),e}(),_HuggingFaceIO=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e,t,i,a,s,o){var l;return _classCallCheck(this,r),(l=n.call(this,e,HuggingFaceUtils.buildKeyVerificationDetails(),HuggingFaceUtils.buildHeaders,s,o)).insertKeyPlaceholderText="Hugging Face Token",l.getKeyLink="https://huggingface.co/settings/tokens",l.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Hugging Face</b></div>\n    <p>First message may take an extented amount of time to complete as the model needs to be initialized.</p>',l.permittedErrorPrefixes=["Authorization header"],l.url="".concat(r.URL_PREFIX).concat(i),l.textInputPlaceholderText=t,"object"==_typeof(a)&&(a.model&&(l.url="".concat(r.URL_PREFIX).concat(a.model)),a.options&&(l.rawBody.options=a.options),a.parameters&&(l.rawBody.parameters=a.parameters)),l}return _createClass(r,[{key:"preprocessBody",value:function(e,t,n){var r,i=JSON.parse(JSON.stringify(e)),a=t[t.length-1].text;if(a)return null!==(r=i.options)&&void 0!==r||(i.options={}),i.options.wait_for_model=!0,_objectSpread({inputs:a},i)}},{key:"callServiceAPI",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n,r){var i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.requestSettings){e.next=2;break}throw new Error("Request settings have not been set up");case 2:i=this.preprocessBody(this.rawBody,n,r),HTTPRequest.request(this,i,t);case 4:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})}]),r}(DirectServiceIO);_HuggingFaceIO.URL_PREFIX="https://api-inference.huggingface.co/models/";var HuggingFaceIO=_HuggingFaceIO,HuggingFaceFileIO=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e,t,i,a,s,o){var l;return _classCallCheck(this,r),(l=n.call(this,e,t,i,a,s,o)).isTextInputDisabled=!0,l.canSendMessage=r.canSendFile,l}return _createClass(r,[{key:"preprocessBody",value:function(e,t,n){return n[0]}},{key:"callServiceAPI",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.requestSettings){e.next=2;break}throw new Error("Request settings have not been set up");case 2:if(null!=r&&r[0]){e.next=4;break}throw new Error("No file was added");case 4:HTTPRequest.poll(this,r[0],t,!1);case 5:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})}],[{key:"canSendFile",value:function(e,t){return!(null==t||!t[0])}}]),r}(HuggingFaceIO),HuggingFaceAudioClassificationIO=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){var t,i,a;_classCallCheck(this,r);var s=null==(i=null==(t=e.directConnection)?void 0:t.huggingFace)?void 0:i.audioClassification,o=null==(a=e.directConnection)?void 0:a.huggingFace;return n.call(this,e,"Attach an audio file","ehcalabres/wav2vec2-lg-xlsr-en-speech-emotion-recognition",s,o,{audio:{}})}return _createClass(r,[{key:"extractPollResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.estimated_time){e.next=2;break}return e.abrupt("return",{timeoutMS:1e3*(t.estimated_time+1)});case 2:if(!t.error){e.next=4;break}throw t.error;case 4:return e.abrupt("return",{text:(null==(n=t[0])?void 0:n.label)||""});case 5:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),r}(HuggingFaceFileIO),HuggingFaceImageClassificationIO=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){var t,i,a;_classCallCheck(this,r);var s=null==(i=null==(t=e.directConnection)?void 0:t.huggingFace)?void 0:i.imageClassification,o=null==(a=e.directConnection)?void 0:a.huggingFace;return n.call(this,e,"Attach an image file","google/vit-base-patch16-224",s,o,{images:{}})}return _createClass(r,[{key:"extractPollResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.estimated_time){e.next=2;break}return e.abrupt("return",{timeoutMS:1e3*(t.estimated_time+1)});case 2:if(!t.error){e.next=4;break}throw t.error;case 4:return e.abrupt("return",{text:(null==(n=t[0])?void 0:n.label)||""});case 5:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),r}(HuggingFaceFileIO),BASE_64_PREFIX="data:image/png;base64,",StabilityAIUtils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"buildHeaders",value:function(e){return{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}},{key:"handleVerificationResult",value:function(e,t,n,r){e.message?r(ErrorMessages.INVALID_KEY):n(t)}},{key:"buildKeyVerificationDetails",value:function(){return{url:"https://api.stability.ai/v1/engines/list",method:"GET",handleVerificationResult:e.handleVerificationResult}}}]),e}(),StabilityAIIO=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,a,s){var o;return _classCallCheck(this,n),(o=t.call(this,e,r,i,a,s)).insertKeyPlaceholderText="Stability AI API Key",o.getKeyLink="https://platform.stability.ai/docs/getting-started/authentication",o.permittedErrorPrefixes=["Incorrect","invalid_"],o}return _createClass(n)}(DirectServiceIO),StabilityAIImageToImageUpscaleIO=function(e){_inherits(i,e);var t,n,r=_createSuper(i);function i(e){var t,n;_classCallCheck(this,i);var a=e.directConnection,s=null==a?void 0:a.stabilityAI;(t=r.call(this,e,StabilityAIUtils.buildKeyVerificationDetails(),StabilityAIUtils.buildHeaders,s,{images:{files:{acceptedFormats:".png",maxNumberOfFiles:1}}})).url="https://api.stability.ai/v1/generation/esrgan-v1-x2plus/image-to-image/upscale",t.textInputPlaceholderText="Describe image changes",t.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Stability AI</b></div>\n    <div style="width: 100%; text-align: center; margin-left: -10px; margin-top: 5px"><b>Image to Image Upscale</b></div>\n    <p>Upload an image to generate a new one with higher resolution.</p>\n    <p>Click <a href="https://platform.stability.ai/">here</a> for more info.</p>';var o=null==(n=null==a?void 0:a.stabilityAI)?void 0:n.imageToImageUpscale;return"object"==_typeof(o)&&(o.engine_id&&(t.url="https://api.stability.ai/v1/generation/".concat(o.engine_id,"/image-to-image/upscale")),i.cleanConfig(o),Object.assign(t.rawBody,o)),t.canSendMessage=i.canSendFileMessage,t}return _createClass(i,[{key:"createFormDataBody",value:function(e,t){var n=new FormData;return n.append("image",t),Object.keys(e).forEach((function(t){n.append(t,String(e[t]))})),n}},{key:"callServiceAPI",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n,r){var i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.requestSettings){e.next=2;break}throw new Error("Request settings have not been set up");case 2:if(r){e.next=4;break}throw new Error("Image was not found");case 4:i=this.createFormDataBody(this.rawBody,r[0]),RequestUtils.temporarilyRemoveHeader(this.requestSettings,HTTPRequest.request.bind(this,this,i,t),!1);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.message){e.next=2;break}throw t.message;case 2:return e.abrupt("return",{files:t.artifacts.map((function(e){return{src:"".concat(BASE_64_PREFIX).concat(e.base64),type:"image"}}))});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}],[{key:"cleanConfig",value:function(e){delete e.engine_id}},{key:"canSendFileMessage",value:function(e,t){return!(null==t||!t[0])}}]),i}(StabilityAIIO),StabilityAIImageToImageMaskingIO=function(e){_inherits(i,e);var t,n,r=_createSuper(i);function i(e){var t,n;_classCallCheck(this,i);var a=e.directConnection,s=null==a?void 0:a.stabilityAI;(t=r.call(this,e,StabilityAIUtils.buildKeyVerificationDetails(),StabilityAIUtils.buildHeaders,s,{images:{files:{acceptedFormats:".png",maxNumberOfFiles:2}}})).url="https://api.stability.ai/v1/generation/stable-inpainting-512-v2-0/image-to-image/masking",t._maskSource="MASK_IMAGE_WHITE",t.textInputPlaceholderText="Describe image changes",t.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Stability AI</b></div>\n    <div style="width: 100%; text-align: center; margin-left: -10px; margin-top: 5px"><b>Image to Image Masking</b></div>\n    <p>Upload an image, its mask image to create a new one based on the changes you have described for the mask area.</p>\n    <p>Click <a href="https://platform.stability.ai/">here</a> for more info.</p>';var o=null==(n=null==a?void 0:a.stabilityAI)?void 0:n.imageToImageMasking;return"object"==_typeof(o)&&(o.engine_id&&(t.url="https://api.stability.ai/v1/generation/".concat(o.engine_id,"/image-to-image/masking")),void 0!==o.weight&&null!==o.weight&&(t._imageWeight=o.weight),void 0!==o.mask_source&&null!==o.mask_source&&(t._maskSource=o.mask_source),i.cleanConfig(o),Object.assign(t.rawBody,o)),t.canSendMessage=i.canSendFileTextMessage,t}return _createClass(i,[{key:"createFormDataBody",value:function(e,t,n,r){var i=new FormData;return i.append("init_image",t),i.append("mask_source",String(this._maskSource)),i.append("mask_image",n),r&&""!==r&&i.append("text_prompts[0][text]",r),void 0!==this._imageWeight&&null!==this._imageWeight&&i.append("text_prompts[0][weight]",String(this._imageWeight)),Object.keys(e).forEach((function(t){i.append(t,String(e[t]))})),void 0===i.get("weight")&&i.append("weight",String(1)),i}},{key:"callServiceAPI",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n,r){var i,a,s,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.requestSettings){e.next=2;break}throw new Error("Request settings have not been set up");case 2:if(r&&r[0]&&r[1]){e.next=4;break}throw new Error("Image was not found");case 4:s=null==(a=null==(i=n[n.length-1])?void 0:i.text)?void 0:a.trim(),o=this.createFormDataBody(this.rawBody,r[0],r[1],s),RequestUtils.temporarilyRemoveHeader(this.requestSettings,HTTPRequest.request.bind(this,this,o,t),!1);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.message){e.next=2;break}throw t.message;case 2:return e.abrupt("return",{files:t.artifacts.map((function(e){return{src:"".concat(BASE_64_PREFIX).concat(e.base64),type:"image"}}))});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}],[{key:"cleanConfig",value:function(e){delete e.engine_id,delete e.weight}},{key:"canSendFileTextMessage",value:function(e,t){return!(null==t||!t[0]||!e||""===e.trim())}}]),i}(StabilityAIIO),HuggingFaceAudioRecognitionIO=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){var t,i,a;_classCallCheck(this,r);var s=null==(i=null==(t=e.directConnection)?void 0:t.huggingFace)?void 0:i.audioSpeechRecognition,o=null==(a=e.directConnection)?void 0:a.huggingFace;return n.call(this,e,"Attach an audio file","facebook/wav2vec2-large-960h-lv60-self",s,o,{audio:{}})}return _createClass(r,[{key:"extractPollResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.estimated_time){e.next=2;break}return e.abrupt("return",{timeoutMS:1e3*(t.estimated_time+1)});case 2:if(!t.error){e.next=4;break}throw t.error;case 4:return e.abrupt("return",{text:t.text||""});case 5:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),r}(HuggingFaceFileIO),HuggingFaceTextGenerationIO=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){var t,i,a;_classCallCheck(this,r);var s=null==(i=null==(t=e.directConnection)?void 0:t.huggingFace)?void 0:i.textGeneration,o=null==(a=e.directConnection)?void 0:a.huggingFace;return n.call(this,e,"Once upon a time","gpt2",s,o)}return _createClass(r,[{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.error){e.next=2;break}throw t.error;case 2:return e.abrupt("return",{text:t[0].generated_text||""});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),r}(HuggingFaceIO),HuggingFaceQuestionAnswerIO=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){var t,i,a,s;_classCallCheck(this,r);var o=null==(a=null==(i=e.directConnection)?void 0:i.huggingFace)?void 0:a.questionAnswer,l=null==(s=e.directConnection)?void 0:s.huggingFace;return(t=n.call(this,e,"Ask a question","bert-large-uncased-whole-word-masking-finetuned-squad",o,l)).permittedErrorPrefixes=["Authorization header","Error in"],t.context=o.context,t}return _createClass(r,[{key:"preprocessBody",value:function(e,t){var n=t[t.length-1].text;if(n)return{inputs:{question:n,context:this.context,options:{wait_for_model:!0}}}}},{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.error){e.next=2;break}throw t.error;case 2:return e.abrupt("return",{text:t.answer||""});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),r}(HuggingFaceIO),HuggingFaceSummarizationIO=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){var t,i,a;_classCallCheck(this,r);var s=null==(i=null==(t=e.directConnection)?void 0:t.huggingFace)?void 0:i.summarization,o=null==(a=e.directConnection)?void 0:a.huggingFace;return n.call(this,e,"Insert text to summarize","facebook/bart-large-cnn",s,o)}return _createClass(r,[{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.error){e.next=2;break}throw t.error;case 2:return e.abrupt("return",{text:t[0].summary_text||""});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),r}(HuggingFaceIO),HuggingFaceConversationIO=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){var t,i,a,s;_classCallCheck(this,r);var o=null==(a=null==(i=e.directConnection)?void 0:i.huggingFace)?void 0:a.conversation,l=null==(s=e.directConnection)?void 0:s.huggingFace;return void 0===(t=n.call(this,e,"Ask me anything!","facebook/blenderbot-400M-distill",o,l)).maxMessages&&(t.maxMessages=-1),t}return _createClass(r,[{key:"processMessages",value:function(e){var t=e[e.length-1].text,n=e.slice(0,e.length-1);if(t)return{past_user_inputs:n.filter((function(e){return"user"===e.role})).map((function(e){return e.text})),generated_responses:n.filter((function(e){return"ai"===e.role})).map((function(e){return e.text})),mostRecentMessageText:t}}},{key:"preprocessBody",value:function(e,t){var n,r=JSON.parse(JSON.stringify(e)),i=this.processMessages(t);if(i)return null!==(n=r.options)&&void 0!==n||(r.options={}),r.options.wait_for_model=!0,_objectSpread({inputs:{past_user_inputs:i.past_user_inputs,generated_responses:i.generated_responses,text:i.mostRecentMessageText}},r)}},{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.error){e.next=2;break}throw t.error;case 2:return e.abrupt("return",{text:t.generated_text||""});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),r}(HuggingFaceIO),StabilityAIImageToImageIO=function(e){_inherits(i,e);var t,n,r=_createSuper(i);function i(e){var t,n;_classCallCheck(this,i);var a=e.directConnection,s=null==a?void 0:a.stabilityAI;(t=r.call(this,e,StabilityAIUtils.buildKeyVerificationDetails(),StabilityAIUtils.buildHeaders,s,{images:{files:{acceptedFormats:".png",maxNumberOfFiles:1}}})).url="https://api.stability.ai/v1/generation/stable-diffusion-v1-5/image-to-image",t.textInputPlaceholderText="Describe image changes",t.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Stability AI - Image to Image</b></div>\n    <p>Upload an image to create a new one with the changes you have described.</p>\n    <p>Click <a href="https://platform.stability.ai/">here</a> for more info.</p>';var o=null==(n=null==a?void 0:a.stabilityAI)?void 0:n.imageToImage;return"object"==_typeof(o)&&(o.engine_id&&(t.url="https://api.stability.ai/v1/generation/".concat(o.engine_id,"/text-to-image")),void 0!==o.weight&&null!==o.weight&&(t._imageWeight=o.weight),i.cleanConfig(o),Object.assign(t.rawBody,o)),t.canSendMessage=i.canSendFileTextMessage,t}return _createClass(i,[{key:"createFormDataBody",value:function(e,t,n){var r=new FormData;return r.append("init_image",t),n&&""!==n&&r.append("text_prompts[0][text]",n),void 0!==this._imageWeight&&null!==this._imageWeight&&r.append("text_prompts[0][weight]",String(this._imageWeight)),Object.keys(e).forEach((function(t){r.append(t,String(e[t]))})),void 0===r.get("weight")&&r.append("weight",String(1)),r}},{key:"callServiceAPI",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n,r){var i,a,s,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.requestSettings){e.next=2;break}throw new Error("Request settings have not been set up");case 2:if(r){e.next=4;break}throw new Error("Image was not found");case 4:s=null==(a=null==(i=n[n.length-1])?void 0:i.text)?void 0:a.trim(),o=this.createFormDataBody(this.rawBody,r[0],s),RequestUtils.temporarilyRemoveHeader(this.requestSettings,HTTPRequest.request.bind(this,this,o,t),!1);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.message){e.next=2;break}throw t.message;case 2:return e.abrupt("return",{files:t.artifacts.map((function(e){return{src:"".concat(BASE_64_PREFIX).concat(e.base64),type:"image"}}))});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}],[{key:"cleanConfig",value:function(e){delete e.engine_id,delete e.weight}},{key:"canSendFileTextMessage",value:function(e,t){return!(null==t||!t[0]||!e||""===e.trim())}}]),i}(StabilityAIIO),HuggingFaceTranslationIO=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){var t,i,a;_classCallCheck(this,r);var s=null==(i=null==(t=e.directConnection)?void 0:t.huggingFace)?void 0:i.translation,o=null==(a=e.directConnection)?void 0:a.huggingFace;return n.call(this,e,"Insert text to translate","Helsinki-NLP/opus-tatoeba-en-ja",s,o)}return _createClass(r,[{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.error){e.next=2;break}throw t.error;case 2:return e.abrupt("return",{text:t[0].translation_text||""});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),r}(HuggingFaceIO),StabilityAITextToImageIO=function(e){_inherits(i,e);var t,n,r=_createSuper(i);function i(e){var t,n;_classCallCheck(this,i);var a=e.directConnection,s=null==a?void 0:a.stabilityAI;(t=r.call(this,e,StabilityAIUtils.buildKeyVerificationDetails(),StabilityAIUtils.buildHeaders,s)).url="https://api.stability.ai/v1/generation/stable-diffusion-v1-5/text-to-image",t.textInputPlaceholderText="Describe an image",t.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Stability AI - Text to Image</b></div>\n    <p>Insert text to generate an image.</p>\n    <p>Click <a href="https://platform.stability.ai/">here</a> for more info.</p>';var o=null==(n=null==a?void 0:a.stabilityAI)?void 0:n.textToImage;return"object"==_typeof(o)&&(o.engine_id&&(t.url="https://api.stability.ai/v1/generation/".concat(o.engine_id,"/text-to-image")),void 0!==o.weight&&null!==o.weight&&(t._imageWeight=o.weight),i.cleanConfig(o),Object.assign(t.rawBody,o)),t.canSendMessage=i.canSendTextMessage,t}return _createClass(i,[{key:"preprocessBody",value:function(e,t){var n=JSON.parse(JSON.stringify(e)),r={text:t};return this._imageWeight&&(r.weight=this._imageWeight),n.text_prompts=[r],n}},{key:"callServiceAPI",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.requestSettings){e.next=2;break}throw new Error("Request settings have not been set up");case 2:r=this.preprocessBody(this.rawBody,n[n.length-1].text),HTTPRequest.request(this,r,t);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.message){e.next=2;break}throw t.message;case 2:return e.abrupt("return",{files:t.artifacts.map((function(e){return{src:"".concat(BASE_64_PREFIX).concat(e.base64),type:"image"}}))});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}],[{key:"cleanConfig",value:function(e){delete e.engine_id,delete e.weight}},{key:"canSendTextMessage",value:function(e){return!(!e||""===e.trim())}}]),i}(StabilityAIIO),HuggingFaceFillMaskIO=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){var t,i,a,s;_classCallCheck(this,r);var o=null==(a=null==(i=e.directConnection)?void 0:i.huggingFace)?void 0:a.fillMask,l=null==(s=e.directConnection)?void 0:s.huggingFace;return(t=n.call(this,e,"The goal of life is [MASK].","bert-base-uncased",o,l)).introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Hugging Face</b></div>\n    <p>Insert a sentence with the word [MASK] and the model will try to fill it for you. E.g. I want [MASK].</p>\n    <p>First message may take an extented amount of time to complete as the model needs to be initialized.</p>',t.permittedErrorPrefixes=["Authorization header","No mask_token"],t}return _createClass(r,[{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.error){e.next=2;break}throw t.error;case 2:return e.abrupt("return",{text:t[0].sequence||""});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),r}(HuggingFaceIO),CohereUtils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"buildHeaders",value:function(e){return{Authorization:"Bearer ".concat(e),"Content-Type":"application/json",accept:"application/json"}}},{key:"handleVerificationResult",value:function(e,t,n,r){"invalid request: prompt must be at least 1 token long"===e.message?n(t):r(ErrorMessages.INVALID_KEY)}},{key:"buildKeyVerificationDetails",value:function(){return{url:"https://api.cohere.ai/v1/generate",method:"POST",handleVerificationResult:e.handleVerificationResult,body:JSON.stringify({prompt:""})}}}]),e}(),CohereIO=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,a,s){var o;return _classCallCheck(this,n),(o=t.call(this,e,CohereUtils.buildKeyVerificationDetails(),CohereUtils.buildHeaders,s)).insertKeyPlaceholderText="Cohere API Key",o.getKeyLink="https://dashboard.cohere.ai/api-keys",o.permittedErrorPrefixes=["invalid"],o.url=r,o.textInputPlaceholderText=i,a&&"object"==_typeof(a)&&Object.assign(o.rawBody,a),o}return _createClass(n)}(DirectServiceIO),CohereTextGenerationIO=function(e){_inherits(i,e);var t,n,r=_createSuper(i);function i(e){var t,n,a;_classCallCheck(this,i);var s=null==(n=null==(t=e.directConnection)?void 0:t.cohere)?void 0:n.textGeneration,o=null==(a=e.directConnection)?void 0:a.cohere;return r.call(this,e,"https://api.cohere.ai/v1/generate","Once upon a time",s,o)}return _createClass(i,[{key:"preprocessBody",value:function(e,t){var n=JSON.parse(JSON.stringify(e)),r=t[t.length-1].text;if(r)return _objectSpread({prompt:r},n)}},{key:"callServiceAPI",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.requestSettings){e.next=2;break}throw new Error("Request settings have not been set up");case 2:r=this.preprocessBody(this.rawBody,n),HTTPRequest.request(this,r,t);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.message){e.next=2;break}throw t.message;case 2:return e.abrupt("return",{text:(null==(n=t.generations)?void 0:n[0].text)||""});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),i}(CohereIO),CohereSummarizationIO=function(e){_inherits(i,e);var t,n,r=_createSuper(i);function i(e){var t,n,a;_classCallCheck(this,i);var s=null==(n=null==(t=e.directConnection)?void 0:t.cohere)?void 0:n.summarization,o=null==(a=e.directConnection)?void 0:a.cohere;return r.call(this,e,"https://api.cohere.ai/v1/summarize","Insert text to summarize",s,o)}return _createClass(i,[{key:"preprocessBody",value:function(e,t){var n=JSON.parse(JSON.stringify(e)),r=t[t.length-1].text;if(r)return _objectSpread({text:r},n)}},{key:"callServiceAPI",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.requestSettings){e.next=2;break}throw new Error("Request settings have not been set up");case 2:r=this.preprocessBody(this.rawBody,n),HTTPRequest.request(this,r,t);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.message){e.next=2;break}throw t.message;case 2:return e.abrupt("return",{text:t.summary||""});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),i}(CohereIO),AzureUtils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"buildTextToSpeechHeaders",value:function(e,t){return{"Ocp-Apim-Subscription-Key":t,"Content-Type":"application/ssml+xml","X-Microsoft-OutputFormat":e}}},{key:"buildSpeechToTextHeaders",value:function(e){return{"Ocp-Apim-Subscription-Key":e,Accept:"application/json"}}},{key:"handleSpeechVerificationResult",value:function(e,t,n,r){e.error?r(ErrorMessages.INVALID_KEY):n(t)}},{key:"buildSpeechKeyVerificationDetails",value:function(t){return{url:"https://".concat(t,".api.cognitive.microsoft.com/sts/v1.0/issuetoken"),method:"POST",createHeaders:function(e){return{"Ocp-Apim-Subscription-Key":"".concat(e)}},handleVerificationResult:e.handleSpeechVerificationResult}}},{key:"buildSummarizationHeader",value:function(e){return{"Ocp-Apim-Subscription-Key":e,"Content-Type":"application/json"}}},{key:"handleLanguageVerificationResult",value:function(e,t,n,r){var i;"401"===(null==(i=e.error)?void 0:i.code)?r(ErrorMessages.INVALID_KEY):n(t)}},{key:"buildLanguageKeyVerificationDetails",value:function(t){return{url:"".concat(t,"/language/analyze-text/jobs?api-version=2022-10-01-preview"),method:"POST",createHeaders:function(e){return{"Ocp-Apim-Subscription-Key":"".concat(e)}},handleVerificationResult:e.handleLanguageVerificationResult}}},{key:"handleTranslationVerificationResult",value:function(e,t,n,r){e.json().then((function(e){Array.isArray(e)||401e3!==e.error.code?n(t):r(ErrorMessages.INVALID_KEY)}))}},{key:"buildTranslationKeyVerificationDetails",value:function(t){return{url:"https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to=es",method:"POST",createHeaders:function(n){return e.buildTranslationHeaders(t,n)},handleVerificationResult:e.handleTranslationVerificationResult}}},{key:"buildTranslationHeaders",value:function(e,t){var n={"Ocp-Apim-Subscription-Key":t,"Content-Type":"application/json"};return e&&(n["Ocp-Apim-Subscription-Region"]=e),n}}]),e}(),AzureLanguageIO=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,a,s){var o;return _classCallCheck(this,n),(o=t.call(this,e,AzureUtils.buildLanguageKeyVerificationDetails(i),r,a,s)).insertKeyPlaceholderText="Azure Language Subscription Key",o.getKeyLink="https://learn.microsoft.com/en-us/azure/api-management/api-management-subscriptions#create-and-manage-subscriptions-in-azure-portal",o.permittedErrorPrefixes=["Access"],o}return _createClass(n)}(DirectServiceIO),AzureSummarizationIO=function(e){_inherits(a,e);var t,n,r,i=_createSuper(a);function a(e){var t,n,r,s,o,l;_classCallCheck(this,a);var c=null==(s=null==(r=e.directConnection)?void 0:r.azure)?void 0:s.summarization,u=null==(o=e.directConnection)?void 0:o.azure;return(n=i.call(this,e,AzureUtils.buildSummarizationHeader,c.endpoint,u)).url="",n.textInputPlaceholderText="Insert text to summarize",null!==(t=(l=n.rawBody).language)&&void 0!==t||(l.language="en"),Object.assign(n.rawBody,c),n.url="".concat(c.endpoint,"/language/analyze-text/jobs?api-version=2022-10-01-preview"),n}return _createClass(a,[{key:"preprocessBody",value:function(e,t){var n=t[t.length-1].text;if(n)return{analysisInput:{documents:[{id:"1",language:e.language,text:n}]},tasks:[{kind:"ExtractiveSummarization"}]}}},{key:"callServiceAPI",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.requestSettings){e.next=2;break}throw new Error("Request settings have not been set up");case 2:r=this.preprocessBody(this.rawBody,n),HTTPRequest.request(this,r,t),this.messages=t;case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,r,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.error){e.next=2;break}throw t.error.message;case 2:return this.messages&&this.completionsHandlers&&(r=t.headers.get("operation-location"),i={method:"GET",headers:null==(n=this.requestSettings)?void 0:n.headers},HTTPRequest.executePollRequest(this,r,i,this.messages)),e.abrupt("return",{pollingInAnotherRequest:!0});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"extractPollResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,r,i,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.error){e.next=2;break}throw t.error;case 2:if("running"!==t.status){e.next=4;break}return e.abrupt("return",{timeoutMS:2e3});case 4:if(!(t.errors.length>0)){e.next=6;break}throw t.errors[0];case 6:if(!(t.tasks.items[0].results.errors.length>0)){e.next=8;break}throw t.tasks.items[0].results.errors[0];case 8:n="",r=_createForOfIteratorHelper(t.tasks.items[0].results.documents[0].sentences);try{for(r.s();!(i=r.n()).done;)a=i.value,n+=a.text}catch(s){r.e(s)}finally{r.f()}return e.abrupt("return",{text:n||""});case 12:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),a}(AzureLanguageIO),_OpenAIConverseBaseBody=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"generateDefaultBody",value:function(e){return{model:e}}},{key:"build",value:function(t,n){var r=e.generateDefaultBody(t);return n&&"boolean"!=typeof n?Object.assign(r,n):r}}]),e}();_OpenAIConverseBaseBody.GPT_COMPLETIONS_DAVINCI_MODEL="text-davinci-003",_OpenAIConverseBaseBody.GPT_CHAT_TURBO_MODEL="gpt-3.5-turbo";var OpenAIConverseBaseBody=_OpenAIConverseBaseBody,_OpenAIUtils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"buildHeaders",value:function(e){return{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}},{key:"handleVerificationResult",value:function(e,t,n,r){var i=e;i.error?"invalid_api_key"===i.error.code?r(ErrorMessages.INVALID_KEY):r(ErrorMessages.CONNECTION_FAILED):n(t)}},{key:"buildKeyVerificationDetails",value:function(){return{url:"https://api.openai.com/v1/models",method:"GET",handleVerificationResult:e.handleVerificationResult}}}]),e}();_OpenAIUtils.CONVERSE_MAX_CHAR_LENGTH=13352,_OpenAIUtils.FILE_MAX_CHAR_LENGTH=1e3;var OpenAIUtils=_OpenAIUtils,OpenAICompletionsIO=function(e){_inherits(i,e);var t,n,r=_createSuper(i);function i(e){var t,n,a,s;_classCallCheck(this,i);var o=e.directConnection,l=e.textInput,c=null==o?void 0:o.openAI;(n=r.call(this,e,OpenAIUtils.buildKeyVerificationDetails(),OpenAIUtils.buildHeaders,c)).insertKeyPlaceholderText="OpenAI API Key",n.getKeyLink="https://platform.openai.com/account/api-keys",n.url="https://api.openai.com/v1/completions",n.permittedErrorPrefixes=["Incorrect"],n._maxCharLength=OpenAIUtils.CONVERSE_MAX_CHAR_LENGTH,n.full_transaction_max_tokens=4e3,n.numberOfCharsPerToken=3.5;var u=null==(a=null==o?void 0:o.openAI)?void 0:a.completions;return null!=l&&l.characterLimit&&(n._maxCharLength=l.characterLimit),"object"==_typeof(u)&&Object.assign(n.rawBody,u),null!==(t=(s=n.rawBody).model)&&void 0!==t||(s.model=OpenAIConverseBaseBody.GPT_COMPLETIONS_DAVINCI_MODEL),n}return _createClass(i,[{key:"preprocessBody",value:function(e,t){var n=JSON.parse(JSON.stringify(e)),r=t[t.length-1].text;if(r){var i=r.substring(0,this._maxCharLength),a=n.max_tokens||this.full_transaction_max_tokens-i.length/this.numberOfCharsPerToken;return _objectSpread({prompt:i,max_tokens:Math.floor(a)},n)}}},{key:"callServiceAPI",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.requestSettings){e.next=2;break}throw new Error("Request settings have not been set up");case 2:r=this.preprocessBody(this.rawBody,n),this.deepChat.stream||r.stream?(r.stream=!0,Stream.request(this,r,t)):HTTPRequest.request(this,r,t);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.error){e.next=2;break}throw t.error.message;case 2:return e.abrupt("return",{text:(null==(n=t.choices[0])?void 0:n.text)||""});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),i}(DirectServiceIO),AssemblyAIUtils=function(){function e(){_classCallCheck(this,e)}var t;return _createClass(e,null,[{key:"poll",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r,i,a,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={authorization:t,"content-type":"application/json"},e.t0="https://api.assemblyai.com/v2/transcript/",e.next=4,fetch("https://api.assemblyai.com/v2/transcript",{method:"POST",body:JSON.stringify({audio_url:n}),headers:r});case 4:return e.next=6,e.sent.json();case 6:e.t1=e.sent.id,i=e.t0.concat.call(e.t0,e.t1);case 8:if(a){e.next=24;break}return e.next=11,fetch(i,{headers:r});case 11:return e.next=13,e.sent.json();case 13:if("completed"!==(s=e.sent).status){e.next=18;break}a=s,e.next=22;break;case 18:if("error"!==s.status){e.next=20;break}throw new Error("Transcription failed: ".concat(s.error));case 20:return e.next=22,new Promise((function(e){return setTimeout(e,3e3)}));case 22:e.next=8;break;case 24:return e.abrupt("return",a);case 25:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})},{key:"buildHeaders",value:function(e){return{Authorization:e,"Content-Type":"application/octet-stream"}}},{key:"handleVerificationResult",value:function(e,t,n,r){var i=e;i.error?"invalid_api_key"===i.error.code?r(ErrorMessages.INVALID_KEY):r(ErrorMessages.CONNECTION_FAILED):n(t)}},{key:"buildKeyVerificationDetails",value:function(){return{url:"https://api.assemblyai.com/v2/upload",method:"POST",handleVerificationResult:e.handleVerificationResult}}}]),e}(),AssemblyAIAudioIO=function(e){_inherits(i,e);var t,n,r=_createSuper(i);function i(e){var t,n;_classCallCheck(this,i);var a=null==(n=e.directConnection)?void 0:n.assemblyAI;return(t=r.call(this,e,AssemblyAIUtils.buildKeyVerificationDetails(),AssemblyAIUtils.buildHeaders,a,{audio:{}})).insertKeyPlaceholderText="AssemblyAI API Key",t.getKeyLink="https://www.assemblyai.com/app/account",t.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>AssemblyAI Audio</b></div>\n    <p><b>Upload an audio file</b> to transcribe it into text.\n    <p>\n      Click <a href="https://www.assemblyai.com/docs/Guides/transcribing_an_audio_file#get-started">here</a> for more info.\n    </p>',t.url="https://api.assemblyai.com/v2/upload",t.isTextInputDisabled=!0,t.textInputPlaceholderText="Upload an audio file",t.permittedErrorPrefixes=["Authentication","Invalid"],t.canSendMessage=i.canFileSendMessage,t}return _createClass(i,[{key:"callServiceAPI",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n,r){var i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(i=this.requestSettings)&&i.headers){e.next=2;break}throw new Error("Request settings have not been set up");case 2:if(null!=r&&r[0]){e.next=4;break}throw new Error("No file was added");case 4:HTTPRequest.request(this,r[0],t,!1);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,r,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.error){e.next=2;break}throw t.error;case 2:return i=null==(r=null==(n=this.requestSettings)?void 0:n.headers)?void 0:r.Authorization,e.next=5,AssemblyAIUtils.poll(i,t.upload_url);case 5:return e.t0=e.sent.text,e.abrupt("return",{text:e.t0});case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"canFileSendMessage",value:function(e,t){return!(null==t||!t[0])}}]),i}(DirectServiceIO),AzureSpeechIO=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,a,s){var o;return _classCallCheck(this,n),(o=t.call(this,e,AzureUtils.buildSpeechKeyVerificationDetails(i),r,a,s)).insertKeyPlaceholderText="Azure Speech Subscription Key",o.getKeyLink="https://learn.microsoft.com/en-us/azure/api-management/api-management-subscriptions#create-and-manage-subscriptions-in-azure-portal",o}return _createClass(n)}(DirectServiceIO),_AzureTextToSpeechIO=function(e){_inherits(i,e);var t,n,r=_createSuper(i);function i(e){var t,n,a,s,o,l,c,u,d,p;_classCallCheck(this,i);var h=null==(l=null==(o=e.directConnection)?void 0:o.azure)?void 0:l.textToSpeech,f=null==(c=e.directConnection)?void 0:c.azure;return(s=r.call(this,e,AzureUtils.buildTextToSpeechHeaders.bind({},(null==h?void 0:h.outputFormat)||"audio-16khz-128kbitrate-mono-mp3"),h.region,f)).introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Azure Text To Speech</b></div>\n    <p>Insert text to synthesize it to audio.\n    <p>\n      Click <a href="'.concat(i.HELP_LINK,'">here</a> for more info.\n    </p>'),s.url="",Object.assign(s.rawBody,h),null!==(t=(u=s.rawBody).lang)&&void 0!==t||(u.lang="en-US"),null!==(n=(d=s.rawBody).name)&&void 0!==n||(d.name="en-US-JennyNeural"),null!==(a=(p=s.rawBody).gender)&&void 0!==a||(p.gender="Female"),s.url="https://".concat(h.region,".tts.speech.microsoft.com/cognitiveservices/v1"),s}return _createClass(i,[{key:"preprocessBody",value:function(e,t){var n=t[t.length-1].text;if(n)return"<speak version='1.0' xml:lang='".concat(e.lang,"'>\n      <voice xml:lang='").concat(e.lang,"' xml:gender='").concat(e.gender,"' name='").concat(e.name,"'>\n        ").concat(n,"\n      </voice>\n    </speak>")}},{key:"callServiceAPI",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.requestSettings){e.next=2;break}throw new Error("Request settings have not been set up");case 2:r=this.preprocessBody(this.rawBody,n),HTTPRequest.request(this,r,t,!1);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=new FileReader;n.readAsDataURL(t),n.onload=function(t){e({files:[{src:t.target.result,type:"audio"}]})}})));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),i}(AzureSpeechIO);_AzureTextToSpeechIO.HELP_LINK="https://learn.microsoft.com/en-GB/azure/cognitive-services/speech-service/get-started-text-to-speech?tabs=windows%2Cterminal&pivots=programming-language-rest";var AzureTextToSpeechIO=_AzureTextToSpeechIO,_AzureSpeechToTextIO=function(e){_inherits(i,e);var t,n,r=_createSuper(i);function i(e){var t,n,a,s;_classCallCheck(this,i);var o=null==(a=null==(n=e.directConnection)?void 0:n.azure)?void 0:a.speechToText,l=null==(s=e.directConnection)?void 0:s.azure;(t=r.call(this,e,AzureUtils.buildSpeechToTextHeaders,o.region,l,{audio:{files:{acceptedFormats:".wav,.ogg"}}})).introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Azure Speech To Text</b></div>\n    <p><b>Upload a .wav or .ogg audio file</b> to transcribe it into text.\n    <p>\n      Click <a href="'.concat(i.HELP_LINK,'">here</a> for more info.\n    </p>'),t.url="",t.isTextInputDisabled=!0,t.textInputPlaceholderText="Upload an audio file",t.canSendMessage=i.canFileSendMessage;var c=o.lang||"en-US";return t.url="https://".concat(o.region,".stt.speech.microsoft.com/speech/recognition/conversation/cognitiveservices/v1?language=").concat(c,"&format=detailed"),t.recordAudio=void 0,t}return _createClass(i,[{key:"callServiceAPI",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n,r){var i,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(i=this.requestSettings)&&i.headers){e.next=2;break}throw new Error("Request settings have not been set up");case 2:if(null!=r&&r[0]){e.next=4;break}throw new Error("No file was added");case 4:null!=(a=this.requestSettings)&&a.headers&&(this.requestSettings.headers["Content-Type"]=r[0].name.toLocaleLowerCase().endsWith(".wav")?"audio/wav; codecs=audio/pcm; samplerate=16000":"audio/ogg; codecs=opus"),HTTPRequest.request(this,r[0],t,!1);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.error){e.next=2;break}throw t.error;case 2:return e.abrupt("return",{text:t.DisplayText||""});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}],[{key:"canFileSendMessage",value:function(e,t){return!(null==t||!t[0])}}]),i}(AzureSpeechIO);_AzureSpeechToTextIO.HELP_LINK="https://learn.microsoft.com/en-GB/azure/cognitive-services/speech-service/get-started-text-to-speech?tabs=windows%2Cterminal&pivots=programming-language-rest";var AzureSpeechToTextIO=_AzureSpeechToTextIO,AzureTranslationIO=function(e){_inherits(i,e);var t,n,r=_createSuper(i);function i(e){var t,n,a,s;_classCallCheck(this,i);var o=null==(a=null==(n=e.directConnection)?void 0:n.azure)?void 0:a.translation,l=null==(s=e.directConnection)?void 0:s.azure;return(t=r.call(this,e,AzureUtils.buildTranslationKeyVerificationDetails(o.region),AzureUtils.buildTranslationHeaders.bind({},null==o?void 0:o.region),l)).insertKeyPlaceholderText="Azure Translate Subscription Key",t.getKeyLink="https://learn.microsoft.com/en-us/azure/api-management/api-management-subscriptions#create-and-manage-subscriptions-in-azure-portal",t.url="",t.url="https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to=".concat(o.language||"es"),t}return _createClass(i,[{key:"preprocessBody",value:function(e){var t=e[e.length-1].text;if(t)return[{Text:t}]}},{key:"callServiceAPI",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.requestSettings){e.next=2;break}throw new Error("Request settings have not been set up");case 2:r=this.preprocessBody(n),HTTPRequest.request(this,r,t);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t)){e.next=2;break}return e.abrupt("return",{text:(null==(n=t[0].translations)?void 0:n[0].text)||""});case 2:throw t.error;case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),i}(DirectServiceIO),_OpenAIImagesIO=function(e){_inherits(i,e);var t,n,r=_createSuper(i);function i(e){var t,n;_classCallCheck(this,i);var a=e.directConnection,s=e.textInput,o=null==a?void 0:a.openAI;(t=r.call(this,e,OpenAIUtils.buildKeyVerificationDetails(),OpenAIUtils.buildHeaders,o,{images:{files:{acceptedFormats:".png",maxNumberOfFiles:2}}})).insertKeyPlaceholderText="OpenAI API Key",t.getKeyLink="https://platform.openai.com/account/api-keys",t.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>OpenAI DALL\xb7E</b></div>\n    <p><b>Insert text</b> to generate an image.</p>\n    <p><b>Upload 1</b> PNG image to generate its variation and optionally insert text to specify the change.</p>\n    <p><b>Upload 2</b> PNG images where the second is a copy of the first with a transparent area where the edit should\n      take place and text to specify the edit.</p>\n    <p>Click <a href="https://platform.openai.com/docs/guides/images/introduction">here</a> for more info.</p>',t.url="",t.permittedErrorPrefixes=["Incorrect","Invalid input image"],t._maxCharLength=OpenAIUtils.FILE_MAX_CHAR_LENGTH,null!=s&&s.characterLimit&&(t._maxCharLength=s.characterLimit);var l=null==(n=null==a?void 0:a.openAI)?void 0:n.images;if(t.camera){var c="object"==_typeof(l)&&l.size?Number.parseInt(l.size):1024;t.camera.files={dimensions:{width:c,height:c}}}return"object"==_typeof(l)&&Object.assign(t.rawBody,l),t.canSendMessage=i.canFileSendMessage,t}return _createClass(i,[{key:"preprocessBody",value:function(e,t){var n=JSON.parse(JSON.stringify(e));if(t&&""!==t){var r=t.substring(0,this._maxCharLength);n.prompt=r}return n}},{key:"callApiWithImage",value:function(e,t,n){var r,a,s,o=null==(a=null==(r=t[t.length-1])?void 0:r.text)?void 0:a.trim();if(n[1]||o&&""!==o){this.url=i.IMAGE_EDIT_URL;var l=this.preprocessBody(this.rawBody,o);s=i.createFormDataBody(l,n[0],n[1])}else this.url=i.IMAGE_VARIATIONS_URL,s=i.createFormDataBody(this.rawBody,n[0]);RequestUtils.temporarilyRemoveHeader(this.requestSettings,HTTPRequest.request.bind(this,this,s,e),!1)}},{key:"callServiceAPI",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n,r){var a,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(a=this.requestSettings)&&a.headers){e.next=2;break}throw new Error("Request settings have not been set up");case 2:if(null==r||!r[0]){e.next=6;break}this.callApiWithImage(t,n,r),e.next=11;break;case 6:if(this.requestSettings){e.next=8;break}throw new Error("Request settings have not been set up");case 8:this.url=i.IMAGE_GENERATION_URL,s=this.preprocessBody(this.rawBody,n[n.length-1].text),HTTPRequest.request(this,s,t);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.error){e.next=2;break}throw t.error.message;case 2:return e.abrupt("return",{files:t.data.map((function(e){return e.url?{src:e.url,type:"image"}:{src:"".concat(BASE_64_PREFIX).concat(e.b64_json),type:"image"}}))});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}],[{key:"canFileSendMessage",value:function(e,t){return!(null==t||!t[0])||!(!e||""===e.trim())}},{key:"createFormDataBody",value:function(e,t,n){var r=new FormData;return r.append("image",t),n&&r.append("mask",n),Object.keys(e).forEach((function(t){r.append(t,String(e[t]))})),r}}]),i}(DirectServiceIO);_OpenAIImagesIO.IMAGE_GENERATION_URL="https://api.openai.com/v1/images/generations",_OpenAIImagesIO.IMAGE_VARIATIONS_URL="https://api.openai.com/v1/images/variations",_OpenAIImagesIO.IMAGE_EDIT_URL="https://api.openai.com/v1/images/edits";var OpenAIImagesIO=_OpenAIImagesIO,_OpenAIAudioIO=function(e){_inherits(i,e);var t,n,r=_createSuper(i);function i(e){var t,n,a,s;_classCallCheck(this,i);var o=e.directConnection,l=e.textInput,c=null==o?void 0:o.openAI;(n=r.call(this,e,OpenAIUtils.buildKeyVerificationDetails(),OpenAIUtils.buildHeaders,c,{audio:{}})).insertKeyPlaceholderText="OpenAI API Key",n.getKeyLink="https://platform.openai.com/account/api-keys",n.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>OpenAI Whisper</b></div>\n    <p><b>Upload an audio file</b> to transcribe it into text. You can optionally provide text to guide the audio\n      processing.\n    <p>Click <a href="https://platform.openai.com/docs/api-reference/audio/create">here</a> for more info.</p>',n.url="",n.permittedErrorPrefixes=["Invalid"],n._maxCharLength=OpenAIUtils.FILE_MAX_CHAR_LENGTH,n._service_url=i.AUDIO_TRANSCRIPTIONS_URL,null!=l&&l.characterLimit&&(n._maxCharLength=l.characterLimit);var u=null==(a=null==o?void 0:o.openAI)?void 0:a.audio;return"object"==_typeof(u)&&(n.processConfig(u),i.cleanConfig(u),Object.assign(n.rawBody,u)),null!==(t=(s=n.rawBody).model)&&void 0!==t||(s.model=i.DEFAULT_MODEL),n.rawBody.response_format="json",n.canSendMessage=i.canSendFileMessage,n}return _createClass(i,[{key:"processConfig",value:function(e){null!=e&&e.type&&"translation"===e.type&&(this._service_url=i.AUDIO_TRANSLATIONS_URL,delete e.language)}},{key:"preprocessBody",value:function(e,t,n){var r,i,a=JSON.parse(JSON.stringify(e)),s=null==(i=null==(r=t[t.length-n.length+1])?void 0:r.text)?void 0:i.trim();if(s&&""!==s){var o=s.substring(0,this._maxCharLength);a.prompt=o}return a}},{key:"callServiceAPI",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n,r){var a,s,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(a=this.requestSettings)&&a.headers){e.next=2;break}throw new Error("Request settings have not been set up");case 2:if(null!=r&&r[0]){e.next=4;break}throw new Error("No file was added");case 4:this.url=this.requestSettings.url||this._service_url,s=this.preprocessBody(this.rawBody,n,r),o=i.createFormDataBody(s,r[0]),RequestUtils.temporarilyRemoveHeader(this.requestSettings,HTTPRequest.request.bind(this,this,o,t),!1);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.error){e.next=2;break}throw t.error.message;case 2:return e.abrupt("return",{text:t.text});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}],[{key:"canSendFileMessage",value:function(e,t){return!(null==t||!t[0])}},{key:"cleanConfig",value:function(e){delete e.type}},{key:"createFormDataBody",value:function(e,t){var n=new FormData;return n.append("file",t),Object.keys(e).forEach((function(t){n.append(t,String(e[t]))})),n}}]),i}(DirectServiceIO);_OpenAIAudioIO.AUDIO_TRANSCRIPTIONS_URL="https://api.openai.com/v1/audio/transcriptions",_OpenAIAudioIO.AUDIO_TRANSLATIONS_URL="https://api.openai.com/v1/audio/translations",_OpenAIAudioIO.DEFAULT_MODEL="whisper-1";var OpenAIAudioIO=_OpenAIAudioIO,OpenAIChatIO=function(e){_inherits(i,e);var t,n,r=_createSuper(i);function i(e){var t,n,a,s,o,l;_classCallCheck(this,i);var c=null==(a=e.directConnection)?void 0:a.openAI;(n=r.call(this,e,OpenAIUtils.buildKeyVerificationDetails(),OpenAIUtils.buildHeaders,c)).insertKeyPlaceholderText="OpenAI API Key",n.getKeyLink="https://platform.openai.com/account/api-keys",n.url="https://api.openai.com/v1/chat/completions",n.permittedErrorPrefixes=["Incorrect"],n._systemMessage=i.generateSystemMessage("You are a helpful assistant.");var u=null==(o=null==(s=e.directConnection)?void 0:s.openAI)?void 0:o.chat;return"object"==_typeof(u)&&(u.systemPrompt&&(n._systemMessage=i.generateSystemMessage(u.systemPrompt)),n.cleanConfig(u),Object.assign(n.rawBody,u)),void 0===n.maxMessages&&(n.maxMessages=-1),null!==(t=(l=n.rawBody).model)&&void 0!==t||(l.model=OpenAIConverseBaseBody.GPT_CHAT_TURBO_MODEL),n}return _createClass(i,[{key:"cleanConfig",value:function(e){delete e.systemPrompt}},{key:"preprocessBody",value:function(e,t){var n=JSON.parse(JSON.stringify(e)),r=this.totalMessagesMaxCharLength||OpenAIUtils.CONVERSE_MAX_CHAR_LENGTH,i=MessageLimitUtils.getCharacterLimitMessages(t,r-this._systemMessage.content.length).map((function(e){return{content:e.text,role:"ai"===e.role?"assistant":"user"}}));return n.messages=[this._systemMessage].concat(_toConsumableArray(i)),n}},{key:"callServiceAPI",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.requestSettings){e.next=2;break}throw new Error("Request settings have not been set up");case 2:r=this.preprocessBody(this.rawBody,n),this.deepChat.stream||r.stream?(r.stream=!0,Stream.request(this,r,t)):HTTPRequest.request(this,r,t);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.error){e.next=2;break}throw t.error.message;case 2:return e.abrupt("return",t.choices[0].delta?{text:t.choices[0].delta.content||""}:t.choices[0].message?{text:t.choices[0].message.content}:{text:""});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}],[{key:"generateSystemMessage",value:function(e){return{role:"system",content:e}}}]),i}(DirectServiceIO),CohereChatIO=function(e){_inherits(i,e);var t,n,r=_createSuper(i);function i(e){var t,n,a,s;_classCallCheck(this,i);var o=null==(a=null==(n=e.directConnection)?void 0:n.cohere)?void 0:a.chat,l=null==(s=e.directConnection)?void 0:s.cohere;return(t=r.call(this,e,"https://api.cohere.ai/v1/chat","Ask me anything!",o,l)).username="USER","object"==_typeof(o)&&(o.user_name&&(t.username=o.user_name),t.cleanConfig(o),Object.assign(t.rawBody,o)),void 0===t.maxMessages&&(t.maxMessages=-1),t}return _createClass(i,[{key:"cleanConfig",value:function(e){delete e.user_name}},{key:"preprocessBody",value:function(e,t){var n=this,r=JSON.parse(JSON.stringify(e));return r.query=t[t.length-1].text,r.chat_history=t.slice(0,t.length-1).map((function(e){return{text:e.text,user_name:"ai"===e.role?"CHATBOT":n.username}})),r}},{key:"callServiceAPI",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.requestSettings){e.next=2;break}throw new Error("Request settings have not been set up");case 2:r=this.preprocessBody(this.rawBody,n),HTTPRequest.request(this,r,t);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"extractResultData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.message){e.next=2;break}throw t.message;case 2:return e.abrupt("return",{text:t.text});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),i}(CohereIO),ServiceIOFactory=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"create",value:function(e){var t=e.directConnection,n=e.request;if(t){if(t.openAI)return t.openAI.images?new OpenAIImagesIO(e):t.openAI.audio?new OpenAIAudioIO(e):t.openAI.completions?new OpenAICompletionsIO(e):new OpenAIChatIO(e);if(t.assemblyAI)return new AssemblyAIAudioIO(e);if(t.cohere)return t.cohere.chat?new CohereChatIO(e):t.cohere.summarization?new CohereSummarizationIO(e):new CohereTextGenerationIO(e);if(t.huggingFace)return t.huggingFace.textGeneration?new HuggingFaceTextGenerationIO(e):t.huggingFace.summarization?new HuggingFaceSummarizationIO(e):t.huggingFace.translation?new HuggingFaceTranslationIO(e):t.huggingFace.fillMask?new HuggingFaceFillMaskIO(e):t.huggingFace.questionAnswer?new HuggingFaceQuestionAnswerIO(e):t.huggingFace.audioSpeechRecognition?new HuggingFaceAudioRecognitionIO(e):t.huggingFace.audioClassification?new HuggingFaceAudioClassificationIO(e):t.huggingFace.imageClassification?new HuggingFaceImageClassificationIO(e):new HuggingFaceConversationIO(e);if(t.azure){if(t.azure.speechToText)return new AzureSpeechToTextIO(e);if(t.azure.textToSpeech)return new AzureTextToSpeechIO(e);if(t.azure.summarization)return new AzureSummarizationIO(e);if(t.azure.translation)return new AzureTranslationIO(e)}if(t.stabilityAI)return t.stabilityAI.imageToImage?new StabilityAIImageToImageIO(e):t.stabilityAI.imageToImageUpscale?new StabilityAIImageToImageUpscaleIO(e):t.stabilityAI.imageToImageMasking?new StabilityAIImageToImageMaskingIO(e):new StabilityAITextToImageIO(e);if(t.demo&&(null==n||!n.url))return new BaseServiceIO(e,void 0,t.demo)}return new BaseServiceIO(e)}}]),e}(),_GoogleFont=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"appendStyleSheetToHead",value:function(){var t=document.getElementsByTagName("head")[0];if(!Array.from(t.getElementsByTagName("link")).some((function(t){return t.getAttribute("href")===e.FONT_URL}))){var n=document.createElement("link");n.rel="stylesheet",n.href=e.FONT_URL,t.appendChild(n)}}}]),e}();_GoogleFont.FONT_URL="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap";var GoogleFont=_GoogleFont,TypeConverters=_createClass((function e(){_classCallCheck(this,e)}));function Property(e){return function(t,n){Object.defineProperty(t,n,{});var r=t.constructor,i=n.toLocaleLowerCase();r._attributes_[i]=TypeConverters.attibutes[e],r._attributeToProperty_[i]=n}}TypeConverters.attibutes={string:function(e){return e},number:function(e){return parseFloat(e)},boolean:function(e){return"true"===e},object:function(e){return JSON.parse(e)},array:function(e){return JSON.parse(e)},function:function _function(value){return eval(value)}};var FireEvents=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"onNewMessage",value:function(e,t,n){var r=JSON.parse(JSON.stringify({message:t,isInitial:n}));e.onNewMessage(r),e.dispatchEvent(new CustomEvent("new-message",{detail:r}))}},{key:"onMessagesCleared",value:function(e){e.onMessagesCleared(),e.dispatchEvent(new CustomEvent("messages-cleared"))}},{key:"onRender",value:function(e){e.onComponentRender(),e.dispatchEvent(new CustomEvent("render"))}}]),e}(),_ElementUtils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"addElements",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach((function(t){return e.appendChild(t)}))}},{key:"isScrollbarAtBottomOfElement",value:function(t){var n=t.scrollHeight,r=t.clientHeight;return t.scrollTop>=n-r-e.CODE_SNIPPET_GENERATION_JUMP}},{key:"cloneElement",value:function(e){var t=e.cloneNode(!0);return e.parentNode.replaceChild(t,e),t}}]),e}();_ElementUtils.CODE_SNIPPET_GENERATION_JUMP=.5;var ElementUtils=_ElementUtils,_TextToSpeech=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"speak",value:function(e,t){if(window.SpeechSynthesisUtterance){var n=new SpeechSynthesisUtterance(e);Object.assign(n,t),speechSynthesis.speak(n)}}},{key:"processConfig",value:function(t,n){var r={};setTimeout((function(){if("object"==_typeof(t)&&(t.lang&&(r.lang=t.lang),t.pitch&&(r.pitch=t.pitch),t.rate&&(r.rate=t.rate),t.volume&&(r.volume=t.volume),t.voiceName)){var e=window.speechSynthesis.getVoices().find((function(e){var n;return e.name.toLocaleLowerCase()===(null==(n=t.voiceName)?void 0:n.toLocaleLowerCase())}));e&&(r.voice=e)}n(r)}),e.LOAD_VOICES_MS)}}]),e}();_TextToSpeech.LOAD_VOICES_MS=200;var TextToSpeech=_TextToSpeech,LoadingMessageDotsStyle=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"colorToHex",value:function(e){var t=document.createElement("div");return t.style.color=e,document.body.appendChild(t),"#".concat(window.getComputedStyle(t).color.match(/\d+/g).map((function(e){return parseInt(e).toString(16).padStart(2,"0")})).join(""))}},{key:"set",value:function(t,n){var r,i,a,s;if(null!=(i=null==(r=null==n?void 0:n.loading)?void 0:r.bubble)&&i.color){var o=e.colorToHex(null==(s=null==(a=null==n?void 0:n.loading)?void 0:a.bubble)?void 0:s.color);t.style.setProperty("--message-dots-color",o),t.style.setProperty("--message-dots-color-fade","".concat(o,"33"))}else t.style.setProperty("--message-dots-color","#848484"),t.style.setProperty("--message-dots-color-fade","#55555533")}}]),e}(),MessageStyleUtils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"applyCustomStylesToElements",value:function(e,t,n){if(n&&(Object.assign(e.outerContainer.style,n.outerContainer),Object.assign(e.innerContainer.style,n.innerContainer),Object.assign(e.bubbleElement.style,n.bubble),t)){var r=e.bubbleElement.children[0],i="a"!==r.tagName.toLocaleLowerCase()?r:r.children[0];Object.assign(i.style,n.media)}}},{key:"applySideStyles",value:function(t,n,r,i){i&&(e.applyCustomStylesToElements(t,r,i.shared),n?e.applyCustomStylesToElements(t,r,i.ai):e.applyCustomStylesToElements(t,r,i.user))}},{key:"isMessageSideStyles",value:function(e){return!!(e.ai||e.shared||e.user)}},{key:"applyCustomStyles",value:function(t,n,r,i,a){var s;a&&t.default!==a?e.isMessageSideStyles(a)?(e.applySideStyles(n,r,i,t.default),e.applySideStyles(n,r,i,a)):(e.applyCustomStylesToElements(n,i,null==(s=t.default)?void 0:s.shared),e.applyCustomStylesToElements(n,i,a)):e.applySideStyles(n,r,i,t.default)}},{key:"extractParticularSharedStyles",value:function(e,t){if(null!=t&&t.shared){var n=t.shared,r={outerContainer:{},innerContainer:{},bubble:{},media:{}};return e.forEach((function(e){var t,i,a,s;r.outerContainer[e]=(null==(t=n.outerContainer)?void 0:t[e])||"",r.innerContainer[e]=(null==(i=n.innerContainer)?void 0:i[e])||"",r.bubble[e]=(null==(a=n.bubble)?void 0:a[e])||"",r.media[e]=(null==(s=n.media)?void 0:s[e])||""})),r}}}]),e}(),IntroPanel=function(){function e(t,n,r){_classCallCheck(this,e),this._isDisplayed=!1,t?(this._elementRef=this.createIntroPanelWithChild(t,r),this._isDisplayed=!0):n&&(this._elementRef=this.createInternalIntroPanel(n,r),this._isDisplayed=!0)}return _createClass(e,[{key:"createIntroPanelWithChild",value:function(t,n){var r=e.createIntroPanel(n);return"none"===t.style.display&&(t.style.display="block"),r.appendChild(t),r}},{key:"createInternalIntroPanel",value:function(t,n){var r=e.createIntroPanel(n);return r.id="internal-intro-panel",r.innerHTML=t,r}},{key:"hide",value:function(){this._isDisplayed&&this._elementRef&&(this._elementRef.style.display="none",this._isDisplayed=!1)}},{key:"display",value:function(){!this._isDisplayed&&this._elementRef&&(this._elementRef.style.display="",this._isDisplayed=!0)}}],[{key:"createIntroPanel",value:function(e){var t=document.createElement("div");return t.classList.add("intro-panel"),Object.assign(t.style,e),t}}]),e}(),_FileMessageUtils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"updateMessages",value:function(e,t,n,r,i){var a,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];e.applyCustomStyles(t,i,!0,null==(a=e.messageStyles)?void 0:a[r]),e.elementRef.scrollTop=e.elementRef.scrollHeight;var o=Messages.createMessageContent(i,void 0,n);e.messages.push(o),e.sendClientUpdate(o,s)}},{key:"wrapInLink",value:function(e,t){var n=document.createElement("a");return n.href=t,n.target="_blank",n.appendChild(e),n}},{key:"processContent",value:function(t,n){return!n||n.startsWith("data")?t:e.wrapInLink(t,n)}},{key:"waitToLoadThenScroll",value:function(e){setTimeout((function(){e.scrollTop=e.scrollHeight}),60)}},{key:"scrollDownOnImageLoad",value:function(t,n){if(t.startsWith("data"))e.waitToLoadThenScroll(n);else try{fetch(t,{mode:"no-cors"}).catch((function(){})).finally((function(){e.waitToLoadThenScroll(n)}))}catch(r){n.scrollTop=n.scrollHeight}}}]),e}();_FileMessageUtils.DEFAULT_FILE_NAME="file";var FileMessageUtils=_FileMessageUtils,FILE_ICON_STRING='<?xml version="1.0" encoding="iso-8859-1"?>\n<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" \n\t viewBox="50 30 420 450" xml:space="preserve">\n<g filter="brightness(0) saturate(100%) invert(16%) sepia(0%) saturate(1942%) hue-rotate(215deg) brightness(99%) contrast(93%)">\n\t<g>\n\t\t<path d="M447.933,103.629c-0.034-3.076-1.224-6.09-3.485-8.352L352.683,3.511c-0.004-0.004-0.007-0.005-0.011-0.008\n\t\t\tC350.505,1.338,347.511,0,344.206,0H89.278C75.361,0,64.04,11.32,64.04,25.237v461.525c0,13.916,11.32,25.237,25.237,25.237\n\t\t\th333.444c13.916,0,25.237-11.32,25.237-25.237V103.753C447.96,103.709,447.937,103.672,447.933,103.629z M356.194,40.931\n\t\t\tl50.834,50.834h-49.572c-0.695,0-1.262-0.567-1.262-1.262V40.931z M423.983,486.763c0,0.695-0.566,1.261-1.261,1.261H89.278\n\t\t\tc-0.695,0-1.261-0.566-1.261-1.261V25.237c0-0.695,0.566-1.261,1.261-1.261h242.94v66.527c0,13.916,11.322,25.239,25.239,25.239\n\t\t\th66.527V486.763z"/>\n\t</g>\n</g>\n<g>\n\t<g>\n\t\t<path d="M362.088,164.014H149.912c-6.62,0-11.988,5.367-11.988,11.988c0,6.62,5.368,11.988,11.988,11.988h212.175\n\t\t\tc6.62,0,11.988-5.368,11.988-11.988C374.076,169.381,368.707,164.014,362.088,164.014z"/>\n\t</g>\n</g>\n<g>\n\t<g>\n\t\t<path d="M362.088,236.353H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.62,5.368,11.988,11.988,11.988h212.175\n\t\t\tc6.62,0,11.988-5.368,11.988-11.988C374.076,241.721,368.707,236.353,362.088,236.353z"/>\n\t</g>\n</g>\n<g>\n\t<g>\n\t\t<path d="M362.088,308.691H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.621,5.368,11.988,11.988,11.988h212.175\n\t\t\tc6.62,0,11.988-5.367,11.988-11.988C374.076,314.06,368.707,308.691,362.088,308.691z"/>\n\t</g>\n</g>\n<g>\n\t<g>\n\t\t<path d="M256,381.031H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.621,5.368,11.988,11.988,11.988H256\n\t\t\tc6.62,0,11.988-5.367,11.988-11.988C267.988,386.398,262.62,381.031,256,381.031z"/>\n\t</g>\n</g>\n</svg>',FileMessages=function(){function e(){_classCallCheck(this,e)}var t;return _createClass(e,null,[{key:"createImage",value:function(e,t){var n=new Image;return n.src=e.src,FileMessageUtils.scrollDownOnImageLoad(n.src,t),FileMessageUtils.processContent(n,n.src)}},{key:"addNewImageMessage",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function t(n,r,i){var a,s,o,l=arguments;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=l.length>3&&void 0!==l[3]&&l[3],s=e.createImage(r,n.elementRef),(o=n.createNewMessageElement("",i)).bubbleElement.appendChild(s),o.bubbleElement.classList.add("image-message"),n.elementRef.appendChild(o.outerContainer),FileMessageUtils.updateMessages(n,o,r,"image",i,a);case 3:case"end":return t.stop()}}),t)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"createAudioElement",value:function(e,t){var n=document.createElement("audio");return n.src=e.src,n.classList.add("audio-player"),n.controls=!0,Browser$1.IS_SAFARI&&(n.classList.add("audio-player-safari"),n.classList.add(t?"audio-player-safari-left":"audio-player-safari-right")),n}},{key:"addNewAudioMessage",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.createAudioElement(n,r),s=t.createNewMessageElement("",r);s.bubbleElement.appendChild(a),s.bubbleElement.classList.add("audio-message"),t.elementRef.appendChild(s.outerContainer),FileMessageUtils.updateMessages(t,s,n,"audio",r,i)}},{key:"createAnyFile",value:function(e){var t=document.createElement("div");t.classList.add("any-file-message-contents");var n=document.createElement("div");n.classList.add("any-file-message-icon-container");var r=SVGIconUtils.createSVGElement(FILE_ICON_STRING);r.classList.add("any-file-message-icon"),n.appendChild(r);var i=document.createElement("div");return i.classList.add("any-file-message-text"),i.textContent=e.name||FileMessageUtils.DEFAULT_FILE_NAME,t.appendChild(n),t.appendChild(i),FileMessageUtils.processContent(t,e.src)}},{key:"addNewAnyFileMessage",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=t.createNewMessageElement("",r),s=e.createAnyFile(n);a.bubbleElement.classList.add("any-file-message-bubble"),a.bubbleElement.appendChild(s),t.elementRef.appendChild(a.outerContainer),FileMessageUtils.updateMessages(t,a,n,"file",r,i)}}]),e}(),aiLogoUrl="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8c3ZnIGZpbGw9IiMwMDAwMDAiIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIAoJCXZpZXdCb3g9IjAgMCAzMiAzMiIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+Cgk8cGF0aCBkPSJNMjMsMzAuMzZIOWMtMi40MDQsMC00LjM2LTEuOTU2LTQuMzYtNC4zNlYxNWMwLTIuNDA0LDEuOTU2LTQuMzYsNC4zNi00LjM2aDMuNjU5CgkJYzAuMTY3LTEuNTY2LDEuNDE1LTIuODEzLDIuOTgxLTIuOTgxVjUuMzMzYy0xLjEzMS0wLjE3NC0yLTEuMTU0LTItMi4zMzNjMC0xLjMwMSwxLjA1OS0yLjM2LDIuMzYtMi4zNgoJCWMxLjMwMiwwLDIuMzYsMS4wNTksMi4zNiwyLjM2YzAsMS4xNzktMC44NjksMi4xNTktMiwyLjMzM1Y3LjY2YzEuNTY2LDAuMTY3LDIuODE0LDEuNDE1LDIuOTgxLDIuOTgxSDIzCgkJYzIuNDA0LDAsNC4zNiwxLjk1Niw0LjM2LDQuMzZ2MTFDMjcuMzYsMjguNDA0LDI1LjQwNCwzMC4zNiwyMywzMC4zNnogTTksMTEuMzZjLTIuMDA3LDAtMy42NCwxLjYzMy0zLjY0LDMuNjR2MTEKCQljMCwyLjAwNywxLjYzMywzLjY0LDMuNjQsMy42NGgxNGMyLjAwNywwLDMuNjQtMS42MzMsMy42NC0zLjY0VjE1YzAtMi4wMDctMS42MzMtMy42NC0zLjY0LTMuNjRIOXogTTEzLjM4NCwxMC42NGg1LjIzMQoJCUMxOC40MzksOS4zNTQsMTcuMzM0LDguMzYsMTYsOC4zNkMxNC42NjcsOC4zNiwxMy41NjEsOS4zNTQsMTMuMzg0LDEwLjY0eiBNMTYsMS4zNmMtMC45MDQsMC0xLjY0LDAuNzM2LTEuNjQsMS42NAoJCVMxNS4wOTYsNC42NCwxNiw0LjY0YzAuOTA0LDAsMS42NC0wLjczNiwxLjY0LTEuNjRTMTYuOTA0LDEuMzYsMTYsMS4zNnogTTIwLDI3LjM2aC04Yy0xLjMwMSwwLTIuMzYtMS4wNTktMi4zNi0yLjM2CgkJczEuMDU5LTIuMzYsMi4zNi0yLjM2aDhjMS4zMDIsMCwyLjM2LDEuMDU5LDIuMzYsMi4zNlMyMS4zMDIsMjcuMzYsMjAsMjcuMzZ6IE0xMiwyMy4zNmMtMC45MDQsMC0xLjY0LDAuNzM1LTEuNjQsMS42NAoJCXMwLjczNiwxLjY0LDEuNjQsMS42NGg4YzAuOTA0LDAsMS42NC0wLjczNSwxLjY0LTEuNjRzLTAuNzM1LTEuNjQtMS42NC0xLjY0SDEyeiBNMzEsMjMuODZoLTJjLTAuMTk5LDAtMC4zNi0wLjE2MS0wLjM2LTAuMzZWMTUKCQljMC0wLjE5OSwwLjE2MS0wLjM2LDAuMzYtMC4zNmgyYzAuMTk5LDAsMC4zNiwwLjE2MSwwLjM2LDAuMzZ2OC41QzMxLjM2LDIzLjY5OSwzMS4xOTksMjMuODYsMzEsMjMuODZ6IE0yOS4zNiwyMy4xNGgxLjI3OXYtNy43OAoJCUgyOS4zNlYyMy4xNHogTTMsMjMuODZIMWMtMC4xOTksMC0wLjM2LTAuMTYxLTAuMzYtMC4zNlYxNWMwLTAuMTk5LDAuMTYxLTAuMzYsMC4zNi0wLjM2aDJjMC4xOTksMCwwLjM2LDAuMTYxLDAuMzYsMC4zNnY4LjUKCQlDMy4zNiwyMy42OTksMy4xOTksMjMuODYsMywyMy44NnogTTEuMzYsMjMuMTRoMS4yOHYtNy43OEgxLjM2VjIzLjE0eiBNMjAsMjAuMzZjLTEuMzAyLDAtMi4zNi0xLjA1OS0yLjM2LTIuMzYKCQlzMS4wNTktMi4zNiwyLjM2LTIuMzZzMi4zNiwxLjA1OSwyLjM2LDIuMzZDMjIuMzYsMTkuMzAyLDIxLjMwMiwyMC4zNiwyMCwyMC4zNnogTTIwLDE2LjM2Yy0wLjkwNCwwLTEuNjQsMC43MzYtMS42NCwxLjY0CgkJczAuNzM1LDEuNjQsMS42NCwxLjY0czEuNjQtMC43MzUsMS42NC0xLjY0UzIwLjkwNCwxNi4zNiwyMCwxNi4zNnogTTEyLDIwLjM2Yy0xLjMwMSwwLTIuMzYtMS4wNTktMi4zNi0yLjM2czEuMDU5LTIuMzYsMi4zNi0yLjM2CgkJczIuMzYsMS4wNTksMi4zNiwyLjM2QzE0LjM2LDE5LjMwMiwxMy4zMDEsMjAuMzYsMTIsMjAuMzZ6IE0xMiwxNi4zNmMtMC45MDQsMC0xLjY0LDAuNzM2LTEuNjQsMS42NHMwLjczNiwxLjY0LDEuNjQsMS42NAoJCXMxLjY0LTAuNzM1LDEuNjQtMS42NFMxMi45MDQsMTYuMzYsMTIsMTYuMzZ6Ii8+Cgk8cmVjdCBzdHlsZT0iZmlsbDpub25lOyIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIi8+Cjwvc3ZnPg==",avatarUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAAD6CAMAAAC/MqoPAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAADNQTFRF////9vX18vLy/Pz86enp4+Li2tnZ1tbWzczM+fn57Ozs4N/f09LS0M/P5uXl7+/v3dzcwtncCAAAAAFiS0dEAIgFHUgAAAAJcEhZcwAAAEgAAABIAEbJaz4AAAZNSURBVHja7d3bdtsqEABQYABZSLH9/3+ZpnUsIcF5iOM6PfElNoMHMfPQdq3GmL0GkLhEUqLaUExnOtOZznSmM53pTGc605nOdKYznelMZzrTmV4LXSqllKyJDkob26xWq8Zae/iH0QoWTm9d1xur4WuypQJtTd+5dqn0VjcxzNO5/57mEBvdLo8Oron6aseWOjYOFkVvjQs3DmgyONMuht52EfztP+4hdu0i6LCO808/M8c1lE/fuPGej41uUzgdtoO/75N+2ELJ9I3b3//hPXbiMenm3pR/Jt4USgcLBIp4Bh10gqKVhvLo0klCxeSky96nKcj3siw6pJIL4XsoiQ7apyvMY/V3HHrSRioLopvEhSpTCn2TPEuwKYMOIX0tAxRBf/Hpa+lfSqBv9gi1FPsNfTrMAiVmIE/vJhz61FGnQxRIEYE4vfNYdN8Rp6MlHaHotHTn8ejekaZPAjEmyvQWdZFTtYTpXqCGJ0zvcek9Yfoel76nS0ffv1NMp1ca+pkgyfRCGind4L7OWWc605l+cxjsyhqy9AGbPpClc1/nvl5VX0c/3Alk6RU3+Am7shNZ+h6bvidLr7jBB+zKBrL0irOOudmIUDzTmf5gIP+iEuXtRuTVaEmY/oZLfyNMrzjryPc0gerMTdpVg0tvjJUU6bLPcGOoUv46SLL6Wi8yhLf06C7TUyekI0efRaaYqdFltkeNpPumRPSMDxgBYvSM035FrKAmH72hRW99PrpvSdEHkTEGUvSsK3yKVDkuJ92RohcZaehzzirPpOg+J92Tolfc4Cumx5xVXpGiZ34+ICX6W84qv5GiR5NPbiIpOv6BCoSvSkTX+eiaGP092zINvBOj4x8mSf9FqejvNo/cvpOji19ZbmviL0GPLsYMFzgzCor0+Bv/ePDvSJKOb9dJ5UlnbnEHiHgzv6cdTpJOWuc/u3FEucLDOL75xGtBiefrcwgoC9NDSH/jkH6pAuXmBqPQ9HSUPVdZBH1GGOrMXAQdYxcKZfxAoK+KKBKFLosoEoX+u4giUehz8jlcnAuhp78I46yDYNAd+QLR6K+pr+yvxdBTHyVDubQh0UfSxaHSd0lbvNkVRE87JGOtc+PQd2QLQ6fHhJkKsSh6yg13tO08JPprsgrrXWH0dJd2vH1MLPprot4eXoujpzrdhngiD40ek2y92lggPcnWa8qN1Yz0BFuvZhRl0uOfR0v4Ewuli/Bg4Qr3lArqGdndQ3UPO1EunXYwnelMZzrTmc50pjOd6UxnOtOZznSmM53pTGf6kuj6oedFKV0s3fX6sX1S3bsi6a4PD7+/YAqYeBw6pIB/4qEgOqxdSPbGiim4NRRCbzs3Jj0L4UfXtQXQVRfn5IdA/Bw7RZzurEV6EtdsLeGXkIPuA+K1UoVeA0l62zmN/LqfSSft9KkepmoRuvi3nd5uKNFB9zbbXEANqdr941XO0NJx2v2jdJenpf+/3bvn0ts16ph+sd6hX7dPo2+2cZzE02Ia43bzDHqr+2Evnhz74ZHU30ffbKOeng1/NPV30Ns1gYQnSP2P6e65Pfxc6h02XZqXQCjhJ6kPL6bFo4NrGvAU4UII4SE2P1vQuZkuOxckVfehisF1MjUddN/MZBN+kvq5uf0O/xa66gyNS9ktMWlz44rO1Z8C19i5FPdHzPamXn+F3hryPfxMr78+4F+kq22kO6Rf6fUQt+puuustyWv4rbG3l/duztFB96GYoe1cTBdXMr+nw9qVM6ZfxOvzezff0nXi/ZOndvrR6Zvpm0c3h6nhdb+5iS7tsIim/qXZD9+97/Jf+rpZ5BET1ayv0GUzLhEuhBBjIy/RdVPgndutIRt9nt7p5cKFEEJ3Z+jQFDZL+XnMDXxHB73gxn5s9Kc3d3/pFciFkN/QTSXHJpX5l66gDrkQoP6hL3xsPw39la4qOiV8tH78XeSbue6N9mvWa6J/ybpc1CT1Wnh5Qq9meP8IOKH3ddH7E/ri1iYux/SXDrXR4UiPdck/wUpU+FtPf6/orja6O9KL3l56LOvVxe5Ib2qjN0d6Vbex4ghWlU3bPqI90If66MNng680FNpbJijH6kCvaF3uMzQ3+IrpFerV4Y9dffQdN3im10ivbuImhD3Qq5u4HdZkua8znelMZ/pS4z9CPVKkxowNxgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNy0wMy0yN1QxNTo0NToxNSswMDowMN1xSg4AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTctMDMtMjdUMTU6NDU6MTUrMDA6MDCsLPKyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==",AvatarEl=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"applyCustomStylesToElements",value:function(e,t,n){Object.assign(e.style,n.container),Object.assign(t.style,n.avatar)}},{key:"applyCustomStyles",value:function(t,n,r,i){var a,s,o;null!=(a=r.default)&&a.styles&&e.applyCustomStylesToElements(t,n,r.default.styles),i?null!=(s=r.ai)&&s.styles&&e.applyCustomStylesToElements(t,n,r.ai.styles):null!=(o=r.user)&&o.styles&&e.applyCustomStylesToElements(t,n,r.user.styles)}},{key:"createAvatar",value:function(t,n){var r,i,a,s,o=document.createElement("img");o.src=t?(null==(r=null==n?void 0:n.ai)?void 0:r.src)||(null==(i=null==n?void 0:n.default)?void 0:i.src)||aiLogoUrl:(null==(a=null==n?void 0:n.user)?void 0:a.src)||(null==(s=null==n?void 0:n.default)?void 0:s.src)||avatarUrl,o.classList.add("avatar");var l=document.createElement("div");return l.classList.add("avatar-container"),l.appendChild(o),n&&e.applyCustomStyles(l,o,n,t),l}},{key:"getPosition",value:function(e,t){var n,r,i,a,s,o,l,c,u=e?null==(a=null==(i=null==t?void 0:t.ai)?void 0:i.styles)?void 0:a.position:null==(o=null==(s=null==t?void 0:t.user)?void 0:s.styles)?void 0:o.position;return null!==(n=u)&&void 0!==n||(u=null==(c=null==(l=null==t?void 0:t.default)?void 0:l.styles)?void 0:c.position),null!==(r=u)&&void 0!==r||(u=e?"left":"right"),u}},{key:"add",value:function(t,n,r){var i="boolean"==typeof r?void 0:r,a=e.createAvatar(n,i),s=e.getPosition(n,i);a.classList.add("left"===s?"left-item-position":"right-item-position"),t.insertAdjacentElement("left"===s?"beforebegin":"afterend",a)}}]),e}(),Name=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getPosition",value:function(e,t){var n,r,i,a=e?null==(n=null==t?void 0:t.ai)?void 0:n.position:null==(r=null==t?void 0:t.user)?void 0:r.position;return a||(a=null==(i=null==t?void 0:t.default)?void 0:i.position),a||(a=e?"left":"right"),a}},{key:"applyStyle",value:function(e,t,n){var r,i,a;Object.assign(e.style,null==(r=n.default)?void 0:r.style,t?null==(i=n.ai)?void 0:i.style:null==(a=n.user)?void 0:a.style)}},{key:"getNameText",value:function(e,t){var n,r,i,a;return e?(null==(n=t.ai)?void 0:n.text)||(null==(r=t.default)?void 0:r.text)||"AI":(null==(i=t.user)?void 0:i.text)||(null==(a=t.default)?void 0:a.text)||"User"}},{key:"createName",value:function(t,n){var r=document.createElement("div");return r.classList.add("name"),r.textContent=e.getNameText(t,n),e.applyStyle(r,t,n),r}},{key:"add",value:function(t,n,r){var i="boolean"==typeof r?{}:r,a=e.createName(n,i),s=e.getPosition(n,i);a.classList.add("left"===s?"left-item-position":"right-item-position"),t.insertAdjacentElement("left"===s?"beforebegin":"afterend",a)}}]),e}(),Messages=function(){function e(t,n,r){var i,a,s=this;_classCallCheck(this,e),this._messageElementRefs=[],this._streamedText="",this.messages=[];var o=n.permittedErrorPrefixes,l=n.introPanelMarkUp,c=n.demo;this._remarkable=RemarkableConfig.createNew(),this.elementRef=e.createContainerElement(),this.messageStyles=t.messageStyles,this._avatars=t.avatars,this._names=t.names,this._errorMessageOverrides=null==(i=t.errorMessages)?void 0:i.overrides,this._onNewMessage=FireEvents.onNewMessage.bind(this,t),this._onMessagesCleared=FireEvents.onMessagesCleared.bind(this,t),this._displayLoadingMessage=e.getDisplayLoadingMessage(t,n),this._permittedErrorPrefixes=o,this.populateIntroPanel(r,l,t.introPanelStyle),t.introMessage&&this.addIntroductoryMessage(t.introMessage),t.initialMessages&&this.populateInitialMessages(t.initialMessages),this.displayServiceErrorMessages=null==(a=t.errorMessages)?void 0:a.displayServiceErrorMessages,t.getMessages=function(){return JSON.parse(JSON.stringify(s.messages))},t.clearMessages=this.clearMessages.bind(this),t.refreshMessages=this.refreshTextMessages.bind(this),c&&this.prepareDemo(c),t.textToSpeech&&TextToSpeech.processConfig(t.textToSpeech,(function(e){s._textToSpeech=e}))}var t;return _createClass(e,[{key:"prepareDemo",value:function(e){"object"==_typeof(e)&&(e.response&&(this.customDemoResponse=e.response),e.displayErrors&&(e.displayErrors.default&&this.addNewErrorMessage("",""),e.displayErrors.service&&this.addNewErrorMessage("service",""),e.displayErrors.speechToText&&this.addNewErrorMessage("speechToText","")),e.displayLoadingBubble&&this.addLoadingMessage())}},{key:"addIntroductoryMessage",value:function(e){var t;if(e&&(this._introMessage=e),this._introMessage){var n=this.createAndAppendNewMessageElement(this._introMessage,!0);this.applyCustomStyles(n,!0,!1,null==(t=this.messageStyles)?void 0:t.intro)}}},{key:"populateInitialMessages",value:function(e){var t=this;e.forEach((function(e){e.text?t.addNewMessage({text:e.text},"ai"===e.role,!0,!0):e.file&&t.addNewMessage({files:[e.file]},"ai"===e.role,!0,!0)})),setTimeout((function(){return t.elementRef.scrollTop=t.elementRef.scrollHeight}))}},{key:"applyCustomStyles",value:function(e,t,n,r){this.messageStyles&&MessageStyleUtils.applyCustomStyles(this.messageStyles,e,t,n,r)}},{key:"addInnerContainerElements",value:function(e,t,n){return e.classList.add("message-bubble",n?"ai-message-text":"user-message-text"),e.innerHTML=this._remarkable.render(t),0===e.innerText.trim().length&&(e.innerText=t),this._avatars&&AvatarEl.add(e,n,this._avatars),this._names&&Name.add(e,n,this._names),{bubbleElement:e}}},{key:"createMessageElements",value:function(t,n){var r=e.createBaseElements(),i=r.outerContainer,a=r.innerContainer,s=r.bubbleElement;return i.appendChild(a),this.addInnerContainerElements(s,t,n),this._messageElementRefs.push(r),r}},{key:"createNewMessageElement",value:function(e,t){var n;null==(n=this._introPanel)||n.hide();var r=this._messageElementRefs[this._messageElementRefs.length-1];return null!=r&&r.bubbleElement.classList.contains("loading-message-text")&&(r.outerContainer.remove(),this._messageElementRefs.pop()),this.createMessageElements(e,t)}},{key:"createAndAppendNewMessageElement",value:function(e,t){var n=this.createNewMessageElement(e,t);return this.elementRef.appendChild(n.outerContainer),this.elementRef.scrollTop=this.elementRef.scrollHeight,n}},{key:"addNewTextMessage",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=this.createAndAppendNewMessageElement(t,n);this.applyCustomStyles(a,n,!1);var s=e.createMessageContent(n,t);return 0===t.trim().length&&e.editEmptyMessageElement(a.bubbleElement),this.messages.push(s),r&&this.sendClientUpdate(s,i),a}},{key:"addNewMessage",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];void 0!==e.text&&null!==e.text?(this.addNewTextMessage(e.text,t,n,i),!i&&this._textToSpeech&&t&&TextToSpeech.speak(e.text,this._textToSpeech)):e.files&&e.files.forEach((function(e){var n,a;"audio"===e.type||null!=(n=e.src)&&n.startsWith("data:audio")?FileMessages.addNewAudioMessage(r,e,t,i):"image"===e.type||"gif"===e.type||null!=(a=e.src)&&a.startsWith("data:image")?FileMessages.addNewImageMessage(r,e,t,i):FileMessages.addNewAnyFileMessage(r,e,t,i)}))}},{key:"sendClientUpdate",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];null==(t=this._onNewMessage)||t.call(this,e,n)}},{key:"removeMessageOnError",value:function(){var e,t=null==(e=this._messageElementRefs[this._messageElementRefs.length-1])?void 0:e.bubbleElement;(null!=t&&t.classList.contains("streamed-message")&&""===t.textContent||null!=t&&t.classList.contains("loading-message-text"))&&(t.remove(),this._messageElementRefs.pop())}},{key:"addNewErrorMessage",value:function(t,n){var r,i,a,s;this.removeMessageOnError();var o=e.createBaseElements(),l=o.outerContainer,c=o.bubbleElement;c.classList.add("error-message-text");var u=this.getPermittedMessage(n)||(null==(r=this._errorMessageOverrides)?void 0:r[t])||(null==(i=this._errorMessageOverrides)?void 0:i.default)||"Error, please try again.";c.innerHTML=u;var d=MessageStyleUtils.extractParticularSharedStyles(["fontSize","fontFamily"],null==(a=this.messageStyles)?void 0:a.default);MessageStyleUtils.applyCustomStylesToElements(o,!1,d),MessageStyleUtils.applyCustomStylesToElements(o,!1,null==(s=this.messageStyles)?void 0:s.error),this.elementRef.appendChild(l),this.elementRef.scrollTop=this.elementRef.scrollHeight,this._textToSpeech&&TextToSpeech.speak(u,this._textToSpeech),this._streamedText=""}},{key:"getPermittedMessage",value:function(t){if(t){if(this.displayServiceErrorMessages)return t;if("string"==typeof t&&this._permittedErrorPrefixes){var n=e.checkPermittedErrorPrefixes(this._permittedErrorPrefixes,t);if(n)return n}else if(Array.isArray(t)&&this._permittedErrorPrefixes)for(var r=0;r<t.length;r+=1){var i=e.checkPermittedErrorPrefixes(this._permittedErrorPrefixes,t[r]);if(i)return i}}}},{key:"isLastMessageError",value:function(){var e,t,n,r,i;return null==(i=null==(r=null==(n=null==(t=null==(e=this.elementRef.children[this.elementRef.children.length-1])?void 0:e.children)?void 0:t[0])?void 0:n.children)?void 0:r[0])?void 0:i.classList.contains("error-message-text")}},{key:"addLoadingMessage",value:function(){var e;if(this._displayLoadingMessage){var t=this.createMessageElements("",!0),n=t.outerContainer,r=t.bubbleElement;r.classList.add("loading-message-text");var i=document.createElement("div");i.classList.add("dots-flashing"),r.appendChild(i),this.applyCustomStyles(t,!0,!1,null==(e=this.messageStyles)?void 0:e.loading),LoadingMessageDotsStyle.set(r,this.messageStyles),this.elementRef.appendChild(n),this.elementRef.scrollTop=this.elementRef.scrollHeight}}},{key:"addNewStreamedMessage",value:function(){var e=this.addNewTextMessage("",!0,!1).bubbleElement;return e.classList.add("streamed-message"),this.elementRef.scrollTop=this.elementRef.scrollHeight,e}},{key:"updateStreamedMessage",value:function(e,t){var n,r,i,a,s,o=ElementUtils.isScrollbarAtBottomOfElement(this.elementRef);if(0!==e.trim().length){var l=null==(n=this.messageStyles)?void 0:n.default;t.style.color=(null==(i=null==(r=null==l?void 0:l.ai)?void 0:r.bubble)?void 0:i.color)||(null==(s=null==(a=null==l?void 0:l.shared)?void 0:a.bubble)?void 0:s.color)||""}this._streamedText+=e,t.innerHTML=this._remarkable.render(this._streamedText),o&&(this.elementRef.scrollTop=this.elementRef.scrollHeight)}},{key:"finaliseStreamedMessage",value:function(){this.messages[this.messages.length-1].text=this._streamedText,this.sendClientUpdate(e.createMessageContent(!0,this._streamedText),!1),this._textToSpeech&&TextToSpeech.speak(this._streamedText,this._textToSpeech),this._streamedText=""}},{key:"populateIntroPanel",value:function(e,t,n){(e||t)&&(this._introPanel=new IntroPanel(e,t,n),this._introPanel._elementRef&&this.elementRef.appendChild(this._introPanel._elementRef))}},{key:"addMultipleFiles",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all((t||[]).map((function(e){return new Promise((function(t){if(e.type&&"any"!==e.type){var r=new FileReader;r.readAsDataURL(e.file),r.onload=function(){n.addNewMessage({files:[{src:r.result,type:e.type}]},!1,!0),t(!0)}}else{var i=e.file.name||FileMessageUtils.DEFAULT_FILE_NAME;n.addNewMessage({files:[{name:i,type:"any"}]},!1,!0),t(!0)}}))}))));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"clearMessages",value:function(e){var t,n,r=[];this._messageElementRefs.forEach((function(e){var t=e.bubbleElement.classList;t.contains("loading-message-text")||t.contains("streamed-message")?r.push(e):e.outerContainer.remove()})),this._messageElementRefs=r,!1!==e&&(null!=(t=this._introPanel)&&t._elementRef&&this._introPanel.display(),this.addIntroductoryMessage()),null==(n=this._onMessagesCleared)||n.call(this)}},{key:"refreshTextMessages",value:function(){var e=this;this._remarkable=RemarkableConfig.createNew(),this.messages.forEach((function(t,n){t.text&&(e._messageElementRefs[n].bubbleElement.innerHTML=e._remarkable.render(t.text))}))}}],[{key:"getDisplayLoadingMessage",value:function(e,t){var n;return!t.websocket&&(null===(n=e.displayLoadingBubble)||void 0===n||n)}},{key:"createContainerElement",value:function(){var e=document.createElement("div");return e.id="messages",e}},{key:"createMessageContent",value:function(e,t,n){return n?{role:e?"ai":"user",file:n}:{role:e?"ai":"user",text:t||""}}},{key:"createBaseElements",value:function(){var e=document.createElement("div"),t=document.createElement("div");t.classList.add("inner-message-container"),e.appendChild(t),e.classList.add("outer-message-container");var n=document.createElement("div");return n.classList.add("message-bubble"),t.appendChild(n),{outerContainer:e,innerContainer:t,bubbleElement:n}}},{key:"editEmptyMessageElement",value:function(e){e.textContent=".",e.style.color="#00000000"}},{key:"checkPermittedErrorPrefixes",value:function(e,t){for(var n=0;n<e.length;n+=1)if(t.startsWith(e[n]))return t}}]),e}(),_InputButtonStyleAdjustments=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"adjustInputPadding",value:function(e,t){t["inside-left"].length>0&&e.classList.add("text-input-inner-left-adjustment"),t["inside-right"].length>0&&e.classList.add("text-input-inner-right-adjustment")}},{key:"adjustForOutsideButton",value:function(t,n,r){0===r["outside-right"].length&&r["outside-left"].length>0?(t[0].classList.add(e.INPUT_OUTSIDE_LEFT_SMALL_ADJUSTMENT_CLASS),n.classList.add(e.INPUT_OUTSIDE_LEFT_SMALL_ADJUSTMENT_CLASS)):0===r["outside-left"].length&&r["outside-right"].length>0&&(t[3].classList.add(e.INPUT_OUTSIDE_RIGHT_SMALL_ADJUSTMENT_CLASS),n.classList.add(e.INPUT_OUTSIDE_RIGHT_SMALL_ADJUSTMENT_CLASS))}},{key:"adjustOutsideSubmit",value:function(t,n,r){if(!(r["inside-left"].length>0||r["inside-right"].length>0)){if(0===r["outside-right"].length&&r["outside-left"].length>0)return t[0].classList.add(e.INPUT_OUTSIDE_LEFT_ADJUSTMENT_CLASS),n.classList.add(e.INPUT_OUTSIDE_LEFT_ADJUSTMENT_CLASS),r["outside-left"].map((function(e){return e.button.elementRef.classList.add("submit-button-enlarged")}));if(0===r["outside-left"].length&&r["outside-right"].length>0)return t[3].classList.add(e.INPUT_OUTSIDE_RIGHT_ADJUSTMENT_CLASS),n.classList.add(e.INPUT_OUTSIDE_RIGHT_ADJUSTMENT_CLASS),r["outside-right"].map((function(e){return e.button.elementRef.classList.add("submit-button-enlarged")}))}}},{key:"set",value:function(t,n,r,i){!!e.adjustOutsideSubmit(n,r,i)||e.adjustForOutsideButton(n,r,i),e.adjustInputPadding(t,i)}}]),e}();_InputButtonStyleAdjustments.INPUT_OUTSIDE_LEFT_ADJUSTMENT_CLASS="text-input-container-left-adjustment",_InputButtonStyleAdjustments.INPUT_OUTSIDE_RIGHT_ADJUSTMENT_CLASS="text-input-container-right-adjustment",_InputButtonStyleAdjustments.INPUT_OUTSIDE_LEFT_SMALL_ADJUSTMENT_CLASS="text-input-container-left-small-adjustment",_InputButtonStyleAdjustments.INPUT_OUTSIDE_RIGHT_SMALL_ADJUSTMENT_CLASS="text-input-container-right-small-adjustment";var InputButtonStyleAdjustments=_InputButtonStyleAdjustments,ButtonContainers=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"create",value:function(){return Array.from({length:4}).map((function(e,t){var n=document.createElement("div");return n.classList.add("input-button-container"),(0===t||3===t)&&n.classList.add("outer-button-container"),(1===t||2===t)&&n.classList.add("inner-button-container"),n}))}},{key:"add",value:function(e,t){e.insertBefore(t[1],e.firstChild),e.insertBefore(t[0],e.firstChild),e.appendChild(t[2]),e.appendChild(t[3])}},{key:"getContainerIndex",value:function(e){return"outside-left"===e?0:"inside-left"===e?1:"inside-right"===e?2:3}},{key:"addButton",value:function(t,n,r){n.classList.add(r);var i=e.getContainerIndex(r);t[i].appendChild(n),3===i&&n.classList.add("outside-right")}}]),e}(),BUTTON_ORDER=["camera","gifs","images","audio","mixedFiles","submit","microphone"],CustomButtonInnerElements=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"createTextElement",value:function(e){var t=document.createElement("div");return t.classList.add("text-button"),t.innerText=e,t}},{key:"createElement",value:function(t,n){return n?e.createTextElement(t):SVGIconUtils.createSVGElement(t)}},{key:"createCustomElement",value:function(t,n){var r,i,a,s,o=t[n];return null!=(r=null==o?void 0:o.text)&&r.content?e.createElement(null==(i=null==o?void 0:o.text)?void 0:i.content,!0):null!=(a=null==o?void 0:o.svg)&&a.content?e.createElement(null==(s=null==o?void 0:o.svg)?void 0:s.content,!1):void 0}},{key:"processElement",value:function(e,t){null!=t&&t.classList.contains("text-button")||e.classList.add("input-button-svg")}},{key:"createSpecificStateElement",value:function(t,n,r){var i;return r&&(i=e.createCustomElement(r,n)),e.processElement(t,i),i}},{key:"create",value:function(t,n,r){var i={};if(!r)return e.processElement(t),i;var a=e.createSpecificStateElement(t,n[0],r);i[n[0]]=a;var s=a;return n.slice(1).forEach((function(t){s=e.createCustomElement(r,t)||s,i[t]=s})),i}}]),e}(),PLUS_ICON_STRING='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">\n    <path d="M16 0c-8.836 0-16 7.163-16 16s7.163 16 16 16c8.837 0 16-7.163 16-16s-7.163-16-16-16zM16 30.032c-7.72 0-14-6.312-14-14.032s6.28-14 14-14 14 6.28 14 14-6.28 14.032-14 14.032zM23 15h-6v-6c0-0.552-0.448-1-1-1s-1 0.448-1 1v6h-6c-0.552 0-1 0.448-1 1s0.448 1 1 1h6v6c0 0.552 0.448 1 1 1s1-0.448 1-1v-6h6c0.552 0 1-0.448 1-1s-0.448-1-1-1z"></path>\n</svg>',ButtonCSS=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"unsetAllCSS",value:function(e,t){var n,r;t.container&&StyleUtils.unsetAllCSSMouseStates(e,t.container),null!=(n=t.svg)&&n.styles&&StyleUtils.unsetAllCSSMouseStates(e.children[0],t.svg.styles),null!=(r=t.text)&&r.styles&&StyleUtils.unsetAllCSSMouseStates(e.children[0],t.text.styles)}},{key:"unsetActionCSS",value:function(e,t){var n,r;t.container&&StyleUtils.unsetActivityCSSMouseStates(e,t.container),null!=(n=t.svg)&&n.styles&&StyleUtils.unsetActivityCSSMouseStates(e.children[0],t.svg.styles),null!=(r=t.text)&&r.styles&&StyleUtils.unsetActivityCSSMouseStates(e.children[0],t.text.styles)}},{key:"setElementsCSS",value:function(e,t,n){var r,i,a,s,o;Object.assign(e.style,null==(r=t.container)?void 0:r[n]),Object.assign(e.children[0].style,null==(a=null==(i=t.svg)?void 0:i.styles)?void 0:a[n]),Object.assign(e.children[0].style,null==(o=null==(s=t.text)?void 0:s.styles)?void 0:o[n])}},{key:"setElementCssUpToState",value:function(t,n,r){e.setElementsCSS(t,n,"default"),"default"!==r&&(e.setElementsCSS(t,n,"hover"),"hover"!==r&&e.setElementsCSS(t,n,"click"))}}]),e}(),InputButton=function(){function e(t,n,r,i){_classCallCheck(this,e),this._mouseState={state:"default"},this.elementRef=t,this._customStyles=r,this.position=n,this.dropupText=i}return _createClass(e,[{key:"buttonMouseLeave",value:function(e){this._mouseState.state="default",e&&(ButtonCSS.unsetAllCSS(this.elementRef,e),ButtonCSS.setElementsCSS(this.elementRef,e,"default"))}},{key:"buttonMouseEnter",value:function(e){this._mouseState.state="hover",e&&ButtonCSS.setElementsCSS(this.elementRef,e,"hover")}},{key:"buttonMouseUp",value:function(e){e&&ButtonCSS.unsetActionCSS(this.elementRef,e),this.buttonMouseEnter(e)}},{key:"buttonMouseDown",value:function(e){this._mouseState.state="click",e&&ButtonCSS.setElementsCSS(this.elementRef,e,"click")}},{key:"setEvents",value:function(e){this.elementRef.onmousedown=this.buttonMouseDown.bind(this,e),this.elementRef.onmouseup=this.buttonMouseUp.bind(this,e),this.elementRef.onmouseenter=this.buttonMouseEnter.bind(this,e),this.elementRef.onmouseleave=this.buttonMouseLeave.bind(this,e)}},{key:"unsetCustomStateStyles",value:function(e){if(this._customStyles)for(var t=0;t<e.length;t+=1){var n=e[t],r=n&&this._customStyles[n];r&&ButtonCSS.unsetActionCSS(this.elementRef,r)}}},{key:"reapplyStateStyle",value:function(e,t){if(this._customStyles){t&&this.unsetCustomStateStyles(t);var n=this._customStyles[e];n&&ButtonCSS.setElementCssUpToState(this.elementRef,n,this._mouseState.state),this.setEvents(n)}}}]),e}(),DropupItemNavigation=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"focusItemWhenOnEdge",value:function(t,n){var r=n?t.children[0]:t.children[t.children.length-1];e.focusSiblingItem(r,t,n,!0)}},{key:"focusSiblingItem",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?t:t[r?"nextSibling":"previousSibling"];i?(t.dispatchEvent(new MouseEvent("mouseleave")),i.dispatchEvent(new MouseEvent("mouseenter"))):(t.dispatchEvent(new MouseEvent("mouseleave")),e.focusItemWhenOnEdge(n,r))}}]),e}(),StatefulEvents=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"mouseUp",value:function(e,t){var n=t.target;StyleUtils.unsetAllCSSMouseStates(n,e),Object.assign(n.style,e.default),Object.assign(n.style,e.hover)}},{key:"mouseDown",value:function(e,t){var n=t.target;Object.assign(n.style,e.click)}},{key:"mouseLeave",value:function(e,t){var n=t.target;StyleUtils.unsetAllCSSMouseStates(n,e),Object.assign(n.style,e.default)}},{key:"mouseEnter",value:function(e,t){var n=t.target;Object.assign(n.style,e.hover)}},{key:"add",value:function(t,n){t.addEventListener("mouseenter",e.mouseEnter.bind(this,n)),t.addEventListener("mouseleave",e.mouseLeave.bind(this,n)),t.addEventListener("mousedown",e.mouseDown.bind(this,n)),t.addEventListener("mouseup",e.mouseUp.bind(this,n))}}]),e}(),DropupItem=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"addItemEvents",value:function(e,t,n,r){StatefulEvents.add(t,r),t.addEventListener("click",(function(){n.click()})),t.addEventListener("mouseenter",(function(t){e.highlightedItem=t.target})),t.addEventListener("mouseleave",(function(){e.highlightedItem=void 0}))}},{key:"createItemText",value:function(e,t){var n=document.createElement("div");return Object.assign(n.style,t),n.classList.add("dropup-menu-item-text"),n.textContent=e||"File",n}},{key:"createItemIcon",value:function(e,t){var n=document.createElement("div");return Object.assign(n.style,t),n.classList.add("dropup-menu-item-icon"),n.appendChild(e.children[0]),n}},{key:"populateItem",value:function(t,n,r,i){var a=t.children[0];a.classList.contains("text-button")?n.appendChild(e.createItemText(a.textContent,null==i?void 0:i.text)):(n.appendChild(e.createItemIcon(t,null==i?void 0:i.iconContainer)),n.appendChild(e.createItemText(r,null==i?void 0:i.text)))}},{key:"createItem",value:function(t,n,r){var i,a=n.elementRef,s=n.dropupText,o=document.createElement("div");Object.assign(o.style,null==(i=null==r?void 0:r.item)?void 0:i.default),e.populateItem(a,o,s,r),o.classList.add("dropup-menu-item");var l=StyleUtils.generateStateful((null==r?void 0:r.item)||{},{backgroundColor:"#f3f3f3"},{backgroundColor:"#ebebeb"});return e.addItemEvents(t,o,a,l),o}}]),e}(),DropupMenu=function(){function e(t,n){var r,i=this;_classCallCheck(this,e),this._isOpen=!0,this._styles=n,this.elementRef=e.createElement(null==(r=this._styles)?void 0:r.container),this.close(),setTimeout((function(){return i.addWindowEvents(t)}))}return _createClass(e,[{key:"open",value:function(){this.elementRef.style.display="block",this._isOpen=!0}},{key:"close",value:function(){this._isOpen&&(this.elementRef.style.display="none",this._isOpen=!1)}},{key:"toggle",value:function(){this._isOpen?this.close():this.open()}},{key:"addItem",value:function(e){var t=DropupItem.createItem(this,e,this._styles);this.elementRef.appendChild(t)}},{key:"addWindowEvents",value:function(e){var t=this;window.addEventListener("click",(function(n){var r;e.parentElement!==(null==(r=n.target.shadowRoot)?void 0:r.children[0])&&t.close()})),window.addEventListener("keydown",(function(e){var n,r,i;t._isOpen&&(e.key===KEYBOARD_KEY.ESCAPE?(t.close(),null==(n=t.highlightedItem)||n.dispatchEvent(new MouseEvent("mouseleave"))):e.key===KEYBOARD_KEY.ENTER?(null==(r=t.highlightedItem)||r.click(),null==(i=t.highlightedItem)||i.dispatchEvent(new MouseEvent("mouseleave"))):e.key===KEYBOARD_KEY.ARROW_DOWN?DropupItemNavigation.focusSiblingItem(t.highlightedItem||t.elementRef.children[t.elementRef.children.length-1],t.elementRef,!0):e.key===KEYBOARD_KEY.ARROW_UP&&DropupItemNavigation.focusSiblingItem(t.highlightedItem||t.elementRef.children[0],t.elementRef,!1))}))}}],[{key:"createElement",value:function(e){var t=document.createElement("div");return t.id="dropup-menu",Object.assign(t.style,e),t}}]),e}(),Dropup=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i,a;_classCallCheck(this,n);var s=(i=t.call(this,n.createButtonElement(),void 0,{styles:null==(a=null==r?void 0:r.button)?void 0:a.styles})).createInnerElements(i._customStyles);return i._menu=new DropupMenu(e,null==r?void 0:r.menu),i.addClickEvent(),i.buttonContainer=n.createButtonContainer(),i.elementRef.appendChild(s.styles),i.buttonContainer.appendChild(i.elementRef),i.elementRef.classList.add("dropup-icon","upload-file-button"),i.buttonContainer.appendChild(i._menu.elementRef),i.reapplyStateStyle("styles"),i.addContainerEvents(e),i}return _createClass(n,[{key:"createInnerElements",value:function(e){return{styles:this.createInnerElement(n.createSVGIconElement(),"styles",e)}}},{key:"createInnerElement",value:function(e,t,n){return CustomButtonInnerElements.createSpecificStateElement(this.elementRef,t,n)||e}},{key:"addClickEvent",value:function(){this.elementRef.onclick=this._menu.toggle.bind(this._menu)}},{key:"addItem",value:function(e){this._menu.addItem(e)}},{key:"addContainerEvents",value:function(e){var t=this;e.addEventListener("click",(function(e){e.target.classList.contains("dropup-icon")||t._menu.close()}))}}],[{key:"createButtonElement",value:function(){var e=document.createElement("div");return e.classList.add("input-button"),e}},{key:"createSVGIconElement",value:function(){var e=SVGIconUtils.createSVGElement(PLUS_ICON_STRING);return e.id="dropup-icon",e}},{key:"createButtonContainer",value:function(){var e=document.createElement("div");return e.id="dropup-container",e}},{key:"getPosition",value:function(e,t){var n,r;return null!=(n=null==t?void 0:t.button)&&n.position?null==(r=null==t?void 0:t.button)?void 0:r.position:e["outside-left"].length>0&&0===e["outside-right"].length?"outside-right":"outside-left"}}]),n}(InputButton),InputButtonPositions=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"addToDropup",value:function(e,t,n,r){var i=new Dropup(n,r);BUTTON_ORDER.forEach((function(e){var n=t["dropup-menu"].findIndex((function(t){return t.buttonType===e})),r=t["dropup-menu"][n];r&&(i.addItem(r.button),t["dropup-menu"].splice(n,1))}));var a=Dropup.getPosition(t,r);ButtonContainers.addButton(e,i.buttonContainer,a),t[a].push({})}},{key:"addToSideContainer",value:function(e,t){["inside-left","inside-right","outside-left","outside-right"].forEach((function(n){var r=n;t[r].forEach((function(t){ButtonContainers.addButton(e,t.button.elementRef,r)}))}))}},{key:"setPosition",value:function(e,t,n){var r=_objectSpread(_objectSpread({},e[t]),{},{buttonType:t});n.push(r),delete e[t]}},{key:"createPositionsObj",value:function(){return{"dropup-menu":[],"outside-left":[],"inside-left":[],"inside-right":[],"outside-right":[]}}},{key:"generatePositions",value:function(t){var n=e.createPositionsObj();Object.keys(t).forEach((function(r){var i,a=null==(i=t[r])?void 0:i.button.position;a&&e.setPosition(t,r,n[a])})),0===n["inside-right"].length&&t.submit&&e.setPosition(t,"submit",n["inside-right"]),0===n["outside-right"].length&&(t.submit?e.setPosition(t,"submit",n["outside-right"]):t.microphone?e.setPosition(t,"microphone",n["outside-right"]):t.camera&&e.setPosition(t,"camera",n["outside-right"])),t.submit&&e.setPosition(t,"submit",0===n["outside-left"].length?n["outside-left"]:n["inside-right"]),t.microphone&&e.setPosition(t,"microphone",0===n["outside-left"].length?n["outside-left"]:n["inside-right"]);var r=Object.keys(t);return r.length>1||n["dropup-menu"].length>0?BUTTON_ORDER.forEach((function(e){t[e]&&n["dropup-menu"].push(_objectSpread(_objectSpread({},t[e]),{},{buttonType:e}))})):1===r.length&&e.setPosition(t,r[0],0===n["outside-right"].length?n["outside-right"]:n["outside-left"]),n}},{key:"addButtons",value:function(t,n,r,i){var a=e.generatePositions(n);return e.addToSideContainer(t,a),a["dropup-menu"].length>0&&e.addToDropup(t,a,r,i),a}}]),e}(),MIXED_FILES_ICON_STRING='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<title>file</title>\n<path d="M20 10.9696L11.9628 18.5497C10.9782 19.4783 9.64274 20 8.25028 20C6.85782 20 5.52239 19.4783 4.53777 18.5497C3.55315 17.6211 3 16.3616 3 15.0483C3 13.7351 3.55315 12.4756 4.53777 11.547L12.575 3.96687C13.2314 3.34779 14.1217 3 15.05 3C15.9783 3 16.8686 3.34779 17.525 3.96687C18.1814 4.58595 18.5502 5.4256 18.5502 6.30111C18.5502 7.17662 18.1814 8.01628 17.525 8.63535L9.47904 16.2154C9.15083 16.525 8.70569 16.6989 8.24154 16.6989C7.77738 16.6989 7.33224 16.525 7.00403 16.2154C6.67583 15.9059 6.49144 15.4861 6.49144 15.0483C6.49144 14.6106 6.67583 14.1907 7.00403 13.8812L14.429 6.88674" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>',IMAGE_ICON_STRING='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n  <path d="M20,15.2928932 L20,5.5 C20,4.67157288 19.3284271,4 18.5,4 L5.5,4 C4.67157288,4 4,4.67157288 4,5.5 L4,12.2928932 L7.14644661,9.14644661 C7.34170876,8.95118446 7.65829124,8.95118446 7.85355339,9.14644661 L13.5,14.7928932 L16.1464466,12.1464466 C16.3417088,11.9511845 16.6582912,11.9511845 16.8535534,12.1464466 L20,15.2928932 Z M20,16.7071068 L16.5,13.2071068 L13.8535534,15.8535534 C13.6582912,16.0488155 13.3417088,16.0488155 13.1464466,15.8535534 L7.5,10.2071068 L4,13.7071068 L4,18.5 C4,19.3284271 4.67157288,20 5.5,20 L18.5,20 C19.3284271,20 20,19.3284271 20,18.5 L20,16.7071068 Z M3,5.5 C3,4.11928813 4.11928813,3 5.5,3 L18.5,3 C19.8807119,3 21,4.11928813 21,5.5 L21,18.5 C21,19.8807119 19.8807119,21 18.5,21 L5.5,21 C4.11928813,21 3,19.8807119 3,18.5 L3,5.5 Z M15,6 L17,6 C17.5522847,6 18,6.44771525 18,7 L18,9 C18,9.55228475 17.5522847,10 17,10 L15,10 C14.4477153,10 14,9.55228475 14,9 L14,7 C14,6.44771525 14.4477153,6 15,6 Z M15,7 L15,9 L17,9 L17,7 L15,7 Z"/>\n</svg>\n',AUDIO_ICON_STRING='<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="-49.49 -49.49 593.87 593.87" stroke-width="3.95908" transform="rotate(0)">\n  <g stroke-width="0"></g>\n  <g stroke-linecap="round" stroke-linejoin="round" stroke-width="0.98977"></g>\n  <g>\n    <g>\n      <g>\n        <path d="M163.205,76.413v293.301c-3.434-3.058-7.241-5.867-11.486-8.339c-21.38-12.452-49.663-15.298-77.567-7.846 c-49.038,13.096-80.904,54.519-71.038,92.337c4.019,15.404,14.188,28.221,29.404,37.087c13.553,7.894,29.87,11.933,47.115,11.933 c9.962,0,20.231-1.356,30.447-4.087c42.74-11.406,72.411-44.344,72.807-77.654h0.011v-0.162c0.002-0.166,0-0.331,0-0.496V187.072 l290.971-67.3v178.082c-3.433-3.055-7.238-5.863-11.481-8.334c-21.385-12.452-49.654-15.308-77.567-7.846 c-49.038,13.087-80.904,54.519-71.038,92.356c4.019,15.385,14.183,28.212,29.404,37.067c13.548,7.894,29.875,11.933,47.115,11.933 c9.962,0,20.231-1.356,30.452-4.087c42.74-11.413,72.411-44.346,72.804-77.654h0.004v-0.065c0.003-0.236,0.001-0.469,0-0.704V0 L163.205,76.413z M104.999,471.779c-22.543,6.038-45.942,3.846-62.572-5.846c-10.587-6.163-17.591-14.817-20.255-25.038 c-7.144-27.375,18.452-58.029,57.062-68.346c8.409-2.25,16.938-3.346,25.188-3.346c13.87,0,26.962,3.115,37.389,9.192 c10.587,6.163,17.591,14.817,20.255,25.029c0.809,3.102,1.142,6.248,1.139,9.4v0.321h0.014 C162.99,437.714,139.082,462.678,104.999,471.779z M182.898,166.853V92.067l290.971-67.298v74.784L182.898,166.853z M415.677,399.923c-22.558,6.038-45.942,3.837-62.587-5.846c-10.587-6.163-17.587-14.817-20.25-25.019 c-7.144-27.385,18.452-58.058,57.058-68.365c8.414-2.25,16.942-3.346,25.192-3.346c13.875,0,26.962,3.115,37.385,9.192 c10.596,6.163,17.596,14.817,20.26,25.029v0.01c0.796,3.05,1.124,6.144,1.135,9.244v0.468h0.02 C473.668,365.851,449.763,390.814,415.677,399.923z">\n        </path>\n      </g>\n    </g>\n  </g>\n</svg>',GIF_ICON_STRING='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 5.9266752 5.6408391" height="21.31971" width="22.4">\n  <g>\n    <path d="m 5.2564627,1.548212 c -3.1136005,-0.4796804 -1.5568006,-0.2398402 0,0 z M 2.0001198,2.0922063 c 0.1556781,0 0.2657489,0.020893 0.3917849,0.080366 0.081154,0.038347 0.1153492,0.134065 0.076377,0.2138602 -0.038973,0.07979 -0.1363527,0.1134129 -0.2175069,0.075091 -0.078199,-0.036919 -0.1407455,-0.048792 -0.250655,-0.048792 -0.2260486,0 -0.3921482,0.2042182 -0.3921482,0.4801409 0,0.2761822 0.1663188,0.4810688 0.3921482,0.4810688 0.1117901,0 0.2064255,-0.046133 0.255659,-0.1284198 l 0.00162,-0.00389 V 3.0534032 l -0.098011,1.75e-4 c -0.081844,0 -0.1495979,-0.059305 -0.1612403,-0.1365887 l -0.00175,-0.023683 c 0,-0.08047 0.060311,-0.1470874 0.1389194,-0.1585331 l 0.024085,-0.00195 h 0.2612303 c 0.081842,0 0.149598,0.059305 0.1612404,0.1365891 l 0.00175,0.023683 -3.398e-4,0.3968809 v 0 l -0.00168,0.014211 v 0 l -0.00553,0.023034 v 0 l -0.00532,0.014145 c -0.098178,0.22826 -0.3236506,0.3528713 -0.5706303,0.3528713 -0.4240855,0 -0.7181621,-0.3622714 -0.7181621,-0.8016063 0,-0.4391857 0.2940275,-0.8006848 0.7181621,-0.8006848 z m 1.2034759,0.031275 c 0.081843,0 0.1495977,0.059305 0.1612403,0.1365891 l 0.00175,0.023683 v 1.2211775 c 0,0.088516 -0.07298,0.1602721 -0.1630073,0.1602721 -0.081841,0 -0.1495972,-0.059305 -0.1612397,-0.1365892 L 3.040589,3.5049308 V 2.2837527 c 0,-0.088516 0.07298,-0.1602721 0.1630067,-0.1602714 z m 0.7813442,0 0.5209469,0.00195 c 0.090025,3.048e-4 0.1627543,0.072306 0.1624458,0.1608234 -2.809e-4,0.08047 -0.06083,0.1468798 -0.1394772,0.158066 l -0.024092,0.00195 -0.3575326,-0.0013 v 0.4497782 l 0.2928918,2.27e-4 c 0.081842,0 0.1495979,0.059305 0.1612403,0.136589 l 0.00175,0.023683 c 0,0.080469 -0.06031,0.1470871 -0.1389193,0.1585393 l -0.024092,0.00195 -0.2928919,-2.336e-4 1.563e-4,0.2860316 c 0,0.080471 -0.06031,0.1470873 -0.1389193,0.1585395 l -0.024085,0.00195 c -0.081843,0 -0.1495979,-0.059305 -0.1612403,-0.1365826 l -0.00175,-0.023691 V 2.2841354 c 2.798e-4,-0.08047 0.060829,-0.1468797 0.1394758,-0.1580594 z"/>\n    <path d="m 5.0894191,1.0943261 c 0,-0.21918999 -0.177687,-0.39686999 -0.396876,-0.39686999 h -3.43959 c -0.2191879,0 -0.391262,0.1777519 -0.3968759,0.39686999 l -0.027082,3.4379266 c 0.040152,0.2939927 0.4235456,0.409415 0.4235456,0.409415 l 3.4785583,-0.00851 c 0,0 0.3008506,-0.1402998 0.3236271,-0.4201576 0.042911,-0.5272495 0.034693,-1.6106146 0.034693,-3.4186761 z m -4.49792494,0 c 0,-0.36530999 0.29614504,-0.66145999 0.66145894,-0.66145999 h 3.43959 c 0.365314,0 0.66146,0.29615 0.66146,0.66145999 v 3.43959 c 0,0.36532 -0.296146,0.66146 -0.66146,0.66146 h -3.43959 c -0.3653139,0 -0.66145894,-0.29614 -0.66145894,-0.66146 z"/>\n  </g>\n</svg>\n',FILE_TYPE_BUTTON_ICONS={images:{id:"upload-images-icon",svgString:IMAGE_ICON_STRING,dropupText:"Image"},gifs:{id:"upload-gifs-icon",svgString:GIF_ICON_STRING,dropupText:"GIF"},audio:{id:"upload-audio-icon",svgString:AUDIO_ICON_STRING,dropupText:"Audio"},mixedFiles:{id:"upload-mixed-files-icon",svgString:MIXED_FILES_ICON_STRING,dropupText:"File"}},FileAttachmentsType=function(){function e(t,n,r){_classCallCheck(this,e),this._attachments=[],this._fileCountLimit=99,this._acceptedFormat="",t.maxNumberOfFiles&&(this._fileCountLimit=t.maxNumberOfFiles),this._toggleContainerDisplay=n,this._fileAttachmentsContainerRef=r,t.acceptedFormats&&(this._acceptedFormat=t.acceptedFormats)}return _createClass(e,[{key:"attemptAddFile",value:function(t,n){return!!e.isFileTypeValid(t,this._acceptedFormat)&&(this.addAttachmentBasedOnType(t,n,!0),!0)}},{key:"addAttachmentBasedOnType",value:function(t,n,r){if(t.type.startsWith("image")){var i=e.createImageAttachment(n);this.addFileAttachment(t,"image",i,r)}else if(t.type.startsWith("audio")){var a=AudioFileAttachmentType.createAudioAttachment(n);this.addFileAttachment(t,"audio",a,r)}else{var s=e.createAnyFileAttachment(t.name);this.addFileAttachment(t,"any",s,r)}}},{key:"addFileAttachment",value:function(t,n,r,i){var a=e.createContainer(r);if(this._attachments.length>=this._fileCountLimit){var s=this._attachments[this._attachments.length-1].removeButton;null==s||s.click();var o=this._fileAttachmentsContainerRef.children;this._fileAttachmentsContainerRef.insertBefore(a,o[0])}else this._fileAttachmentsContainerRef.appendChild(a);var l={file:t,attachmentContainerElement:a,fileType:n};return i&&(l.removeButton=this.createRemoveAttachmentButton(l),a.appendChild(l.removeButton)),this._toggleContainerDisplay(!0),this._attachments.push(l),this._fileAttachmentsContainerRef.scrollTop=this._fileAttachmentsContainerRef.scrollHeight,l}},{key:"createRemoveAttachmentButton",value:function(e){var t=document.createElement("div");t.classList.add("remove-file-attachment-button"),t.onclick=this.removeAttachment.bind(this,e);var n=document.createElement("div");return n.classList.add("x-icon"),n.innerText="\xd7",t.appendChild(n),t}},{key:"removeAttachment",value:function(e){var t=this._attachments.findIndex((function(t){return t===e})),n=this._attachments[t].attachmentContainerElement;this._attachments.splice(t,1),AudioFileAttachmentType.stopAttachmentPlayback(n),n.remove(),this._toggleContainerDisplay(!1)}},{key:"getFiles",value:function(){return Array.from(this._attachments).map((function(e){return{file:e.file,type:e.fileType}}))}},{key:"removeAllAttachments",value:function(){this._attachments.forEach((function(e){setTimeout((function(){var t;return null==(t=e.removeButton)?void 0:t.click()}))}))}}],[{key:"isFileTypeValid",value:function(e,t){if(""===t)return!0;for(var n=t.split(","),r=0;r<n.length;r++){var i=n[r].trim();if(e.type===i)return!0;if(i.startsWith(".")){var a=i.slice(1);if(e.name.endsWith(a))return!0}else{if(e.name.endsWith(i))return!0;if(i.endsWith("/*")&&e.type.startsWith(i.slice(0,-2)))return!0}}return!1}},{key:"createImageAttachment",value:function(e){var t=new Image;return t.src=e,t.classList.add("image-attachment"),t}},{key:"createAnyFileAttachment",value:function(e){var t=document.createElement("div");t.classList.add("border-bound-attachment"),Browser$1.IS_SAFARI&&t.classList.add("border-bound-attachment-safari");var n=document.createElement("div");n.classList.add("any-file-attachment-text");var r=document.createElement("div");return r.classList.add("file-attachment-text-container"),r.appendChild(n),n.textContent=e,t.appendChild(r),t}},{key:"createContainer",value:function(e){var t=document.createElement("div");return t.classList.add("file-attachment"),t.appendChild(e),t}}]),e}(),PLAY_ICON_STRING='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">\n  <title>play</title>\n  <path d="M5.92 24.096q0 1.088 0.928 1.728 0.512 0.288 1.088 0.288 0.448 0 0.896-0.224l16.16-8.064q0.48-0.256 0.8-0.736t0.288-1.088-0.288-1.056-0.8-0.736l-16.16-8.064q-0.448-0.224-0.896-0.224-0.544 0-1.088 0.288-0.928 0.608-0.928 1.728v16.16z"></path>\n</svg>',STOP_ICON_STRING='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">\n<title>stop</title>\n<path d="M5.92 24.096q0 0.832 0.576 1.408t1.44 0.608h16.128q0.832 0 1.44-0.608t0.576-1.408v-16.16q0-0.832-0.576-1.44t-1.44-0.576h-16.128q-0.832 0-1.44 0.576t-0.576 1.44v16.16z"></path>\n</svg>',_AudioFileAttachmentType=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){return _classCallCheck(this,n),t.call(this,e,r,i)}return _createClass(n,[{key:"createTimer",value:function(e,t){var r=this,i=0,a=void 0!==t&&t<n.TIMER_LIMIT_S?t:n.TIMER_LIMIT_S;return setInterval((function(){var t;(i+=1)===a&&(null==(t=r.stopPlaceholderCallback)||t.call(r),r.clearTimer()),600===i&&e.classList.add("audio-placeholder-text-4-digits");var n=Math.floor(i/60),s=(i%60).toString().padStart(2,"0");e.textContent="".concat(n,":").concat(s)}),1e3)}},{key:"createPlaceholderAudioAttachment",value:function(e){var t=n.createAudioContainer(),r=document.createElement("div");r.classList.add("audio-placeholder-text-3-digits");var i=document.createElement("div");i.classList.add("file-attachment-text-container","audio-placeholder-text-3-digits-container"),i.appendChild(r);var a=SVGIconUtils.createSVGElement(STOP_ICON_STRING);return a.classList.add("attachment-icon","stop-icon","not-removable-attachment-icon"),r.textContent="0:00",this._activePlaceholderTimer=this.createTimer(r,e),t.appendChild(i),this.addPlaceholderAudioAttachmentEvents(t,a,i),t}},{key:"addPlaceholderAudioAttachmentEvents",value:function(e,t,n){var r=this;e.addEventListener("mouseenter",(function(){return e.replaceChildren(t)}));e.addEventListener("mouseleave",(function(){return e.replaceChildren(n)}));e.addEventListener("click",(function(){var e;return null==(e=r.stopPlaceholderCallback)?void 0:e.call(r)}))}},{key:"addPlaceholderAttachment",value:function(e,t){var n=this.createPlaceholderAudioAttachment(t);this._activePlaceholderAttachment=this.addFileAttachment(new File([],""),"audio",n,!1),this.stopPlaceholderCallback=e}},{key:"completePlaceholderAttachment",value:function(e,t){var r=this._activePlaceholderAttachment;r&&(r.file=e,n.addAudioElements(r.attachmentContainerElement.children[0],t),r.removeButton=this.createRemoveAttachmentButton(r),r.attachmentContainerElement.appendChild(r.removeButton),this._activePlaceholderAttachment=void 0,this.clearTimer())}},{key:"removePlaceholderAttachment",value:function(){this._activePlaceholderAttachment&&(this.removeAttachment(this._activePlaceholderAttachment),this._activePlaceholderAttachment=void 0,this.clearTimer())}},{key:"clearTimer",value:function(){void 0!==this._activePlaceholderTimer&&(clearInterval(this._activePlaceholderTimer),this._activePlaceholderTimer=void 0,this.stopPlaceholderCallback=void 0)}}],[{key:"createAudioContainer",value:function(){var e=document.createElement("div");return e.classList.add("border-bound-attachment","audio-attachment-icon-container"),Browser$1.IS_SAFARI&&e.classList.add("border-bound-attachment-safari"),e}},{key:"addAudioElements",value:function(e,t){var n=e.parentElement?ElementUtils.cloneElement(e):e,r=document.createElement("audio");r.src=t;var i=SVGIconUtils.createSVGElement(PLAY_ICON_STRING);i.classList.add("attachment-icon","play-icon");var a=SVGIconUtils.createSVGElement(STOP_ICON_STRING);a.classList.add("attachment-icon","stop-icon"),n.replaceChildren(i),r.onplay=function(){n.replaceChildren(a)},r.onpause=function(){n.replaceChildren(i),r.currentTime=0},r.onended=function(){n.replaceChildren(i)},n.onclick=function(){r.paused?r.play():r.pause()}}},{key:"createAudioAttachment",value:function(e){var t=n.createAudioContainer();return n.addAudioElements(t,e),t}},{key:"stopAttachmentPlayback",value:function(e){var t,n,r;null!=(r=null==(n=null==(t=e.children[0])?void 0:t.children)?void 0:n[0])&&r.classList.contains("stop-icon")&&e.children[0].click()}}]),n}(FileAttachmentsType);_AudioFileAttachmentType.TIMER_LIMIT_S=5999;var AudioFileAttachmentType=_AudioFileAttachmentType,FileAttachmentTypeFactory=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"create",value:function(e,t,n,r){return"audio"===r?new AudioFileAttachmentType(e,t,n):new FileAttachmentsType(e,t,n)}}]),e}(),FileAttachments=function(){function e(t,n,r){_classCallCheck(this,e),this._fileAttachmentsTypes=[],this.elementRef=this.createAttachmentContainer();var i="object"==_typeof(r)&&!!r.displayFileAttachmentContainer;this.toggleContainerDisplay(i),t.appendChild(this.elementRef),n&&Object.assign(this.elementRef.style,n)}var t;return _createClass(e,[{key:"addType",value:function(e,t){var n=FileAttachmentTypeFactory.create(e,this.toggleContainerDisplay.bind(this),this.elementRef,t);return this._fileAttachmentsTypes.push(n),n}},{key:"createAttachmentContainer",value:function(){var e=document.createElement("div");return e.id="file-attachment-container",e}},{key:"toggleContainerDisplay",value:function(e){e?this.elementRef.style.display="block":0===this.elementRef.children.length&&(this.elementRef.style.display="none")}},{key:"getAllFileData",value:function(){var e=this._fileAttachmentsTypes.map((function(e){return e.getFiles()})).flat();return e.length>0?e:void 0}},{key:"completePlaceholders",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this._fileAttachmentsTypes.map(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null==(n=t.stopPlaceholderCallback)?void 0:n.call(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"addFilesToAnyType",value:function(t){e.addFilesToType(t,this._fileAttachmentsTypes)}},{key:"removeAllFiles",value:function(){this._fileAttachmentsTypes.forEach((function(e){return e.removeAllAttachments()})),this.elementRef.replaceChildren(),this.toggleContainerDisplay(!1)}},{key:"getNumberOfTypes",value:function(){return this._fileAttachmentsTypes.length}}],[{key:"addFilesToType",value:function(e,t){e.forEach((function(e){var n=new FileReader;n.readAsDataURL(e),n.onload=function(n){for(var r=0;r<t.length&&!t[r].attemptAddFile(e,n.target.result);r+=1);}}))}}]),e}(),_Modal=function(){function e(t,n,r){_classCallCheck(this,e),this._isOpen=!1,this._contentRef=e.createModalContent(n,null==r?void 0:r.backgroundColor),this._buttonPanel=e.createButtonPanel(null==r?void 0:r.backgroundColor),this._elementRef=e.createContainer(this._contentRef,r),this._elementRef.appendChild(this._buttonPanel),t.appendChild(this._elementRef),this._backgroundPanelRef=e.createDarkBackgroundPanel(),t.appendChild(this._backgroundPanelRef),this.addWindowEvents()}return _createClass(e,[{key:"isOpen",value:function(){return this._isOpen}},{key:"addButtons",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t){return e._buttonPanel.appendChild(t)}))}},{key:"close",value:function(){var t=this;this._elementRef.classList.remove("show-modal"),this._elementRef.classList.add("hide-modal"),this._backgroundPanelRef.classList.remove("show-modal-background"),this._backgroundPanelRef.classList.add("hide-modal-background"),this._isOpen=!1,setTimeout((function(){t._elementRef.style.display="none",t._backgroundPanelRef.style.display="none"}),e.MODAL_CLOSE_TIMEOUT_MS)}},{key:"displayModalElements",value:function(){this._elementRef.style.display="flex",this._elementRef.classList.remove("hide-modal"),this._elementRef.classList.add("show-modal"),this._backgroundPanelRef.style.display="block",this._backgroundPanelRef.classList.remove("hide-modal-background"),this._backgroundPanelRef.classList.add("show-modal-background"),this._isOpen=!0}},{key:"openTextModal",value:function(e){this._contentRef.innerHTML=e,this.displayModalElements()}},{key:"addCloseButton",value:function(t,n,r){var i=this,a=n?e.createSVGButton(t):e.createTextButton(t);return this.addButtons(a),a.onclick=function(){i.close(),setTimeout((function(){null==r||r()}),140)},a}},{key:"addWindowEvents",value:function(){var e=this;window.addEventListener("keydown",(function(t){var n,r;e._isOpen&&(t.key===KEYBOARD_KEY.ESCAPE?(e.close(),null==(n=e.extensionCloseCallback)||n.call(e)):t.key===KEYBOARD_KEY.ENTER&&(e.close(),null==(r=e.extensionCloseCallback)||r.call(e)))}))}}],[{key:"createContainer",value:function(e,t){var n=document.createElement("div");return n.classList.add("modal"),n.appendChild(e),t&&delete t.backgroundColor,Object.assign(n.style,t),n}},{key:"createModalContent",value:function(e,t){var n,r=document.createElement("div");return(n=r.classList).add.apply(n,_toConsumableArray(e)),t&&(r.style.backgroundColor=t),document.createElement("div").appendChild(r),r}},{key:"createButtonPanel",value:function(e){var t=document.createElement("div");return t.classList.add("modal-button-panel"),e&&(t.style.backgroundColor=e),t}},{key:"createDarkBackgroundPanel",value:function(){var e=document.createElement("div");return e.id="modal-background-panel",e}},{key:"createTextButton",value:function(e){var t=document.createElement("div");return t.classList.add("modal-button"),t.textContent=e,t}},{key:"createSVGButton",value:function(e){var t=document.createElement("div");t.classList.add("modal-button","modal-svg-button");var n=SVGIconUtils.createSVGElement(e);return n.classList.add("modal-svg-button-icon"),t.appendChild(n),t}},{key:"createTextModalFunc",value:function(t,n,r){var i;if("object"==_typeof(n)&&null!=(i=n.files)&&i.infoModal){var a=new e(t,["modal-content"],n.files.infoModal.containerStyle);return a.addCloseButton("OK",!1,r),a.openTextModal.bind(a,n.infoModalTextMarkUp||"")}}}]),e}();_Modal.MODAL_CLOSE_TIMEOUT_MS=190;var Modal=_Modal,UploadFileButton=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,a,s,o){var l,c,u,d,p,h,f;_classCallCheck(this,n);var m=(l=t.call(this,n.createButtonElement(),null==(c=i.button)?void 0:c.position,i.button,o)).createInnerElements(a,s,l._customStyles);return l._inputElement=n.createInputElement(null==(u=null==i?void 0:i.files)?void 0:u.acceptedFormats),l.addClickEvent(e,i),l.elementRef.replaceChildren(m.styles),l.reapplyStateStyle("styles"),l._fileAttachmentsType=r,l._openModalOnce=!1===(null==(p=null==(d=i.files)?void 0:d.infoModal)?void 0:p.openModalOnce)||null==(f=null==(h=i.files)?void 0:h.infoModal)?void 0:f.openModalOnce,l}return _createClass(n,[{key:"createInnerElements",value:function(e,t,r){var i=n.createSVGIconElement(e,t);return{styles:this.createInnerElement(i,"styles",r)}}},{key:"triggerImportPrompt",value:function(e){e.onchange=this.import.bind(this,e),e.click()}},{key:"import",value:function(e){FileAttachments.addFilesToType(Array.from(e.files||[]),[this._fileAttachmentsType]),e.value=""}},{key:"createInnerElement",value:function(e,t,n){return CustomButtonInnerElements.createSpecificStateElement(this.elementRef,t,n)||e}},{key:"addClickEvent",value:function(e,t){var n=this.triggerImportPrompt.bind(this,this._inputElement),r=Modal.createTextModalFunc(e,t,n);this.elementRef.onclick=this.click.bind(this,r)}},{key:"click",value:function(e){!e||void 0!==this._openModalOnce&&!0!==this._openModalOnce?this.triggerImportPrompt(this._inputElement):(e(),!0===this._openModalOnce&&(this._openModalOnce=!1))}}],[{key:"createInputElement",value:function(e){var t=document.createElement("input");return t.type="file",t.accept=e||"",t.hidden=!0,t.multiple=!0,t}},{key:"createButtonElement",value:function(){var e=document.createElement("div");return e.classList.add("input-button","upload-file-button"),e}},{key:"createSVGIconElement",value:function(e,t){var n=SVGIconUtils.createSVGElement(t);return n.id=e,n}}]),n}(InputButton),DragAndDrop=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"create",value:function(t,n,r){var i=e.createElement(r);e.addEvents(i,t,n),t.appendChild(i)}},{key:"createElement",value:function(e){var t=document.createElement("div");return t.id="drag-and-drop","object"==_typeof(e)&&Object.assign(t.style,e),t}},{key:"addEvents",value:function(t,n,r){n.ondragenter=function(n){n.preventDefault(),e.display(t)},t.ondragleave=function(n){n.preventDefault(),e.hide(t)},t.ondragover=function(e){e.preventDefault()},t.ondrop=function(n){n.preventDefault(),e.uploadFile(r,n),e.hide(t)}}},{key:"uploadFile",value:function(e,t){var n,r=null==(n=t.dataTransfer)?void 0:n.files;r&&e.addFilesToAnyType(Array.from(r))}},{key:"display",value:function(e){e.style.display="block"}},{key:"hide",value:function(e){e.style.display="none"}},{key:"isEnabled",value:function(e,t){return(void 0===t||!1!==t)&&(!!t||e.getNumberOfTypes()>0)}}]),e}(),MICROPHONE_ICON_STRING='<?xml version="1.0" encoding="iso-8859-1"?>\n<svg height="1.4em" width="1.4em" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n\t viewBox="0 0 490.9 490.9" xml:space="preserve">\n\t<g>\n\t\t<g>\n\t\t\t<path d="M245.5,322.9c53,0,96.2-43.2,96.2-96.2V96.2c0-53-43.2-96.2-96.2-96.2s-96.2,43.2-96.2,96.2v130.5\n\t\t\t\tC149.3,279.8,192.5,322.9,245.5,322.9z M173.8,96.2c0-39.5,32.2-71.7,71.7-71.7s71.7,32.2,71.7,71.7v130.5\n\t\t\t\tc0,39.5-32.2,71.7-71.7,71.7s-71.7-32.2-71.7-71.7V96.2z"/>\n\t\t\t<path d="M94.4,214.5c-6.8,0-12.3,5.5-12.3,12.3c0,85.9,66.7,156.6,151.1,162.8v76.7h-63.9c-6.8,0-12.3,5.5-12.3,12.3\n\t\t\t\ts5.5,12.3,12.3,12.3h152.3c6.8,0,12.3-5.5,12.3-12.3s-5.5-12.3-12.3-12.3h-63.9v-76.7c84.4-6.3,151.1-76.9,151.1-162.8\n\t\t\t\tc0-6.8-5.5-12.3-12.3-12.3s-12.3,5.5-12.3,12.3c0,76.6-62.3,138.9-138.9,138.9s-138.9-62.3-138.9-138.9\n\t\t\t\tC106.6,220,101.2,214.5,94.4,214.5z"/>\n\t\t</g>\n\t</g>\n</svg>\n',MicrophoneButton=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),"dropup-menu"===(null==e?void 0:e.position)&&(e.position="outside-right"),(r=t.call(this,n.createMicrophoneElement(),null==e?void 0:e.position,e)).isActive=!1,r._innerElements=r.createInnerElements(r._customStyles),r.changeToDefault(),r}return _createClass(n,[{key:"createInnerElements",value:function(e){var t=n.createSVGIconElement();return{default:this.createInnerElement(t,"default",e),active:this.createInnerElement(t,"active",e),unsupported:this.createInnerElement(t,"unsupported",e),commandMode:this.createInnerElement(t,"commandMode",e)}}},{key:"createInnerElement",value:function(e,t,n){return CustomButtonInnerElements.createSpecificStateElement(this.elementRef,t,n)||e}},{key:"changeToActive",value:function(){this.elementRef.replaceChildren(this._innerElements.active),this.toggleIconFilter("active"),this.reapplyStateStyle("active",["default","commandMode"]),this.isActive=!0}},{key:"changeToDefault",value:function(){this.elementRef.replaceChildren(this._innerElements.default),this.toggleIconFilter("default"),this.reapplyStateStyle("default",["active","commandMode"]),this.isActive=!1}},{key:"changeToCommandMode",value:function(){this.elementRef.replaceChildren(this._innerElements.unsupported),this.toggleIconFilter("command"),this.reapplyStateStyle("commandMode",["active"])}},{key:"changeToUnsupported",value:function(){this.elementRef.replaceChildren(this._innerElements.unsupported),this.elementRef.classList.add("unsupported-microphone"),this.reapplyStateStyle("unsupported",["active"])}},{key:"toggleIconFilter",value:function(e){var t=this.elementRef.children[0];if("svg"===t.tagName.toLocaleLowerCase())switch(e){case"default":t.classList.remove("active-microphone-icon","command-microphone-icon"),t.classList.add("default-microphone-icon");break;case"active":t.classList.remove("default-microphone-icon","command-microphone-icon"),t.classList.add("active-microphone-icon");break;case"command":t.classList.remove("active-microphone-icon","default-microphone-icon"),t.classList.add("command-microphone-icon")}}}],[{key:"createMicrophoneElement",value:function(){var e=document.createElement("div");return e.id="microphone-button",e.classList.add("input-button"),e}},{key:"createSVGIconElement",value:function(){var e=SVGIconUtils.createSVGElement(MICROPHONE_ICON_STRING);return e.id="microphone-icon",e}}]),n}(InputButton),dist={},webSpeech={},webSpeechTranscript={},translate={},text={};Object.defineProperty(text,"__esModule",{value:!0}),text.Text=void 0;var Text=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"capitalize",value:function(t){return t.replace(e.FIRST_CHAR_REGEX,(function(e){return e.toUpperCase()}))}},{key:"lineBreak",value:function(t){return t.replace(e.DOUBLE_LINE,"<p></p>").replace(e.ONE_LINE,"<br>")}},{key:"isCharDefined",value:function(e){return void 0!==e&&"\xa0"!==e&&" "!==e&&"\n"!==e&&""!==e}},{key:"breakupIntoWordsArr",value:function(e){return e.split(/(\W+)/)}}]),e}();text.Text=Text,Text.FIRST_CHAR_REGEX=/\S/,Text.DOUBLE_LINE=/\n\n/g,Text.ONE_LINE=/\n/g,Object.defineProperty(translate,"__esModule",{value:!0}),translate.Translate=void 0;var text_1$3=text,Translate=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"translate",value:function(e,t){for(var n=text_1$3.Text.breakupIntoWordsArr(e),r=0;r<n.length;r+=1)t[n[r]]&&(n[r]=t[n[r]]);return n.join("")}}]),e}();translate.Translate=Translate,Object.defineProperty(webSpeechTranscript,"__esModule",{value:!0}),webSpeechTranscript.WebSpeechTranscript=void 0;var translate_1$1=translate,WebSpeechTranscript=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"extract",value:function(e,t,n){for(var r="",i=e.resultIndex;i<e.results.length;++i){var a=e.results[i][0].transcript;n&&(a=translate_1$1.Translate.translate(a,n)),e.results[i].isFinal?t+=a:r+=a}return{interimTranscript:r,finalTranscript:t,newText:r||t}}},{key:"extractSafari",value:function(e,t,n){for(var r="",i=e.resultIndex;i<e.results.length;++i){var a=e.results[i][0].transcript;n&&(a=translate_1$1.Translate.translate(a,n)),r+=a}return{interimTranscript:"",finalTranscript:r,newText:r}}}]),e}();webSpeechTranscript.WebSpeechTranscript=WebSpeechTranscript;var browser={};Object.defineProperty(browser,"__esModule",{value:!0}),browser.Browser=void 0;var Browser=_createClass((function e(){_classCallCheck(this,e)}));browser.Browser=Browser,Browser.IS_SAFARI=function(){return void 0===Browser._IS_SAFARI&&(Browser._IS_SAFARI=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),Browser._IS_SAFARI};var speech={},eventListeners={};Object.defineProperty(eventListeners,"__esModule",{value:!0}),eventListeners.EventListeners=void 0;var EventListeners=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getElementIfFocusedOnAvailable",value:function(e,t){return Array.isArray(e)?e.find((function(e){return t===e})):t===e?e:void 0}},{key:"keyDownWindow",value:function(t){var n=this;t.element&&e.getElementIfFocusedOnAvailable(t.element,document.activeElement)&&(null!==e.KEY_DOWN_TIMEOUT&&clearTimeout(e.KEY_DOWN_TIMEOUT),e.KEY_DOWN_TIMEOUT=setTimeout((function(){e.KEY_DOWN_TIMEOUT=null,n.resetRecording(t)}),500))}},{key:"mouseDownWindow",value:function(t,n){this.mouseDownElement=e.getElementIfFocusedOnAvailable(t,n.target)}},{key:"mouseUpWindow",value:function(e){this.mouseDownElement&&this.resetRecording(e),this.mouseDownElement=void 0}},{key:"add",value:function(t,n){var r=void 0===(null==n?void 0:n.insertInCursorLocation)||(null==n?void 0:n.insertInCursorLocation);null!=n&&n.element&&r&&(t.mouseDownEvent=e.mouseDownWindow.bind(t,n.element),document.addEventListener("mousedown",t.mouseDownEvent),t.mouseUpEvent=e.mouseUpWindow.bind(t,n),document.addEventListener("mouseup",t.mouseUpEvent),t.keyDownEvent=e.keyDownWindow.bind(t,n),document.addEventListener("keydown",t.keyDownEvent))}},{key:"remove",value:function(e){document.removeEventListener("mousedown",e.mouseDownEvent),document.removeEventListener("mouseup",e.mouseUpEvent),document.removeEventListener("keydown",e.keyDownEvent)}}]),e}();eventListeners.EventListeners=EventListeners,EventListeners.KEY_DOWN_TIMEOUT=null;var preResultUtils={};Object.defineProperty(preResultUtils,"__esModule",{value:!0}),preResultUtils.PreResultUtils=void 0;var PreResultUtils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"process",value:function(e,t,n,r,i){var a=null==r?void 0:r(t,n);return!!a&&(setTimeout((function(){a.restart?e.resetRecording(i):a.stop&&e.stop()})),(a.stop||a.restart)&&a.removeNewText)}}]),e}();preResultUtils.PreResultUtils=PreResultUtils;var commandUtils={},autoScroll={};Object.defineProperty(autoScroll,"__esModule",{value:!0}),autoScroll.AutoScroll=void 0;var AutoScroll=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"changeStateIfNeeded",value:function(e,t){t&&!e.isCursorAtEnd&&(e.endPadding="",e.scrollingSpan.innerHTML="&nbsp;")}},{key:"scrollGeneric",value:function(e,t){e.isCursorAtEnd?t.scrollTop=t.scrollHeight:e.scrollingSpan.scrollIntoView({block:"nearest"})}},{key:"scrollSafariPrimitiveToEnd",value:function(e){e.scrollLeft=e.scrollWidth,e.scrollTop=e.scrollHeight}},{key:"isElementOverflown",value:function(e){return e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth}},{key:"isRequired",value:function(t,n){return t&&e.isElementOverflown(n)}}]),e}();autoScroll.AutoScroll=AutoScroll;var elements={};Object.defineProperty(elements,"__esModule",{value:!0}),elements.Elements=void 0;var Elements=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"isPrimitiveElement",value:function(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName}},{key:"createInterimSpan",value:function(){var e=document.createElement("span");return e.style.color="grey",e.style.pointerEvents="none",e}},{key:"createGenericSpan",value:function(){var e=document.createElement("span");return e.style.pointerEvents="none",e}},{key:"appendSpans",value:function(e,t){if(e.spansPopulated=!0,e.insertInCursorLocation&&document.activeElement===t){var n=window.getSelection();if(null!=n&&n.focusNode){var r=n.getRangeAt(0);return r.insertNode(e.scrollingSpan),r.insertNode(e.interimSpan),r.insertNode(e.finalSpan),r.collapse(!1),n.removeAllRanges(),void n.addRange(r)}}t.appendChild(e.finalSpan),t.appendChild(e.interimSpan),t.appendChild(e.scrollingSpan)}},{key:"applyCustomColors",value:function(e,t){t.interim&&(e.interimSpan.style.color=t.interim),t.final&&(e.finalSpan.style.color=t.final)}},{key:"isInsideShadowDOM",value:function(e){return e.getRootNode()instanceof ShadowRoot}}]),e}();elements.Elements=Elements;var cursor={};Object.defineProperty(cursor,"__esModule",{value:!0}),cursor.Cursor=void 0;var Cursor=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"setOffsetForGeneric",value:function(t,n){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=0,a=0;a<t.childNodes.length;a+=1){var s=t.childNodes[a];if(s.childNodes.length>0){var o=e.setOffsetForGeneric(s,n,r);if(-1===o)return-1;r+=o}else if(null!==s.textContent){if(r+s.textContent.length>n){var l=document.createRange();l.setStart(s,n-r),l.collapse(!0);var c=window.getSelection();return null==c||c.removeAllRanges(),null==c||c.addRange(l),t.focus(),-1}r+=s.textContent.length,i+=s.textContent.length}}return i}},{key:"focusEndOfGeneric",value:function(e){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=window.getSelection();n&&(n.removeAllRanges(),n.addRange(t))}},{key:"setOffsetForSafariGeneric",value:function(t,n){var r=window.getSelection();if(r){var i=e.getGenericElementCursorOffset(t,r,!0);console.log(i),setTimeout((function(){}),100),e.setOffsetForGeneric(t,i+n)}}},{key:"setOffsetForPrimitive",value:function(e,t,n){n&&e.blur(),e.setSelectionRange(t,t),e.focus()}},{key:"getGenericElementCursorOffset",value:function(e,t,n){var r=0;if(t.rangeCount>0){var i=t.getRangeAt(0),a=i.cloneRange();a.selectNodeContents(e),n?a.setEnd(i.startContainer,i.startOffset):a.setEnd(i.endContainer,i.endOffset),r=a.toString().length}return r}}]),e}();cursor.Cursor=Cursor,Object.defineProperty(commandUtils,"__esModule",{value:!0}),commandUtils.CommandUtils=void 0;var autoScroll_1$1=autoScroll,elements_1$3=elements,browser_1$2=browser,cursor_1$3=cursor,text_1$2=text,CommandUtils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"processCommand",value:function(e,t){return(!t||!t.caseSensitive)&&(e=e.toLowerCase()),!1===(null==t?void 0:t.substrings)?text_1$2.Text.breakupIntoWordsArr(e):e}},{key:"process",value:function(t){var n;return!0===(null===(n=t.settings)||void 0===n?void 0:n.caseSensitive)?t:Object.keys(t).reduce((function(n,r){var i=t[r];return n[r]="string"==typeof i?e.processCommand(i,t.settings):i,n}),{})}},{key:"toggleCommandModeOn",value:function(e){var t;e.isWaitingForCommand=!0,null===(t=e.onCommandModeTrigger)||void 0===t||t.call(e,!0)}},{key:"toggleCommandModeOff",value:function(e){var t;e.isWaitingForCommand&&(null===(t=e.onCommandModeTrigger)||void 0===t||t.call(e,!1),e.isWaitingForCommand=!1)}},{key:"setText",value:function(t,n,r,i){e.toggleCommandModeOff(t),elements_1$3.Elements.isPrimitiveElement(i)?(i.value=r,t.isTargetInShadow||cursor_1$3.Cursor.setOffsetForPrimitive(i,r.length,!0),browser_1$2.Browser.IS_SAFARI()&&t.autoScroll&&autoScroll_1$1.AutoScroll.scrollSafariPrimitiveToEnd(i)):(i.textContent=r,t.isTargetInShadow||cursor_1$3.Cursor.focusEndOfGeneric(i),setTimeout((function(){return autoScroll_1$1.AutoScroll.scrollGeneric(t,i)}))),t.resetRecording(n)}},{key:"checkIfMatchesSubstring",value:function(e,t){return t.includes(e)}},{key:"checkIfMatchesWord",value:function(e,t,n){for(var r=e,i=n.length-1;i>=0;i-=1){for(var a=i,s=r.length-1;n[a]===r[s]&&s>=0;)a-=1,s-=1;if(s<0)return!0}return!1}},{key:"execCommand",value:function(t,n,r,i,a){var s,o,l,c=t.commands;if(c&&i&&r){var u=!0===(null===(s=c.settings)||void 0===s?void 0:s.caseSensitive)?n:n.toLowerCase(),d=text_1$2.Text.breakupIntoWordsArr(u),p=!1===(null===(o=c.settings)||void 0===o?void 0:o.substrings)?e.checkIfMatchesWord:e.checkIfMatchesSubstring;if(c.commandMode&&p(c.commandMode,u,d))return t.setInterimColorToFinal(),setTimeout((function(){return e.toggleCommandModeOn(t)})),{doNotProcessTranscription:!1};if(!c.commandMode||t.isWaitingForCommand){if(c.stop&&p(c.stop,u,d))return e.toggleCommandModeOff(t),setTimeout((function(){return t.stop()})),{doNotProcessTranscription:!1};if(c.pause&&p(c.pause,u,d))return e.toggleCommandModeOff(t),t.setInterimColorToFinal(),setTimeout((function(){var e;t.isPaused=!0,null===(e=t.onPauseTrigger)||void 0===e||e.call(t,!0)})),{doNotProcessTranscription:!1};if(c.resume&&p(c.resume,u,d))return t.isPaused=!1,null===(l=t.onPauseTrigger)||void 0===l||l.call(t,!1),e.toggleCommandModeOff(t),t.resetRecording(r),{doNotProcessTranscription:!0};if(c.reset&&p(c.reset,u,d))return void 0!==a&&e.setText(t,r,a,i),{doNotProcessTranscription:!0};if(c.removeAllText&&p(c.removeAllText,u,d))return e.setText(t,r,"",i),{doNotProcessTranscription:!0}}}}}]),e}();commandUtils.CommandUtils=CommandUtils;var highlight={};Object.defineProperty(highlight,"__esModule",{value:!0}),highlight.Highlight=void 0;var elements_1$2=elements,cursor_1$2=cursor,Highlight=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"setStateForPrimitive",value:function(e,t){var n,r;null!==t.selectionStart&&(n=t.selectionStart),null!==t.selectionEnd&&(r=t.selectionEnd),e.isHighlighted=n!==r}},{key:"setStateForGeneric",value:function(e,t){var n=window.getSelection();if(null!=n&&n.focusNode){var r=cursor_1$2.Cursor.getGenericElementCursorOffset(t,n,!0),i=cursor_1$2.Cursor.getGenericElementCursorOffset(t,n,!1);e.isHighlighted=r!==i}}},{key:"setState",value:function(t,n){document.activeElement===n&&(elements_1$2.Elements.isPrimitiveElement(n)?e.setStateForPrimitive(t,n):e.setStateForGeneric(t,n))}},{key:"removeForGeneric",value:function(e,t){var n=window.getSelection();if(n){var r=cursor_1$2.Cursor.getGenericElementCursorOffset(t,n,!0);n.deleteFromDocument(),cursor_1$2.Cursor.setOffsetForGeneric(t,r),e.isHighlighted=!1}}},{key:"removeForPrimitive",value:function(e,t){var n=t.selectionStart,r=t.selectionEnd,i=t.value;if(n&&r){var a=i.substring(0,n)+i.substring(r);t.value=a,cursor_1$2.Cursor.setOffsetForPrimitive(t,n,e.autoScroll)}e.isHighlighted=!1}}]),e}();highlight.Highlight=Highlight;var padding={};Object.defineProperty(padding,"__esModule",{value:!0}),padding.Padding=void 0;var elements_1$1=elements,cursor_1$1=cursor,text_1$1=text,Padding=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"setStateForPrimitiveElement",value:function(e,t){if(document.activeElement===t&&null!==t.selectionStart){var n=t.selectionStart,r=t.value[n-1],i=null===t.selectionEnd?n:t.selectionEnd,a=t.value[i];return text_1$1.Text.isCharDefined(r)&&(e.startPadding=" ",e.numberOfSpacesBeforeNewText=1),text_1$1.Text.isCharDefined(a)&&(e.endPadding=" ",e.numberOfSpacesAfterNewText=1),void(e.isCursorAtEnd=t.value.length===i)}var s=t.value[t.value.length-1];text_1$1.Text.isCharDefined(s)&&(e.startPadding=" ",e.numberOfSpacesBeforeNewText=1),e.isCursorAtEnd=!0}},{key:"setStateForGenericElement",value:function(e,t){var n,r,i;if(document.activeElement===t){var a=window.getSelection();if(null!=a&&a.focusNode){var s=cursor_1$1.Cursor.getGenericElementCursorOffset(t,a,!0),o=null===(n=t.textContent)||void 0===n?void 0:n[s-1],l=cursor_1$1.Cursor.getGenericElementCursorOffset(t,a,!1),c=null===(r=t.textContent)||void 0===r?void 0:r[l];return text_1$1.Text.isCharDefined(o)&&(e.startPadding=" "),text_1$1.Text.isCharDefined(c)&&(e.endPadding=" "),void(e.isCursorAtEnd=(null===(i=t.textContent)||void 0===i?void 0:i.length)===l)}}var u=t.innerText.charAt(t.innerText.length-1);text_1$1.Text.isCharDefined(u)&&(e.startPadding=" "),e.isCursorAtEnd=!0}},{key:"setState",value:function(t,n){elements_1$1.Elements.isPrimitiveElement(n)?e.setStateForPrimitiveElement(t,n):e.setStateForGenericElement(t,n)}},{key:"adjustStateAfterRecodingPrimitiveElement",value:function(e,t){e.primitiveTextRecorded=!0,e.insertInCursorLocation&&document.activeElement===t&&(null!==t.selectionEnd&&(e.endPadding=e.endPadding+t.value.slice(t.selectionEnd)),null!==t.selectionStart)?e.startPadding=t.value.slice(0,t.selectionStart)+e.startPadding:e.startPadding=t.value+e.startPadding}},{key:"adjustSateForNoTextPrimitiveElement",value:function(e){1===e.numberOfSpacesBeforeNewText&&(e.startPadding=e.startPadding.substring(0,e.startPadding.length-1),e.numberOfSpacesBeforeNewText=0),1===e.numberOfSpacesAfterNewText&&(e.endPadding=e.endPadding.substring(1),e.numberOfSpacesAfterNewText=0)}}]),e}();padding.Padding=Padding,Object.defineProperty(speech,"__esModule",{value:!0}),speech.Speech=void 0;var eventListeners_1=eventListeners,preResultUtils_1=preResultUtils,commandUtils_1$1=commandUtils,autoScroll_1=autoScroll,highlight_1=highlight,elements_1=elements,padding_1=padding,browser_1$1=browser,cursor_1=cursor,text_1=text,Speech=function(){function e(){_classCallCheck(this,e),this.finalTranscript="",this.interimSpan=elements_1.Elements.createInterimSpan(),this.finalSpan=elements_1.Elements.createGenericSpan(),this.scrollingSpan=elements_1.Elements.createGenericSpan(),this.isCursorAtEnd=!1,this.spansPopulated=!1,this.startPadding="",this.endPadding="",this.numberOfSpacesBeforeNewText=0,this.numberOfSpacesAfterNewText=0,this.isHighlighted=!1,this.primitiveTextRecorded=!1,this.recognizing=!1,this._displayInterimResults=!0,this.insertInCursorLocation=!0,this.autoScroll=!0,this.isRestarting=!1,this.isPaused=!1,this.isWaitingForCommand=!1,this.isTargetInShadow=!1,this.cannotBeStopped=!1,this.resetState()}return _createClass(e,[{key:"prepareBeforeStart",value:function(e){var t,n;if(null!=e&&e.element)if(eventListeners_1.EventListeners.add(this,e),Array.isArray(e.element)){var r=e.element.find((function(e){return e===document.activeElement}))||e.element[0];if(!r)return;this.prepare(r)}else this.prepare(e.element);void 0!==(null==e?void 0:e.displayInterimResults)&&(this._displayInterimResults=e.displayInterimResults),null!=e&&e.textColor&&(this._finalTextColor=null===(t=null==e?void 0:e.textColor)||void 0===t?void 0:t.final,elements_1.Elements.applyCustomColors(this,e.textColor)),void 0!==(null==e?void 0:e.insertInCursorLocation)&&(this.insertInCursorLocation=e.insertInCursorLocation),void 0!==(null==e?void 0:e.autoScroll)&&(this.autoScroll=e.autoScroll),this._onResult=null==e?void 0:e.onResult,this._onPreResult=null==e?void 0:e.onPreResult,this._onStart=null==e?void 0:e.onStart,this._onStop=null==e?void 0:e.onStop,this._onError=null==e?void 0:e.onError,this.onCommandModeTrigger=null==e?void 0:e.onCommandModeTrigger,this.onPauseTrigger=null==e?void 0:e.onPauseTrigger,this._options=e,null!==(n=this._options)&&void 0!==n&&n.commands&&(this.commands=commandUtils_1$1.CommandUtils.process(this._options.commands))}},{key:"prepare",value:function(e){padding_1.Padding.setState(this,e),highlight_1.Highlight.setState(this,e),this.isTargetInShadow=elements_1.Elements.isInsideShadowDOM(e),elements_1.Elements.isPrimitiveElement(e)?(this._primitiveElement=e,this._originalText=this._primitiveElement.value):(this._genericElement=e,this._originalText=this._genericElement.textContent)}},{key:"resetRecording",value:function(e){this.isRestarting=!0,this.stop(!0),this.resetState(!0),this.start(e,!0)}},{key:"updateElements",value:function(e,t,n){var r,i=text_1.Text.capitalize(t);if(this.finalTranscript!==i||""!==e){preResultUtils_1.PreResultUtils.process(this,n,""===e,this._onPreResult,this._options)&&(e="",n="");var a=this.commands&&commandUtils_1$1.CommandUtils.execCommand(this,n,this._options,this._primitiveElement||this._genericElement,this._originalText);if(a){if(a.doNotProcessTranscription)return;e="",n=""}if(!this.isPaused&&!this.isWaitingForCommand){null===(r=this._onResult)||void 0===r||r.call(this,n,""===e),this.finalTranscript=i,this._displayInterimResults||(e="");var s=""===this.finalTranscript&&""===e;this._primitiveElement?this.updatePrimitiveElement(this._primitiveElement,e,s):this._genericElement&&this.updateGenericElement(this._genericElement,e,s)}}}},{key:"updatePrimitiveElement",value:function(e,t,n){this.isHighlighted&&highlight_1.Highlight.removeForPrimitive(this,e),this.primitiveTextRecorded||padding_1.Padding.adjustStateAfterRecodingPrimitiveElement(this,e),n&&padding_1.Padding.adjustSateForNoTextPrimitiveElement(this);var r=this.startPadding+this.finalTranscript+t;if(e.value=r+this.endPadding,!this.isTargetInShadow){var i=r.length+this.numberOfSpacesAfterNewText;cursor_1.Cursor.setOffsetForPrimitive(e,i,this.autoScroll)}this.autoScroll&&browser_1$1.Browser.IS_SAFARI()&&this.isCursorAtEnd&&autoScroll_1.AutoScroll.scrollSafariPrimitiveToEnd(e)}},{key:"updateGenericElement",value:function(e,t,n){this.isHighlighted&&highlight_1.Highlight.removeForGeneric(this,e),this.spansPopulated||elements_1.Elements.appendSpans(this,e);var r=(n?"":this.startPadding)+text_1.Text.lineBreak(this.finalTranscript);this.finalSpan.innerHTML=r;var i=autoScroll_1.AutoScroll.isRequired(this.autoScroll,e);autoScroll_1.AutoScroll.changeStateIfNeeded(this,i);var a=text_1.Text.lineBreak(t)+(n?"":this.endPadding);this.interimSpan.innerHTML=a,browser_1$1.Browser.IS_SAFARI()&&this.insertInCursorLocation&&cursor_1.Cursor.setOffsetForSafariGeneric(e,r.length+a.length),i&&autoScroll_1.AutoScroll.scrollGeneric(this,e),n&&(this.scrollingSpan.innerHTML="")}},{key:"finalise",value:function(e){this._genericElement&&(e?(this.finalSpan=elements_1.Elements.createGenericSpan(),this.setInterimColorToFinal(),this.interimSpan=elements_1.Elements.createInterimSpan(),this.scrollingSpan=elements_1.Elements.createGenericSpan()):this._genericElement.textContent=this._genericElement.textContent,this.spansPopulated=!1),eventListeners_1.EventListeners.remove(this)}},{key:"setInterimColorToFinal",value:function(){this.interimSpan.style.color=this._finalTextColor||"black"}},{key:"resetState",value:function(e){this._primitiveElement=void 0,this._genericElement=void 0,this.finalTranscript="",this.finalSpan.innerHTML="",this.interimSpan.innerHTML="",this.scrollingSpan.innerHTML="",this.startPadding="",this.endPadding="",this.isHighlighted=!1,this.primitiveTextRecorded=!1,this.numberOfSpacesBeforeNewText=0,this.numberOfSpacesAfterNewText=0,e||(this.stopTimeout=void 0)}},{key:"setStateOnStart",value:function(){var e;this.recognizing=!0,this.isRestarting?this.isRestarting=!1:null===(e=this._onStart)||void 0===e||e.call(this)}},{key:"setStateOnStop",value:function(){var e;this.recognizing=!1,this.isRestarting||null===(e=this._onStop)||void 0===e||e.call(this)}},{key:"setStateOnError",value:function(e){var t;null===(t=this._onError)||void 0===t||t.call(this,e),this.recognizing=!1}}]),e}();speech.Speech=Speech,Object.defineProperty(webSpeech,"__esModule",{value:!0}),webSpeech.WebSpeech=void 0;var webSpeechTranscript_1=webSpeechTranscript,browser_1=browser,speech_1$1=speech,WebSpeech=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.call(this)}return _createClass(n,[{key:"start",value:function(e){var t;void 0===this._extractText&&(this._extractText=browser_1.Browser.IS_SAFARI()?webSpeechTranscript_1.WebSpeechTranscript.extractSafari:webSpeechTranscript_1.WebSpeechTranscript.extract),this.validate()&&(this.prepareBeforeStart(e),this.instantiateService(e),null===(t=this._service)||void 0===t||t.start(),this._translations=null==e?void 0:e.translations)}},{key:"validate",value:function(){return!!n.getAPI()||(this.error("Speech Recognition is unsupported"),!1)}},{key:"instantiateService",value:function(e){var t,r,i=n.getAPI();this._service=new i,this._service.continuous=!0,this._service.interimResults=null===(t=null==e?void 0:e.displayInterimResults)||void 0===t||t,this._service.lang=(null===(r=null==e?void 0:e.language)||void 0===r?void 0:r.trim())||"en-US",this.setEvents()}},{key:"setEvents",value:function(){var e=this;this._service&&(this._service.onstart=function(){e.setStateOnStart()},this._service.onerror=function(t){browser_1.Browser.IS_SAFARI()&&"Another request is started"===t.message||"aborted"===t.error&&e.isRestarting||"no-speech"!==t.error&&e.error(t.message||t.error)},this._service.onaudioend=function(){e.setStateOnStop()},this._service.onend=function(){e._stopping=!1},this._service.onresult=function(t){if(_typeof(t.results)>"u"&&e._service)e._service.onend=null,e._service.stop();else if(e._extractText&&!e._stopping){var n=e._extractText(t,e.finalTranscript,e._translations),r=n.interimTranscript,i=n.finalTranscript,a=n.newText;e.updateElements(r,i,a)}})}},{key:"stop",value:function(e){var t;this._stopping=!0,null===(t=this._service)||void 0===t||t.stop(),this.finalise(e)}},{key:"error",value:function(e){console.error(e),this.setStateOnError(e),this.stop()}}],[{key:"getAPI",value:function(){return window.webkitSpeechRecognition||window.SpeechRecognition}}]),n}(speech_1$1.Speech);webSpeech.WebSpeech=WebSpeech;var globalState={};Object.defineProperty(globalState,"__esModule",{value:!0}),globalState.GlobalState=void 0;var GlobalState=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"doubleClickDetector",value:function(){return!!e.doubleClickPending||(e.doubleClickPending=!0,setTimeout((function(){e.doubleClickPending=!1}),300),!1)}}]),e}();globalState.GlobalState=GlobalState,GlobalState.doubleClickPending=!1;var azure={},preventConnectionStop={};Object.defineProperty(preventConnectionStop,"__esModule",{value:!0}),preventConnectionStop.PreventConnectionStop=void 0;var PreventConnectionStop=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"applyPrevention",value:function(e){clearTimeout(e._manualConnectionStopPrevention),e.cannotBeStopped=!0,e._manualConnectionStopPrevention=setTimeout((function(){e.cannotBeStopped=!1}),800)}},{key:"clearPrevention",value:function(e){clearTimeout(e._manualConnectionStopPrevention),e.cannotBeStopped=!1}}]),e}();preventConnectionStop.PreventConnectionStop=PreventConnectionStop;var azureSpeechConfig={},readme={};Object.defineProperty(readme,"__esModule",{value:!0}),readme.README_URL=void 0,readme.README_URL="https://github.com/OvidijusParsiunas/speech-to-element",Object.defineProperty(azureSpeechConfig,"__esModule",{value:!0}),azureSpeechConfig.AzureSpeechConfig=void 0;var readme_1=readme,AzureSpeechConfig=function(){function e(){_classCallCheck(this,e)}var t,n;return _createClass(e,null,[{key:"validateOptions",value:function(e,t){return t?t.subscriptionKey||t.token||t.retrieveToken?!!t.region||(e("Please define a 'region' property - more info: ".concat(readme_1.README_URL)),!1):(e("Please define a 'subscriptionKey', 'token' or 'retrieveToken' property - more info: ".concat(readme_1.README_URL)),!1):(e("Please provide subscription details - more info: ".concat(readme_1.README_URL)),!1)}},{key:"getNewSpeechConfig",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.region){e.next=2;break}return e.abrupt("return",n.subscriptionKey?t.fromSubscription(n.subscriptionKey.trim(),n.region.trim()):n.token?t.fromAuthorizationToken(n.token.trim(),n.region.trim()):n.retrieveToken?n.retrieveToken().then((function(e){return n.region?t.fromAuthorizationToken((null==e?void 0:e.trim())||"",n.region.trim()):null})).catch((function(e){return console.error(e),null})):null);case 2:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"process",value:function(e,t){t.language&&(e.speechRecognitionLanguage=t.language.trim())}},{key:"get",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function t(n,r){var i;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getNewSpeechConfig(n,r);case 2:return i=t.sent,t.abrupt("return",(i&&e.process(i,r),i));case 4:case"end":return t.stop()}}),t)}))),function(e,n){return t.apply(this,arguments)})}]),e}();azureSpeechConfig.AzureSpeechConfig=AzureSpeechConfig;var stopTimeout={};Object.defineProperty(stopTimeout,"__esModule",{value:!0}),stopTimeout.StopTimeout=void 0;var StopTimeout=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"set",value:function(e){e.stopTimeout=setTimeout((function(){return e.stop()}),e.stopTimeoutMS)}},{key:"reset",value:function(t,n){t.stopTimeoutMS=n||e.DEFAULT_MS,t.stopTimeout&&clearTimeout(t.stopTimeout),e.set(t)}}]),e}();stopTimeout.StopTimeout=StopTimeout,StopTimeout.DEFAULT_MS=2e4;var azureTranscript={};Object.defineProperty(azureTranscript,"__esModule",{value:!0}),azureTranscript.AzureTranscript=void 0;var translate_1=translate,AzureTranscript=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"extract",value:function(e,t,n,r){return r&&(e=translate_1.Translate.translate(e,r)),n?{interimTranscript:"",finalTranscript:t+e,newText:e}:{interimTranscript:e,finalTranscript:t,newText:e}}}]),e}();azureTranscript.AzureTranscript=AzureTranscript,Object.defineProperty(azure,"__esModule",{value:!0}),azure.Azure=void 0;var preventConnectionStop_1=preventConnectionStop,azureSpeechConfig_1=azureSpeechConfig,stopTimeout_1=stopTimeout,azureTranscript_1=azureTranscript,speech_1=speech,Azure=function(e){_inherits(i,e);var t,n,r=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=r.apply(this,arguments))._newTextPadding="",e}return _createClass(i,[{key:"start",value:function(e,t){this._newTextPadding="",void 0===this.stopTimeout&&stopTimeout_1.StopTimeout.reset(this,null==e?void 0:e.stopAfterSilenceMs),this.prepareBeforeStart(e),this.startAsync(e),t||preventConnectionStop_1.PreventConnectionStop.applyPrevention(this)}},{key:"startAsync",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.validate(t),!e.t0){e.next=6;break}return e.next=4,this.instantiateService(t);case 4:this._translations=null==t?void 0:t.translations,null===(n=this._service)||void 0===n||n.startContinuousRecognitionAsync((function(){}),this.error);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"validate",value:function(e){return i.getAPI()?azureSpeechConfig_1.AzureSpeechConfig.validateOptions(this.error.bind(this),e):(this.moduleNotFound(),!1)}},{key:"instantiateService",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,r,a,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.getAPI(),r=n.AudioConfig.fromDefaultMicrophoneInput(),e.next=4,azureSpeechConfig_1.AzureSpeechConfig.get(n.SpeechConfig,t);case 4:(a=e.sent)?(s=new n.SpeechRecognizer(a,r),this.setEvents(s),this._service=s,t.retrieveToken&&this.retrieveTokenInterval(t.retrieveToken)):this.error("Unable to contact Azure server");case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"setEvents",value:function(e){e.recognizing=this.onRecognizing.bind(this),e.recognized=this.onRecognized.bind(this),e.sessionStarted=this.onSessionStarted.bind(this),e.canceled=this.onCanceled.bind(this),e.sessionStopped=this.onSessionStopped.bind(this)}},{key:"onRecognizing",value:function(e,t){if(!this._stopping){var n=azureTranscript_1.AzureTranscript.extract(this._newTextPadding+t.result.text,this.finalTranscript,!1,this._translations),r=n.interimTranscript,i=n.finalTranscript,a=n.newText;stopTimeout_1.StopTimeout.reset(this,this.stopTimeoutMS),this.updateElements(r,i,a)}}},{key:"onRecognized",value:function(e,t){var n=t.result;switch(n.reason){case window.SpeechSDK.ResultReason.Canceled:break;case window.SpeechSDK.ResultReason.RecognizedSpeech:if(n.text&&!this._stopping){var r=azureTranscript_1.AzureTranscript.extract(this._newTextPadding+n.text,this.finalTranscript,!0,this._translations),i=r.interimTranscript,a=r.finalTranscript,s=r.newText;stopTimeout_1.StopTimeout.reset(this,this.stopTimeoutMS),this.updateElements(i,a,s),""!==a&&(this._newTextPadding=" ")}}}},{key:"onCanceled",value:function(e,t){t.reason===window.SpeechSDK.CancellationReason.Error&&this.error(t.errorDetails)}},{key:"onSessionStarted",value:function(){preventConnectionStop_1.PreventConnectionStop.clearPrevention(this),this.setStateOnStart()}},{key:"onSessionStopped",value:function(){this._retrieveTokenInterval||clearInterval(this._retrieveTokenInterval),this._stopping=!1,this.setStateOnStop()}},{key:"retrieveTokenInterval",value:function(e){var t=this;this._retrieveTokenInterval=setInterval((function(){null==e||e().then((function(e){t._service&&(t._service.authorizationToken=(null==e?void 0:e.trim())||"")})).catch((function(e){t.error(e)}))}),1e4)}},{key:"stop",value:function(e){var t;!e&&this._retrieveTokenInterval&&clearInterval(this._retrieveTokenInterval),this._stopping=!0,null===(t=this._service)||void 0===t||t.stopContinuousRecognitionAsync(),this.finalise(e)}},{key:"moduleNotFound",value:function(){console.error("speech recognition module not found:"),console.error("please install the 'microsoft-cognitiveservices-speech-sdk' npm package or add a script tag: <script src=\"https://aka.ms/csspeech/jsbrowserpackageraw\"><\/script>"),this.setStateOnError("speech recognition module not found")}},{key:"error",value:function(e){this._retrieveTokenInterval&&clearInterval(this._retrieveTokenInterval),console.error(e),this.setStateOnError(e),this.stop()}}],[{key:"getAPI",value:function(){return window.SpeechSDK}}]),i}(speech_1.Speech);azure.Azure=Azure,Object.defineProperty(dist,"__esModule",{value:!0});var webSpeech_1=webSpeech,commandUtils_1=commandUtils,globalState_1=globalState,azure_1=azure,SpeechToElement=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"toggle",value:function(t,n){var r,i,a=t.toLocaleLowerCase().trim();null!==(r=globalState_1.GlobalState.service)&&void 0!==r&&r.recognizing?this.stop():"webspeech"===a?e.startWebSpeech(n):"azure"===a?e.startAzure(n):(console.error("service not found - must be either 'webspeech' or 'azure'"),null===(i=null==n?void 0:n.onError)||void 0===i||i.call(n,"service not found - must be either 'webspeech' or 'azure'"))}},{key:"startWebSpeech",value:function(t){e.stop()||(globalState_1.GlobalState.service=new webSpeech_1.WebSpeech,globalState_1.GlobalState.service.start(t))}},{key:"isWebSpeechSupported",value:function(){return!!webSpeech_1.WebSpeech.getAPI()}},{key:"startAzure",value:function(t){var n;e.stop()||null!==(n=globalState_1.GlobalState.service)&&void 0!==n&&n.cannotBeStopped||(globalState_1.GlobalState.service=new azure_1.Azure,globalState_1.GlobalState.service.start(t))}},{key:"stop",value:function(){var e;return!!globalState_1.GlobalState.doubleClickDetector()||(!(null===(e=globalState_1.GlobalState.service)||void 0===e)&&e.recognizing&&globalState_1.GlobalState.service.stop(),!1)}},{key:"endCommandMode",value:function(){globalState_1.GlobalState.service&&commandUtils_1.CommandUtils.toggleCommandModeOff(globalState_1.GlobalState.service)}}]),e}(),_default=dist.default=SpeechToElement,SpeechToText=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var a,s;_classCallCheck(this,n),a=t.call(this,"object"==_typeof(e.speechToText)?null==(s=e.speechToText)?void 0:s.button:{});var o=n.processConfiguration(r,e.speechToText),l=o.serviceName,c=o.processedConfig;if(a._addErrorMessage=i,"webspeech"!==l||_default.isWebSpeechSupported()){var u=!e.textInput||!e.textInput.disabled;a.elementRef.onclick=a.buttonClick.bind(_assertThisInitialized(a),r,u,l,c)}else a.changeToUnsupported();return a}return _createClass(n,[{key:"buttonClick",value:function(e,t,n,r){e.removeTextIfPlaceholder(),_default.toggle(n,_objectSpread({insertInCursorLocation:!1,element:t?e.inputElementRef:void 0,onError:this.onError.bind(this),onStart:this.changeToActive.bind(this),onStop:this.changeToDefault.bind(this),onCommandModeTrigger:this.onCommandModeTrigger.bind(this)},r))}},{key:"onCommandModeTrigger",value:function(e){e?this.changeToCommandMode():this.changeToActive()}},{key:"onError",value:function(){this._addErrorMessage("speechToText","speech input error")}}],[{key:"processConfiguration",value:function(e,t){var r,i,a,s,o,l="object"==_typeof(t)?t:{},c="object"==_typeof(l.webSpeech)?l.webSpeech:{},u=l.azure||{},d=_objectSpread(_objectSpread({displayInterimResults:null!==(r=l.displayInterimResults)&&void 0!==r?r:void 0,textColor:null!==(i=l.textColor)&&void 0!==i?i:void 0,translations:null!==(a=l.translations)&&void 0!==a?a:void 0,commands:null!==(s=l.commands)&&void 0!==s?s:void 0},c),u),p=null==(o=l.commands)?void 0:o.submit;return p&&(d.onPreResult=function(t){return t.toLowerCase().includes(p)?(setTimeout((function(){var t;return null==(t=e.submit)?void 0:t.call(e)})),_default.endCommandMode(),{restart:!0,removeNewText:!0}):null}),{serviceName:n.getServiceName(l),processedConfig:d}}},{key:"getServiceName",value:function(e){return e.webSpeech?"webspeech":e.azure?"azure":"webspeech"}}]),n}(MicrophoneButton),NewFileName=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getFileName",value:function(e,t){var n=new Date,r=String(n.getHours()).padStart(2,"0"),i=String(n.getMinutes()).padStart(2,"0"),a=String(n.getSeconds()).padStart(2,"0");return"".concat(e,"-").concat(r,"-").concat(i,"-").concat(a,".").concat(t)}}]),e}(),RecordAudio=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i,a,s;return _classCallCheck(this,n),(i=t.call(this,r.button))._waitingForBrowserApproval=!1,i._audioType=e,i._extension=(null==(a=r.files)?void 0:a.format)||"mp3",i._maxDurationSeconds=null==(s=r.files)?void 0:s.maxDurationSeconds,i.elementRef.onclick=i.buttonClick.bind(_assertThisInitialized(i)),i}return _createClass(n,[{key:"buttonClick",value:function(){this._waitingForBrowserApproval||(this.isActive?this.stop():(this._waitingForBrowserApproval=!0,this.record()))}},{key:"stop",value:function(){var e=this;return new Promise((function(t){var n,r;e.changeToDefault(),null==(n=e._mediaRecorder)||n.stop(),null==(r=e._mediaStream)||r.getTracks().forEach((function(e){return e.stop()})),setTimeout((function(){t()}),10)}))}},{key:"record",value:function(){var e=this;navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){e.changeToActive(),e._mediaRecorder=new MediaRecorder(t),e._audioType.addPlaceholderAttachment(e.stop.bind(e),e._maxDurationSeconds),e._mediaStream=t,e._mediaRecorder.addEventListener("dataavailable",(function(t){e.createFile(t)})),e._mediaRecorder.start()})).catch((function(t){console.error(t),e.stop()})).finally((function(){e._waitingForBrowserApproval=!1}))}},{key:"createFile",value:function(e){var t=this,n=new Blob([e.data],{type:"audio/".concat(this._extension)}),r=NewFileName.getFileName(this._newFilePrefix||"audio",this._extension),i=new File([n],r,{type:n.type}),a=new FileReader;a.readAsDataURL(i),a.onload=function(e){t._audioType.completePlaceholderAttachment(i,e.target.result)}}}]),n}(MicrophoneButton),SUBMIT_ICON_STRING='<?xml version="1.0" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.0//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">\n<svg xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="none" stroke-width="1" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">\n  <line x1="22" y1="2" x2="11" y2="14"></line>\n  <polygon points="22 2 15 22 11 14 2 10 22 2"></polygon>\n</svg>\n',SubmitButtonStateStyle=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"resetSubmit",value:function(e,t){t?e.unsetCustomStateStyles(["loading","submit"]):e.unsetCustomStateStyles(["stop","loading","submit"]),e.reapplyStateStyle("submit")}}]),e}(),SubmitButton=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e,t,i,a,s){var o,l;return _classCallCheck(this,r),(o=n.call(this,r.createButtonContainerElement(),null==(l=e.submitButtonStyles)?void 0:l.position,e.submitButtonStyles))._isRequestInProgress=!1,o._isLoadingActive=!1,o._isSVGLoadingIconOverriden=!1,o._messages=i,o._inputElementRef=t,o._fileAttachments=s,o._innerElements=o.createInnerElements(),o._abortStream=new AbortController,o._serviceIO=a,o.attemptOverwriteLoadingStyle(e),o.changeToSubmitIcon(),o.assignHandlers(),o}return _createClass(r,[{key:"createInnerElements",value:function(){var e=CustomButtonInnerElements.create(this.elementRef,["submit","loading","stop"],this._customStyles),t=e.submit,n=e.loading,i=e.stop;return{submit:t||r.createSubmitIconElement(),loading:n||r.createLoadingIconElement(),stop:i||r.createStopIconElement()}}},{key:"attemptOverwriteLoadingStyle",value:function(e){var t,n,r,i,a,s,o,l,c;if(!(null!=(n=null==(t=this._customStyles)?void 0:t.submit)&&n.svg||null!=(a=null==(i=null==(r=this._customStyles)?void 0:r.loading)?void 0:i.svg)&&a.content||null!=(l=null==(o=null==(s=this._customStyles)?void 0:s.loading)?void 0:o.text)&&l.content||void 0!==e.displayLoadingBubble&&!0!==e.displayLoadingBubble)){var u=document.createElement("style");u.textContent="\n        .loading-button > * {\n          filter: brightness(0) saturate(100%) invert(72%) sepia(0%) saturate(3044%) hue-rotate(322deg) brightness(100%)\n            contrast(96%) !important;\n        }",null==(c=e.shadowRoot)||c.appendChild(u),this._isSVGLoadingIconOverriden=!0}}},{key:"assignHandlers",value:function(){this._serviceIO.completionsHandlers={onFinish:this.changeToSubmitIcon.bind(this)},this._serviceIO.streamHandlers={onOpen:this.changeToStopIcon.bind(this),onClose:this.changeToSubmitIcon.bind(this),abortStream:this._abortStream};var e=this._serviceIO.deepChat.stream;"object"==_typeof(e)&&"number"==typeof e.simulation&&(this._serviceIO.streamHandlers.simulationInterim=e.simulation)}},{key:"submitFromInput",value:function(){var e;if(this._inputElementRef.classList.contains("text-input-placeholder"))this.submit(!1,"");else{var t=null==(e=this._inputElementRef.textContent)?void 0:e.trim();this.submit(!1,t)}}},{key:"submit",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r,i,a,s,o,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t,e.t0){e.next=6;break}return e.next=4,this._fileAttachments.completePlaceholders();case 4:a=this._fileAttachments.getAllFileData(),s=null==a?void 0:a.map((function(e){return e.file}));case 6:if(o=""===n?void 0:n,!this._isRequestInProgress){e.next=9;break}return e.abrupt("return");case 9:if(null==(r=this._serviceIO.deepChat)||!r.validateMessageBeforeSending){e.next=14;break}if(this._serviceIO.deepChat.validateMessageBeforeSending(o,s)){e.next=12;break}return e.abrupt("return");case 12:e.next=16;break;case 14:if(this._serviceIO.canSendMessage(o,s)){e.next=16;break}return e.abrupt("return");case 16:if(this.changeToLoadingIcon(),""!==n&&this._messages.addNewMessage({text:n},!1,!0),e.t1=a,!e.t1){e.next=22;break}return e.next=22,this._messages.addMultipleFiles(a);case 22:return this._messages.addLoadingMessage(),t||TextInputEl.clear(this._inputElementRef),l={text:o,files:s},e.next=27,this._serviceIO.callAPI(l,this._messages);case 27:t||null==(i=this._fileAttachments)||i.removeAllFiles();case 28:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"stopStream",value:function(){this._abortStream.abort(),this.changeToSubmitIcon()}},{key:"changeToStopIcon",value:function(){this.elementRef.classList.remove("loading-button"),this.elementRef.replaceChildren(this._innerElements.stop),this.reapplyStateStyle("stop",["loading","submit"]),this.elementRef.onclick=this.stopStream.bind(this),this._isLoadingActive=!1}},{key:"changeToLoadingIcon",value:function(){this._serviceIO.websocket||(this._isSVGLoadingIconOverriden||this.elementRef.replaceChildren(this._innerElements.loading),this.elementRef.classList.add("loading-button"),this.reapplyStateStyle("loading",["submit"]),this.elementRef.onclick=function(){},this._isRequestInProgress=!0,this._isLoadingActive=!0)}},{key:"changeToSubmitIcon",value:function(){this.elementRef.classList.remove("loading-button"),this.elementRef.replaceChildren(this._innerElements.submit),SubmitButtonStateStyle.resetSubmit(this,this._isLoadingActive),this.elementRef.onclick=this.submitFromInput.bind(this),this._isRequestInProgress=!1,this._isLoadingActive=!1}}],[{key:"createButtonContainerElement",value:function(){var e=document.createElement("div");return e.classList.add("input-button"),e}},{key:"createSubmitIconElement",value:function(){var e=SVGIconUtils.createSVGElement(SUBMIT_ICON_STRING);return e.id="submit-icon",e}},{key:"createLoadingIconElement",value:function(){var e=document.createElement("div");return e.classList.add("dots-jumping"),e}},{key:"createStopIconElement",value:function(){var e=document.createElement("div");return e.id="stop-icon",e}}]),r}(InputButton),REFRESH_ICON_STRING='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">\n  <path d="M27.1 14.313V5.396L24.158 8.34c-2.33-2.325-5.033-3.503-8.11-3.503C9.902 4.837 4.901 9.847 4.899 16c.001 6.152 5.003 11.158 11.15 11.16 4.276 0 9.369-2.227 10.836-8.478l.028-.122h-3.23l-.022.068c-1.078 3.242-4.138 5.421-7.613 5.421a8 8 0 0 1-5.691-2.359A7.993 7.993 0 0 1 8 16.001c0-4.438 3.611-8.049 8.05-8.049 2.069 0 3.638.58 5.924 2.573l-3.792 3.789H27.1z"/>\n</svg>\n',CAPTURE_ICON_STRING='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">\n  <title>capture</title>\n  <path d="M0 16q0 3.264 1.28 6.208t3.392 5.12 5.12 3.424 6.208 1.248 6.208-1.248 5.12-3.424 3.392-5.12 1.28-6.208-1.28-6.208-3.392-5.12-5.088-3.392-6.24-1.28q-3.264 0-6.208 1.28t-5.12 3.392-3.392 5.12-1.28 6.208zM4 16q0-3.264 1.6-6.016t4.384-4.352 6.016-1.632 6.016 1.632 4.384 4.352 1.6 6.016-1.6 6.048-4.384 4.352-6.016 1.6-6.016-1.6-4.384-4.352-1.6-6.048z"></path>\n</svg>\n',CLOSE_ICON_STRING='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">\n  <path d="M195.2 195.2a64 64 0 0 1 90.496 0L512 421.504 738.304 195.2a64 64 0 0 1 90.496 90.496L602.496 512 828.8 738.304a64 64 0 0 1-90.496 90.496L512 602.496 285.696 828.8a64 64 0 0 1-90.496-90.496L421.504 512 195.2 285.696a64 64 0 0 1 0-90.496z"/>\n</svg>',TICK_ICON_STRING='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M4.89163 13.2687L9.16582 17.5427L18.7085 8" stroke="#000000" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>',CameraModal=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,a){var s;_classCallCheck(this,n),(s=t.call(this,e,["modal-content","modal-camera-content"],i))._stopped=!1,s._format="image/png",s._canvas=document.createElement("canvas"),s._canvas.classList.add("camera-modal-canvas");var o=s.addButtonsAndTheirEvents(r),l=o.captureButton,c=o.submitButton;return s._captureButton=l,s._submitButton=c,s._captureIcon=s._captureButton.children[0],s._refreshIcon=SVGIconUtils.createSVGElement(REFRESH_ICON_STRING),s._refreshIcon.classList.add("modal-svg-button-icon","modal-svg-refresh-icon"),"jpeg"===(null==a?void 0:a.format)&&(s._format="image/jpeg"),null!=a&&a.dimensions&&(s._dimensions=a.dimensions),s._contentRef.appendChild(s._canvas),s.extensionCloseCallback=s.stop,s}return _createClass(n,[{key:"addButtonsAndTheirEvents",value:function(e){var t=Modal.createSVGButton(CAPTURE_ICON_STRING);t.classList.add("modal-svg-camera-button"),t.children[0].classList.add("modal-svg-camera-icon");var n=this.addCloseButton(CLOSE_ICON_STRING,!0);n.classList.add("modal-svg-close-button"),n.children[0].classList.add("modal-svg-close-icon");var r=Modal.createSVGButton(TICK_ICON_STRING);return r.classList.add("modal-svg-submit-button"),this.addButtons(t,r),this.addButtonEvents(t,n,r,e),{captureButton:t,submitButton:r}}},{key:"addButtonEvents",value:function(e,t,n,r){var i=this;e.onclick=function(){i.capture()},t.addEventListener("click",this.stop.bind(this)),n.onclick=function(){var e=i.getFile();e&&FileAttachments.addFilesToType([e],[r]),i.stop(),i.close()}}},{key:"stop",value:function(){var e=this;this._mediaStream&&this._mediaStream.getTracks().forEach((function(e){return e.stop()})),this._stopped=!0,setTimeout((function(){e._captureButton.replaceChildren(e._captureIcon),e._captureButton.classList.replace("modal-svg-refresh-button","modal-svg-camera-button");var t=e._canvas.getContext("2d");null==t||t.clearRect(0,0,e._canvas.width,e._canvas.height)}),Modal.MODAL_CLOSE_TIMEOUT_MS)}},{key:"start",value:function(){var e=this;this._dataURL=void 0,this._submitButton.classList.add("modal-svg-submit-disabled"),this._stopped=!1,navigator.mediaDevices.getUserMedia({video:this._dimensions||!0}).then((function(t){if(e._mediaStream=t,!e.isOpen())return e.stop();var n=document.createElement("video");n.srcObject=t,n.play(),requestAnimationFrame(e.updateCanvas.bind(e,n,e._canvas))})).catch((function(t){console.error(t),e.stop(),e.close()}))}},{key:"capture",value:function(){this._dataURL?(this._captureButton.replaceChildren(this._captureIcon),this._captureButton.classList.replace("modal-svg-refresh-button","modal-svg-camera-button"),this._submitButton.classList.add("modal-svg-submit-disabled"),this._dataURL=void 0):(this._captureButton.replaceChildren(this._refreshIcon),this._captureButton.classList.replace("modal-svg-camera-button","modal-svg-refresh-button"),this._submitButton.classList.remove("modal-svg-submit-disabled"),this._dataURL=this._canvas.toDataURL())}},{key:"getFile",value:function(){if(this._dataURL){for(var e=atob(this._dataURL.split(",")[1]),t=new Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);var r=new Uint8Array(t),i=new Blob([r],{type:this._format}),a="image/jpeg"===this._format?"jpeg":"png",s=NewFileName.getFileName(this._newFilePrefix||"photo",a);return new File([i],s,{type:i.type})}}},{key:"updateCanvas",value:function(e,t){if(!this._stopped){if(!this._dataURL){t.width=e.videoWidth,t.height=e.videoHeight;var n=t.getContext("2d");null==n||n.drawImage(e,0,0,t.width,t.height)}requestAnimationFrame(this.updateCanvas.bind(this,e,t))}}},{key:"openCameraModal",value:function(e){this.displayModalElements(),e.start()}}],[{key:"createCameraModalFunc",value:function(e,t,r,i){var a=new n(e,t,r,i);return a.openCameraModal.bind(a,a)}}]),n}(Modal),CAMERA_ICON_STRING='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">\n  <path d="M29 7h-4.599l-2.401-4h-12l-2.4 4h-4.6c-1 0-3 1-3 2.969v16.031c0 1.657 1.5 3 2.792 3h26.271c1.313 0 2.938-1.406 2.938-2.968v-16.032c0-1-1-3-3-3zM30 26.032c0 0.395-0.639 0.947-0.937 0.969h-26.265c-0.232-0.019-0.797-0.47-0.797-1v-16.031c0-0.634 0.851-0.953 1-0.969h5.732l2.4-4h9.802l1.785 3.030 0.55 0.97h5.731c0.705 0 0.99 0.921 1 1v16.032zM16 10c-3.866 0-7 3.134-7 7s3.134 7 7 7 7-3.134 7-7-3.134-7-7-7zM16 22c-2.757 0-5-2.243-5-5s2.243-5 5-5 5 2.243 5 5-2.243 5-5 5z"></path>\n</svg>',CameraButton=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var a,s;_classCallCheck(this,n);var o=(a=t.call(this,n.createButtonElement(),null==(s=null==i?void 0:i.button)?void 0:s.position,(null==i?void 0:i.button)||{},"Photo")).createInnerElements(a._customStyles);return i&&a.addClickEvent(e,r,i.modalContainerStyle,i.files),a.elementRef.classList.add("upload-file-button"),a.elementRef.appendChild(o.styles),a.reapplyStateStyle("styles"),a}return _createClass(n,[{key:"createInnerElements",value:function(e){return{styles:this.createInnerElement(n.createSVGIconElement(),"styles",e)}}},{key:"createInnerElement",value:function(e,t,n){return CustomButtonInnerElements.createSpecificStateElement(this.elementRef,t,n)||e}},{key:"addClickEvent",value:function(e,t,n,r){var i=CameraModal.createCameraModalFunc(e,t,n,r);this.elementRef.onclick=i}}],[{key:"createButtonElement",value:function(){var e=document.createElement("div");return e.classList.add("input-button"),e}},{key:"createSVGIconElement",value:function(){var e=SVGIconUtils.createSVGElement(CAMERA_ICON_STRING);return e.id="camera-icon",e}}]),n}(InputButton),Input=function(){function e(t,n,r,i){_classCallCheck(this,e),this.elementRef=e.createPanelElement(t.inputAreaStyle);var a=new TextInputEl(r,t.textInput),s={},o=this.createFileUploadComponents(t,r,i,s);t.speechToText&&!s.microphone&&(s.microphone={button:new SpeechToText(t,a,n.addNewErrorMessage.bind(n))});var l=new SubmitButton(t,a.inputElementRef,n,r,o);a.submit=l.submitFromInput.bind(l),t.submitUserMessage=l.submit.bind(l,!0),s.submit={button:l},e.addElements(this.elementRef,a,s,i,o,t.dropupStyles)}return _createClass(e,[{key:"createFileUploadComponents",value:function(t,n,r,i){var a,s,o,l,c=new FileAttachments(this.elementRef,t.attachmentContainerStyle,n.demo);if(e.createUploadButtons(n.fileTypes||{},c,r,i),null!=(a=n.camera)&&a.files){var u=(null==(s=i.images)?void 0:s.fileType)||c.addType(n.camera.files,"images");i.camera={button:new CameraButton(r,u,n.camera)}}if(null!=(o=n.recordAudio)&&o.files){var d=(null==(l=i.audio)?void 0:l.fileType)||c.addType(n.recordAudio.files,"audio");i.microphone={button:new RecordAudio(d,n.recordAudio)}}return DragAndDrop.isEnabled(c,t.dragAndDrop)&&DragAndDrop.create(r,c,t.dragAndDrop),c}}],[{key:"createPanelElement",value:function(e){var t=document.createElement("div");return t.id="input",Object.assign(t.style,e),t}},{key:"createUploadButtons",value:function(e,t,n,r){Object.keys(e).forEach((function(i){var a=i,s=e[a];if(s.files){var o=t.addType(s.files,a),l=FILE_TYPE_BUTTON_ICONS[a],c=l.id,u=l.svgString,d=l.dropupText,p=new UploadFileButton(n,o,s,c,u,d);r[a]={button:p,fileType:o}}}))}},{key:"addElements",value:function(e,t,n,r,i,a){ElementUtils.addElements(e,t.elementRef);var s=ButtonContainers.create(),o=InputButtonPositions.addButtons(s,n,r,a);InputButtonStyleAdjustments.set(t.inputElementRef,s,i.elementRef,o),ButtonContainers.add(e,s)}}]),e}(),ChatView=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"createElements",value:function(e,t,n){var r=document.createElement("div");r.id="chat-view";var i=new Messages(e,t,n);t.websocket&&Websocket.assignListeners(t,i);var a=new Input(e,i,t,r);return ElementUtils.addElements(r,i.elementRef,a.elementRef),r}},{key:"render",value:function(t,n,r,i){var a=e.createElements(t,r,i);n.replaceChildren(a)}}]),e}(),style='#validate-property-key-view{height:100%;position:relative;display:flex;justify-content:center;align-items:center;padding:8px}#large-loading-ring{display:inline-block;width:50px;height:50px}#large-loading-ring:after{content:" ";display:block;width:38px;height:38px;margin:1px;border-radius:50%;border:5px solid #5fb2ff;border-color:#5fb2ff transparent #5fb2ff transparent;animation:large-loading-ring 1.4s linear infinite}@keyframes large-loading-ring{0%{transform:rotate(0)}to{transform:rotate(360deg)}}#insert-key-view{height:100%;position:relative}#insert-key-contents{text-align:center;position:absolute;top:44%;left:50%;transform:translate(-50%,-50%);width:82%;display:flex;max-width:700px}#insert-key-title{margin-bottom:15px}#insert-key-input-container{margin-right:2.7em;width:calc(100% - 80px)}#insert-key-input{padding:.3em 1.7em .3em .3em;border-width:1px;border-style:solid;border-radius:3px;width:100%;font-size:inherit}.insert-key-input-valid{border-color:gray}.insert-key-input-invalid{border-color:red}#visibility-icon-container{position:relative;float:right;cursor:pointer;-webkit-user-select:none;user-select:none}.visibility-icon{filter:brightness(0) saturate(100%) invert(63%) sepia(1%) saturate(9%) hue-rotate(43deg) brightness(98%) contrast(92%);position:absolute;right:-1.7em;top:-1.43em}#visible-icon{top:-1.4em}.visibility-icon:hover{filter:unset}.visibility-icon>*{pointer-events:none}#start-button{border:1px solid grey;color:#454545;border-radius:4px;width:3em;display:flex;justify-content:center;align-items:center;cursor:pointer;padding:.28em .3em;-webkit-user-select:none;user-select:none;background-color:#fff}#start-button:hover{background-color:#f2f2f2}#start-button:active{background-color:#d2d2d2}#insert-key-help-text-container{width:100%;position:absolute;margin-top:32px;margin-bottom:20px}#insert-key-help-text-contents{width:100%;position:absolute}#insert-key-input-invalid-text{display:block;margin-top:1em;margin-bottom:.5em;color:red}.insert-key-input-help-text{display:block;margin-top:16px}#loading-ring{display:inline-block;width:16px;height:16px}#loading-ring:after{content:" ";display:block;width:11px;height:11px;margin:1px;border-radius:50%;border:2px solid #0084ff;border-color:#0084ff transparent #0084ff transparent;animation:loading-ring 1.2s linear infinite}@keyframes loading-ring{0%{transform:rotate(0)}to{transform:rotate(360deg)}}#error-view{color:red;font-size:1.2em;line-height:1.3em;margin-top:-5px;text-align:center;height:100%;display:flex;justify-content:center;align-items:center;padding-left:8px;padding-right:8px}.intro-panel{position:absolute;display:flex;justify-content:center;right:0;bottom:0;left:0;margin:auto;height:fit-content;top:-2.5em}#internal-intro-panel{width:250px;height:min-content;display:block;border-radius:5px;overflow:auto;border:1px solid rgb(203,203,203);padding:10px;max-height:calc(100% - 6.8em)}#internal-intro-panel>p{margin-block-start:.8em;margin-block-end:.8em}pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}/*!\n  Theme: a11y-dark\n  Author: @ericwbailey\n  Maintainer: @ericwbailey\n\n  Based on the Tomorrow Night Eighties theme: https://github.com/isagalaev/highlight.js/blob/master/src/styles/tomorrow-night-eighties.css\n*/.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast: active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}#messages{overflow:auto}.outer-message-container:last-child{margin-bottom:5px}.inner-message-container{display:flex;width:90%;margin-left:auto;margin-right:auto;max-width:100%}.message-bubble{margin-top:10px;word-wrap:break-word;width:fit-content;max-width:60%;border-radius:10px;padding:.42em .55em;height:fit-content}.user-message-text{color:#fff;background-color:#0084ff;margin-right:0;margin-left:auto}.ai-message-text{color:#000;background-color:#e4e6eb;margin-left:0;margin-right:auto}.error-message-text{margin:14px auto 10px;background-color:#f4c0c0;color:#474747;text-align:center;max-width:95%}.loading-message-text{width:1em;padding:.6em .75em .6em 1.3em}.message-bubble>p{line-height:1.26em}.message-bubble>p:first-child{margin-top:0}.message-bubble>p:last-child{margin-bottom:0}pre{overflow:auto;display:block;word-break:break-all;word-wrap:break-word;border-radius:7px;background:#2b2b2b;color:#f8f8f2;margin-top:.8em;margin-bottom:.8em;padding:.6em;font-size:.9em;line-height:1.5em}.image-message{padding:0;display:flex;background-color:#ddd}.image-message>*,.image-message>*>*{width:100%;border-radius:8px;display:flex}.audio-message{width:60%;max-width:300px;height:2.2em;max-height:54px;padding:0;background-color:unset}.audio-player{width:100%;height:100%}.audio-player-safari{height:fit-content;width:40px}.audio-player-safari-left{float:left}.audio-player-safari-right{float:right}.any-file-message-bubble{padding:1px}.any-file-message-contents{display:flex}.any-file-message-icon-container{width:1.3em;min-width:1.3em;position:relative;border-radius:4px;margin-left:6px;margin-right:2px}.any-file-message-icon{background-color:#fff;border-radius:4px;position:absolute;width:1em;height:1.25em;padding:1px;margin-top:auto;margin-bottom:auto;top:0;bottom:0}.any-file-message-text{padding-top:5px;overflow-wrap:anywhere;padding-bottom:5px;padding-right:7px}.message-bubble>a{color:inherit}.left-item-position{margin-right:10px}.right-item-position{margin-left:10px}.avatar{padding-top:5px;width:1.5em;height:1.5em;border-radius:1px}.avatar-container{margin-top:9px}.name{margin-top:16px;font-size:15px}#drag-and-drop{position:absolute;display:none;z-index:10;height:calc(100% - 10px);width:calc(100% - 10px);background-color:#70c6ff4d;border:5px dashed #6dafff}#file-attachment-container{position:absolute;height:3.6em;width:calc(80% - 4px);top:-2.5em;border-radius:5px;overflow:auto;text-align:left;background-color:#d7d7d73b;padding-left:4px}.file-attachment{width:2.85em;height:2.85em;display:inline-flex;margin-right:.6em;margin-bottom:.44em;margin-top:4px;position:relative;background-color:#fff;border-radius:5px}.image-attachment{width:100%;height:100%;object-fit:cover;border-radius:5px}.border-bound-attachment{width:calc(100% - 2px);height:calc(100% - 2px);border:1px solid #c3c3c3;border-radius:5px;overflow:hidden}.border-bound-attachment-safari{width:calc(100% - 1px);height:calc(100% - 1px)}.audio-attachment-icon-container{cursor:pointer}.audio-attachment-icon-container:hover{background-color:#f8f8f8}.attachment-icon{left:0;right:0;bottom:0;top:2px;margin:auto;position:absolute;width:25px;-webkit-user-select:none;user-select:none}.not-removable-attachment-icon{top:0;right:0;bottom:0;left:0}.play-icon{filter:brightness(0) saturate(100%) invert(17%) sepia(0%) saturate(1392%) hue-rotate(67deg) brightness(98%) contrast(97%)}.stop-icon{filter:brightness(0) saturate(100%) invert(29%) sepia(90%) saturate(1228%) hue-rotate(198deg) brightness(93%) contrast(98%)}.audio-placeholder-text-3-digits{padding-left:.26rem}.audio-placeholder-text-4-digits{padding-left:.1rem}.any-file-attachment{padding:2px 0}.file-attachment-text-container{position:absolute;width:inherit;display:flex;align-items:center;height:100%;top:-1px}.audio-placeholder-text-3-digits-container{padding-top:1px;cursor:default}.any-file-attachment-text{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;padding-left:.13em;margin-left:auto;margin-right:auto}.remove-file-attachment-button{height:1.25em;width:1.25em;border:1px solid #cfcfcf;border-radius:25px;background-color:#fff;top:-4px;right:-5px;position:absolute;display:flex;justify-content:center;cursor:pointer;-webkit-user-select:none;user-select:none}.remove-file-attachment-button:hover{background-color:#e4e4e4}.remove-file-attachment-button:active{background-color:#d7d7d7}.x-icon{color:#4e4e4e;top:-.075em;position:relative;font-size:1.05em}.modal{display:none;flex-direction:column;align-items:center;justify-content:center;position:absolute;width:80%;max-width:420px;max-height:80%;margin:auto;top:0;right:0;bottom:0;left:0;z-index:2}.modal-content{border-top:1px solid rgb(217,217,217);border-left:1px solid rgb(217,217,217);border-right:1px solid rgb(217,217,217);border-top-left-radius:inherit;border-top-right-radius:inherit;background-color:#fff;overflow-y:auto;height:fit-content;max-height:calc(100% - 3.3em);width:100%}.modal-content>p{margin-left:1em;margin-right:1em}.modal-content>ul{margin-right:1em}.modal-button-panel{height:3.3em;border:1px solid;border-color:rgb(223,223,223) rgb(217,217,217) rgb(217,217,217);border-bottom-left-radius:inherit;border-bottom-right-radius:inherit;background-color:#fff;text-align:center;justify-content:center;display:flex;width:100%}.modal-button{min-width:2.5em;text-align:center;color:#fff;border-radius:5px;padding:.4em .4em .3em;height:1.25em;background-color:#3279b2;top:0;bottom:0;cursor:pointer;-webkit-user-select:none;user-select:none;margin:auto .31em}.modal-button:hover{background-color:#276da7}.modal-button:active{background-color:#1b5687}.modal-svg-button{padding:0 0 2px;width:2em;height:1.8em}.modal-svg-button-icon{width:100%;height:100%;filter:brightness(0) saturate(100%) invert(100%) sepia(15%) saturate(4%) hue-rotate(346deg) brightness(101%) contrast(102%)}#modal-background-panel{position:absolute;width:100%;height:100%;background-color:#00000042;z-index:1;display:none}.show-modal-background{animation:fadeInBackground .3s ease-in-out}@keyframes fadeInBackground{0%{opacity:0}to{opacity:1}}.show-modal{animation:fadeInModal .3s ease-in-out}@keyframes fadeInModal{0%{opacity:0;scale:.95}to{opacity:1;scale:1}}.hide-modal-background{animation:fadeOutBackground .2s ease-in-out}@keyframes fadeOutBackground{0%{opacity:1}to{opacity:0}}.hide-modal{animation:fadeOutModal .2s ease-in-out}@keyframes fadeOutModal{0%{opacity:1;scale:1}to{opacity:0;scale:.95}}.modal-camera-content{overflow:hidden;text-align:center;border:unset;height:100%;background-color:#2a2a2a;display:flex;justify-content:center}.camera-modal-canvas{max-width:100%;max-height:100%;margin-top:auto;margin-bottom:auto}.modal-svg-submit-button{background-color:green}.modal-svg-submit-button:hover{background-color:#007500}.modal-svg-submit-button:active{background-color:#006500}.modal-svg-submit-disabled{pointer-events:none;background-color:#747474}.modal-svg-close-button{height:1.56em;padding-top:.37em;padding-bottom:0;background-color:#c13e3e}.modal-svg-close-button:hover{background-color:#b43434}.modal-svg-close-button:active{background-color:#972929}.modal-svg-close-icon{width:80%;height:80%}.modal-svg-camera-button{height:1.6em;padding-top:.38em;padding-bottom:0}.modal-svg-camera-icon{height:76%}.modal-svg-refresh-icon{height:105%}.modal-svg-refresh-button{height:1.66em;padding-top:.11em;padding-bottom:.21em}.input-button-container{position:relative;z-index:1}.inside-right{position:absolute;right:calc(10% + .35em);bottom:.85em}.inside-left{position:absolute;left:calc(10% + .35em);bottom:.85em}.outside-left{position:absolute;right:calc(11px - .55em);bottom:.88em}.outside-right{position:absolute;left:calc(11px - .55em);bottom:.88em}#upload-images-icon{position:absolute;pointer-events:none;width:1.45em;height:1.45em;left:.11em;bottom:.08em;filter:brightness(0) saturate(100%) invert(43%) sepia(0%) saturate(740%) hue-rotate(77deg) brightness(99%) contrast(92%)}#upload-gifs-icon{position:absolute;pointer-events:none;width:1.5em;height:1.48em;left:.07em;bottom:.08em;filter:brightness(0) saturate(100%) invert(49%) sepia(0%) saturate(2586%) hue-rotate(12deg) brightness(93%) contrast(90%)}#upload-audio-icon{position:absolute;pointer-events:none;width:1.21em;height:1.21em;left:.17em;bottom:.2em;filter:brightness(0) saturate(100%) invert(15%) sepia(0%) saturate(337%) hue-rotate(125deg) brightness(91%) contrast(94%);transform:scaleX(.95)}#camera-icon{position:absolute;pointer-events:none;width:1.21em;height:1.21em;left:.23em;bottom:.2em;filter:brightness(0) saturate(100%) invert(52%) sepia(0%) saturate(161%) hue-rotate(164deg) brightness(91%) contrast(92%);transform:scaleX(.95)}#upload-mixed-files-icon{position:absolute;pointer-events:none;width:1.21em;height:1.21em;left:.25em;bottom:.2em;filter:brightness(0) saturate(100%) invert(53%) sepia(0%) saturate(36%) hue-rotate(74deg) brightness(98%) contrast(93%);transform:scaleX(.95)}#interim-text{color:gray}#microphone-button{padding-top:.5px}.outer-button-container>#microphone-button{padding-bottom:1px}#microphone-icon{position:absolute;pointer-events:none;width:1.21em;height:1.21em;left:.25em;bottom:.25em}.default-microphone-icon{filter:brightness(0) saturate(100%) invert(32%) sepia(0%) saturate(924%) hue-rotate(46deg) brightness(95%) contrast(99%)}.active-microphone-icon{filter:brightness(0) saturate(100%) invert(10%) sepia(97%) saturate(7495%) hue-rotate(0deg) brightness(101%) contrast(107%);border-radius:10px}.command-microphone-icon{filter:brightness(0) saturate(100%) invert(42%) sepia(96%) saturate(1067%) hue-rotate(77deg) brightness(99%) contrast(102%)}.unsupported-microphone{display:none}#submit-icon{height:100%;filter:brightness(0) saturate(100%) invert(32%) sepia(0%) saturate(924%) hue-rotate(46deg) brightness(95%) contrast(99%);width:1.21em}#stop-icon{background-color:#acacac;position:absolute;width:.95em;height:.95em;left:.35em;bottom:.35em;border-radius:2px}.submit-button-enlarged{scale:1.1;margin-right:.3em;margin-left:.3em}.dots-jumping{position:relative;left:calc(-9990px + .275em);width:.22em;height:.22em;border-radius:5px;background-color:#848484;color:#848484;box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484;animation:dots-jumping 1.5s infinite linear;bottom:-.7em}@keyframes dots-jumping{0%{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}16.667%{box-shadow:9990px -6px #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}33.333%{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}50%{box-shadow:9990px 0 #848484,calc(9990px + .44em) -6px 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}66.667%{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}83.333%{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) -6px 0 0 #848484}to{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}}.dots-flashing{position:relative;width:.45em;height:.45em;border-radius:5px;background-color:var(--message-dots-color);color:var(--message-dots-color);animation:dots-flashing 1s infinite linear alternate;animation-delay:.5s}.dots-flashing:before,.dots-flashing:after{content:"";display:inline-block;position:absolute;top:0}.dots-flashing:before{left:-.7em;width:.45em;height:.45em;border-radius:5px;background-color:var(--message-dots-color);color:var(--message-dots-color);animation:dots-flashing 1s infinite alternate;animation-delay:0s}.dots-flashing:after{left:.7em;width:.45em;height:.45em;border-radius:5px;background-color:var(--message-dots-color);color:var(--message-dots-color);animation:dots-flashing 1s infinite alternate;animation-delay:1s}@keyframes dots-flashing{0%{background-color:var(--message-dots-color)}50%,to{background-color:var(--message-dots-color-fade)}}.input-button{border-radius:4px;cursor:pointer;margin-bottom:.2em;-webkit-user-select:none;user-select:none}.input-button-svg{width:1.65em;height:1.65em}.input-button:hover{background-color:#9c9c9c2e}.input-button:active{background-color:#9c9c9c5e}.loading-button{background-color:#fff;cursor:auto}.loading-button:hover,.loading-button:active{background-color:#fff}.text-button{filter:unset!important;display:flex;justify-content:center;align-items:center;margin-left:4px;margin-right:4px;height:1.6em}#text-input-container{background-color:#fff;width:80%;display:flex;border:1px solid #0000001a;border-radius:5px;margin-top:.8em;margin-bottom:.8em;box-shadow:#959da533 0 1px 12px;overflow-y:auto;max-height:200px;position:relative}.text-input-container-left-adjustment{margin-left:1.5em}.text-input-container-right-adjustment{margin-right:1.5em}.text-input-container-left-small-adjustment{margin-left:1.1em}.text-input-container-left-small-adjustment>.outside-left{right:calc(14px - .55em)}.text-input-container-right-small-adjustment{margin-right:1.1em}.text-input-container-right-small-adjustment>.outside-right{left:calc(14px - .55em)}#text-input{text-align:left;outline:none;word-wrap:break-word;line-break:auto}.text-input-styling{padding:.4em .5em;overflow:overlay;width:100%}.text-input-inner-left-adjustment{padding-left:2.2em}.text-input-inner-right-adjustment{padding-right:2em}.text-input-disabled{pointer-events:none;-webkit-user-select:none;user-select:none}.text-input-placeholder{color:gray}.outside-right>#dropup-menu,.inside-right>#dropup-menu{right:0}#dropup-icon{position:absolute;pointer-events:none;width:1.16em;height:1.2em;left:.265em;bottom:.43em;filter:brightness(0) saturate(100%) invert(54%) sepia(0%) saturate(724%) hue-rotate(6deg) brightness(92%) contrast(90%)}#dropup-menu{background-color:#fff;position:absolute;transform:translateY(-100%);border-radius:5px;z-index:1;top:-.49em;box-shadow:#0003 -1px 2px 10px,#0000001a 0 2px 4px;cursor:pointer;-webkit-user-select:none;user-select:none}.dropup-menu-item{height:1.4em;padding:.28em .84em .28em .35em;display:flex;position:relative}.dropup-menu-item>*{pointer-events:none}.dropup-menu-item:first-child{padding-top:.49em;border-top-left-radius:inherit;border-top-right-radius:inherit}.dropup-menu-item:last-child{padding-bottom:.45em;border-bottom-left-radius:inherit;border-bottom-right-radius:inherit}.dropup-menu-item-icon{width:1.39em;position:relative;margin-right:.56em}.dropup-menu-item-icon>svg{bottom:0!important;top:0!important;margin-bottom:auto;margin-top:auto}.dropup-menu-item-text{margin-top:.08em;width:max-content}#input{width:100%;display:inline-flex;text-align:center;margin-left:auto;margin-right:auto;margin-top:auto;position:relative;justify-content:center}#chat-view{height:100%;display:grid;grid-template-columns:100%}::-webkit-scrollbar{width:9px;height:9px}::-webkit-scrollbar-thumb{background-color:#d0d0d0;border-radius:5px}::-webkit-scrollbar-track{background-color:#f2f2f2}:host{all:initial;display:table-cell}#container{height:350px;width:320px;border:1px solid #cacaca;font-family:Inter,sans-serif,Avenir,Helvetica,Arial;font-size:.9rem;background-color:#fff;position:relative;overflow:hidden}\n',__defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__decorateClass=function(e,t,n,r){for(var i,a=r>1?void 0:r?__getOwnPropDesc(t,n):t,s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&__defProp(t,n,a),a},DeepChat=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this)).getMessages=function(){return[]},e.submitUserMessage=function(){return console.warn("submitUserMessage failed - please wait for chat view to render before calling this property.")},e.focusInput=function(){FocusUtils.focusFromParentElement(e._elementRef)},e.refreshMessages=function(){},e.clearMessages=function(){},e.onNewMessage=function(){},e.onMessagesCleared=function(){},e.onComponentRender=function(){},e._hasBeenRendered=!1,e._auxiliaryStyleApplied=!1,GoogleFont.appendStyleSheetToHead(),e._elementRef=document.createElement("div"),e._elementRef.id="container",e.attachShadow({mode:"open"}).appendChild(e._elementRef),WebComponentStyleUtils.apply(style,e.shadowRoot),setTimeout((function(){e._hasBeenRendered||e.onRender()}),20),e}return _createClass(n,[{key:"changeToChatView",value:function(){this._activeService&&(this._activeService.validateConfigKey=!1),this.onRender()}},{key:"onRender",value:function(){var e,t,n,r,i;null!==(e=this._activeService)&&void 0!==e||(this._activeService=ServiceIOFactory.create(this)),this._activeService&&(this.auxiliaryStyle&&!this._auxiliaryStyleApplied&&(WebComponentStyleUtils.apply(this.auxiliaryStyle,this.shadowRoot),this._auxiliaryStyleApplied=!0),Object.assign(this._elementRef.style,this.containerStyle),this._activeService.key&&this._activeService.validateConfigKey?ValidateKeyPropertyView.render(this._elementRef,this.changeToChatView.bind(this),this._activeService):this._activeService instanceof DirectServiceIO&&this._activeService.key||null!=(n=this.request)&&n.url||null!=(r=this.request)&&r.handler||null!=(i=this.directConnection)&&i.demo?(null!==(t=this._childElement)&&void 0!==t||(this._childElement=this.children[0]),ChatView.render(this,this._elementRef,this._activeService,this._childElement)):this._activeService instanceof DirectServiceIO?InsertKeyView.render(this._elementRef,this.changeToChatView.bind(this),this._activeService):ErrorView.render(this._elementRef,'Please define "request" with a "url"'),this._hasBeenRendered=!0,FireEvents.onRender(this))}}]),n}(InternalHTML);__decorateClass([Property("object")],DeepChat.prototype,"directConnection",2),__decorateClass([Property("object")],DeepChat.prototype,"request",2),__decorateClass([Property("object")],DeepChat.prototype,"stream",2),__decorateClass([Property("object")],DeepChat.prototype,"requestBodyLimits",2),__decorateClass([Property("function")],DeepChat.prototype,"requestInterceptor",2),__decorateClass([Property("function")],DeepChat.prototype,"responseInterceptor",2),__decorateClass([Property("function")],DeepChat.prototype,"validateMessageBeforeSending",2),__decorateClass([Property("object")],DeepChat.prototype,"containerStyle",2),__decorateClass([Property("object")],DeepChat.prototype,"attachmentContainerStyle",2),__decorateClass([Property("object")],DeepChat.prototype,"dropupStyles",2),__decorateClass([Property("object")],DeepChat.prototype,"inputAreaStyle",2),__decorateClass([Property("object")],DeepChat.prototype,"textInput",2),__decorateClass([Property("object")],DeepChat.prototype,"submitButtonStyles",2),__decorateClass([Property("string")],DeepChat.prototype,"auxiliaryStyle",2),__decorateClass([Property("array")],DeepChat.prototype,"initialMessages",2),__decorateClass([Property("string")],DeepChat.prototype,"introMessage",2),__decorateClass([Property("object")],DeepChat.prototype,"avatars",2),__decorateClass([Property("object")],DeepChat.prototype,"names",2),__decorateClass([Property("boolean")],DeepChat.prototype,"displayLoadingBubble",2),__decorateClass([Property("object")],DeepChat.prototype,"errorMessages",2),__decorateClass([Property("object")],DeepChat.prototype,"messageStyles",2),__decorateClass([Property("object")],DeepChat.prototype,"textToSpeech",2),__decorateClass([Property("object")],DeepChat.prototype,"speechToText",2),__decorateClass([Property("object")],DeepChat.prototype,"images",2),__decorateClass([Property("object")],DeepChat.prototype,"gifs",2),__decorateClass([Property("object")],DeepChat.prototype,"camera",2),__decorateClass([Property("object")],DeepChat.prototype,"audio",2),__decorateClass([Property("object")],DeepChat.prototype,"microphone",2),__decorateClass([Property("object")],DeepChat.prototype,"mixedFiles",2),__decorateClass([Property("object")],DeepChat.prototype,"dragAndDrop",2),__decorateClass([Property("object")],DeepChat.prototype,"introPanelStyle",2),__decorateClass([Property("function")],DeepChat.prototype,"onNewMessage",2),__decorateClass([Property("function")],DeepChat.prototype,"onMessagesCleared",2),__decorateClass([Property("function")],DeepChat.prototype,"onComponentRender",2),customElements.define("deep-chat",DeepChat)}}]);