/*! For license information please see common.9330af7a.js.LICENSE.txt */
"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8592],{3905:(e,t,s)=>{s.d(t,{Zo:()=>d,kt:()=>m});var n=s(7294);function i(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function r(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function o(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?r(Object(s),!0).forEach((function(t){i(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):r(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function a(e,t){if(null==e)return{};var s,n,i=function(e,t){if(null==e)return{};var s,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)s=r[n],t.indexOf(s)>=0||(i[s]=e[s]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)s=r[n],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(i[s]=e[s])}return i}var l=n.createContext({}),c=function(e){var t=n.useContext(l),s=t;return e&&(s="function"==typeof e?e(t):o(o({},t),e)),s},d=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var s=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,d=a(e,["components","mdxType","originalType","parentName"]),u=c(s),h=i,m=u["".concat(l,".").concat(h)]||u[h]||p[h]||r;return s?n.createElement(m,o(o({ref:t},d),{},{components:s})):n.createElement(m,o({ref:t},d))}));function m(e,t){var s=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=s.length,o=new Array(r);o[0]=h;var a={};for(var l in t)hasOwnProperty.call(t,l)&&(a[l]=t[l]);a.originalType=e,a[u]="string"==typeof e?e:i,o[1]=a;for(var c=2;c<r;c++)o[c]=s[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,s)}h.displayName="MDXCreateElement"},1262:(e,t,s)=>{s.d(t,{Z:()=>r});var n=s(7294),i=s(2389);function r(e){let{children:t,fallback:s}=e;return(0,i.Z)()?n.createElement(n.Fragment,null,t?.()):s??null}},4602:(e,t,s)=>{s.d(t,{Z:()=>r});var n=s(1262),i=s(7294);function r(e){return i.createElement(n.Z,null,(()=>{const t=s(4925).DeepChat;return i.createElement(t,e,e.children)}))}},4925:(e,t,s)=>{s.r(t),s.d(t,{DeepChat:()=>c});var n=s(7694);const i=new Set(["children","localName","ref","style","className"]),r=new WeakMap,o=(e,t,s,n,i)=>{const o=null==i?void 0:i[t];void 0===o||s===n?null==s&&t in HTMLElement.prototype?e.removeAttribute(t):e[t]=s:((e,t,s)=>{let n=r.get(e);void 0===n&&r.set(e,n=new Map);let i=n.get(t);void 0!==s?void 0===i?(n.set(t,i={handleEvent:s}),e.addEventListener(t,i)):i.handleEvent=s:void 0!==i&&(n.delete(t),e.removeEventListener(t,i))})(e,o,s)};var a=s(7294),l=s.t(a,2);const c=function(e=window.React,t,s,n,r){let a,l,c;if(void 0===t){const t=e;({tagName:l,elementClass:c,events:n,displayName:r}=t),a=t.react}else a=e,c=s,l=t;const d=a.Component,u=a.createElement,p=new Set(Object.keys(null!=n?n:{}));class h extends d{constructor(){super(...arguments),this.o=null}t(e){if(null!==this.o)for(const t in this.i)o(this.o,t,this.props[t],e?e[t]:void 0,n)}componentDidMount(){var e;this.t(),null===(e=this.o)||void 0===e||e.removeAttribute("defer-hydration")}componentDidUpdate(e){this.t(e)}render(){const{_$Gl:e,...t}=this.props;this.h!==e&&(this.u=t=>{null!==e&&((e,t)=>{"function"==typeof e?e(t):e.current=t})(e,t),this.o=t,this.h=e}),this.i={};const s={ref:this.u};for(const[n,r]of Object.entries(t))i.has(n)?s["className"===n?"class":n]=r:p.has(n)||n in c.prototype?this.i[n]=r:s[n]=r;return s.suppressHydrationWarning=!0,u(l,s)}}h.displayName=null!=r?r:c.name;const m=a.forwardRef(((e,t)=>u(h,{...e,_$Gl:t},null==e?void 0:e.children)));return m.displayName=h.displayName,m}({tagName:"deep-chat",elementClass:n.S,react:l,events:{onactivate:"activate",onchange:"change"}})},7694:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>DeepChat});class ErrorView{static render(e,t){const s=document.createElement("div");s.id="error-view",s.innerText=t,e.replaceChildren(s)}}class ValidateKeyPropertyView{static onLoad(e){e.innerHTML='<div id="large-loading-ring"></div>'}static createElements(){const e=document.createElement("div");return e.id="validate-property-key-view",e}static render(e,t,s){const n=ValidateKeyPropertyView.createElements(),i={onSuccess:t,onFail:ErrorView.render.bind(this,e,"Your 'key' has failed authentication"),onLoad:ValidateKeyPropertyView.onLoad.bind(this,n)};s.key&&s.verifyKey(s.key,i),e.replaceChildren(n)}}class WebComponentStyleUtils{static apply(e,t){if(t)try{WebComponentStyleUtils.applyStyleSheet(e,t)}catch{WebComponentStyleUtils.addStyleElement(e,t)}}static applyStyleSheet(e,t){const s=new CSSStyleSheet;s.replaceSync(e),t.adoptedStyleSheets.push(s)}static addStyleElement(e,t){const s=document.createElement("style");s.innerHTML=e,t.appendChild(s)}}var KEYBOARD_KEY=(e=>(e.ESCAPE="Escape",e.ENTER="Enter",e.TAB="Tab",e.ARROW_UP="ArrowUp",e.ARROW_DOWN="ArrowDown",e.ARROW_RIGHT="ArrowRight",e.ARROW_LEFT="ArrowLeft",e.BACKSPACE="Backspace",e.DELETE="Delete",e.META="Meta",e.CONTROL="Control",e))(KEYBOARD_KEY||{});class StyleUtils{static unsetStyle(e,t){const s=Object.keys(t).reduce(((e,t)=>(e[t]="",e)),{});Object.assign(e.style,s)}static unsetActivityCSSMouseStates(e,t){t.click&&StyleUtils.unsetStyle(e,t.click),t.hover&&StyleUtils.unsetStyle(e,t.hover)}static unsetAllCSSMouseStates(e,t){StyleUtils.unsetActivityCSSMouseStates(e,t),t.default&&StyleUtils.unsetStyle(e,t.default)}static generateStateful(e,t,s){const n=e.default||{},i=Object.assign(JSON.parse(JSON.stringify({...n,...t})),null==e?void 0:e.hover);return{default:n,hover:i,click:Object.assign(JSON.parse(JSON.stringify({...i,...s})),null==e?void 0:e.click)}}}let Browser$1=class{};Browser$1.IS_SAFARI=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),Browser$1.IS_CHROMIUM=window.chrome;class PasteUtils{static sanitizePastedTextContent(e){var t,s;e.preventDefault();const n=null==(t=e.clipboardData)?void 0:t.getData("text/plain");null==(s=document.execCommand)||s.call(document,"insertHTML",!1,n)}}const _InputLimit=class{static add(e,t){e.addEventListener("keydown",_InputLimit.onKeyDown.bind(this,t)),e.oninput=_InputLimit.onInput.bind(this,t)}static onKeyDown(e,t){const s=t.target.textContent;s&&s.length>=e&&!_InputLimit.PERMITTED_KEYS.has(t.key)&&!_InputLimit.isKeyCombinationPermitted(t)&&t.preventDefault()}static isKeyCombinationPermitted(e){return"a"===e.key&&(e.ctrlKey||e.metaKey)}static onInput(e,t){const s=t.target,n=s.textContent;n&&n.length>e&&(s.textContent=n.substring(0,e),FocusUtils.focusEndOfInput(s))}};let InputLimit=_InputLimit;InputLimit.PERMITTED_KEYS=new Set([KEYBOARD_KEY.BACKSPACE,KEYBOARD_KEY.DELETE,KEYBOARD_KEY.ARROW_RIGHT,KEYBOARD_KEY.ARROW_LEFT,KEYBOARD_KEY.ARROW_DOWN,KEYBOARD_KEY.ARROW_UP,KEYBOARD_KEY.META,KEYBOARD_KEY.CONTROL,KEYBOARD_KEY.ENTER]);const _TextInputEl=class{constructor(e,t){var s;const n=_TextInputEl.processConfig(e,t);this.elementRef=_TextInputEl.createContainerElement(null==(s=null==n?void 0:n.styles)?void 0:s.container),this.inputElementRef=this.createInputElement(n),this._config=n,this.elementRef.appendChild(this.inputElementRef),null!=t&&t.characterLimit&&InputLimit.add(this.inputElementRef,null==t?void 0:t.characterLimit)}static processConfig(e,t){var s;return t??(t={}),t.disabled??(t.disabled=e.isTextInputDisabled),t.placeholder??(t.placeholder={}),(s=t.placeholder).text??(s.text=e.textInputPlaceholderText),t}static preventAutomaticScrollUpOnNewLine(e){let t;e.addEventListener("keydown",(()=>{t=window.scrollY})),e.addEventListener("input",(()=>{t!==window.scrollY&&window.scrollTo({top:t})}))}static clear(e){const t=window.scrollY;e.classList.contains("text-input-disabled")||(e.textContent=""),Browser$1.IS_CHROMIUM&&window.scrollTo({top:t})}createInputElement(e){var t,s,n;const i=document.createElement("div");return i.id=_TextInputEl.TEXT_INPUT_ID,i.classList.add("text-input-styling","text-input-placeholder"),i.innerText=(null==(t=null==e?void 0:e.placeholder)?void 0:t.text)||"Ask me anything!",Browser$1.IS_CHROMIUM&&_TextInputEl.preventAutomaticScrollUpOnNewLine(i),"boolean"==typeof(null==e?void 0:e.disabled)&&!0===e.disabled?(i.contentEditable="false",i.classList.add("text-input-disabled")):(i.contentEditable="true",this.addEventListeners(i,e)),Object.assign(i.style,null==(s=null==e?void 0:e.styles)?void 0:s.text),Object.assign(i.style,null==(n=null==e?void 0:e.placeholder)?void 0:n.style),i}removeTextIfPlaceholder(){var e,t,s,n;this.inputElementRef.classList.contains("text-input-placeholder")&&!this.inputElementRef.classList.contains("text-input-disabled")&&(null!=(e=this._config.placeholder)&&e.style&&(StyleUtils.unsetStyle(this.inputElementRef,null==(t=this._config.placeholder)?void 0:t.style),Object.assign(this.inputElementRef.style,null==(n=null==(s=this._config)?void 0:s.styles)?void 0:n.text)),_TextInputEl.clear(this.inputElementRef),this.inputElementRef.classList.remove("text-input-placeholder"))}static toggleEditability(e,t){e.contentEditable=t?"true":"false"}addEventListeners(e,t){var s,n,i;e.onfocus=this.onFocus.bind(this,null==(s=null==t?void 0:t.styles)?void 0:s.focus),null!=(n=null==t?void 0:t.styles)&&n.focus&&(e.onblur=this.onBlur.bind(this,t.styles.focus,null==(i=null==t?void 0:t.styles)?void 0:i.container)),e.addEventListener("keydown",this.onKeydown.bind(this)),e.onpaste=PasteUtils.sanitizePastedTextContent}onFocus(e){Browser$1.IS_SAFARI?setTimeout((()=>{this.removeTextIfPlaceholder()})):this.removeTextIfPlaceholder(),Object.assign(this.elementRef.style,e)}onBlur(e,t){StyleUtils.unsetStyle(this.elementRef,e),t&&Object.assign(this.elementRef.style,t)}static createContainerElement(e){const t=document.createElement("div");return t.id="text-input-container",Object.assign(t.style,e),t}onKeydown(e){var t;e.key===KEYBOARD_KEY.ENTER&&!e.ctrlKey&&!e.shiftKey&&(e.preventDefault(),null==(t=this.submit)||t.call(this))}};let TextInputEl=_TextInputEl;TextInputEl.TEXT_INPUT_ID="text-input";class FocusUtils{static focusEndOfInput(e){const t=document.createRange();t.selectNodeContents(e),t.collapse(!1);const s=window.getSelection();null==s||s.removeAllRanges(),null==s||s.addRange(t)}static focusFromParentElement(e){const t=e.querySelector(`#${TextInputEl.TEXT_INPUT_ID}`);t&&FocusUtils.focusEndOfInput(t)}}async function getBytes(e,t){const s=e.getReader();let n;for(;!(n=await s.read()).done;)t(n.value)}function getLines(e){let t,s,n,i=!1;return function(r){void 0===t?(t=r,s=0,n=-1):t=concat(t,r);const o=t.length;let a=0;for(;s<o;){i&&(10===t[s]&&(a=++s),i=!1);let r=-1;for(;s<o&&-1===r;++s)switch(t[s]){case 58:-1===n&&(n=s-a);break;case 13:i=!0;case 10:r=s}if(-1===r)break;e(t.subarray(a,r),n),a=s,n=-1}a===o?t=void 0:0!==a&&(t=t.subarray(a),s-=a)}}function getMessages(e,t,s){let n=newMessage();const i=new TextDecoder;return function(r,o){if(0===r.length)null==s||s(n),n=newMessage();else if(o>0){const s=i.decode(r.subarray(0,o)),a=o+(32===r[o+1]?2:1),l=i.decode(r.subarray(a));switch(s){case"data":n.data=n.data?n.data+"\n"+l:l;break;case"event":n.event=l;break;case"id":e(n.id=l);break;case"retry":const s=parseInt(l,10);isNaN(s)||t(n.retry=s)}}}}function concat(e,t){const s=new Uint8Array(e.length+t.length);return s.set(e),s.set(t,e.length),s}function newMessage(){return{data:"",event:"",id:"",retry:void 0}}var __rest=globalThis&&globalThis.__rest||function(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(s[n[i]]=e[n[i]])}return s};const EventStreamContentType="text/event-stream",DefaultRetryInterval=1e3,LastEventId="last-event-id";function fetchEventSource(e,t){var{signal:s,headers:n,onopen:i,onmessage:r,onclose:o,onerror:a,openWhenHidden:l,fetch:c}=t,d=__rest(t,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise(((t,u)=>{const p=Object.assign({},n);let h;function m(){h.abort(),document.hidden||_()}p.accept||(p.accept=EventStreamContentType),l||document.addEventListener("visibilitychange",m);let g=DefaultRetryInterval,f=0;function v(){document.removeEventListener("visibilitychange",m),window.clearTimeout(f),h.abort()}null==s||s.addEventListener("abort",(()=>{v(),t()}));const b=c??window.fetch,y=i??defaultOnOpen;async function _(){var s;h=new AbortController;try{const s=await b(e,Object.assign(Object.assign({},d),{headers:p,signal:h.signal}));await y(s),await getBytes(s.body,getLines(getMessages((e=>{e?p[LastEventId]=e:delete p[LastEventId]}),(e=>{g=e}),r))),null==o||o(),v(),t()}catch(n){if(!h.signal.aborted)try{const e=null!==(s=null==a?void 0:a(n))&&void 0!==s?s:g;window.clearTimeout(f),f=window.setTimeout(_,e)}catch(i){v(),u(i)}}}_()}))}function defaultOnOpen(e){const t=e.headers.get("content-type");if(null==t||!t.startsWith(EventStreamContentType))throw new Error(`Expected content-type to be ${EventStreamContentType}, Actual: ${t}`)}function getInterceptorMessage(e){return e&&JSON.stringify(e)}function getInvalidResponseMessage(e,t,s){return`${`\nResponse message: ${JSON.stringify(e)} \n`+(t?`Response message after interceptor: ${getInterceptorMessage(s)} \n`:"")}Make sure the response message is using the Result format: https://deepchat.dev/docs/connect/#Result \n You can also augment it using the responseInterceptor property: https://deepchat.dev/docs/interceptors#responseInterceptor`}const ErrorMessages={INVALID_KEY:"Invalid API Key",CONNECTION_FAILED:"Failed to connect",INVALID_RESPONSE_FORMAT:getInvalidResponseMessage,INVALID_STREAM_FORMAT:"Make sure the events are using the Result format: https://deepchat.dev/docs/connect/#Result \nYou can also augment them using the responseInterceptor property: https://deepchat.dev/docs/interceptors#responseInterceptor"},_RequestUtils=class{static temporarilyRemoveHeader(e,t,s){if(null==e||!e.headers)throw new Error("Request settings have not been set up");const n=e.headers[_RequestUtils.CONTENT_TYPE];delete e.headers[_RequestUtils.CONTENT_TYPE],t(s),e.headers[_RequestUtils.CONTENT_TYPE]=n}static displayError(e,t){if(console.error(t),"object"==typeof t)return 0===Object.keys(t).length?e.addNewErrorMessage("service","Service error, please try again."):e.addNewErrorMessage("service",JSON.stringify(t));e.addNewErrorMessage("service",t)}};let RequestUtils=_RequestUtils;RequestUtils.CONTENT_TYPE="Content-Type";const _Demo=class{static generateResponseForOneMessage(e){if(e.file)return"image"===e.file.type?"That is a nice image!":"audio"===e.file.type?"I like the sound of that!":"gif"===e.file.type?"That is a nice gif!":"That is an interesting file!";if(e.text){if("?"===e.text.charAt(e.text.length-1))return"I'm sorry but I can't answer that question...";if(e.text.includes("updog"))return"What's updog?"}return"Hi there! This is a demo response!"}static generateResponse(e){const t=[];for(let n=e.messages.length-1;n>=0&&"ai"!==e.messages[n].role;n-=1)t.push(e.messages[n]);if(1===t.length)return _Demo.generateResponseForOneMessage(e.messages[e.messages.length-1]);const s=e.messages.findIndex((e=>e.text));return-1!==s&&t.splice(s,1),1===t.length?_Demo.generateResponseForOneMessage(e.messages[e.messages.length-1]):"Wow, very cool files!"}static getCustomResponse(e,t){return"function"==typeof e?e(t):e}static getResponse(e){return e.customDemoResponse?_Demo.getCustomResponse(e.customDemoResponse,e.messages[e.messages.length-1]):{text:_Demo.generateResponse(e)}}static request(e,t,s){const n=_Demo.getResponse(e);setTimeout((()=>{const i=(null==s?void 0:s(n))||n;e.addNewMessage(i,!0,!0),t()}),400)}static requestStream(e,t,s){var n;const i=(null==(n=_Demo.getResponse(e).text)?void 0:n.split(" "))||[];setTimeout((()=>{const n=e.addNewStreamedMessage();t(),_Demo.populateMessages(n,i,e,s)}),400)}static populateMessages(e,t,s,n,i=0){setTimeout((()=>{const r=t[i];r?(s.updateStreamedMessage(`${r} `,e),_Demo.populateMessages(e,t,s,n,i+1)):(s.finaliseStreamedMessage(),n())}),70)}};let Demo=_Demo;Demo.URL="deep-chat-demo";class HTTPRequest{static request(e,t,s,n=!0){var i,r,o,a,l,c;const d={body:t,headers:null==(i=e.requestSettings)?void 0:i.headers},{body:u,headers:p}=(null==(o=(r=e.deepChat).requestInterceptor)?void 0:o.call(r,d))||d,{onFinish:h}=e.completionsHandlers;if((null==(a=e.requestSettings)?void 0:a.url)===Demo.URL)return Demo.request(s,h,e.deepChat.responseInterceptor);let m=!0;fetch((null==(l=e.requestSettings)?void 0:l.url)||e.url||"",{method:(null==(c=e.requestSettings)?void 0:c.method)||"POST",headers:p,body:n?JSON.stringify(u):u}).then((e=>(m=!!e.ok,e))).then((e=>HTTPRequest.processResponseByType(e))).then((async t=>{var n,i;if(!e.extractResultData)return;const r=(null==(i=(n=e.deepChat).responseInterceptor)?void 0:i.call(n,t))||t,o=await e.extractResultData(r);if(!m)throw t;if(!o)throw Error(ErrorMessages.INVALID_RESPONSE_FORMAT(t,!!e.deepChat.responseInterceptor,r));o.pollingInAnotherRequest||(s.addNewMessage(o,!0,!0),h())})).catch((e=>{RequestUtils.displayError(s,e),h()}))}static requestStream(e,t,s,n=!0){var i,r,o,a,l,c;const d={body:t,headers:null==(i=e.requestSettings)?void 0:i.headers},{body:u,headers:p}=(null==(o=(r=e.deepChat).requestInterceptor)?void 0:o.call(r,d))||d,{onOpen:h,onClose:m,abortStream:g}=e.streamHandlers;if((null==(a=e.requestSettings)?void 0:a.url)===Demo.URL)return Demo.requestStream(s,h,m);let f=null;fetchEventSource((null==(l=e.requestSettings)?void 0:l.url)||e.url||"",{method:(null==(c=e.requestSettings)?void 0:c.method)||"POST",headers:p,body:n?JSON.stringify(u):u,openWhenHidden:!0,async onopen(e){if(e.ok)return f=s.addNewStreamedMessage(),h();throw await HTTPRequest.processResponseByType(e)},onmessage(t){var n;if(JSON.stringify(t.data)!==JSON.stringify("[DONE]")){const i=JSON.parse(t.data);null==(n=e.extractResultData)||n.call(e,i).then((e=>{null!=e&&e.text?f&&s.updateStreamedMessage(e.text,f):console.error(`Response data: ${t.data} \n ${ErrorMessages.INVALID_STREAM_FORMAT}`)})).catch((e=>RequestUtils.displayError(s,e)))}},onerror(e){throw m(),e},onclose(){s.finaliseStreamedMessage(),m()},signal:g.signal}).catch((t=>{var n;null==(n=e.extractResultData)||n.call(e,t).then((()=>{RequestUtils.displayError(s,t)})).catch((e=>{RequestUtils.displayError(s,e)}))}))}static executePollRequest(e,t,s,n){console.log("polling");const{onFinish:i}=e.completionsHandlers;fetch(t,s).then((e=>e.json())).then((async r=>{var o,a;if(!e.extractPollResultData)return;const l=await e.extractPollResultData((null==(a=(o=e.deepChat).responseInterceptor)?void 0:a.call(o,r))||r);l.timeoutMS?setTimeout((()=>{HTTPRequest.executePollRequest(e,t,s,n)}),l.timeoutMS):(console.log("finished polling"),n.addNewMessage(l,!0,!0),i())})).catch((e=>{RequestUtils.displayError(n,e),i()}))}static poll(e,t,s,n=!0){var i,r,o,a,l;const c={body:t,headers:null==(i=e.requestSettings)?void 0:i.headers},{body:d,headers:u}=(null==(o=(r=e.deepChat).requestInterceptor)?void 0:o.call(r,c))||c,p=(null==(a=e.requestSettings)?void 0:a.url)||e.url||"",h={method:(null==(l=e.requestSettings)?void 0:l.method)||"POST",body:n?JSON.stringify(d):d,headers:u};HTTPRequest.executePollRequest(e,p,h,s)}static verifyKey(e,t,s,n,i,r,o,a,l){if(""===e)return r(ErrorMessages.INVALID_KEY);o(),fetch(t,{method:n,headers:s,body:l||null}).then((e=>HTTPRequest.processResponseByType(e))).then((t=>{a(t,e,i,r)})).catch((e=>{r(ErrorMessages.CONNECTION_FAILED),console.error(e)}))}static processResponseByType(e){const t=e.headers.get("content-type");return null!=t&&t.includes("application/json")?e.json():null!=t&&t.includes("text/plain")||!t?e:e.blob()}}class MessageLimitUtils{static getCharacterLimitMessages(e,t){var s;let n=0,i=e.length-1;for(;i>=0;i-=1){const r=null==(s=e[i])?void 0:s.text;if(void 0!==r&&(n+=r.length,n>t)){e[i].text=r.substring(0,r.length-(n-t));break}}return e.slice(Math.max(i,0))}static getRequestMessages(e,t){var s;const n=[];let i=(null==(s=e.files)?void 0:s.length)||0,r=!!e.text;for(let o=t.length-1;o>=0;o-=1){const e=t[o];if(n.push(e),e.file?i-=1:e.text&&(r=!1),0===i&&!r)break}return n}static getMaxMessages(e,t){return e.slice(Math.max(e.length-t,0))}static processMessages(e,t,s,n){return void 0!==s?s>0&&(t=MessageLimitUtils.getMaxMessages(t,s)):t=MessageLimitUtils.getRequestMessages(e,t),void 0===n?t:MessageLimitUtils.getCharacterLimitMessages(t,n)}}class Websocket{static setup(e,t){if(e.requestSettings.url!==Demo.URL){const s="boolean"!=typeof t?t:void 0;e.websocket=Websocket.connect(e.requestSettings.url,s),e.permittedErrorPrefixes=["Connection error"]}}static connect(e,t){return new WebSocket(e||"",t)}static assignListeners(e,t){e.websocket&&(e.websocket.onmessage=async s=>{var n,i;if(e.extractResultData)try{const r=JSON.parse(s.data),o=await e.extractResultData((null==(i=(n=e.deepChat).responseInterceptor)?void 0:i.call(n,r))||r);t.addNewMessage(o,!0,!0)}catch(r){RequestUtils.displayError(t,r)}},e.websocket.onerror=e=>{console.error(e),t.addNewErrorMessage("service","Connection error")},e.websocket.onclose=()=>{console.error("Connection closed"),t.isLastMessageError()||t.addNewErrorMessage("service","Connection error")})}static sendWebsocket(e,t,s,n,i=!0){var r,o,a,l;const c={body:s,headers:null==(r=t.requestSettings)?void 0:r.headers},{body:d}=(null==(a=(o=t.deepChat).requestInterceptor)?void 0:a.call(o,c))||c,u=i?JSON.stringify(d):d;if((null==(l=t.requestSettings)?void 0:l.url)===Demo.URL)return Demo.request(n,t.completionsHandlers.onFinish,t.deepChat.responseInterceptor);e.readyState!==e.OPEN?(console.error("Connection is not open"),n.addNewErrorMessage("service","Connection error")):e.send(JSON.stringify(u))}}var textarea;function decodeEntity(e){return(textarea=textarea||document.createElement("textarea")).innerHTML="&"+e+";",textarea.value}var hasOwn=Object.prototype.hasOwnProperty;function has(e,t){return!!e&&hasOwn.call(e,t)}function assign(e){return[].slice.call(arguments,1).forEach((function(t){if(t){if("object"!=typeof t)throw new TypeError(t+"must be object");Object.keys(t).forEach((function(s){e[s]=t[s]}))}})),e}var UNESCAPE_MD_RE=/\\([\\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;function unescapeMd(e){return e.indexOf("\\")<0?e:e.replace(UNESCAPE_MD_RE,"$1")}function isValidEntityCode(e){return!(e>=55296&&e<=57343||e>=64976&&e<=65007||65535==(65535&e)||65534==(65535&e)||e>=0&&e<=8||11===e||e>=14&&e<=31||e>=127&&e<=159||e>1114111)}function fromCodePoint(e){if(e>65535){var t=55296+((e-=65536)>>10),s=56320+(1023&e);return String.fromCharCode(t,s)}return String.fromCharCode(e)}var NAMED_ENTITY_RE=/&([a-z#][a-z0-9]{1,31});/gi,DIGITAL_ENTITY_TEST_RE=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))/i;function replaceEntityPattern(e,t){var s=0,n=decodeEntity(t);return t!==n?n:35===t.charCodeAt(0)&&DIGITAL_ENTITY_TEST_RE.test(t)&&isValidEntityCode(s="x"===t[1].toLowerCase()?parseInt(t.slice(2),16):parseInt(t.slice(1),10))?fromCodePoint(s):e}function replaceEntities(e){return e.indexOf("&")<0?e:e.replace(NAMED_ENTITY_RE,replaceEntityPattern)}var HTML_ESCAPE_TEST_RE=/[&<>"]/,HTML_ESCAPE_REPLACE_RE=/[&<>"]/g,HTML_REPLACEMENTS={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function replaceUnsafeChar(e){return HTML_REPLACEMENTS[e]}function escapeHtml(e){return HTML_ESCAPE_TEST_RE.test(e)?e.replace(HTML_ESCAPE_REPLACE_RE,replaceUnsafeChar):e}var rules={};function nextToken(e,t){return++t>=e.length-2?t:"paragraph_open"===e[t].type&&e[t].tight&&"inline"===e[t+1].type&&0===e[t+1].content.length&&"paragraph_close"===e[t+2].type&&e[t+2].tight?nextToken(e,t+2):t}rules.blockquote_open=function(){return"<blockquote>\n"},rules.blockquote_close=function(e,t){return"</blockquote>"+getBreak(e,t)},rules.code=function(e,t){return e[t].block?"<pre><code>"+escapeHtml(e[t].content)+"</code></pre>"+getBreak(e,t):"<code>"+escapeHtml(e[t].content)+"</code>"},rules.fence=function(e,t,s,n,i){var r,o,a=e[t],l="",c=s.langPrefix;if(a.params){if(o=(r=a.params.split(/\s+/g)).join(" "),has(i.rules.fence_custom,r[0]))return i.rules.fence_custom[r[0]](e,t,s,n,i);l=' class="'+c+escapeHtml(replaceEntities(unescapeMd(o)))+'"'}return"<pre><code"+l+">"+(s.highlight&&s.highlight.apply(s.highlight,[a.content].concat(r))||escapeHtml(a.content))+"</code></pre>"+getBreak(e,t)},rules.fence_custom={},rules.heading_open=function(e,t){return"<h"+e[t].hLevel+">"},rules.heading_close=function(e,t){return"</h"+e[t].hLevel+">\n"},rules.hr=function(e,t,s){return(s.xhtmlOut?"<hr />":"<hr>")+getBreak(e,t)},rules.bullet_list_open=function(){return"<ul>\n"},rules.bullet_list_close=function(e,t){return"</ul>"+getBreak(e,t)},rules.list_item_open=function(){return"<li>"},rules.list_item_close=function(){return"</li>\n"},rules.ordered_list_open=function(e,t){var s=e[t];return"<ol"+(s.order>1?' start="'+s.order+'"':"")+">\n"},rules.ordered_list_close=function(e,t){return"</ol>"+getBreak(e,t)},rules.paragraph_open=function(e,t){return e[t].tight?"":"<p>"},rules.paragraph_close=function(e,t){var s=!(e[t].tight&&t&&"inline"===e[t-1].type&&!e[t-1].content);return(e[t].tight?"":"</p>")+(s?getBreak(e,t):"")},rules.link_open=function(e,t,s){var n=e[t].title?' title="'+escapeHtml(replaceEntities(e[t].title))+'"':"",i=s.linkTarget?' target="'+s.linkTarget+'"':"";return'<a href="'+escapeHtml(e[t].href)+'"'+n+i+">"},rules.link_close=function(){return"</a>"},rules.image=function(e,t,s){var n=' src="'+escapeHtml(e[t].src)+'"',i=e[t].title?' title="'+escapeHtml(replaceEntities(e[t].title))+'"':"";return"<img"+n+(' alt="'+(e[t].alt?escapeHtml(replaceEntities(unescapeMd(e[t].alt))):"")+'"')+i+(s.xhtmlOut?" /":"")+">"},rules.table_open=function(){return"<table>\n"},rules.table_close=function(){return"</table>\n"},rules.thead_open=function(){return"<thead>\n"},rules.thead_close=function(){return"</thead>\n"},rules.tbody_open=function(){return"<tbody>\n"},rules.tbody_close=function(){return"</tbody>\n"},rules.tr_open=function(){return"<tr>"},rules.tr_close=function(){return"</tr>\n"},rules.th_open=function(e,t){var s=e[t];return"<th"+(s.align?' style="text-align:'+s.align+'"':"")+">"},rules.th_close=function(){return"</th>"},rules.td_open=function(e,t){var s=e[t];return"<td"+(s.align?' style="text-align:'+s.align+'"':"")+">"},rules.td_close=function(){return"</td>"},rules.strong_open=function(){return"<strong>"},rules.strong_close=function(){return"</strong>"},rules.em_open=function(){return"<em>"},rules.em_close=function(){return"</em>"},rules.del_open=function(){return"<del>"},rules.del_close=function(){return"</del>"},rules.ins_open=function(){return"<ins>"},rules.ins_close=function(){return"</ins>"},rules.mark_open=function(){return"<mark>"},rules.mark_close=function(){return"</mark>"},rules.sub=function(e,t){return"<sub>"+escapeHtml(e[t].content)+"</sub>"},rules.sup=function(e,t){return"<sup>"+escapeHtml(e[t].content)+"</sup>"},rules.hardbreak=function(e,t,s){return s.xhtmlOut?"<br />\n":"<br>\n"},rules.softbreak=function(e,t,s){return s.breaks?s.xhtmlOut?"<br />\n":"<br>\n":"\n"},rules.text=function(e,t){return escapeHtml(e[t].content)},rules.htmlblock=function(e,t){return e[t].content},rules.htmltag=function(e,t){return e[t].content},rules.abbr_open=function(e,t){return'<abbr title="'+escapeHtml(replaceEntities(e[t].title))+'">'},rules.abbr_close=function(){return"</abbr>"},rules.footnote_ref=function(e,t){var s=Number(e[t].id+1).toString(),n="fnref"+s;return e[t].subId>0&&(n+=":"+e[t].subId),'<sup class="footnote-ref"><a href="#fn'+s+'" id="'+n+'">['+s+"]</a></sup>"},rules.footnote_block_open=function(e,t,s){return(s.xhtmlOut?'<hr class="footnotes-sep" />\n':'<hr class="footnotes-sep">\n')+'<section class="footnotes">\n<ol class="footnotes-list">\n'},rules.footnote_block_close=function(){return"</ol>\n</section>\n"},rules.footnote_open=function(e,t){return'<li id="fn'+Number(e[t].id+1).toString()+'"  class="footnote-item">'},rules.footnote_close=function(){return"</li>\n"},rules.footnote_anchor=function(e,t){var s="fnref"+Number(e[t].id+1).toString();return e[t].subId>0&&(s+=":"+e[t].subId),' <a href="#'+s+'" class="footnote-backref">\u21a9</a>'},rules.dl_open=function(){return"<dl>\n"},rules.dt_open=function(){return"<dt>"},rules.dd_open=function(){return"<dd>"},rules.dl_close=function(){return"</dl>\n"},rules.dt_close=function(){return"</dt>\n"},rules.dd_close=function(){return"</dd>\n"};var getBreak=rules.getBreak=function(e,t){return(t=nextToken(e,t))<e.length&&"list_item_close"===e[t].type?"":"\n"};function Renderer(){this.rules=assign({},rules),this.getBreak=rules.getBreak}function Ruler(){this.__rules__=[],this.__cache__=null}function block(e){e.inlineMode?e.tokens.push({type:"inline",content:e.src.replace(/\n/g," ").trim(),level:0,lines:[0,1],children:[]}):e.block.parse(e.src,e.options,e.env,e.tokens)}function StateInline(e,t,s,n,i){this.src=e,this.env=n,this.options=s,this.parser=t,this.tokens=i,this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache=[],this.isInLabel=!1,this.linkLevel=0,this.linkContent="",this.labelUnmatchedScopes=0}function parseLinkLabel(e,t){var s,n,i,r=-1,o=e.posMax,a=e.pos,l=e.isInLabel;if(e.isInLabel)return-1;if(e.labelUnmatchedScopes)return e.labelUnmatchedScopes--,-1;for(e.pos=t+1,e.isInLabel=!0,s=1;e.pos<o;){if(91===(i=e.src.charCodeAt(e.pos)))s++;else if(93===i&&0===--s){n=!0;break}e.parser.skipToken(e)}return n?(r=e.pos,e.labelUnmatchedScopes=0):e.labelUnmatchedScopes=s-1,e.pos=a,e.isInLabel=l,r}function parseAbbr(e,t,s,n){var i,r,o,a,l,c;if(42!==e.charCodeAt(0)||91!==e.charCodeAt(1)||-1===e.indexOf("]:")||((r=parseLinkLabel(i=new StateInline(e,t,s,n,[]),1))<0||58!==e.charCodeAt(r+1)))return-1;for(a=i.posMax,o=r+2;o<a&&10!==i.src.charCodeAt(o);o++);return l=e.slice(2,r),0===(c=e.slice(r+2,o).trim()).length?-1:(n.abbreviations||(n.abbreviations={}),typeof n.abbreviations[":"+l]>"u"&&(n.abbreviations[":"+l]=c),o)}function abbr(e){var t,s,n,i,r=e.tokens;if(!e.inlineMode)for(t=1,s=r.length-1;t<s;t++)if("paragraph_open"===r[t-1].type&&"inline"===r[t].type&&"paragraph_close"===r[t+1].type){for(n=r[t].content;n.length&&!((i=parseAbbr(n,e.inline,e.options,e.env))<0);)n=n.slice(i).trim();r[t].content=n,n.length||(r[t-1].tight=!0,r[t+1].tight=!0)}}function normalizeLink(e){var t=replaceEntities(e);try{t=decodeURI(t)}catch{}return encodeURI(t)}function parseLinkDestination(e,t){var s,n,i,r=t,o=e.posMax;if(60===e.src.charCodeAt(t)){for(t++;t<o;){if(10===(s=e.src.charCodeAt(t)))return!1;if(62===s)return i=normalizeLink(unescapeMd(e.src.slice(r+1,t))),!!e.parser.validateLink(i)&&(e.pos=t+1,e.linkContent=i,!0);92===s&&t+1<o?t+=2:t++}return!1}for(n=0;t<o&&!(32===(s=e.src.charCodeAt(t))||s<32||127===s);)if(92===s&&t+1<o)t+=2;else{if(40===s&&++n>1||41===s&&--n<0)break;t++}return!(r===t||(i=unescapeMd(e.src.slice(r,t)),!e.parser.validateLink(i)))&&(e.linkContent=i,e.pos=t,!0)}function parseLinkTitle(e,t){var s,n=t,i=e.posMax,r=e.src.charCodeAt(t);if(34!==r&&39!==r&&40!==r)return!1;for(t++,40===r&&(r=41);t<i;){if((s=e.src.charCodeAt(t))===r)return e.pos=t+1,e.linkContent=unescapeMd(e.src.slice(n+1,t)),!0;92===s&&t+1<i?t+=2:t++}return!1}function normalizeReference(e){return e.trim().replace(/\s+/g," ").toUpperCase()}function parseReference(e,t,s,n){var i,r,o,a,l,c,d,u,p;if(91!==e.charCodeAt(0)||-1===e.indexOf("]:")||((r=parseLinkLabel(i=new StateInline(e,t,s,n,[]),0))<0||58!==e.charCodeAt(r+1)))return-1;for(a=i.posMax,o=r+2;o<a&&(32===(l=i.src.charCodeAt(o))||10===l);o++);if(!parseLinkDestination(i,o))return-1;for(d=i.linkContent,c=o=i.pos,o+=1;o<a&&(32===(l=i.src.charCodeAt(o))||10===l);o++);for(o<a&&c!==o&&parseLinkTitle(i,o)?(u=i.linkContent,o=i.pos):(u="",o=c);o<a&&32===i.src.charCodeAt(o);)o++;return o<a&&10!==i.src.charCodeAt(o)?-1:(p=normalizeReference(e.slice(1,r)),typeof n.references[p]>"u"&&(n.references[p]={title:u,href:d}),o)}function references(e){var t,s,n,i,r=e.tokens;if(e.env.references=e.env.references||{},!e.inlineMode)for(t=1,s=r.length-1;t<s;t++)if("inline"===r[t].type&&"paragraph_open"===r[t-1].type&&"paragraph_close"===r[t+1].type){for(n=r[t].content;n.length&&!((i=parseReference(n,e.inline,e.options,e.env))<0);)n=n.slice(i).trim();r[t].content=n,n.length||(r[t-1].tight=!0,r[t+1].tight=!0)}}function inline(e){var t,s,n,i=e.tokens;for(s=0,n=i.length;s<n;s++)"inline"===(t=i[s]).type&&e.inline.parse(t.content,e.options,e.env,t.children)}function footnote_block(e){var t,s,n,i,r,o,a,l,c,d=0,u=!1,p={};if(e.env.footnotes&&(e.tokens=e.tokens.filter((function(e){return"footnote_reference_open"===e.type?(u=!0,l=[],c=e.label,!1):"footnote_reference_close"===e.type?(u=!1,p[":"+c]=l,!1):(u&&l.push(e),!u)})),e.env.footnotes.list)){for(o=e.env.footnotes.list,e.tokens.push({type:"footnote_block_open",level:d++}),t=0,s=o.length;t<s;t++){for(e.tokens.push({type:"footnote_open",id:t,level:d++}),o[t].tokens?((a=[]).push({type:"paragraph_open",tight:!1,level:d++}),a.push({type:"inline",content:"",level:d,children:o[t].tokens}),a.push({type:"paragraph_close",tight:!1,level:--d})):o[t].label&&(a=p[":"+o[t].label]),e.tokens=e.tokens.concat(a),r="paragraph_close"===e.tokens[e.tokens.length-1].type?e.tokens.pop():null,i=o[t].count>0?o[t].count:1,n=0;n<i;n++)e.tokens.push({type:"footnote_anchor",id:t,subId:n,level:d});r&&e.tokens.push(r),e.tokens.push({type:"footnote_close",level:--d})}e.tokens.push({type:"footnote_block_close",level:--d})}}Renderer.prototype.renderInline=function(e,t,s){for(var n=this.rules,i=e.length,r=0,o="";i--;)o+=n[e[r].type](e,r++,t,s,this);return o},Renderer.prototype.render=function(e,t,s){for(var n=this.rules,i=e.length,r=-1,o="";++r<i;)"inline"===e[r].type?o+=this.renderInline(e[r].children,t,s):o+=n[e[r].type](e,r,t,s,this);return o},Ruler.prototype.__find__=function(e){for(var t=this.__rules__.length,s=-1;t--;)if(this.__rules__[++s].name===e)return s;return-1},Ruler.prototype.__compile__=function(){var e=this,t=[""];e.__rules__.forEach((function(e){e.enabled&&e.alt.forEach((function(e){t.indexOf(e)<0&&t.push(e)}))})),e.__cache__={},t.forEach((function(t){e.__cache__[t]=[],e.__rules__.forEach((function(s){s.enabled&&(t&&s.alt.indexOf(t)<0||e.__cache__[t].push(s.fn))}))}))},Ruler.prototype.at=function(e,t,s){var n=this.__find__(e),i=s||{};if(-1===n)throw new Error("Parser rule not found: "+e);this.__rules__[n].fn=t,this.__rules__[n].alt=i.alt||[],this.__cache__=null},Ruler.prototype.before=function(e,t,s,n){var i=this.__find__(e),r=n||{};if(-1===i)throw new Error("Parser rule not found: "+e);this.__rules__.splice(i,0,{name:t,enabled:!0,fn:s,alt:r.alt||[]}),this.__cache__=null},Ruler.prototype.after=function(e,t,s,n){var i=this.__find__(e),r=n||{};if(-1===i)throw new Error("Parser rule not found: "+e);this.__rules__.splice(i+1,0,{name:t,enabled:!0,fn:s,alt:r.alt||[]}),this.__cache__=null},Ruler.prototype.push=function(e,t,s){var n=s||{};this.__rules__.push({name:e,enabled:!0,fn:t,alt:n.alt||[]}),this.__cache__=null},Ruler.prototype.enable=function(e,t){e=Array.isArray(e)?e:[e],t&&this.__rules__.forEach((function(e){e.enabled=!1})),e.forEach((function(e){var t=this.__find__(e);if(t<0)throw new Error("Rules manager: invalid rule name "+e);this.__rules__[t].enabled=!0}),this),this.__cache__=null},Ruler.prototype.disable=function(e){(e=Array.isArray(e)?e:[e]).forEach((function(e){var t=this.__find__(e);if(t<0)throw new Error("Rules manager: invalid rule name "+e);this.__rules__[t].enabled=!1}),this),this.__cache__=null},Ruler.prototype.getRules=function(e){return null===this.__cache__&&this.__compile__(),this.__cache__[e]||[]},StateInline.prototype.pushPending=function(){this.tokens.push({type:"text",content:this.pending,level:this.pendingLevel}),this.pending=""},StateInline.prototype.push=function(e){this.pending&&this.pushPending(),this.tokens.push(e),this.pendingLevel=this.level},StateInline.prototype.cacheSet=function(e,t){for(var s=this.cache.length;s<=e;s++)this.cache.push(0);this.cache[e]=t},StateInline.prototype.cacheGet=function(e){return e<this.cache.length?this.cache[e]:0};var PUNCT_CHARS=" \n()[]'\".,!?-";function regEscape(e){return e.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1")}function abbr2(e){var t,s,n,i,r,o,a,l,c,d,u,p,h=e.tokens;if(e.env.abbreviations)for(e.env.abbrRegExp||(p="(^|["+PUNCT_CHARS.split("").map(regEscape).join("")+"])("+Object.keys(e.env.abbreviations).map((function(e){return e.substr(1)})).sort((function(e,t){return t.length-e.length})).map(regEscape).join("|")+")($|["+PUNCT_CHARS.split("").map(regEscape).join("")+"])",e.env.abbrRegExp=new RegExp(p,"g")),d=e.env.abbrRegExp,s=0,n=h.length;s<n;s++)if("inline"===h[s].type)for(t=(i=h[s].children).length-1;t>=0;t--)if("text"===(r=i[t]).type){for(l=0,o=r.content,d.lastIndex=0,c=r.level,a=[];u=d.exec(o);)d.lastIndex>l&&a.push({type:"text",content:o.slice(l,u.index+u[1].length),level:c}),a.push({type:"abbr_open",title:e.env.abbreviations[":"+u[2]],level:c++}),a.push({type:"text",content:u[2],level:c}),a.push({type:"abbr_close",level:--c}),l=d.lastIndex-u[3].length;a.length&&(l<o.length&&a.push({type:"text",content:o.slice(l),level:c}),h[s].children=i=[].concat(i.slice(0,t),a,i.slice(t+1)))}}var RARE_RE=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/,SCOPED_ABBR_RE=/\((c|tm|r|p)\)/gi,SCOPED_ABBR={c:"\xa9",r:"\xae",p:"\xa7",tm:"\u2122"};function replaceScopedAbbr(e){return e.indexOf("(")<0?e:e.replace(SCOPED_ABBR_RE,(function(e,t){return SCOPED_ABBR[t.toLowerCase()]}))}function replace(e){var t,s,n,i,r;if(e.options.typographer)for(r=e.tokens.length-1;r>=0;r--)if("inline"===e.tokens[r].type)for(t=(i=e.tokens[r].children).length-1;t>=0;t--)"text"===(s=i[t]).type&&(n=replaceScopedAbbr(n=s.content),RARE_RE.test(n)&&(n=n.replace(/\+-/g,"\xb1").replace(/\.{2,}/g,"\u2026").replace(/([?!])\u2026/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---([^-]|$)/gm,"$1\u2014$2").replace(/(^|\s)--(\s|$)/gm,"$1\u2013$2").replace(/(^|[^-\s])--([^-\s]|$)/gm,"$1\u2013$2")),s.content=n)}var QUOTE_TEST_RE=/['"]/,QUOTE_RE=/['"]/g,PUNCT_RE=/[-\s()\[\]]/,APOSTROPHE="\u2019";function isLetter(e,t){return!(t<0||t>=e.length)&&!PUNCT_RE.test(e[t])}function replaceAt(e,t,s){return e.substr(0,t)+s+e.substr(t+1)}function smartquotes(e){var t,s,n,i,r,o,a,l,c,d,u,p,h,m,g,f,v;if(e.options.typographer)for(v=[],g=e.tokens.length-1;g>=0;g--)if("inline"===e.tokens[g].type)for(f=e.tokens[g].children,v.length=0,t=0;t<f.length;t++)if("text"===(s=f[t]).type&&!QUOTE_TEST_RE.test(s.text)){for(a=f[t].level,h=v.length-1;h>=0&&!(v[h].level<=a);h--);v.length=h+1,r=0,o=(n=s.content).length;e:for(;r<o&&(QUOTE_RE.lastIndex=r,i=QUOTE_RE.exec(n),i);)if(l=!isLetter(n,i.index-1),r=i.index+1,m="'"===i[0],(c=!isLetter(n,r))||l){if(u=!c,p=!l)for(h=v.length-1;h>=0&&(d=v[h],!(v[h].level<a));h--)if(d.single===m&&v[h].level===a){d=v[h],m?(f[d.token].content=replaceAt(f[d.token].content,d.pos,e.options.quotes[2]),s.content=replaceAt(s.content,i.index,e.options.quotes[3])):(f[d.token].content=replaceAt(f[d.token].content,d.pos,e.options.quotes[0]),s.content=replaceAt(s.content,i.index,e.options.quotes[1])),v.length=h;continue e}u?v.push({token:t,pos:i.index,single:m,level:a}):p&&m&&(s.content=replaceAt(s.content,i.index,APOSTROPHE))}else m&&(s.content=replaceAt(s.content,i.index,APOSTROPHE))}}var _rules=[["block",block],["abbr",abbr],["references",references],["inline",inline],["footnote_tail",footnote_block],["abbr2",abbr2],["replacements",replace],["smartquotes",smartquotes]];function Core(){this.options={},this.ruler=new Ruler;for(var e=0;e<_rules.length;e++)this.ruler.push(_rules[e][0],_rules[e][1])}function StateBlock(e,t,s,n,i){var r,o,a,l,c,d,u;for(this.src=e,this.parser=t,this.options=s,this.env=n,this.tokens=i,this.bMarks=[],this.eMarks=[],this.tShift=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.parentType="root",this.ddIndent=-1,this.level=0,this.result="",d=0,u=!1,a=l=d=0,c=(o=this.src).length;l<c;l++){if(r=o.charCodeAt(l),!u){if(32===r){d++;continue}u=!0}(10===r||l===c-1)&&(10!==r&&l++,this.bMarks.push(a),this.eMarks.push(l),this.tShift.push(d),u=!1,d=0,a=l+1)}this.bMarks.push(o.length),this.eMarks.push(o.length),this.tShift.push(0),this.lineMax=this.bMarks.length-1}function code(e,t,s){var n,i;if(e.tShift[t]-e.blkIndent<4)return!1;for(i=n=t+1;n<s;)if(e.isEmpty(n))n++;else{if(!(e.tShift[n]-e.blkIndent>=4))break;i=++n}return e.line=n,e.tokens.push({type:"code",content:e.getLines(t,i,4+e.blkIndent,!0),block:!0,lines:[t,e.line],level:e.level}),!0}function fences(e,t,s,n){var i,r,o,a,l,c=!1,d=e.bMarks[t]+e.tShift[t],u=e.eMarks[t];if(d+3>u||126!==(i=e.src.charCodeAt(d))&&96!==i||(l=d,(r=(d=e.skipChars(d,i))-l)<3)||(o=e.src.slice(d,u).trim()).indexOf("`")>=0)return!1;if(n)return!0;for(a=t;!(++a>=s||(d=l=e.bMarks[a]+e.tShift[a],u=e.eMarks[a],d<u&&e.tShift[a]<e.blkIndent));)if(!(e.src.charCodeAt(d)!==i||e.tShift[a]-e.blkIndent>=4||(d=e.skipChars(d,i),d-l<r||(d=e.skipSpaces(d),d<u)))){c=!0;break}return r=e.tShift[t],e.line=a+(c?1:0),e.tokens.push({type:"fence",params:o,content:e.getLines(t+1,a,r,!0),lines:[t,e.line],level:e.level}),!0}function blockquote(e,t,s,n){var i,r,o,a,l,c,d,u,p,h,m,g=e.bMarks[t]+e.tShift[t],f=e.eMarks[t];if(g>f||62!==e.src.charCodeAt(g++)||e.level>=e.options.maxNesting)return!1;if(n)return!0;for(32===e.src.charCodeAt(g)&&g++,l=e.blkIndent,e.blkIndent=0,a=[e.bMarks[t]],e.bMarks[t]=g,r=(g=g<f?e.skipSpaces(g):g)>=f,o=[e.tShift[t]],e.tShift[t]=g-e.bMarks[t],u=e.parser.ruler.getRules("blockquote"),i=t+1;i<s&&!((g=e.bMarks[i]+e.tShift[i])>=(f=e.eMarks[i]));i++)if(62!==e.src.charCodeAt(g++)){if(r)break;for(m=!1,p=0,h=u.length;p<h;p++)if(u[p](e,i,s,!0)){m=!0;break}if(m)break;a.push(e.bMarks[i]),o.push(e.tShift[i]),e.tShift[i]=-1337}else 32===e.src.charCodeAt(g)&&g++,a.push(e.bMarks[i]),e.bMarks[i]=g,r=(g=g<f?e.skipSpaces(g):g)>=f,o.push(e.tShift[i]),e.tShift[i]=g-e.bMarks[i];for(c=e.parentType,e.parentType="blockquote",e.tokens.push({type:"blockquote_open",lines:d=[t,0],level:e.level++}),e.parser.tokenize(e,t,i),e.tokens.push({type:"blockquote_close",level:--e.level}),e.parentType=c,d[1]=e.line,p=0;p<o.length;p++)e.bMarks[p+t]=a[p],e.tShift[p+t]=o[p];return e.blkIndent=l,!0}function hr(e,t,s,n){var i,r,o,a=e.bMarks[t],l=e.eMarks[t];if((a+=e.tShift[t])>l||42!==(i=e.src.charCodeAt(a++))&&45!==i&&95!==i)return!1;for(r=1;a<l;){if((o=e.src.charCodeAt(a++))!==i&&32!==o)return!1;o===i&&r++}return!(r<3)&&(n||(e.line=t+1,e.tokens.push({type:"hr",lines:[t,e.line],level:e.level})),!0)}function skipBulletListMarker(e,t){var s,n,i;return(n=e.bMarks[t]+e.tShift[t])>=(i=e.eMarks[t])||42!==(s=e.src.charCodeAt(n++))&&45!==s&&43!==s||n<i&&32!==e.src.charCodeAt(n)?-1:n}function skipOrderedListMarker(e,t){var s,n=e.bMarks[t]+e.tShift[t],i=e.eMarks[t];if(n+1>=i||((s=e.src.charCodeAt(n++))<48||s>57))return-1;for(;;){if(n>=i)return-1;if(!((s=e.src.charCodeAt(n++))>=48&&s<=57)){if(41===s||46===s)break;return-1}}return n<i&&32!==e.src.charCodeAt(n)?-1:n}function markTightParagraphs(e,t){var s,n,i=e.level+2;for(s=t+2,n=e.tokens.length-2;s<n;s++)e.tokens[s].level===i&&"paragraph_open"===e.tokens[s].type&&(e.tokens[s+2].tight=!0,e.tokens[s].tight=!0,s+=2)}function list(e,t,s,n){var i,r,o,a,l,c,d,u,p,h,m,g,f,v,b,y,_,S,E,x,I,T=!0;if((u=skipOrderedListMarker(e,t))>=0)g=!0;else{if(!((u=skipBulletListMarker(e,t))>=0))return!1;g=!1}if(e.level>=e.options.maxNesting)return!1;if(m=e.src.charCodeAt(u-1),n)return!0;for(v=e.tokens.length,g?(d=e.bMarks[t]+e.tShift[t],h=Number(e.src.substr(d,u-d-1)),e.tokens.push({type:"ordered_list_open",order:h,lines:y=[t,0],level:e.level++})):e.tokens.push({type:"bullet_list_open",lines:y=[t,0],level:e.level++}),i=t,b=!1,S=e.parser.ruler.getRules("list");i<s&&((p=(f=e.skipSpaces(u))>=e.eMarks[i]?1:f-u)>4&&(p=1),p<1&&(p=1),r=u-e.bMarks[i]+p,e.tokens.push({type:"list_item_open",lines:_=[t,0],level:e.level++}),a=e.blkIndent,l=e.tight,o=e.tShift[t],c=e.parentType,e.tShift[t]=f-e.bMarks[t],e.blkIndent=r,e.tight=!0,e.parentType="list",e.parser.tokenize(e,t,s,!0),(!e.tight||b)&&(T=!1),b=e.line-t>1&&e.isEmpty(e.line-1),e.blkIndent=a,e.tShift[t]=o,e.tight=l,e.parentType=c,e.tokens.push({type:"list_item_close",level:--e.level}),i=t=e.line,_[1]=i,f=e.bMarks[t],!(i>=s||e.isEmpty(i)||e.tShift[i]<e.blkIndent));){for(I=!1,E=0,x=S.length;E<x;E++)if(S[E](e,i,s,!0)){I=!0;break}if(I)break;if(g){if((u=skipOrderedListMarker(e,i))<0)break}else if((u=skipBulletListMarker(e,i))<0)break;if(m!==e.src.charCodeAt(u-1))break}return e.tokens.push({type:g?"ordered_list_close":"bullet_list_close",level:--e.level}),y[1]=i,e.line=i,T&&markTightParagraphs(e,v),!0}function footnote(e,t,s,n){var i,r,o,a,l,c=e.bMarks[t]+e.tShift[t],d=e.eMarks[t];if(c+4>d||91!==e.src.charCodeAt(c)||94!==e.src.charCodeAt(c+1)||e.level>=e.options.maxNesting)return!1;for(a=c+2;a<d;a++){if(32===e.src.charCodeAt(a))return!1;if(93===e.src.charCodeAt(a))break}return!(a===c+2||a+1>=d||58!==e.src.charCodeAt(++a))&&(n||(a++,e.env.footnotes||(e.env.footnotes={}),e.env.footnotes.refs||(e.env.footnotes.refs={}),l=e.src.slice(c+2,a-2),e.env.footnotes.refs[":"+l]=-1,e.tokens.push({type:"footnote_reference_open",label:l,level:e.level++}),i=e.bMarks[t],r=e.tShift[t],o=e.parentType,e.tShift[t]=e.skipSpaces(a)-a,e.bMarks[t]=a,e.blkIndent+=4,e.parentType="footnote",e.tShift[t]<e.blkIndent&&(e.tShift[t]+=e.blkIndent,e.bMarks[t]-=e.blkIndent),e.parser.tokenize(e,t,s,!0),e.parentType=o,e.blkIndent-=4,e.tShift[t]=r,e.bMarks[t]=i,e.tokens.push({type:"footnote_reference_close",level:--e.level})),!0)}function heading(e,t,s,n){var i,r,o,a=e.bMarks[t]+e.tShift[t],l=e.eMarks[t];if(a>=l||(35!==(i=e.src.charCodeAt(a))||a>=l))return!1;for(r=1,i=e.src.charCodeAt(++a);35===i&&a<l&&r<=6;)r++,i=e.src.charCodeAt(++a);return!(r>6||a<l&&32!==i)&&(n||(l=e.skipCharsBack(l,32,a),(o=e.skipCharsBack(l,35,a))>a&&32===e.src.charCodeAt(o-1)&&(l=o),e.line=t+1,e.tokens.push({type:"heading_open",hLevel:r,lines:[t,e.line],level:e.level}),a<l&&e.tokens.push({type:"inline",content:e.src.slice(a,l).trim(),level:e.level+1,lines:[t,e.line],children:[]}),e.tokens.push({type:"heading_close",hLevel:r,level:e.level})),!0)}function lheading(e,t,s){var n,i,r,o=t+1;return!(o>=s||e.tShift[o]<e.blkIndent||e.tShift[o]-e.blkIndent>3||(i=e.bMarks[o]+e.tShift[o],r=e.eMarks[o],i>=r)||(n=e.src.charCodeAt(i),45!==n&&61!==n)||(i=e.skipChars(i,n),i=e.skipSpaces(i),i<r))&&(i=e.bMarks[t]+e.tShift[t],e.line=o+1,e.tokens.push({type:"heading_open",hLevel:61===n?1:2,lines:[t,e.line],level:e.level}),e.tokens.push({type:"inline",content:e.src.slice(i,e.eMarks[t]).trim(),level:e.level+1,lines:[t,e.line-1],children:[]}),e.tokens.push({type:"heading_close",hLevel:61===n?1:2,level:e.level}),!0)}Core.prototype.process=function(e){var t,s,n;for(t=0,s=(n=this.ruler.getRules("")).length;t<s;t++)n[t](e)},StateBlock.prototype.isEmpty=function(e){return this.bMarks[e]+this.tShift[e]>=this.eMarks[e]},StateBlock.prototype.skipEmptyLines=function(e){for(var t=this.lineMax;e<t&&!(this.bMarks[e]+this.tShift[e]<this.eMarks[e]);e++);return e},StateBlock.prototype.skipSpaces=function(e){for(var t=this.src.length;e<t&&32===this.src.charCodeAt(e);e++);return e},StateBlock.prototype.skipChars=function(e,t){for(var s=this.src.length;e<s&&this.src.charCodeAt(e)===t;e++);return e},StateBlock.prototype.skipCharsBack=function(e,t,s){if(e<=s)return e;for(;e>s;)if(t!==this.src.charCodeAt(--e))return e+1;return e},StateBlock.prototype.getLines=function(e,t,s,n){var i,r,o,a,l,c=e;if(e>=t)return"";if(c+1===t)return r=this.bMarks[c]+Math.min(this.tShift[c],s),o=n?this.eMarks[c]+1:this.eMarks[c],this.src.slice(r,o);for(a=new Array(t-e),i=0;c<t;c++,i++)(l=this.tShift[c])>s&&(l=s),l<0&&(l=0),r=this.bMarks[c]+l,o=c+1<t||n?this.eMarks[c]+1:this.eMarks[c],a[i]=this.src.slice(r,o);return a.join("")};var html_blocks={};["article","aside","button","blockquote","body","canvas","caption","col","colgroup","dd","div","dl","dt","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","iframe","li","map","object","ol","output","p","pre","progress","script","section","style","table","tbody","td","textarea","tfoot","th","tr","thead","ul","video"].forEach((function(e){html_blocks[e]=!0}));var HTML_TAG_OPEN_RE=/^<([a-zA-Z]{1,15})[\s\/>]/,HTML_TAG_CLOSE_RE=/^<\/([a-zA-Z]{1,15})[\s>]/;function isLetter$1(e){var t=32|e;return t>=97&&t<=122}function htmlblock(e,t,s,n){var i,r,o,a=e.bMarks[t],l=e.eMarks[t],c=e.tShift[t];if(a+=c,!e.options.html||c>3||a+2>=l||60!==e.src.charCodeAt(a))return!1;if(33===(i=e.src.charCodeAt(a+1))||63===i){if(n)return!0}else{if(47!==i&&!isLetter$1(i))return!1;if(47===i){if(!(r=e.src.slice(a,l).match(HTML_TAG_CLOSE_RE)))return!1}else if(!(r=e.src.slice(a,l).match(HTML_TAG_OPEN_RE)))return!1;if(!0!==html_blocks[r[1].toLowerCase()])return!1;if(n)return!0}for(o=t+1;o<e.lineMax&&!e.isEmpty(o);)o++;return e.line=o,e.tokens.push({type:"htmlblock",level:e.level,lines:[t,e.line],content:e.getLines(t,o,0,!0)}),!0}function getLine(e,t){var s=e.bMarks[t]+e.blkIndent,n=e.eMarks[t];return e.src.substr(s,n-s)}function table(e,t,s,n){var i,r,o,a,l,c,d,u,p,h,m;if(t+2>s||(l=t+1,e.tShift[l]<e.blkIndent)||(o=e.bMarks[l]+e.tShift[l])>=e.eMarks[l]||124!==(i=e.src.charCodeAt(o))&&45!==i&&58!==i||(r=getLine(e,t+1),!/^[-:| ]+$/.test(r))||(c=r.split("|"))<=2)return!1;for(u=[],a=0;a<c.length;a++){if(!(p=c[a].trim())){if(0===a||a===c.length-1)continue;return!1}if(!/^:?-+:?$/.test(p))return!1;58===p.charCodeAt(p.length-1)?u.push(58===p.charCodeAt(0)?"center":"right"):58===p.charCodeAt(0)?u.push("left"):u.push("")}if(-1===(r=getLine(e,t).trim()).indexOf("|")||(c=r.replace(/^\||\|$/g,"").split("|"),u.length!==c.length))return!1;if(n)return!0;for(e.tokens.push({type:"table_open",lines:h=[t,0],level:e.level++}),e.tokens.push({type:"thead_open",lines:[t,t+1],level:e.level++}),e.tokens.push({type:"tr_open",lines:[t,t+1],level:e.level++}),a=0;a<c.length;a++)e.tokens.push({type:"th_open",align:u[a],lines:[t,t+1],level:e.level++}),e.tokens.push({type:"inline",content:c[a].trim(),lines:[t,t+1],level:e.level,children:[]}),e.tokens.push({type:"th_close",level:--e.level});for(e.tokens.push({type:"tr_close",level:--e.level}),e.tokens.push({type:"thead_close",level:--e.level}),e.tokens.push({type:"tbody_open",lines:m=[t+2,0],level:e.level++}),l=t+2;l<s&&!(e.tShift[l]<e.blkIndent||(r=getLine(e,l).trim(),-1===r.indexOf("|")));l++){for(c=r.replace(/^\||\|$/g,"").split("|"),e.tokens.push({type:"tr_open",level:e.level++}),a=0;a<c.length;a++)e.tokens.push({type:"td_open",align:u[a],level:e.level++}),d=c[a].substring(124===c[a].charCodeAt(0)?1:0,124===c[a].charCodeAt(c[a].length-1)?c[a].length-1:c[a].length).trim(),e.tokens.push({type:"inline",content:d,level:e.level,children:[]}),e.tokens.push({type:"td_close",level:--e.level});e.tokens.push({type:"tr_close",level:--e.level})}return e.tokens.push({type:"tbody_close",level:--e.level}),e.tokens.push({type:"table_close",level:--e.level}),h[1]=m[1]=l,e.line=l,!0}function skipMarker(e,t){var s,n,i=e.bMarks[t]+e.tShift[t],r=e.eMarks[t];return i>=r||126!==(n=e.src.charCodeAt(i++))&&58!==n||i===(s=e.skipSpaces(i))||s>=r?-1:s}function markTightParagraphs$1(e,t){var s,n,i=e.level+2;for(s=t+2,n=e.tokens.length-2;s<n;s++)e.tokens[s].level===i&&"paragraph_open"===e.tokens[s].type&&(e.tokens[s+2].tight=!0,e.tokens[s].tight=!0,s+=2)}function deflist(e,t,s,n){var i,r,o,a,l,c,d,u,p,h,m,g,f,v;if(n)return!(e.ddIndent<0)&&skipMarker(e,t)>=0;if(d=t+1,e.isEmpty(d)&&++d>s||e.tShift[d]<e.blkIndent||(i=skipMarker(e,d))<0||e.level>=e.options.maxNesting)return!1;c=e.tokens.length,e.tokens.push({type:"dl_open",lines:l=[t,0],level:e.level++}),o=t,r=d;e:for(;;){for(v=!0,f=!1,e.tokens.push({type:"dt_open",lines:[o,o],level:e.level++}),e.tokens.push({type:"inline",content:e.getLines(o,o+1,e.blkIndent,!1).trim(),level:e.level+1,lines:[o,o],children:[]}),e.tokens.push({type:"dt_close",level:--e.level});;){if(e.tokens.push({type:"dd_open",lines:a=[d,0],level:e.level++}),g=e.tight,p=e.ddIndent,u=e.blkIndent,m=e.tShift[r],h=e.parentType,e.blkIndent=e.ddIndent=e.tShift[r]+2,e.tShift[r]=i-e.bMarks[r],e.tight=!0,e.parentType="deflist",e.parser.tokenize(e,r,s,!0),(!e.tight||f)&&(v=!1),f=e.line-r>1&&e.isEmpty(e.line-1),e.tShift[r]=m,e.tight=g,e.parentType=h,e.blkIndent=u,e.ddIndent=p,e.tokens.push({type:"dd_close",level:--e.level}),a[1]=d=e.line,d>=s||e.tShift[d]<e.blkIndent)break e;if((i=skipMarker(e,d))<0)break;r=d}if(d>=s||(o=d,e.isEmpty(o))||e.tShift[o]<e.blkIndent||(r=o+1)>=s||(e.isEmpty(r)&&r++,r>=s)||e.tShift[r]<e.blkIndent||(i=skipMarker(e,r))<0)break}return e.tokens.push({type:"dl_close",level:--e.level}),l[1]=d,e.line=d,v&&markTightParagraphs$1(e,c),!0}function paragraph(e,t){var s,n,i,r,o,a,l=t+1;if(l<(s=e.lineMax)&&!e.isEmpty(l))for(a=e.parser.ruler.getRules("paragraph");l<s&&!e.isEmpty(l);l++)if(!(e.tShift[l]-e.blkIndent>3)){for(i=!1,r=0,o=a.length;r<o;r++)if(a[r](e,l,s,!0)){i=!0;break}if(i)break}return n=e.getLines(t,l,e.blkIndent,!1).trim(),e.line=l,n.length&&(e.tokens.push({type:"paragraph_open",tight:!1,lines:[t,e.line],level:e.level}),e.tokens.push({type:"inline",content:n,level:e.level+1,lines:[t,e.line],children:[]}),e.tokens.push({type:"paragraph_close",tight:!1,level:e.level})),!0}var _rules$1=[["code",code],["fences",fences,["paragraph","blockquote","list"]],["blockquote",blockquote,["paragraph","blockquote","list"]],["hr",hr,["paragraph","blockquote","list"]],["list",list,["paragraph","blockquote"]],["footnote",footnote,["paragraph"]],["heading",heading,["paragraph","blockquote"]],["lheading",lheading],["htmlblock",htmlblock,["paragraph","blockquote"]],["table",table,["paragraph"]],["deflist",deflist,["paragraph"]],["paragraph",paragraph]];function ParserBlock(){this.ruler=new Ruler;for(var e=0;e<_rules$1.length;e++)this.ruler.push(_rules$1[e][0],_rules$1[e][1],{alt:(_rules$1[e][2]||[]).slice()})}ParserBlock.prototype.tokenize=function(e,t,s){for(var n,i=this.ruler.getRules(""),r=i.length,o=t,a=!1;o<s&&(e.line=o=e.skipEmptyLines(o),!(o>=s||e.tShift[o]<e.blkIndent));){for(n=0;n<r&&!i[n](e,o,s,!1);n++);if(e.tight=!a,e.isEmpty(e.line-1)&&(a=!0),(o=e.line)<s&&e.isEmpty(o)){if(a=!0,++o<s&&"list"===e.parentType&&e.isEmpty(o))break;e.line=o}}};var TABS_SCAN_RE=/[\n\t]/g,NEWLINES_RE=/\r[\n\u0085]|[\u2424\u2028\u0085]/g,SPACES_RE=/\u00a0/g;function isTerminatorChar(e){switch(e){case 10:case 92:case 96:case 42:case 95:case 94:case 91:case 93:case 33:case 38:case 60:case 62:case 123:case 125:case 36:case 37:case 64:case 126:case 43:case 61:case 58:return!0;default:return!1}}function text$1(e,t){for(var s=e.pos;s<e.posMax&&!isTerminatorChar(e.src.charCodeAt(s));)s++;return s!==e.pos&&(t||(e.pending+=e.src.slice(e.pos,s)),e.pos=s,!0)}function newline(e,t){var s,n,i=e.pos;if(10!==e.src.charCodeAt(i))return!1;if(s=e.pending.length-1,n=e.posMax,!t)if(s>=0&&32===e.pending.charCodeAt(s))if(s>=1&&32===e.pending.charCodeAt(s-1)){for(var r=s-2;r>=0;r--)if(32!==e.pending.charCodeAt(r)){e.pending=e.pending.substring(0,r+1);break}e.push({type:"hardbreak",level:e.level})}else e.pending=e.pending.slice(0,-1),e.push({type:"softbreak",level:e.level});else e.push({type:"softbreak",level:e.level});for(i++;i<n&&32===e.src.charCodeAt(i);)i++;return e.pos=i,!0}ParserBlock.prototype.parse=function(e,t,s,n){var i,r=0,o=0;if(!e)return[];(e=(e=e.replace(SPACES_RE," ")).replace(NEWLINES_RE,"\n")).indexOf("\t")>=0&&(e=e.replace(TABS_SCAN_RE,(function(t,s){var n;return 10===e.charCodeAt(s)?(r=s+1,o=0,t):(n="    ".slice((s-r-o)%4),o=s-r+1,n)}))),i=new StateBlock(e,this,t,s,n),this.tokenize(i,i.line,i.lineMax)};for(var ESCAPED=[],i=0;i<256;i++)ESCAPED.push(0);function escape(e,t){var s,n=e.pos,i=e.posMax;if(92!==e.src.charCodeAt(n))return!1;if(++n<i){if((s=e.src.charCodeAt(n))<256&&0!==ESCAPED[s])return t||(e.pending+=e.src[n]),e.pos+=2,!0;if(10===s){for(t||e.push({type:"hardbreak",level:e.level}),n++;n<i&&32===e.src.charCodeAt(n);)n++;return e.pos=n,!0}}return t||(e.pending+="\\"),e.pos++,!0}function backticks(e,t){var s,n,i,r,o,a=e.pos;if(96!==e.src.charCodeAt(a))return!1;for(s=a,a++,n=e.posMax;a<n&&96===e.src.charCodeAt(a);)a++;for(i=e.src.slice(s,a),r=o=a;-1!==(r=e.src.indexOf("`",o));){for(o=r+1;o<n&&96===e.src.charCodeAt(o);)o++;if(o-r===i.length)return t||e.push({type:"code",content:e.src.slice(a,r).replace(/[ \n]+/g," ").trim(),block:!1,level:e.level}),e.pos=o,!0}return t||(e.pending+=i),e.pos+=i.length,!0}function del(e,t){var s,n,i,r,o,a=e.posMax,l=e.pos;if(126!==e.src.charCodeAt(l)||t||l+4>=a||126!==e.src.charCodeAt(l+1)||e.level>=e.options.maxNesting||(r=l>0?e.src.charCodeAt(l-1):-1,o=e.src.charCodeAt(l+2),126===r)||126===o||32===o||10===o)return!1;for(n=l+2;n<a&&126===e.src.charCodeAt(n);)n++;if(n>l+3)return e.pos+=n-l,t||(e.pending+=e.src.slice(l,n)),!0;for(e.pos=l+2,i=1;e.pos+1<a;){if(126===e.src.charCodeAt(e.pos)&&126===e.src.charCodeAt(e.pos+1)&&(r=e.src.charCodeAt(e.pos-1),126!==(o=e.pos+2<a?e.src.charCodeAt(e.pos+2):-1)&&126!==r&&(32!==r&&10!==r?i--:32!==o&&10!==o&&i++,i<=0))){s=!0;break}e.parser.skipToken(e)}return s?(e.posMax=e.pos,e.pos=l+2,t||(e.push({type:"del_open",level:e.level++}),e.parser.tokenize(e),e.push({type:"del_close",level:--e.level})),e.pos=e.posMax+2,e.posMax=a,!0):(e.pos=l,!1)}function ins(e,t){var s,n,i,r,o,a=e.posMax,l=e.pos;if(43!==e.src.charCodeAt(l)||t||l+4>=a||43!==e.src.charCodeAt(l+1)||e.level>=e.options.maxNesting||(r=l>0?e.src.charCodeAt(l-1):-1,o=e.src.charCodeAt(l+2),43===r)||43===o||32===o||10===o)return!1;for(n=l+2;n<a&&43===e.src.charCodeAt(n);)n++;if(n!==l+2)return e.pos+=n-l,t||(e.pending+=e.src.slice(l,n)),!0;for(e.pos=l+2,i=1;e.pos+1<a;){if(43===e.src.charCodeAt(e.pos)&&43===e.src.charCodeAt(e.pos+1)&&(r=e.src.charCodeAt(e.pos-1),43!==(o=e.pos+2<a?e.src.charCodeAt(e.pos+2):-1)&&43!==r&&(32!==r&&10!==r?i--:32!==o&&10!==o&&i++,i<=0))){s=!0;break}e.parser.skipToken(e)}return s?(e.posMax=e.pos,e.pos=l+2,t||(e.push({type:"ins_open",level:e.level++}),e.parser.tokenize(e),e.push({type:"ins_close",level:--e.level})),e.pos=e.posMax+2,e.posMax=a,!0):(e.pos=l,!1)}function mark(e,t){var s,n,i,r,o,a=e.posMax,l=e.pos;if(61!==e.src.charCodeAt(l)||t||l+4>=a||61!==e.src.charCodeAt(l+1)||e.level>=e.options.maxNesting||(r=l>0?e.src.charCodeAt(l-1):-1,o=e.src.charCodeAt(l+2),61===r)||61===o||32===o||10===o)return!1;for(n=l+2;n<a&&61===e.src.charCodeAt(n);)n++;if(n!==l+2)return e.pos+=n-l,t||(e.pending+=e.src.slice(l,n)),!0;for(e.pos=l+2,i=1;e.pos+1<a;){if(61===e.src.charCodeAt(e.pos)&&61===e.src.charCodeAt(e.pos+1)&&(r=e.src.charCodeAt(e.pos-1),61!==(o=e.pos+2<a?e.src.charCodeAt(e.pos+2):-1)&&61!==r&&(32!==r&&10!==r?i--:32!==o&&10!==o&&i++,i<=0))){s=!0;break}e.parser.skipToken(e)}return s?(e.posMax=e.pos,e.pos=l+2,t||(e.push({type:"mark_open",level:e.level++}),e.parser.tokenize(e),e.push({type:"mark_close",level:--e.level})),e.pos=e.posMax+2,e.posMax=a,!0):(e.pos=l,!1)}function isAlphaNum(e){return e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122}function scanDelims(e,t){var s,n,i,r=t,o=!0,a=!0,l=e.posMax,c=e.src.charCodeAt(t);for(s=t>0?e.src.charCodeAt(t-1):-1;r<l&&e.src.charCodeAt(r)===c;)r++;return r>=l&&(o=!1),(i=r-t)>=4?o=a=!1:((32===(n=r<l?e.src.charCodeAt(r):-1)||10===n)&&(o=!1),(32===s||10===s)&&(a=!1),95===c&&(isAlphaNum(s)&&(o=!1),isAlphaNum(n)&&(a=!1))),{can_open:o,can_close:a,delims:i}}function emphasis(e,t){var s,n,i,r,o,a,l,c=e.posMax,d=e.pos,u=e.src.charCodeAt(d);if(95!==u&&42!==u||t)return!1;if(s=(l=scanDelims(e,d)).delims,!l.can_open)return e.pos+=s,t||(e.pending+=e.src.slice(d,e.pos)),!0;if(e.level>=e.options.maxNesting)return!1;for(e.pos=d+s,a=[s];e.pos<c;)if(e.src.charCodeAt(e.pos)!==u)e.parser.skipToken(e);else{if(n=(l=scanDelims(e,e.pos)).delims,l.can_close){for(r=a.pop(),o=n;r!==o;){if(o<r){a.push(r-o);break}if(o-=r,0===a.length)break;e.pos+=r,r=a.pop()}if(0===a.length){s=r,i=!0;break}e.pos+=n;continue}l.can_open&&a.push(n),e.pos+=n}return i?(e.posMax=e.pos,e.pos=d+s,t||((2===s||3===s)&&e.push({type:"strong_open",level:e.level++}),(1===s||3===s)&&e.push({type:"em_open",level:e.level++}),e.parser.tokenize(e),(1===s||3===s)&&e.push({type:"em_close",level:--e.level}),(2===s||3===s)&&e.push({type:"strong_close",level:--e.level})),e.pos=e.posMax+s,e.posMax=c,!0):(e.pos=d,!1)}"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach((function(e){ESCAPED[e.charCodeAt(0)]=1}));var UNESCAPE_RE=/\\([ \\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;function sub(e,t){var s,n,i=e.posMax,r=e.pos;if(126!==e.src.charCodeAt(r)||t||r+2>=i||e.level>=e.options.maxNesting)return!1;for(e.pos=r+1;e.pos<i;){if(126===e.src.charCodeAt(e.pos)){s=!0;break}e.parser.skipToken(e)}return!s||r+1===e.pos||(n=e.src.slice(r+1,e.pos)).match(/(^|[^\\])(\\\\)*\s/)?(e.pos=r,!1):(e.posMax=e.pos,e.pos=r+1,t||e.push({type:"sub",level:e.level,content:n.replace(UNESCAPE_RE,"$1")}),e.pos=e.posMax+1,e.posMax=i,!0)}var UNESCAPE_RE$1=/\\([ \\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;function sup(e,t){var s,n,i=e.posMax,r=e.pos;if(94!==e.src.charCodeAt(r)||t||r+2>=i||e.level>=e.options.maxNesting)return!1;for(e.pos=r+1;e.pos<i;){if(94===e.src.charCodeAt(e.pos)){s=!0;break}e.parser.skipToken(e)}return!s||r+1===e.pos||(n=e.src.slice(r+1,e.pos)).match(/(^|[^\\])(\\\\)*\s/)?(e.pos=r,!1):(e.posMax=e.pos,e.pos=r+1,t||e.push({type:"sup",level:e.level,content:n.replace(UNESCAPE_RE$1,"$1")}),e.pos=e.posMax+1,e.posMax=i,!0)}function links(e,t){var s,n,i,r,o,a,l,c,d=!1,u=e.pos,p=e.posMax,h=e.pos,m=e.src.charCodeAt(h);if(33===m&&(d=!0,m=e.src.charCodeAt(++h)),91!==m||e.level>=e.options.maxNesting||(s=h+1,(n=parseLinkLabel(e,h))<0))return!1;if((a=n+1)<p&&40===e.src.charCodeAt(a)){for(a++;a<p&&(32===(c=e.src.charCodeAt(a))||10===c);a++);if(a>=p)return!1;for(h=a,parseLinkDestination(e,a)?(r=e.linkContent,a=e.pos):r="",h=a;a<p&&(32===(c=e.src.charCodeAt(a))||10===c);a++);if(a<p&&h!==a&&parseLinkTitle(e,a))for(o=e.linkContent,a=e.pos;a<p&&(32===(c=e.src.charCodeAt(a))||10===c);a++);else o="";if(a>=p||41!==e.src.charCodeAt(a))return e.pos=u,!1;a++}else{if(e.linkLevel>0)return!1;for(;a<p&&(32===(c=e.src.charCodeAt(a))||10===c);a++);if(a<p&&91===e.src.charCodeAt(a)&&(h=a+1,(a=parseLinkLabel(e,a))>=0?i=e.src.slice(h,a++):a=h-1),i||(typeof i>"u"&&(a=n+1),i=e.src.slice(s,n)),!(l=e.env.references[normalizeReference(i)]))return e.pos=u,!1;r=l.href,o=l.title}return t||(e.pos=s,e.posMax=n,d?e.push({type:"image",src:r,title:o,alt:e.src.substr(s,n-s),level:e.level}):(e.push({type:"link_open",href:r,title:o,level:e.level++}),e.linkLevel++,e.parser.tokenize(e),e.linkLevel--,e.push({type:"link_close",level:--e.level}))),e.pos=a,e.posMax=p,!0}function footnote_inline(e,t){var s,n,i,r,o=e.posMax,a=e.pos;return!(a+2>=o||94!==e.src.charCodeAt(a)||91!==e.src.charCodeAt(a+1)||e.level>=e.options.maxNesting||(s=a+2,n=parseLinkLabel(e,a+1),n<0))&&(t||(e.env.footnotes||(e.env.footnotes={}),e.env.footnotes.list||(e.env.footnotes.list=[]),i=e.env.footnotes.list.length,e.pos=s,e.posMax=n,e.push({type:"footnote_ref",id:i,level:e.level}),e.linkLevel++,r=e.tokens.length,e.parser.tokenize(e),e.env.footnotes.list[i]={tokens:e.tokens.splice(r)},e.linkLevel--),e.pos=n+1,e.posMax=o,!0)}function footnote_ref(e,t){var s,n,i,r,o=e.posMax,a=e.pos;if(a+3>o||!e.env.footnotes||!e.env.footnotes.refs||91!==e.src.charCodeAt(a)||94!==e.src.charCodeAt(a+1)||e.level>=e.options.maxNesting)return!1;for(n=a+2;n<o;n++){if(32===e.src.charCodeAt(n)||10===e.src.charCodeAt(n))return!1;if(93===e.src.charCodeAt(n))break}return!(n===a+2||n>=o||(n++,s=e.src.slice(a+2,n-1),typeof e.env.footnotes.refs[":"+s]>"u"))&&(t||(e.env.footnotes.list||(e.env.footnotes.list=[]),e.env.footnotes.refs[":"+s]<0?(i=e.env.footnotes.list.length,e.env.footnotes.list[i]={label:s,count:0},e.env.footnotes.refs[":"+s]=i):i=e.env.footnotes.refs[":"+s],r=e.env.footnotes.list[i].count,e.env.footnotes.list[i].count++,e.push({type:"footnote_ref",id:i,subId:r,level:e.level})),e.pos=n,e.posMax=o,!0)}var url_schemas=["coap","doi","javascript","aaa","aaas","about","acap","cap","cid","crid","data","dav","dict","dns","file","ftp","geo","go","gopher","h323","http","https","iax","icap","im","imap","info","ipp","iris","iris.beep","iris.xpc","iris.xpcs","iris.lwz","ldap","mailto","mid","msrp","msrps","mtqp","mupdate","news","nfs","ni","nih","nntp","opaquelocktoken","pop","pres","rtsp","service","session","shttp","sieve","sip","sips","sms","snmp","soap.beep","soap.beeps","tag","tel","telnet","tftp","thismessage","tn3270","tip","tv","urn","vemmi","ws","wss","xcon","xcon-userid","xmlrpc.beep","xmlrpc.beeps","xmpp","z39.50r","z39.50s","adiumxtra","afp","afs","aim","apt","attachment","aw","beshare","bitcoin","bolo","callto","chrome","chrome-extension","com-eventbrite-attendee","content","cvs","dlna-playsingle","dlna-playcontainer","dtn","dvb","ed2k","facetime","feed","finger","fish","gg","git","gizmoproject","gtalk","hcp","icon","ipn","irc","irc6","ircs","itms","jar","jms","keyparc","lastfm","ldaps","magnet","maps","market","message","mms","ms-help","msnim","mumble","mvn","notes","oid","palm","paparazzi","platform","proxy","psyc","query","res","resource","rmi","rsync","rtmp","secondlife","sftp","sgn","skype","smb","soldat","spotify","ssh","steam","svn","teamspeak","things","udp","unreal","ut2004","ventrilo","view-source","webcal","wtai","wyciwyg","xfire","xri","ymsgr"],EMAIL_RE=/^<([a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)>/,AUTOLINK_RE=/^<([a-zA-Z.\-]{1,25}):([^<>\x00-\x20]*)>/;function autolink(e,t){var s,n,i,r,o,a=e.pos;return!(60!==e.src.charCodeAt(a)||(s=e.src.slice(a),s.indexOf(">")<0))&&((n=s.match(AUTOLINK_RE))?!(url_schemas.indexOf(n[1].toLowerCase())<0||(r=n[0].slice(1,-1),o=normalizeLink(r),!e.parser.validateLink(r)))&&(t||(e.push({type:"link_open",href:o,level:e.level}),e.push({type:"text",content:r,level:e.level+1}),e.push({type:"link_close",level:e.level})),e.pos+=n[0].length,!0):!!(i=s.match(EMAIL_RE))&&(o=normalizeLink("mailto:"+(r=i[0].slice(1,-1))),!!e.parser.validateLink(o)&&(t||(e.push({type:"link_open",href:o,level:e.level}),e.push({type:"text",content:r,level:e.level+1}),e.push({type:"link_close",level:e.level})),e.pos+=i[0].length,!0)))}function replace$1(e,t){return e=e.source,t=t||"",function s(n,i){return n?(i=i.source||i,e=e.replace(n,i),s):new RegExp(e,t)}}var attr_name=/[a-zA-Z_:][a-zA-Z0-9:._-]*/,unquoted=/[^"'=<>`\x00-\x20]+/,single_quoted=/'[^']*'/,double_quoted=/"[^"]*"/,attr_value=replace$1(/(?:unquoted|single_quoted|double_quoted)/)("unquoted",unquoted)("single_quoted",single_quoted)("double_quoted",double_quoted)(),attribute=replace$1(/(?:\s+attr_name(?:\s*=\s*attr_value)?)/)("attr_name",attr_name)("attr_value",attr_value)(),open_tag=replace$1(/<[A-Za-z][A-Za-z0-9]*attribute*\s*\/?>/)("attribute",attribute)(),close_tag=/<\/[A-Za-z][A-Za-z0-9]*\s*>/,comment=/<!---->|<!--(?:-?[^>-])(?:-?[^-])*-->/,processing=/<[?].*?[?]>/,declaration=/<![A-Z]+\s+[^>]*>/,cdata=/<!\[CDATA\[[\s\S]*?\]\]>/,HTML_TAG_RE=replace$1(/^(?:open_tag|close_tag|comment|processing|declaration|cdata)/)("open_tag",open_tag)("close_tag",close_tag)("comment",comment)("processing",processing)("declaration",declaration)("cdata",cdata)();function isLetter$2(e){var t=32|e;return t>=97&&t<=122}function htmltag(e,t){var s,n,i,r=e.pos;return!(!e.options.html||(i=e.posMax,60!==e.src.charCodeAt(r)||r+2>=i)||(s=e.src.charCodeAt(r+1),33!==s&&63!==s&&47!==s&&!isLetter$2(s))||(n=e.src.slice(r).match(HTML_TAG_RE),!n))&&(t||e.push({type:"htmltag",content:e.src.slice(r,r+n[0].length),level:e.level}),e.pos+=n[0].length,!0)}var DIGITAL_RE=/^&#((?:x[a-f0-9]{1,8}|[0-9]{1,8}));/i,NAMED_RE=/^&([a-z][a-z0-9]{1,31});/i;function entity(e,t){var s,n,i=e.pos,r=e.posMax;if(38!==e.src.charCodeAt(i))return!1;if(i+1<r)if(35===e.src.charCodeAt(i+1)){if(n=e.src.slice(i).match(DIGITAL_RE))return t||(s="x"===n[1][0].toLowerCase()?parseInt(n[1].slice(1),16):parseInt(n[1],10),e.pending+=isValidEntityCode(s)?fromCodePoint(s):fromCodePoint(65533)),e.pos+=n[0].length,!0}else if(n=e.src.slice(i).match(NAMED_RE)){var o=decodeEntity(n[1]);if(n[1]!==o)return t||(e.pending+=o),e.pos+=n[0].length,!0}return t||(e.pending+="&"),e.pos++,!0}var _rules$2=[["text",text$1],["newline",newline],["escape",escape],["backticks",backticks],["del",del],["ins",ins],["mark",mark],["emphasis",emphasis],["sub",sub],["sup",sup],["links",links],["footnote_inline",footnote_inline],["footnote_ref",footnote_ref],["autolink",autolink],["htmltag",htmltag],["entity",entity]];function ParserInline(){this.ruler=new Ruler;for(var e=0;e<_rules$2.length;e++)this.ruler.push(_rules$2[e][0],_rules$2[e][1]);this.validateLink=validateLink}function validateLink(e){var t=e.trim().toLowerCase();return!(-1!==(t=replaceEntities(t)).indexOf(":")&&-1!==["vbscript","javascript","file","data"].indexOf(t.split(":")[0]))}ParserInline.prototype.skipToken=function(e){var t,s,n=this.ruler.getRules(""),i=n.length,r=e.pos;if((s=e.cacheGet(r))>0)e.pos=s;else{for(t=0;t<i;t++)if(n[t](e,!0))return void e.cacheSet(r,e.pos);e.pos++,e.cacheSet(r,e.pos)}},ParserInline.prototype.tokenize=function(e){for(var t,s,n=this.ruler.getRules(""),i=n.length,r=e.posMax;e.pos<r;){for(s=0;s<i&&!(t=n[s](e,!1));s++);if(t){if(e.pos>=r)break}else e.pending+=e.src[e.pos++]}e.pending&&e.pushPending()},ParserInline.prototype.parse=function(e,t,s,n){var i=new StateInline(e,this,t,s,n);this.tokenize(i)};var defaultConfig={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"\u201c\u201d\u2018\u2019",highlight:null,maxNesting:20},components:{core:{rules:["block","inline","references","replacements","smartquotes","references","abbr2","footnote_tail"]},block:{rules:["blockquote","code","fences","footnote","heading","hr","htmlblock","lheading","list","paragraph","table"]},inline:{rules:["autolink","backticks","del","emphasis","entity","escape","footnote_ref","htmltag","links","newline","text"]}}},fullConfig={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"\u201c\u201d\u2018\u2019",highlight:null,maxNesting:20},components:{core:{},block:{},inline:{}}},commonmarkConfig={options:{html:!0,xhtmlOut:!0,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"\u201c\u201d\u2018\u2019",highlight:null,maxNesting:20},components:{core:{rules:["block","inline","references","abbr2"]},block:{rules:["blockquote","code","fences","heading","hr","htmlblock","lheading","list","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","htmltag","links","newline","text"]}}},config={default:defaultConfig,full:fullConfig,commonmark:commonmarkConfig};function StateCore(e,t,s){this.src=t,this.env=s,this.options=e.options,this.tokens=[],this.inlineMode=!1,this.inline=e.inline,this.block=e.block,this.renderer=e.renderer,this.typographer=e.typographer}function Remarkable(e,t){"string"!=typeof e&&(t=e,e="default"),t&&null!=t.linkify&&console.warn("linkify option is removed. Use linkify plugin instead:\n\nimport Remarkable from 'remarkable';\nimport linkify from 'remarkable/linkify';\nnew Remarkable().use(linkify)\n"),this.inline=new ParserInline,this.block=new ParserBlock,this.core=new Core,this.renderer=new Renderer,this.ruler=new Ruler,this.options={},this.configure(config[e]),this.set(t||{})}Remarkable.prototype.set=function(e){assign(this.options,e)},Remarkable.prototype.configure=function(e){var t=this;if(!e)throw new Error("Wrong `remarkable` preset, check name/content");e.options&&t.set(e.options),e.components&&Object.keys(e.components).forEach((function(s){e.components[s].rules&&t[s].ruler.enable(e.components[s].rules,!0)}))},Remarkable.prototype.use=function(e,t){return e(this,t),this},Remarkable.prototype.parse=function(e,t){var s=new StateCore(this,e,t);return this.core.process(s),s.tokens},Remarkable.prototype.render=function(e,t){return t=t||{},this.renderer.render(this.parse(e,t),this.options,t)},Remarkable.prototype.parseInline=function(e,t){var s=new StateCore(this,e,t);return s.inlineMode=!0,this.core.process(s),s.tokens},Remarkable.prototype.renderInline=function(e,t){return t=t||{},this.renderer.render(this.parseInline(e,t),this.options,t)};class RemarkableConfig{static createNew(){const e=window.hljs;return e?new Remarkable({highlight:function(t,s){if(s&&e.getLanguage(s))try{return e.highlight(s,t).value}catch{console.error("failed to setup the highlight dependency")}try{return e.highlightAuto(t).value}catch{console.error("failed to automatically highlight messages")}return""},html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!0}):new Remarkable}}class SetFileTypes{static parseConfig(e,t,s,n){var i;const r={files:t};if("object"==typeof n){const{files:t,request:o,button:a}=n;t&&(t.infoModal&&(r.files.infoModal=t.infoModal,null!=(i=t.infoModal)&&i.textMarkDown&&(r.infoModalTextMarkUp=s.render(t.infoModal.textMarkDown))),t.acceptedFormats&&(r.files.acceptedFormats=t.acceptedFormats),t.maxNumberOfFiles&&(r.files.maxNumberOfFiles=t.maxNumberOfFiles)),r.button=a,o&&(o.headers||o.method||o.url||e.headers||e.method||e.url)&&(r.request={headers:(null==o?void 0:o.headers)||e.headers,method:(null==o?void 0:o.method)||e.method,url:(null==o?void 0:o.url)||e.url})}return r}static processMixedFiles(e,t,s){if(s){const n={acceptedFormats:""};e.fileTypes.mixedFiles=SetFileTypes.parseConfig(e.requestSettings,n,t,s)}}static processMicrophone(e,t,s,n){var i,r,o,a,l,c;const d={acceptedFormats:"audio/*",...(null==(i=e.fileTypes.audio)?void 0:i.files)||{}};s&&(void 0!==navigator.mediaDevices.getUserMedia?(e.recordAudio=SetFileTypes.parseConfig(e.requestSettings,d,t,s),"object"==typeof s&&s.files&&((r=e.recordAudio).files??(r.files={}),e.recordAudio.files.format=null==(o=s.files)?void 0:o.format,e.recordAudio.files.maxDurationSeconds=null==(a=s.files)?void 0:a.maxDurationSeconds,null!=(l=e.fileTypes.audio)&&l.files&&((c=e.fileTypes.audio.files).maxNumberOfFiles??(c.maxNumberOfFiles=s.files.maxNumberOfFiles)))):n||(e.fileTypes.audio=SetFileTypes.parseConfig(e.requestSettings,d,t,s)))}static processAudioConfig(e,t,s,n){if(!s&&!n)return;const i={acceptedFormats:"audio/*",...(null==n?void 0:n.files)||{}};e.fileTypes.audio=SetFileTypes.parseConfig(e.requestSettings,i,t,s)}static processGifConfig(e,t,s,n){if(!s&&!n)return;const i={acceptedFormats:"image/gif",...(null==n?void 0:n.files)||{}};e.fileTypes.gifs=SetFileTypes.parseConfig(e.requestSettings,i,t,s)}static processCamera(e,t,s,n){var i,r,o,a;const l={acceptedFormats:"image/*",...(null==(i=e.fileTypes.images)?void 0:i.files)||{}};s&&(void 0!==navigator.mediaDevices.getUserMedia?(e.camera=SetFileTypes.parseConfig(e.requestSettings,l,t,s),"object"==typeof s&&(e.camera.modalContainerStyle=s.modalContainerStyle,s.files&&((r=e.camera).files??(r.files={}),e.camera.files.format=null==(o=s.files)?void 0:o.format,e.camera.files.dimensions=null==(a=s.files)?void 0:a.dimensions))):n||(e.fileTypes.images=SetFileTypes.parseConfig(e.requestSettings,l,t,s)))}static processImagesConfig(e,t,s,n){if(!s&&!n)return;const i={acceptedFormats:"image/*",...(null==n?void 0:n.files)||{}};e.fileTypes.images=SetFileTypes.parseConfig(e.requestSettings,i,t,s)}static populateDefaultFileIO(e,t){var s,n;e&&(e.files??(e.files={}),(s=e.files).acceptedFormats??(s.acceptedFormats=t),(n=e.files).maxNumberOfFiles??(n.maxNumberOfFiles=1))}static set(e,t,s){SetFileTypes.populateDefaultFileIO(null==s?void 0:s.audio,".4a,.mp3,.webm,.mp4,.mpga,.wav,.mpeg,.m4a"),SetFileTypes.populateDefaultFileIO(null==s?void 0:s.images,".png,.jpg");const n=RemarkableConfig.createNew();SetFileTypes.processImagesConfig(t,n,e.images,null==s?void 0:s.images),SetFileTypes.processCamera(t,n,e.camera,e.images),SetFileTypes.processGifConfig(t,n,e.gifs,null==s?void 0:s.gifs),SetFileTypes.processAudioConfig(t,n,e.audio,null==s?void 0:s.audio),SetFileTypes.processMicrophone(t,n,e.microphone,e.audio),SetFileTypes.processMixedFiles(t,n,e.mixedFiles)}}class BaseServiceIO{constructor(e,t,s){var n,i,r,o;this.rawBody={},this.validateConfigKey=!1,this.canSendMessage=BaseServiceIO.canSendMessage,this.requestSettings={},this.fileTypes={},this._isStream=!1,this.completionsHandlers={},this.streamHandlers={},this.deepChat=e,this.demo=s,Object.assign(this.rawBody,null==(n=e.request)?void 0:n.additionalBodyProps),this._isStream=!!e.stream,this.totalMessagesMaxCharLength=null==(i=null==e?void 0:e.requestBodyLimits)?void 0:i.totalMessagesMaxCharLength,this.maxMessages=null==(r=null==e?void 0:e.requestBodyLimits)?void 0:r.maxMessages,SetFileTypes.set(e,this,t),e.request&&(this.requestSettings=e.request),this.demo&&((o=this.requestSettings).url??(o.url=Demo.URL)),this._directServiceRequiresFiles=!!t&&Object.keys(t).length>0,this.requestSettings.websocket&&Websocket.setup(this,this.requestSettings.websocket)}static canSendMessage(e,t){return!(!e||""===e.trim())||!!(t&&t.length>0)}verifyKey(e,t){}static createCustomFormDataBody(e,t,s){const n=new FormData;s.forEach((e=>n.append("files",e))),Object.keys(e).forEach((t=>n.append(t,String(e[t]))));let i=0;return t.forEach((e=>{e.text&&n.append(`message${i+=1}`,JSON.stringify(e))})),n}getServiceIOByType(e){if(e.type.startsWith("audio")&&this.fileTypes.audio)return this.fileTypes.audio;if(e.type.startsWith("image")){if(this.fileTypes.gifs&&e.type.endsWith("/gif"))return this.fileTypes.gifs;if(this.fileTypes.images)return this.fileTypes.images;if(this.camera)return this.camera}return this.fileTypes.mixedFiles}callServiceAPI(e,t,s){var n,i,r,o;const a={messages:t,...this.rawBody};let l=!1;null!=(n=this.requestSettings.headers)&&n["Content-Type"]||((i=this.requestSettings).headers??(i.headers={}),(r=this.requestSettings.headers)["Content-Type"]??(r["Content-Type"]="application/json"),l=!0),this._isStream?HTTPRequest.requestStream(this,a,e):HTTPRequest.request(this,a,e),l&&(null==(o=this.requestSettings.headers)||delete o["Content-Type"])}callApiWithFiles(e,t,s,n){const i=BaseServiceIO.createCustomFormDataBody(e,s,n),r=this.requestSettings,o=this.getServiceIOByType(n[0]);this.requestSettings=(null==o?void 0:o.request)||this.requestSettings,HTTPRequest.request(this,i,t,!1),this.requestSettings=r}callAPI(e,t){if(!this.requestSettings)throw new Error("Request settings have not been set up");const s=MessageLimitUtils.processMessages(e,t.messages,this.maxMessages,this.totalMessagesMaxCharLength);if(this.websocket){const e={messages:s,...this.rawBody};Websocket.sendWebsocket(this.websocket,this,e,t,!1)}else e.files&&!this._directServiceRequiresFiles?this.callApiWithFiles(this.rawBody,t,s,e.files):this.callServiceAPI(t,s,e.files)}async extractResultData(e){if(e.error)throw e.error;return e.result}}class DirectServiceIO extends BaseServiceIO{constructor(e,t,s,n,i){var r;super(e,i),this.insertKeyPlaceholderText="API Key",this.getKeyLink="",Object.assign(this.rawBody,null==(r=e.request)?void 0:r.additionalBodyProps),this.keyVerificationDetails=t,this.buildHeadersFunc=s,n&&this.setApiKeyProperties(n),this.requestSettings=this.buildRequestSettings(this.key||"",e.request)}setApiKeyProperties(e){this.key=e.key,e.validateKeyProperty&&(this.validateConfigKey=e.validateKeyProperty)}buildRequestSettings(e,t){const s=t??{};return s.headers=this.buildHeadersFunc(e),s}keyAuthenticated(e,t){this.requestSettings=this.buildRequestSettings(t,this.requestSettings),this.key=t,e()}verifyKey(e,t){const{url:s,method:n,handleVerificationResult:i,createHeaders:r,body:o}=this.keyVerificationDetails,a=(null==r?void 0:r(e))||this.buildHeadersFunc(e);HTTPRequest.verifyKey(e,s,a,n,this.keyAuthenticated.bind(this,t.onSuccess),t.onFail,t.onLoad,i,o)}}class RenderControl{static waitForPropertiesToBeUpdatedBeforeRender(e){e._propUpdated_=!1,setTimeout((()=>{e._propUpdated_?RenderControl.waitForPropertiesToBeUpdatedBeforeRender(e):(e._waitingToRender_=!1,e.onRender())}))}static attemptRender(e){e._propUpdated_=!0,e._waitingToRender_||(e._waitingToRender_=!0,RenderControl.waitForPropertiesToBeUpdatedBeforeRender(e))}}const _InternalHTML=class extends HTMLElement{constructor(){super(),this._waitingToRender_=!1,this._propUpdated_=!1,Object.keys(_InternalHTML._attributeToProperty_).forEach((e=>{this.constructPropertyAccessors(_InternalHTML._attributeToProperty_[e])}))}static get observedAttributes(){return Object.keys(_InternalHTML._attributes_)||[]}constructPropertyAccessors(e){let t;Object.defineProperty(this,e,{get:function(){return t},set:function(e){t=e,RenderControl.attemptRender(this)}})}attributeChangedCallback(e,t,s){if(t===s)return;const n=_InternalHTML._attributes_[e](s);this[_InternalHTML._attributeToProperty_[e]]=n}onRender(){}};let InternalHTML=_InternalHTML;InternalHTML._attributes_={},InternalHTML._attributeToProperty_={};const NOT_VISIBLE_ICON_STRING='<?xml version="1.0" standalone="no"?>\n<svg version="1.1"\n\txmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n\txmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="0.9em" height="0.9em"\n\tviewBox="0 0 1200 1200" enable-background="new 0 0 1200 1200">\n\t\t<path d="\n\t\t\tM669.727,273.516c-22.891-2.476-46.15-3.895-69.727-4.248c-103.025,0.457-209.823,25.517-310.913,73.536\n\t\t\tc-75.058,37.122-148.173,89.529-211.67,154.174C46.232,529.978,6.431,577.76,0,628.74c0.76,44.162,48.153,98.67,77.417,131.764\n\t\t\tc59.543,62.106,130.754,113.013,211.67,154.174c2.75,1.335,5.51,2.654,8.276,3.955l-75.072,131.102l102.005,60.286l551.416-960.033\n\t\t\tl-98.186-60.008L669.727,273.516z M902.563,338.995l-74.927,129.857c34.47,44.782,54.932,100.006,54.932,159.888\n\t\t\tc0,149.257-126.522,270.264-282.642,270.264c-6.749,0-13.29-0.728-19.922-1.172l-49.585,85.84c22.868,2.449,45.99,4.233,69.58,4.541\n\t\t\tc103.123-0.463,209.861-25.812,310.84-73.535c75.058-37.122,148.246-89.529,211.743-154.174\n\t\t\tc31.186-32.999,70.985-80.782,77.417-131.764c-0.76-44.161-48.153-98.669-77.417-131.763\n\t\t\tc-59.543-62.106-130.827-113.013-211.743-154.175C908.108,341.478,905.312,340.287,902.563,338.995L902.563,338.995z\n\t\t\tM599.927,358.478c6.846,0,13.638,0.274,20.361,0.732l-58.081,100.561c-81.514,16.526-142.676,85.88-142.676,168.897\n\t\t\tc0,20.854,3.841,40.819,10.913,59.325c0.008,0.021-0.008,0.053,0,0.074l-58.228,100.854\n\t\t\tc-34.551-44.823-54.932-100.229-54.932-160.182C317.285,479.484,443.808,358.477,599.927,358.478L599.927,358.478z M768.896,570.513\n\t\t\tL638.013,797.271c81.076-16.837,141.797-85.875,141.797-168.603C779.81,608.194,775.724,588.729,768.896,570.513L768.896,570.513z"\n\t\t\t/>\n</svg>\n',VISIBLE_ICON_STRING='<?xml version="1.0" standalone="no"?>\n<svg version="1.1"\n\txmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n\txmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="0.9em" height="0.9em"\n\tviewBox="0 0 1200 1200" enable-background="new 0 0 1200 1200">\n\t\t<path id="path6686" inkscape:connector-curvature="0" d="M779.843,599.925c0,95.331-80.664,172.612-180.169,172.612\n\t\t\tc-99.504,0-180.168-77.281-180.168-172.612c0-95.332,80.664-172.612,180.168-172.612\n\t\t\tC699.179,427.312,779.843,504.594,779.843,599.925z M600,240.521c-103.025,0.457-209.814,25.538-310.904,73.557\n\t\t\tc-75.058,37.122-148.206,89.496-211.702,154.141C46.208,501.218,6.431,549,0,599.981c0.76,44.161,48.13,98.669,77.394,131.763\n\t\t\tc59.543,62.106,130.786,113.018,211.702,154.179c94.271,45.751,198.616,72.092,310.904,73.557\n\t\t\tc103.123-0.464,209.888-25.834,310.866-73.557c75.058-37.122,148.243-89.534,211.74-154.179\n\t\t\tc31.185-32.999,70.962-80.782,77.394-131.763c-0.76-44.161-48.13-98.671-77.394-131.764\n\t\t\tc-59.543-62.106-130.824-112.979-211.74-154.141C816.644,268.36,712.042,242.2,600,240.521z M599.924,329.769\n\t\t\tc156.119,0,282.675,120.994,282.675,270.251c0,149.256-126.556,270.25-282.675,270.25S317.249,749.275,317.249,600.02\n\t\t\tC317.249,450.763,443.805,329.769,599.924,329.769L599.924,329.769z"/>\n</svg>\n';class SVGIconUtils{static createSVGElement(e){return(new DOMParser).parseFromString(e,"image/svg+xml").documentElement}}const _VisibilityIcon=class{static changeVisibility(e,t,s,n){n.target.id===_VisibilityIcon.VISIBLE_ICON_ID?(t.style.display="none",s.style.display="block",e.type="password"):(t.style.display="block",s.style.display="none",e.type="text")}static createIconElement(e,t){const s=SVGIconUtils.createSVGElement(e);return s.id=t,s.classList.add("visibility-icon"),s}static create(e){const t=document.createElement("div");t.id="visibility-icon-container";const s=_VisibilityIcon.createIconElement(VISIBLE_ICON_STRING,_VisibilityIcon.VISIBLE_ICON_ID);s.style.display="none",t.appendChild(s);const n=_VisibilityIcon.createIconElement(NOT_VISIBLE_ICON_STRING,"not-visible-icon");return t.appendChild(n),t.onclick=_VisibilityIcon.changeVisibility.bind(this,e,s,n),t}};let VisibilityIcon=_VisibilityIcon;VisibilityIcon.VISIBLE_ICON_ID="visible-icon";class InsertKeyView{static createCautionText(){const e=document.createElement("a");return e.classList.add("insert-key-input-help-text"),e.innerText="Please exercise CAUTION when inserting your API key outside of deepchat.dev or localhost!!",e}static createHelpLink(e){const t=document.createElement("a");return t.classList.add("insert-key-input-help-text"),t.href=e,t.innerText="Find more info here",t.target="_blank",t}static createFailText(){const e=document.createElement("div");return e.id="insert-key-input-invalid-text",e.style.display="none",e}static createHelpTextContainer(e){const t=document.createElement("div");t.id="insert-key-help-text-container";const s=document.createElement("div");s.id="insert-key-help-text-contents";const n=InsertKeyView.createFailText();if(s.appendChild(n),e){const t=InsertKeyView.createHelpLink(e);s.appendChild(t)}const i=InsertKeyView.createCautionText();return s.appendChild(i),t.appendChild(s),{helpTextContainerElement:t,failTextElement:n}}static onFail(e,t,s,n){e.classList.replace("insert-key-input-valid","insert-key-input-invalid"),s.innerText=n,s.style.display="block",t.innerText="Start",e.classList.remove("loading")}static onLoad(e,t){e.classList.add("loading"),t.innerHTML='<div id="loading-ring"></div>'}static verifyKey(e,t,s){const n=e.value.trim();s.verifyKey(n,t)}static addVerificationEvents(e,t,s,n,i){const r={onSuccess:n,onFail:InsertKeyView.onFail.bind(this,e,t,s),onLoad:InsertKeyView.onLoad.bind(this,e,t)},o=InsertKeyView.verifyKey.bind(this,e,r,i);t.onclick=o,e.onkeydown=t=>{!e.classList.contains("loading")&&t.key===KEYBOARD_KEY.ENTER&&o()}}static createStartButton(){const e=document.createElement("div");return e.id="start-button",e.innerText="Start",e}static onInputFocus(e){e.target.classList.replace("insert-key-input-invalid","insert-key-input-valid")}static createInput(e){const t=document.createElement("div");t.id="insert-key-input-container";const s=document.createElement("input");return s.id="insert-key-input",s.placeholder=e||"API Key",s.type="password",s.classList.add("insert-key-input-valid"),s.onfocus=InsertKeyView.onInputFocus,t.appendChild(s),t}static createContents(e,t){const s=document.createElement("div");s.id="insert-key-contents";const n=InsertKeyView.createInput(t.insertKeyPlaceholderText),i=n.children[0],r=VisibilityIcon.create(i);n.appendChild(r),s.appendChild(n);const o=InsertKeyView.createStartButton(),{helpTextContainerElement:a,failTextElement:l}=InsertKeyView.createHelpTextContainer(t.getKeyLink);return s.appendChild(o),s.appendChild(a),InsertKeyView.addVerificationEvents(i,o,l,e,t),s}static createElements(e,t){const s=document.createElement("div");s.id="insert-key-view";const n=InsertKeyView.createContents(e,t);return s.appendChild(n),s}static render(e,t,s){const n=InsertKeyView.createElements(t,s);e.replaceChildren(n)}}class HuggingFaceUtils{static buildHeaders(e){return{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}static handleVerificationResult(e,t,s,n){const i=e;Array.isArray(i.error)&&"Error in `parameters`: field required"===i.error[0]?s(t):n(ErrorMessages.INVALID_KEY)}static buildKeyVerificationDetails(){return{url:"https://api-inference.huggingface.co/models/gpt2",method:"POST",handleVerificationResult:HuggingFaceUtils.handleVerificationResult}}}const _HuggingFaceIO=class extends DirectServiceIO{constructor(e,t,s,n,i,r){super(e,HuggingFaceUtils.buildKeyVerificationDetails(),HuggingFaceUtils.buildHeaders,i,r),this.insertKeyPlaceholderText="Hugging Face Token",this.getKeyLink="https://huggingface.co/settings/tokens",this.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Hugging Face</b></div>\n    <p>First message may take an extented amount of time to complete as the model needs to be initialized.</p>',this.permittedErrorPrefixes=["Authorization header"],this.url=`${_HuggingFaceIO.URL_PREFIX}${s}`,this.textInputPlaceholderText=t,"object"==typeof n&&(n.model&&(this.url=`${_HuggingFaceIO.URL_PREFIX}${n.model}`),n.options&&(this.rawBody.options=n.options),n.parameters&&(this.rawBody.parameters=n.parameters))}preprocessBody(e,t,s){const n=JSON.parse(JSON.stringify(e)),i=t[t.length-1].text;if(i)return n.options??(n.options={}),n.options.wait_for_model=!0,{inputs:i,...n}}callServiceAPI(e,t,s){if(!this.requestSettings)throw new Error("Request settings have not been set up");const n=this.preprocessBody(this.rawBody,t,s);HTTPRequest.request(this,n,e)}};let HuggingFaceIO=_HuggingFaceIO;HuggingFaceIO.URL_PREFIX="https://api-inference.huggingface.co/models/";class HuggingFaceFileIO extends HuggingFaceIO{constructor(e,t,s,n,i,r){super(e,t,s,n,i,r),this.isTextInputDisabled=!0,this.canSendMessage=HuggingFaceFileIO.canSendFile}static canSendFile(e,t){return!(null==t||!t[0])}preprocessBody(e,t,s){return s[0]}callServiceAPI(e,t,s){if(!this.requestSettings)throw new Error("Request settings have not been set up");if(null==s||!s[0])throw new Error("No file was added");HTTPRequest.poll(this,s[0],e,!1)}}class HuggingFaceAudioClassificationIO extends HuggingFaceFileIO{constructor(e){var t,s,n;super(e,"Attach an audio file","ehcalabres/wav2vec2-lg-xlsr-en-speech-emotion-recognition",null==(s=null==(t=e.directConnection)?void 0:t.huggingFace)?void 0:s.audioClassification,null==(n=e.directConnection)?void 0:n.huggingFace,{audio:{}})}async extractPollResultData(e){var t;if(e.estimated_time)return{timeoutMS:1e3*(e.estimated_time+1)};if(e.error)throw e.error;return{text:(null==(t=e[0])?void 0:t.label)||""}}}class HuggingFaceImageClassificationIO extends HuggingFaceFileIO{constructor(e){var t,s,n;super(e,"Attach an image file","google/vit-base-patch16-224",null==(s=null==(t=e.directConnection)?void 0:t.huggingFace)?void 0:s.imageClassification,null==(n=e.directConnection)?void 0:n.huggingFace,{images:{}})}async extractPollResultData(e){var t;if(e.estimated_time)return{timeoutMS:1e3*(e.estimated_time+1)};if(e.error)throw e.error;return{text:(null==(t=e[0])?void 0:t.label)||""}}}const BASE_64_PREFIX="data:image/png;base64,";class StabilityAIUtils{static buildHeaders(e){return{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}static handleVerificationResult(e,t,s,n){e.message?n(ErrorMessages.INVALID_KEY):s(t)}static buildKeyVerificationDetails(){return{url:"https://api.stability.ai/v1/engines/list",method:"GET",handleVerificationResult:StabilityAIUtils.handleVerificationResult}}}class StabilityAIIO extends DirectServiceIO{constructor(e,t,s,n,i){super(e,t,s,n,i),this.insertKeyPlaceholderText="Stability AI API Key",this.getKeyLink="https://platform.stability.ai/docs/getting-started/authentication",this.permittedErrorPrefixes=["Incorrect","invalid_"]}}class StabilityAIImageToImageUpscaleIO extends StabilityAIIO{constructor(e){var t;const{directConnection:s}=e,n=null==s?void 0:s.stabilityAI;super(e,StabilityAIUtils.buildKeyVerificationDetails(),StabilityAIUtils.buildHeaders,n,{images:{files:{acceptedFormats:".png",maxNumberOfFiles:1}}}),this.url="https://api.stability.ai/v1/generation/esrgan-v1-x2plus/image-to-image/upscale",this.textInputPlaceholderText="Describe image changes",this.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Stability AI</b></div>\n    <div style="width: 100%; text-align: center; margin-left: -10px; margin-top: 5px"><b>Image to Image Upscale</b></div>\n    <p>Upload an image to generate a new one with higher resolution.</p>\n    <p>Click <a href="https://platform.stability.ai/">here</a> for more info.</p>';const i=null==(t=null==s?void 0:s.stabilityAI)?void 0:t.imageToImageUpscale;"object"==typeof i&&(i.engine_id&&(this.url=`https://api.stability.ai/v1/generation/${i.engine_id}/image-to-image/upscale`),StabilityAIImageToImageUpscaleIO.cleanConfig(i),Object.assign(this.rawBody,i)),this.canSendMessage=StabilityAIImageToImageUpscaleIO.canSendFileMessage}static cleanConfig(e){delete e.engine_id}static canSendFileMessage(e,t){return!(null==t||!t[0])}createFormDataBody(e,t){const s=new FormData;return s.append("image",t),Object.keys(e).forEach((t=>{s.append(t,String(e[t]))})),s}callServiceAPI(e,t,s){if(!this.requestSettings)throw new Error("Request settings have not been set up");if(!s)throw new Error("Image was not found");const n=this.createFormDataBody(this.rawBody,s[0]);RequestUtils.temporarilyRemoveHeader(this.requestSettings,HTTPRequest.request.bind(this,this,n,e),!1)}async extractResultData(e){if(e.message)throw e.message;return{files:e.artifacts.map((e=>({src:`${BASE_64_PREFIX}${e.base64}`,type:"image"})))}}}class StabilityAIImageToImageMaskingIO extends StabilityAIIO{constructor(e){var t;const{directConnection:s}=e,n=null==s?void 0:s.stabilityAI;super(e,StabilityAIUtils.buildKeyVerificationDetails(),StabilityAIUtils.buildHeaders,n,{images:{files:{acceptedFormats:".png",maxNumberOfFiles:2}}}),this.url="https://api.stability.ai/v1/generation/stable-inpainting-512-v2-0/image-to-image/masking",this._maskSource="MASK_IMAGE_WHITE",this.textInputPlaceholderText="Describe image changes",this.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Stability AI</b></div>\n    <div style="width: 100%; text-align: center; margin-left: -10px; margin-top: 5px"><b>Image to Image Masking</b></div>\n    <p>Upload an image, its mask image to create a new one based on the changes you have described for the mask area.</p>\n    <p>Click <a href="https://platform.stability.ai/">here</a> for more info.</p>';const i=null==(t=null==s?void 0:s.stabilityAI)?void 0:t.imageToImageMasking;"object"==typeof i&&(i.engine_id&&(this.url=`https://api.stability.ai/v1/generation/${i.engine_id}/image-to-image/masking`),void 0!==i.weight&&null!==i.weight&&(this._imageWeight=i.weight),void 0!==i.mask_source&&null!==i.mask_source&&(this._maskSource=i.mask_source),StabilityAIImageToImageMaskingIO.cleanConfig(i),Object.assign(this.rawBody,i)),this.canSendMessage=StabilityAIImageToImageMaskingIO.canSendFileTextMessage}static cleanConfig(e){delete e.engine_id,delete e.weight}static canSendFileTextMessage(e,t){return!(null==t||!t[0]||!e||""===e.trim())}createFormDataBody(e,t,s,n){const i=new FormData;return i.append("init_image",t),i.append("mask_source",String(this._maskSource)),i.append("mask_image",s),n&&""!==n&&i.append("text_prompts[0][text]",n),void 0!==this._imageWeight&&null!==this._imageWeight&&i.append("text_prompts[0][weight]",String(this._imageWeight)),Object.keys(e).forEach((t=>{i.append(t,String(e[t]))})),void 0===i.get("weight")&&i.append("weight",String(1)),i}callServiceAPI(e,t,s){var n,i;if(!this.requestSettings)throw new Error("Request settings have not been set up");if(!s||!s[0]||!s[1])throw new Error("Image was not found");const r=null==(i=null==(n=t[t.length-1])?void 0:n.text)?void 0:i.trim(),o=this.createFormDataBody(this.rawBody,s[0],s[1],r);RequestUtils.temporarilyRemoveHeader(this.requestSettings,HTTPRequest.request.bind(this,this,o,e),!1)}async extractResultData(e){if(e.message)throw e.message;return{files:e.artifacts.map((e=>({src:`${BASE_64_PREFIX}${e.base64}`,type:"image"})))}}}class HuggingFaceAudioRecognitionIO extends HuggingFaceFileIO{constructor(e){var t,s,n;super(e,"Attach an audio file","facebook/wav2vec2-large-960h-lv60-self",null==(s=null==(t=e.directConnection)?void 0:t.huggingFace)?void 0:s.audioSpeechRecognition,null==(n=e.directConnection)?void 0:n.huggingFace,{audio:{}})}async extractPollResultData(e){if(e.estimated_time)return{timeoutMS:1e3*(e.estimated_time+1)};if(e.error)throw e.error;return{text:e.text||""}}}class HuggingFaceTextGenerationIO extends HuggingFaceIO{constructor(e){var t,s,n;super(e,"Once upon a time","gpt2",null==(s=null==(t=e.directConnection)?void 0:t.huggingFace)?void 0:s.textGeneration,null==(n=e.directConnection)?void 0:n.huggingFace)}async extractResultData(e){if(e.error)throw e.error;return{text:e[0].generated_text||""}}}class HuggingFaceQuestionAnswerIO extends HuggingFaceIO{constructor(e){var t,s,n;const i=null==(s=null==(t=e.directConnection)?void 0:t.huggingFace)?void 0:s.questionAnswer;super(e,"Ask a question","bert-large-uncased-whole-word-masking-finetuned-squad",i,null==(n=e.directConnection)?void 0:n.huggingFace),this.permittedErrorPrefixes=["Authorization header","Error in"],this.context=i.context}preprocessBody(e,t){const s=t[t.length-1].text;if(s)return{inputs:{question:s,context:this.context,options:{wait_for_model:!0}}}}async extractResultData(e){if(e.error)throw e.error;return{text:e.answer||""}}}class HuggingFaceSummarizationIO extends HuggingFaceIO{constructor(e){var t,s,n;super(e,"Insert text to summarize","facebook/bart-large-cnn",null==(s=null==(t=e.directConnection)?void 0:t.huggingFace)?void 0:s.summarization,null==(n=e.directConnection)?void 0:n.huggingFace)}async extractResultData(e){if(e.error)throw e.error;return{text:e[0].summary_text||""}}}class HuggingFaceConversationIO extends HuggingFaceIO{constructor(e){var t,s,n;super(e,"Ask me anything!","facebook/blenderbot-400M-distill",null==(s=null==(t=e.directConnection)?void 0:t.huggingFace)?void 0:s.conversation,null==(n=e.directConnection)?void 0:n.huggingFace),void 0===this.maxMessages&&(this.maxMessages=-1)}processMessages(e){const t=e[e.length-1].text,s=e.slice(0,e.length-1);if(!t)return;return{past_user_inputs:s.filter((e=>"user"===e.role)).map((e=>e.text)),generated_responses:s.filter((e=>"ai"===e.role)).map((e=>e.text)),mostRecentMessageText:t}}preprocessBody(e,t){const s=JSON.parse(JSON.stringify(e)),n=this.processMessages(t);if(n)return s.options??(s.options={}),s.options.wait_for_model=!0,{inputs:{past_user_inputs:n.past_user_inputs,generated_responses:n.generated_responses,text:n.mostRecentMessageText},...s}}async extractResultData(e){if(e.error)throw e.error;return{text:e.generated_text||""}}}class StabilityAIImageToImageIO extends StabilityAIIO{constructor(e){var t;const{directConnection:s}=e,n=null==s?void 0:s.stabilityAI;super(e,StabilityAIUtils.buildKeyVerificationDetails(),StabilityAIUtils.buildHeaders,n,{images:{files:{acceptedFormats:".png",maxNumberOfFiles:1}}}),this.url="https://api.stability.ai/v1/generation/stable-diffusion-v1-5/image-to-image",this.textInputPlaceholderText="Describe image changes",this.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Stability AI - Image to Image</b></div>\n    <p>Upload an image to create a new one with the changes you have described.</p>\n    <p>Click <a href="https://platform.stability.ai/">here</a> for more info.</p>';const i=null==(t=null==s?void 0:s.stabilityAI)?void 0:t.imageToImage;"object"==typeof i&&(i.engine_id&&(this.url=`https://api.stability.ai/v1/generation/${i.engine_id}/text-to-image`),void 0!==i.weight&&null!==i.weight&&(this._imageWeight=i.weight),StabilityAIImageToImageIO.cleanConfig(i),Object.assign(this.rawBody,i)),this.canSendMessage=StabilityAIImageToImageIO.canSendFileTextMessage}static cleanConfig(e){delete e.engine_id,delete e.weight}static canSendFileTextMessage(e,t){return!(null==t||!t[0]||!e||""===e.trim())}createFormDataBody(e,t,s){const n=new FormData;return n.append("init_image",t),s&&""!==s&&n.append("text_prompts[0][text]",s),void 0!==this._imageWeight&&null!==this._imageWeight&&n.append("text_prompts[0][weight]",String(this._imageWeight)),Object.keys(e).forEach((t=>{n.append(t,String(e[t]))})),void 0===n.get("weight")&&n.append("weight",String(1)),n}callServiceAPI(e,t,s){var n,i;if(!this.requestSettings)throw new Error("Request settings have not been set up");if(!s)throw new Error("Image was not found");const r=null==(i=null==(n=t[t.length-1])?void 0:n.text)?void 0:i.trim(),o=this.createFormDataBody(this.rawBody,s[0],r);RequestUtils.temporarilyRemoveHeader(this.requestSettings,HTTPRequest.request.bind(this,this,o,e),!1)}async extractResultData(e){if(e.message)throw e.message;return{files:e.artifacts.map((e=>({src:`${BASE_64_PREFIX}${e.base64}`,type:"image"})))}}}class HuggingFaceTranslationIO extends HuggingFaceIO{constructor(e){var t,s,n;super(e,"Insert text to translate","Helsinki-NLP/opus-tatoeba-en-ja",null==(s=null==(t=e.directConnection)?void 0:t.huggingFace)?void 0:s.translation,null==(n=e.directConnection)?void 0:n.huggingFace)}async extractResultData(e){if(e.error)throw e.error;return{text:e[0].translation_text||""}}}class StabilityAITextToImageIO extends StabilityAIIO{constructor(e){var t;const{directConnection:s}=e,n=null==s?void 0:s.stabilityAI;super(e,StabilityAIUtils.buildKeyVerificationDetails(),StabilityAIUtils.buildHeaders,n),this.url="https://api.stability.ai/v1/generation/stable-diffusion-v1-5/text-to-image",this.textInputPlaceholderText="Describe an image",this.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Stability AI - Text to Image</b></div>\n    <p>Insert text to generate an image.</p>\n    <p>Click <a href="https://platform.stability.ai/">here</a> for more info.</p>';const i=null==(t=null==s?void 0:s.stabilityAI)?void 0:t.textToImage;"object"==typeof i&&(i.engine_id&&(this.url=`https://api.stability.ai/v1/generation/${i.engine_id}/text-to-image`),void 0!==i.weight&&null!==i.weight&&(this._imageWeight=i.weight),StabilityAITextToImageIO.cleanConfig(i),Object.assign(this.rawBody,i)),this.canSendMessage=StabilityAITextToImageIO.canSendTextMessage}static cleanConfig(e){delete e.engine_id,delete e.weight}static canSendTextMessage(e){return!(!e||""===e.trim())}preprocessBody(e,t){const s=JSON.parse(JSON.stringify(e)),n={text:t};return this._imageWeight&&(n.weight=this._imageWeight),s.text_prompts=[n],s}callServiceAPI(e,t){if(!this.requestSettings)throw new Error("Request settings have not been set up");const s=this.preprocessBody(this.rawBody,t[t.length-1].text);HTTPRequest.request(this,s,e)}async extractResultData(e){if(e.message)throw e.message;return{files:e.artifacts.map((e=>({src:`${BASE_64_PREFIX}${e.base64}`,type:"image"})))}}}class HuggingFaceFillMaskIO extends HuggingFaceIO{constructor(e){var t,s,n;super(e,"The goal of life is [MASK].","bert-base-uncased",null==(s=null==(t=e.directConnection)?void 0:t.huggingFace)?void 0:s.fillMask,null==(n=e.directConnection)?void 0:n.huggingFace),this.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Hugging Face</b></div>\n    <p>Insert a sentence with the word [MASK] and the model will try to fill it for you. E.g. I want [MASK].</p>\n    <p>First message may take an extented amount of time to complete as the model needs to be initialized.</p>',this.permittedErrorPrefixes=["Authorization header","No mask_token"]}async extractResultData(e){if(e.error)throw e.error;return{text:e[0].sequence||""}}}class CohereUtils{static buildHeaders(e){return{Authorization:`Bearer ${e}`,"Content-Type":"application/json",accept:"application/json"}}static handleVerificationResult(e,t,s,n){"invalid request: prompt must be at least 1 token long"===e.message?s(t):n(ErrorMessages.INVALID_KEY)}static buildKeyVerificationDetails(){return{url:"https://api.cohere.ai/v1/generate",method:"POST",handleVerificationResult:CohereUtils.handleVerificationResult,body:JSON.stringify({prompt:""})}}}class CohereIO extends DirectServiceIO{constructor(e,t,s,n,i){super(e,CohereUtils.buildKeyVerificationDetails(),CohereUtils.buildHeaders,i),this.insertKeyPlaceholderText="Cohere API Key",this.getKeyLink="https://dashboard.cohere.ai/api-keys",this.permittedErrorPrefixes=["invalid"],this.url=t,this.textInputPlaceholderText=s,n&&"object"==typeof n&&Object.assign(this.rawBody,n)}}class CohereTextGenerationIO extends CohereIO{constructor(e){var t,s,n;super(e,"https://api.cohere.ai/v1/generate","Once upon a time",null==(s=null==(t=e.directConnection)?void 0:t.cohere)?void 0:s.textGeneration,null==(n=e.directConnection)?void 0:n.cohere)}preprocessBody(e,t){const s=JSON.parse(JSON.stringify(e)),n=t[t.length-1].text;if(n)return{prompt:n,...s}}callServiceAPI(e,t){if(!this.requestSettings)throw new Error("Request settings have not been set up");const s=this.preprocessBody(this.rawBody,t);HTTPRequest.request(this,s,e)}async extractResultData(e){var t;if(e.message)throw e.message;return{text:(null==(t=e.generations)?void 0:t[0].text)||""}}}class CohereSummarizationIO extends CohereIO{constructor(e){var t,s,n;super(e,"https://api.cohere.ai/v1/summarize","Insert text to summarize",null==(s=null==(t=e.directConnection)?void 0:t.cohere)?void 0:s.summarization,null==(n=e.directConnection)?void 0:n.cohere)}preprocessBody(e,t){const s=JSON.parse(JSON.stringify(e)),n=t[t.length-1].text;if(n)return{text:n,...s}}callServiceAPI(e,t){if(!this.requestSettings)throw new Error("Request settings have not been set up");const s=this.preprocessBody(this.rawBody,t);HTTPRequest.request(this,s,e)}async extractResultData(e){if(e.message)throw e.message;return{text:e.summary||""}}}class AzureUtils{static buildTextToSpeechHeaders(e,t){return{"Ocp-Apim-Subscription-Key":t,"Content-Type":"application/ssml+xml","X-Microsoft-OutputFormat":e}}static buildSpeechToTextHeaders(e){return{"Ocp-Apim-Subscription-Key":e,Accept:"application/json"}}static handleSpeechVerificationResult(e,t,s,n){e.error?n(ErrorMessages.INVALID_KEY):s(t)}static buildSpeechKeyVerificationDetails(e){return{url:`https://${e}.api.cognitive.microsoft.com/sts/v1.0/issuetoken`,method:"POST",createHeaders:e=>({"Ocp-Apim-Subscription-Key":`${e}`}),handleVerificationResult:AzureUtils.handleSpeechVerificationResult}}static buildSummarizationHeader(e){return{"Ocp-Apim-Subscription-Key":e,"Content-Type":"application/json"}}static handleLanguageVerificationResult(e,t,s,n){var i;"401"===(null==(i=e.error)?void 0:i.code)?n(ErrorMessages.INVALID_KEY):s(t)}static buildLanguageKeyVerificationDetails(e){return{url:`${e}/language/analyze-text/jobs?api-version=2022-10-01-preview`,method:"POST",createHeaders:e=>({"Ocp-Apim-Subscription-Key":`${e}`}),handleVerificationResult:AzureUtils.handleLanguageVerificationResult}}static handleTranslationVerificationResult(e,t,s,n){e.json().then((e=>{Array.isArray(e)||401e3!==e.error.code?s(t):n(ErrorMessages.INVALID_KEY)}))}static buildTranslationKeyVerificationDetails(e){return{url:"https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to=es",method:"POST",createHeaders:t=>AzureUtils.buildTranslationHeaders(e,t),handleVerificationResult:AzureUtils.handleTranslationVerificationResult}}static buildTranslationHeaders(e,t){const s={"Ocp-Apim-Subscription-Key":t,"Content-Type":"application/json"};return e&&(s["Ocp-Apim-Subscription-Region"]=e),s}}class AzureLanguageIO extends DirectServiceIO{constructor(e,t,s,n,i){super(e,AzureUtils.buildLanguageKeyVerificationDetails(s),t,n,i),this.insertKeyPlaceholderText="Azure Language Subscription Key",this.getKeyLink="https://learn.microsoft.com/en-us/azure/api-management/api-management-subscriptions#create-and-manage-subscriptions-in-azure-portal",this.permittedErrorPrefixes=["Access"]}}class AzureSummarizationIO extends AzureLanguageIO{constructor(e){var t,s,n,i;const r=null==(s=null==(t=e.directConnection)?void 0:t.azure)?void 0:s.summarization,o=null==(n=e.directConnection)?void 0:n.azure;super(e,AzureUtils.buildSummarizationHeader,r.endpoint,o),this.url="",this.textInputPlaceholderText="Insert text to summarize",(i=this.rawBody).language??(i.language="en"),Object.assign(this.rawBody,r),this.url=`${r.endpoint}/language/analyze-text/jobs?api-version=2022-10-01-preview`}preprocessBody(e,t){const s=t[t.length-1].text;if(s)return{analysisInput:{documents:[{id:"1",language:e.language,text:s}]},tasks:[{kind:"ExtractiveSummarization"}]}}callServiceAPI(e,t){if(!this.requestSettings)throw new Error("Request settings have not been set up");const s=this.preprocessBody(this.rawBody,t);HTTPRequest.request(this,s,e),this.messages=e}async extractResultData(e){var t;if(e.error)throw e.error.message;if(this.messages&&this.completionsHandlers){const s=e.headers.get("operation-location"),n={method:"GET",headers:null==(t=this.requestSettings)?void 0:t.headers};HTTPRequest.executePollRequest(this,s,n,this.messages)}return{pollingInAnotherRequest:!0}}async extractPollResultData(e){if(e.error)throw e.error;if("running"===e.status)return{timeoutMS:2e3};if(e.errors.length>0)throw e.errors[0];if(e.tasks.items[0].results.errors.length>0)throw e.tasks.items[0].results.errors[0];let t="";for(const s of e.tasks.items[0].results.documents[0].sentences)t+=s.text;return{text:t||""}}}const _OpenAIConverseBaseBody=class{static generateDefaultBody(e){return{model:e}}static build(e,t){const s=_OpenAIConverseBaseBody.generateDefaultBody(e);return t&&"boolean"!=typeof t?Object.assign(s,t):s}};let OpenAIConverseBaseBody=_OpenAIConverseBaseBody;OpenAIConverseBaseBody.GPT_COMPLETIONS_DAVINCI_MODEL="text-davinci-003",OpenAIConverseBaseBody.GPT_CHAT_TURBO_MODEL="gpt-3.5-turbo";const _OpenAIUtils=class{static buildHeaders(e){return{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}static handleVerificationResult(e,t,s,n){const i=e;i.error?"invalid_api_key"===i.error.code?n(ErrorMessages.INVALID_KEY):n(ErrorMessages.CONNECTION_FAILED):s(t)}static buildKeyVerificationDetails(){return{url:"https://api.openai.com/v1/models",method:"GET",handleVerificationResult:_OpenAIUtils.handleVerificationResult}}};let OpenAIUtils=_OpenAIUtils;OpenAIUtils.CONVERSE_MAX_CHAR_LENGTH=13352,OpenAIUtils.FILE_MAX_CHAR_LENGTH=1e3;class OpenAICompletionsIO extends DirectServiceIO{constructor(e){var t,s;const{directConnection:n,textInput:i}=e,r=null==n?void 0:n.openAI;super(e,OpenAIUtils.buildKeyVerificationDetails(),OpenAIUtils.buildHeaders,r),this.insertKeyPlaceholderText="OpenAI API Key",this.getKeyLink="https://platform.openai.com/account/api-keys",this.url="https://api.openai.com/v1/completions",this.permittedErrorPrefixes=["Incorrect"],this._maxCharLength=OpenAIUtils.CONVERSE_MAX_CHAR_LENGTH,this.full_transaction_max_tokens=4e3,this.numberOfCharsPerToken=3.5;const o=null==(t=null==n?void 0:n.openAI)?void 0:t.completions;null!=i&&i.characterLimit&&(this._maxCharLength=i.characterLimit),"object"==typeof o&&Object.assign(this.rawBody,o),(s=this.rawBody).model??(s.model=OpenAIConverseBaseBody.GPT_COMPLETIONS_DAVINCI_MODEL)}preprocessBody(e,t){const s=JSON.parse(JSON.stringify(e)),n=t[t.length-1].text;if(!n)return;const i=n.substring(0,this._maxCharLength),r=s.max_tokens||this.full_transaction_max_tokens-i.length/this.numberOfCharsPerToken;return{prompt:i,max_tokens:Math.floor(r),...s}}callServiceAPI(e,t){if(!this.requestSettings)throw new Error("Request settings have not been set up");const s=this.preprocessBody(this.rawBody,t);this._isStream||s.stream?(s.stream=!0,HTTPRequest.requestStream(this,s,e)):HTTPRequest.request(this,s,e)}async extractResultData(e){var t;if(e.error)throw e.error.message;return{text:(null==(t=e.choices[0])?void 0:t.text)||""}}}class AssemblyAIUtils{static async poll(e,t){const s={authorization:e,"content-type":"application/json"},n=`https://api.assemblyai.com/v2/transcript/${(await(await fetch("https://api.assemblyai.com/v2/transcript",{method:"POST",body:JSON.stringify({audio_url:t}),headers:s})).json()).id}`;let i;for(;!i;){const e=await(await fetch(n,{headers:s})).json();if("completed"===e.status)i=e;else{if("error"===e.status)throw new Error(`Transcription failed: ${e.error}`);await new Promise((e=>setTimeout(e,3e3)))}}return i}static buildHeaders(e){return{Authorization:e,"Content-Type":"application/octet-stream"}}static handleVerificationResult(e,t,s,n){const i=e;i.error?"invalid_api_key"===i.error.code?n(ErrorMessages.INVALID_KEY):n(ErrorMessages.CONNECTION_FAILED):s(t)}static buildKeyVerificationDetails(){return{url:"https://api.assemblyai.com/v2/upload",method:"POST",handleVerificationResult:AssemblyAIUtils.handleVerificationResult}}}class AssemblyAIAudioIO extends DirectServiceIO{constructor(e){var t;const s=null==(t=e.directConnection)?void 0:t.assemblyAI;super(e,AssemblyAIUtils.buildKeyVerificationDetails(),AssemblyAIUtils.buildHeaders,s,{audio:{}}),this.insertKeyPlaceholderText="AssemblyAI API Key",this.getKeyLink="https://www.assemblyai.com/app/account",this.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>AssemblyAI Audio</b></div>\n    <p><b>Upload an audio file</b> to transcribe it into text.\n    <p>\n      Click <a href="https://www.assemblyai.com/docs/Guides/transcribing_an_audio_file#get-started">here</a> for more info.\n    </p>',this.url="https://api.assemblyai.com/v2/upload",this.isTextInputDisabled=!0,this.textInputPlaceholderText="Upload an audio file",this.permittedErrorPrefixes=["Authentication","Invalid"],this.canSendMessage=AssemblyAIAudioIO.canFileSendMessage}static canFileSendMessage(e,t){return!(null==t||!t[0])}callServiceAPI(e,t,s){var n;if(null==(n=this.requestSettings)||!n.headers)throw new Error("Request settings have not been set up");if(null==s||!s[0])throw new Error("No file was added");HTTPRequest.request(this,s[0],e,!1)}async extractResultData(e){var t,s;if(e.error)throw e.error;const n=null==(s=null==(t=this.requestSettings)?void 0:t.headers)?void 0:s.Authorization;return{text:(await AssemblyAIUtils.poll(n,e.upload_url)).text}}}class AzureSpeechIO extends DirectServiceIO{constructor(e,t,s,n,i){super(e,AzureUtils.buildSpeechKeyVerificationDetails(s),t,n,i),this.insertKeyPlaceholderText="Azure Speech Subscription Key",this.getKeyLink="https://learn.microsoft.com/en-us/azure/api-management/api-management-subscriptions#create-and-manage-subscriptions-in-azure-portal"}}const _AzureTextToSpeechIO=class extends AzureSpeechIO{constructor(e){var t,s,n,i,r,o;const a=null==(s=null==(t=e.directConnection)?void 0:t.azure)?void 0:s.textToSpeech,l=null==(n=e.directConnection)?void 0:n.azure;super(e,AzureUtils.buildTextToSpeechHeaders.bind({},(null==a?void 0:a.outputFormat)||"audio-16khz-128kbitrate-mono-mp3"),a.region,l),this.introPanelMarkUp=`\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Azure Text To Speech</b></div>\n    <p>Insert text to synthesize it to audio.\n    <p>\n      Click <a href="${_AzureTextToSpeechIO.HELP_LINK}">here</a> for more info.\n    </p>`,this.url="",Object.assign(this.rawBody,a),(i=this.rawBody).lang??(i.lang="en-US"),(r=this.rawBody).name??(r.name="en-US-JennyNeural"),(o=this.rawBody).gender??(o.gender="Female"),this.url=`https://${a.region}.tts.speech.microsoft.com/cognitiveservices/v1`}preprocessBody(e,t){const s=t[t.length-1].text;if(s)return`<speak version='1.0' xml:lang='${e.lang}'>\n      <voice xml:lang='${e.lang}' xml:gender='${e.gender}' name='${e.name}'>\n        ${s}\n      </voice>\n    </speak>`}callServiceAPI(e,t){if(!this.requestSettings)throw new Error("Request settings have not been set up");const s=this.preprocessBody(this.rawBody,t);HTTPRequest.request(this,s,e,!1)}async extractResultData(e){return new Promise((t=>{const s=new FileReader;s.readAsDataURL(e),s.onload=e=>{t({files:[{src:e.target.result,type:"audio"}]})}}))}};let AzureTextToSpeechIO=_AzureTextToSpeechIO;AzureTextToSpeechIO.HELP_LINK="https://learn.microsoft.com/en-GB/azure/cognitive-services/speech-service/get-started-text-to-speech?tabs=windows%2Cterminal&pivots=programming-language-rest";const _AzureSpeechToTextIO=class extends AzureSpeechIO{constructor(e){var t,s,n;const i=null==(s=null==(t=e.directConnection)?void 0:t.azure)?void 0:s.speechToText,r=null==(n=e.directConnection)?void 0:n.azure;super(e,AzureUtils.buildSpeechToTextHeaders,i.region,r,{audio:{files:{acceptedFormats:".wav,.ogg"}}}),this.introPanelMarkUp=`\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Azure Speech To Text</b></div>\n    <p><b>Upload a .wav or .ogg audio file</b> to transcribe it into text.\n    <p>\n      Click <a href="${_AzureSpeechToTextIO.HELP_LINK}">here</a> for more info.\n    </p>`,this.url="",this.isTextInputDisabled=!0,this.textInputPlaceholderText="Upload an audio file",this.canSendMessage=_AzureSpeechToTextIO.canFileSendMessage;const o=i.lang||"en-US";this.url=`https://${i.region}.stt.speech.microsoft.com/speech/recognition/conversation/cognitiveservices/v1?language=${o}&format=detailed`,this.recordAudio=void 0}static canFileSendMessage(e,t){return!(null==t||!t[0])}callServiceAPI(e,t,s){var n,i;if(null==(n=this.requestSettings)||!n.headers)throw new Error("Request settings have not been set up");if(null==s||!s[0])throw new Error("No file was added");null!=(i=this.requestSettings)&&i.headers&&(this.requestSettings.headers["Content-Type"]=s[0].name.toLocaleLowerCase().endsWith(".wav")?"audio/wav; codecs=audio/pcm; samplerate=16000":"audio/ogg; codecs=opus"),HTTPRequest.request(this,s[0],e,!1)}async extractResultData(e){if(e.error)throw e.error;return{text:e.DisplayText||""}}};let AzureSpeechToTextIO=_AzureSpeechToTextIO;AzureSpeechToTextIO.HELP_LINK="https://learn.microsoft.com/en-GB/azure/cognitive-services/speech-service/get-started-text-to-speech?tabs=windows%2Cterminal&pivots=programming-language-rest";class AzureTranslationIO extends DirectServiceIO{constructor(e){var t,s,n;const i=null==(s=null==(t=e.directConnection)?void 0:t.azure)?void 0:s.translation,r=null==(n=e.directConnection)?void 0:n.azure;super(e,AzureUtils.buildTranslationKeyVerificationDetails(i.region),AzureUtils.buildTranslationHeaders.bind({},null==i?void 0:i.region),r),this.insertKeyPlaceholderText="Azure Translate Subscription Key",this.getKeyLink="https://learn.microsoft.com/en-us/azure/api-management/api-management-subscriptions#create-and-manage-subscriptions-in-azure-portal",this.url="",this.url=`https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to=${i.language||"es"}`}preprocessBody(e){const t=e[e.length-1].text;if(t)return[{Text:t}]}callServiceAPI(e,t){if(!this.requestSettings)throw new Error("Request settings have not been set up");const s=this.preprocessBody(t);HTTPRequest.request(this,s,e)}async extractResultData(e){var t;if(Array.isArray(e))return{text:(null==(t=e[0].translations)?void 0:t[0].text)||""};throw e.error}}const _OpenAIImagesIO=class extends DirectServiceIO{constructor(e){var t;const{directConnection:s,textInput:n}=e,i=null==s?void 0:s.openAI;super(e,OpenAIUtils.buildKeyVerificationDetails(),OpenAIUtils.buildHeaders,i,{images:{files:{acceptedFormats:".png",maxNumberOfFiles:2}}}),this.insertKeyPlaceholderText="OpenAI API Key",this.getKeyLink="https://platform.openai.com/account/api-keys",this.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>OpenAI Images</b></div>\n    <p><b>Insert text</b> to generate an image.</p>\n    <p><b>Upload 1</b> PNG image to generate its variation and optionally insert text to specify the change.</p>\n    <p><b>Upload 2</b> PNG images where the second is a copy of the first with a transparent area where the edit should\n      take place and text to specify the edit.</p>\n    <p>Click <a href="https://platform.openai.com/docs/guides/images/introduction">here</a> for more info.</p>',this.url="",this.permittedErrorPrefixes=["Incorrect","Invalid input image"],this._maxCharLength=OpenAIUtils.FILE_MAX_CHAR_LENGTH,null!=n&&n.characterLimit&&(this._maxCharLength=n.characterLimit);const r=null==(t=null==s?void 0:s.openAI)?void 0:t.images;if(this.camera){const e="object"==typeof r&&r.size?Number.parseInt(r.size):1024;this.camera.files={dimensions:{width:e,height:e}}}"object"==typeof r&&Object.assign(this.rawBody,r),this.canSendMessage=_OpenAIImagesIO.canFileSendMessage}static canFileSendMessage(e,t){return!(null==t||!t[0])||!(!e||""===e.trim())}static createFormDataBody(e,t,s){const n=new FormData;return n.append("image",t),s&&n.append("mask",s),Object.keys(e).forEach((t=>{n.append(t,String(e[t]))})),n}preprocessBody(e,t){const s=JSON.parse(JSON.stringify(e));if(t&&""!==t){const e=t.substring(0,this._maxCharLength);s.prompt=e}return s}callApiWithImage(e,t,s){var n,i;let r;const o=null==(i=null==(n=t[t.length-1])?void 0:n.text)?void 0:i.trim();if(s[1]||o&&""!==o){this.url=_OpenAIImagesIO.IMAGE_EDIT_URL;const e=this.preprocessBody(this.rawBody,o);r=_OpenAIImagesIO.createFormDataBody(e,s[0],s[1])}else this.url=_OpenAIImagesIO.IMAGE_VARIATIONS_URL,r=_OpenAIImagesIO.createFormDataBody(this.rawBody,s[0]);RequestUtils.temporarilyRemoveHeader(this.requestSettings,HTTPRequest.request.bind(this,this,r,e),!1)}callServiceAPI(e,t,s){var n;if(null==(n=this.requestSettings)||!n.headers)throw new Error("Request settings have not been set up");if(null!=s&&s[0])this.callApiWithImage(e,t,s);else{if(!this.requestSettings)throw new Error("Request settings have not been set up");this.url=_OpenAIImagesIO.IMAGE_GENERATION_URL;const s=this.preprocessBody(this.rawBody,t[t.length-1].text);HTTPRequest.request(this,s,e)}}async extractResultData(e){if(e.error)throw e.error.message;return{files:e.data.map((e=>e.url?{src:e.url,type:"image"}:{src:`${BASE_64_PREFIX}${e.b64_json}`,type:"image"}))}}};let OpenAIImagesIO=_OpenAIImagesIO;OpenAIImagesIO.IMAGE_GENERATION_URL="https://api.openai.com/v1/images/generations",OpenAIImagesIO.IMAGE_VARIATIONS_URL="https://api.openai.com/v1/images/variations",OpenAIImagesIO.IMAGE_EDIT_URL="https://api.openai.com/v1/images/edits";const _OpenAIAudioIO=class extends DirectServiceIO{constructor(e){var t,s;const{directConnection:n,textInput:i}=e,r=null==n?void 0:n.openAI;super(e,OpenAIUtils.buildKeyVerificationDetails(),OpenAIUtils.buildHeaders,r,{audio:{}}),this.insertKeyPlaceholderText="OpenAI API Key",this.getKeyLink="https://platform.openai.com/account/api-keys",this.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>OpenAI Audio</b></div>\n    <p><b>Upload an audio file</b> to transcribe it into text. You can optionally provide text to guide the audio\n      processing.\n    <p>Click <a href="https://platform.openai.com/docs/api-reference/audio/create">here</a> for more info.</p>',this.url="",this.permittedErrorPrefixes=["Invalid"],this._maxCharLength=OpenAIUtils.FILE_MAX_CHAR_LENGTH,this._service_url=_OpenAIAudioIO.AUDIO_TRANSCRIPTIONS_URL,null!=i&&i.characterLimit&&(this._maxCharLength=i.characterLimit);const o=null==(t=null==n?void 0:n.openAI)?void 0:t.audio;"object"==typeof o&&(this.processConfig(o),_OpenAIAudioIO.cleanConfig(o),Object.assign(this.rawBody,o)),(s=this.rawBody).model??(s.model=_OpenAIAudioIO.DEFAULT_MODEL),this.rawBody.response_format="json",this.canSendMessage=_OpenAIAudioIO.canSendFileMessage}static canSendFileMessage(e,t){return!(null==t||!t[0])}processConfig(e){null!=e&&e.type&&"translation"===e.type&&(this._service_url=_OpenAIAudioIO.AUDIO_TRANSLATIONS_URL,delete e.language)}static cleanConfig(e){delete e.type}static createFormDataBody(e,t){const s=new FormData;return s.append("file",t),Object.keys(e).forEach((t=>{s.append(t,String(e[t]))})),s}preprocessBody(e,t,s){var n,i;const r=JSON.parse(JSON.stringify(e)),o=null==(i=null==(n=t[t.length-s.length+1])?void 0:n.text)?void 0:i.trim();if(o&&""!==o){const e=o.substring(0,this._maxCharLength);r.prompt=e}return r}callServiceAPI(e,t,s){var n;if(null==(n=this.requestSettings)||!n.headers)throw new Error("Request settings have not been set up");if(null==s||!s[0])throw new Error("No file was added");this.url=this.requestSettings.url||this._service_url;const i=this.preprocessBody(this.rawBody,t,s),r=_OpenAIAudioIO.createFormDataBody(i,s[0]);RequestUtils.temporarilyRemoveHeader(this.requestSettings,HTTPRequest.request.bind(this,this,r,e),!1)}async extractResultData(e){if(e.error)throw e.error.message;return{text:e.text}}};let OpenAIAudioIO=_OpenAIAudioIO;OpenAIAudioIO.AUDIO_TRANSCRIPTIONS_URL="https://api.openai.com/v1/audio/transcriptions",OpenAIAudioIO.AUDIO_TRANSLATIONS_URL="https://api.openai.com/v1/audio/translations",OpenAIAudioIO.DEFAULT_MODEL="whisper-1";class OpenAIChatIO extends DirectServiceIO{constructor(e){var t,s,n,i;const r=null==(t=e.directConnection)?void 0:t.openAI;super(e,OpenAIUtils.buildKeyVerificationDetails(),OpenAIUtils.buildHeaders,r),this.insertKeyPlaceholderText="OpenAI API Key",this.getKeyLink="https://platform.openai.com/account/api-keys",this.url="https://api.openai.com/v1/chat/completions",this.permittedErrorPrefixes=["Incorrect"],this._systemMessage=OpenAIChatIO.generateSystemMessage("You are a helpful assistant.");const o=null==(n=null==(s=e.directConnection)?void 0:s.openAI)?void 0:n.chat;"object"==typeof o&&(o.systemPrompt&&(this._systemMessage=OpenAIChatIO.generateSystemMessage(o.systemPrompt)),this.cleanConfig(o),Object.assign(this.rawBody,o)),void 0===this.maxMessages&&(this.maxMessages=-1),(i=this.rawBody).model??(i.model=OpenAIConverseBaseBody.GPT_CHAT_TURBO_MODEL)}static generateSystemMessage(e){return{role:"system",content:e}}cleanConfig(e){delete e.systemPrompt}preprocessBody(e,t){const s=JSON.parse(JSON.stringify(e)),n=this.totalMessagesMaxCharLength||OpenAIUtils.CONVERSE_MAX_CHAR_LENGTH,i=MessageLimitUtils.getCharacterLimitMessages(t,n-this._systemMessage.content.length).map((e=>({content:e.text,role:"ai"===e.role?"assistant":"user"})));return s.messages=[this._systemMessage,...i],s}callServiceAPI(e,t){if(!this.requestSettings)throw new Error("Request settings have not been set up");const s=this.preprocessBody(this.rawBody,t);this._isStream||s.stream?(s.stream=!0,HTTPRequest.requestStream(this,s,e)):HTTPRequest.request(this,s,e)}async extractResultData(e){if(e.error)throw e.error.message;return e.choices[0].delta?{text:e.choices[0].delta.content||""}:e.choices[0].message?{text:e.choices[0].message.content}:{text:""}}}class CohereChatIO extends CohereIO{constructor(e){var t,s,n;const i=null==(s=null==(t=e.directConnection)?void 0:t.cohere)?void 0:s.chat;super(e,"https://api.cohere.ai/v1/chat","Ask me anything!",i,null==(n=e.directConnection)?void 0:n.cohere),this.username="USER","object"==typeof i&&(i.user_name&&(this.username=i.user_name),this.cleanConfig(i),Object.assign(this.rawBody,i)),void 0===this.maxMessages&&(this.maxMessages=-1)}cleanConfig(e){delete e.user_name}preprocessBody(e,t){const s=JSON.parse(JSON.stringify(e));return s.query=t[t.length-1].text,s.chat_history=t.slice(0,t.length-1).map((e=>({text:e.text,user_name:"ai"===e.role?"CHATBOT":this.username}))),s}callServiceAPI(e,t){if(!this.requestSettings)throw new Error("Request settings have not been set up");const s=this.preprocessBody(this.rawBody,t);HTTPRequest.request(this,s,e)}async extractResultData(e){if(e.message)throw e.message;return{text:e.text}}}class ServiceIOFactory{static create(e){const{directConnection:t}=e;if(t){if(t.openAI)return t.openAI.images?new OpenAIImagesIO(e):t.openAI.audio?new OpenAIAudioIO(e):t.openAI.completions?new OpenAICompletionsIO(e):new OpenAIChatIO(e);if(t.assemblyAI)return new AssemblyAIAudioIO(e);if(t.cohere)return t.cohere.chat?new CohereChatIO(e):t.cohere.summarization?new CohereSummarizationIO(e):new CohereTextGenerationIO(e);if(t.huggingFace)return t.huggingFace.textGeneration?new HuggingFaceTextGenerationIO(e):t.huggingFace.summarization?new HuggingFaceSummarizationIO(e):t.huggingFace.translation?new HuggingFaceTranslationIO(e):t.huggingFace.fillMask?new HuggingFaceFillMaskIO(e):t.huggingFace.questionAnswer?new HuggingFaceQuestionAnswerIO(e):t.huggingFace.audioSpeechRecognition?new HuggingFaceAudioRecognitionIO(e):t.huggingFace.audioClassification?new HuggingFaceAudioClassificationIO(e):t.huggingFace.imageClassification?new HuggingFaceImageClassificationIO(e):new HuggingFaceConversationIO(e);if(t.azure){if(t.azure.speechToText)return new AzureSpeechToTextIO(e);if(t.azure.textToSpeech)return new AzureTextToSpeechIO(e);if(t.azure.summarization)return new AzureSummarizationIO(e);if(t.azure.translation)return new AzureTranslationIO(e)}if(t.stabilityAI)return t.stabilityAI.imageToImage?new StabilityAIImageToImageIO(e):t.stabilityAI.imageToImageUpscale?new StabilityAIImageToImageUpscaleIO(e):t.stabilityAI.imageToImageMasking?new StabilityAIImageToImageMaskingIO(e):new StabilityAITextToImageIO(e);if(t.demo)return new BaseServiceIO(e,void 0,t.demo)}return new BaseServiceIO(e)}}const _GoogleFont=class{static appendStyleSheetToHead(){const e=document.getElementsByTagName("head")[0];if(!Array.from(e.getElementsByTagName("link")).some((e=>e.getAttribute("href")===_GoogleFont.FONT_URL))){const t=document.createElement("link");t.rel="stylesheet",t.href=_GoogleFont.FONT_URL,e.appendChild(t)}}};let GoogleFont=_GoogleFont;GoogleFont.FONT_URL="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap";class TypeConverters{}function Property(e){return function(t,s){Object.defineProperty(t,s,{});const n=t.constructor,i=s.toLocaleLowerCase();n._attributes_[i]=TypeConverters.attibutes[e],n._attributeToProperty_[i]=s}}TypeConverters.attibutes={string:e=>e,number:e=>parseFloat(e),boolean:e=>"true"===e,object:e=>JSON.parse(e),array:e=>JSON.parse(e),function:value=>eval(value)};class FireEvents{static onNewMessage(e,t,s){const n=JSON.parse(JSON.stringify({message:t,isInitial:s}));e.onNewMessage(n),e.dispatchEvent(new CustomEvent("new-message",{detail:n}))}static onRender(e){e.onComponentRender(),e.dispatchEvent(new CustomEvent("render"))}}const _ElementUtils=class{static addElements(e,...t){t.forEach((t=>e.appendChild(t)))}static isScrollbarAtBottomOfElement(e){const t=e.scrollHeight,s=e.clientHeight;return e.scrollTop>=t-s-_ElementUtils.CODE_SNIPPET_GENERATION_JUMP}static cloneElement(e){const t=e.cloneNode(!0);return e.parentNode.replaceChild(t,e),t}};let ElementUtils=_ElementUtils;ElementUtils.CODE_SNIPPET_GENERATION_JUMP=.5;const _TextToSpeech=class{static speak(e,t){if(window.SpeechSynthesisUtterance){const s=new SpeechSynthesisUtterance(e);Object.assign(s,t),speechSynthesis.speak(s)}}static processConfig(e,t){const s={};setTimeout((()=>{if("object"==typeof e&&(e.lang&&(s.lang=e.lang),e.pitch&&(s.pitch=e.pitch),e.rate&&(s.rate=e.rate),e.volume&&(s.volume=e.volume),e.voiceName)){const t=window.speechSynthesis.getVoices().find((t=>{var s;return t.name.toLocaleLowerCase()===(null==(s=e.voiceName)?void 0:s.toLocaleLowerCase())}));t&&(s.voice=t)}t(s)}),_TextToSpeech.LOAD_VOICES_MS)}};let TextToSpeech=_TextToSpeech;TextToSpeech.LOAD_VOICES_MS=200;class LoadingMessageDotsStyle{static colorToHex(e){const t=document.createElement("div");return t.style.color=e,document.body.appendChild(t),`#${window.getComputedStyle(t).color.match(/\d+/g).map((e=>parseInt(e).toString(16).padStart(2,"0"))).join("")}`}static set(e,t){var s,n,i,r;if(null!=(n=null==(s=null==t?void 0:t.loading)?void 0:s.bubble)&&n.color){const s=LoadingMessageDotsStyle.colorToHex(null==(r=null==(i=null==t?void 0:t.loading)?void 0:i.bubble)?void 0:r.color);e.style.setProperty("--message-dots-color",s),e.style.setProperty("--message-dots-color-fade",`${s}33`)}else e.style.setProperty("--message-dots-color","#848484"),e.style.setProperty("--message-dots-color-fade","#55555533")}}class MessageStyleUtils{static applyCustomStylesToElements(e,t,s){if(s&&(Object.assign(e.outerContainer.style,s.outerContainer),Object.assign(e.innerContainer.style,s.innerContainer),Object.assign(e.bubbleElement.style,s.bubble),t)){const t=e.bubbleElement.children[0],n="a"!==t.tagName.toLocaleLowerCase()?t:t.children[0];Object.assign(n.style,s.media)}}static applySideStyles(e,t,s,n){n&&(MessageStyleUtils.applyCustomStylesToElements(e,s,n.shared),t?MessageStyleUtils.applyCustomStylesToElements(e,s,n.ai):MessageStyleUtils.applyCustomStylesToElements(e,s,n.user))}static isMessageSideStyles(e){return!!(e.ai||e.shared||e.user)}static applyCustomStyles(e,t,s,n,i){var r;i&&e.default!==i?MessageStyleUtils.isMessageSideStyles(i)?(MessageStyleUtils.applySideStyles(t,s,n,e.default),MessageStyleUtils.applySideStyles(t,s,n,i)):(MessageStyleUtils.applyCustomStylesToElements(t,n,null==(r=e.default)?void 0:r.shared),MessageStyleUtils.applyCustomStylesToElements(t,n,i)):MessageStyleUtils.applySideStyles(t,s,n,e.default)}static extractParticularSharedStyles(e,t){if(null==t||!t.shared)return;const s=t.shared,n={outerContainer:{},innerContainer:{},bubble:{},media:{}};return e.forEach((e=>{var t,i,r,o;n.outerContainer[e]=(null==(t=s.outerContainer)?void 0:t[e])||"",n.innerContainer[e]=(null==(i=s.innerContainer)?void 0:i[e])||"",n.bubble[e]=(null==(r=s.bubble)?void 0:r[e])||"",n.media[e]=(null==(o=s.media)?void 0:o[e])||""})),n}}class IntroPanel{constructor(e,t,s){this._isDisplayed=!1,e?(this._elementRef=this.createIntroPanelWithChild(e,s),this._isDisplayed=!0):t&&(this._elementRef=this.createInternalIntroPanel(t,s),this._isDisplayed=!0)}static createIntroPanel(e){const t=document.createElement("div");return t.classList.add("intro-panel"),Object.assign(t.style,e),t}createIntroPanelWithChild(e,t){const s=IntroPanel.createIntroPanel(t);return"none"===e.style.display&&(e.style.display="block"),s.appendChild(e),s}createInternalIntroPanel(e,t){const s=IntroPanel.createIntroPanel(t);return s.id="internal-intro-panel",s.innerHTML=e,s}hide(){this._isDisplayed&&this._elementRef&&(this._elementRef.style.display="none",this._isDisplayed=!1)}}const _FileMessageUtils=class{static updateMessages(e,t,s,n,i,r=!1){var o;e.applyCustomStyles(t,i,!0,null==(o=e.messageStyles)?void 0:o[n]),e.elementRef.scrollTop=e.elementRef.scrollHeight;const a=Messages.createMessageContent(i,void 0,s);e.messages.push(a),e.sendClientUpdate(a,r)}static wrapInLink(e,t){const s=document.createElement("a");return s.href=t,s.target="_blank",s.appendChild(e),s}static processContent(e,t){return!t||t.startsWith("data")?e:_FileMessageUtils.wrapInLink(e,t)}static waitToLoadThenScroll(e){setTimeout((()=>{e.scrollTop=e.scrollHeight}),60)}static scrollDownOnImageLoad(e,t){if(e.startsWith("data"))_FileMessageUtils.waitToLoadThenScroll(t);else try{fetch(e,{mode:"no-cors"}).catch((()=>{})).finally((()=>{_FileMessageUtils.waitToLoadThenScroll(t)}))}catch{t.scrollTop=t.scrollHeight}}};let FileMessageUtils=_FileMessageUtils;FileMessageUtils.DEFAULT_FILE_NAME="file";const FILE_ICON_STRING='<?xml version="1.0" encoding="iso-8859-1"?>\n<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" \n\t viewBox="50 30 420 450" xml:space="preserve">\n<g filter="brightness(0) saturate(100%) invert(16%) sepia(0%) saturate(1942%) hue-rotate(215deg) brightness(99%) contrast(93%)">\n\t<g>\n\t\t<path d="M447.933,103.629c-0.034-3.076-1.224-6.09-3.485-8.352L352.683,3.511c-0.004-0.004-0.007-0.005-0.011-0.008\n\t\t\tC350.505,1.338,347.511,0,344.206,0H89.278C75.361,0,64.04,11.32,64.04,25.237v461.525c0,13.916,11.32,25.237,25.237,25.237\n\t\t\th333.444c13.916,0,25.237-11.32,25.237-25.237V103.753C447.96,103.709,447.937,103.672,447.933,103.629z M356.194,40.931\n\t\t\tl50.834,50.834h-49.572c-0.695,0-1.262-0.567-1.262-1.262V40.931z M423.983,486.763c0,0.695-0.566,1.261-1.261,1.261H89.278\n\t\t\tc-0.695,0-1.261-0.566-1.261-1.261V25.237c0-0.695,0.566-1.261,1.261-1.261h242.94v66.527c0,13.916,11.322,25.239,25.239,25.239\n\t\t\th66.527V486.763z"/>\n\t</g>\n</g>\n<g>\n\t<g>\n\t\t<path d="M362.088,164.014H149.912c-6.62,0-11.988,5.367-11.988,11.988c0,6.62,5.368,11.988,11.988,11.988h212.175\n\t\t\tc6.62,0,11.988-5.368,11.988-11.988C374.076,169.381,368.707,164.014,362.088,164.014z"/>\n\t</g>\n</g>\n<g>\n\t<g>\n\t\t<path d="M362.088,236.353H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.62,5.368,11.988,11.988,11.988h212.175\n\t\t\tc6.62,0,11.988-5.368,11.988-11.988C374.076,241.721,368.707,236.353,362.088,236.353z"/>\n\t</g>\n</g>\n<g>\n\t<g>\n\t\t<path d="M362.088,308.691H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.621,5.368,11.988,11.988,11.988h212.175\n\t\t\tc6.62,0,11.988-5.367,11.988-11.988C374.076,314.06,368.707,308.691,362.088,308.691z"/>\n\t</g>\n</g>\n<g>\n\t<g>\n\t\t<path d="M256,381.031H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.621,5.368,11.988,11.988,11.988H256\n\t\t\tc6.62,0,11.988-5.367,11.988-11.988C267.988,386.398,262.62,381.031,256,381.031z"/>\n\t</g>\n</g>\n</svg>';class FileMessages{static createImage(e,t){const s=new Image;return s.src=e.src,FileMessageUtils.scrollDownOnImageLoad(s.src,t),FileMessageUtils.processContent(s,s.src)}static async addNewImageMessage(e,t,s,n=!1){const i=FileMessages.createImage(t,e.elementRef),r=e.createNewMessageElement("",s);r.bubbleElement.appendChild(i),r.bubbleElement.classList.add("image-message"),e.elementRef.appendChild(r.outerContainer),FileMessageUtils.updateMessages(e,r,t,"image",s,n)}static createAudioElement(e,t){const s=document.createElement("audio");return s.src=e.src,s.classList.add("audio-player"),s.controls=!0,Browser$1.IS_SAFARI&&(s.classList.add("audio-player-safari"),s.classList.add(t?"audio-player-safari-left":"audio-player-safari-right")),s}static addNewAudioMessage(e,t,s,n=!1){const i=FileMessages.createAudioElement(t,s),r=e.createNewMessageElement("",s);r.bubbleElement.appendChild(i),r.bubbleElement.classList.add("audio-message"),e.elementRef.appendChild(r.outerContainer),FileMessageUtils.updateMessages(e,r,t,"audio",s,n)}static createAnyFile(e){const t=document.createElement("div");t.classList.add("any-file-message-contents");const s=document.createElement("div");s.classList.add("any-file-message-icon-container");const n=SVGIconUtils.createSVGElement(FILE_ICON_STRING);n.classList.add("any-file-message-icon"),s.appendChild(n);const i=document.createElement("div");return i.classList.add("any-file-message-text"),i.textContent=e.name||FileMessageUtils.DEFAULT_FILE_NAME,t.appendChild(s),t.appendChild(i),FileMessageUtils.processContent(t,e.src)}static addNewAnyFileMessage(e,t,s,n=!1){const i=e.createNewMessageElement("",s),r=FileMessages.createAnyFile(t);i.bubbleElement.classList.add("any-file-message-bubble"),i.bubbleElement.appendChild(r),e.elementRef.appendChild(i.outerContainer),FileMessageUtils.updateMessages(e,i,t,"file",s,n)}}const aiLogoUrl="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8c3ZnIGZpbGw9IiMwMDAwMDAiIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIAoJCXZpZXdCb3g9IjAgMCAzMiAzMiIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+Cgk8cGF0aCBkPSJNMjMsMzAuMzZIOWMtMi40MDQsMC00LjM2LTEuOTU2LTQuMzYtNC4zNlYxNWMwLTIuNDA0LDEuOTU2LTQuMzYsNC4zNi00LjM2aDMuNjU5CgkJYzAuMTY3LTEuNTY2LDEuNDE1LTIuODEzLDIuOTgxLTIuOTgxVjUuMzMzYy0xLjEzMS0wLjE3NC0yLTEuMTU0LTItMi4zMzNjMC0xLjMwMSwxLjA1OS0yLjM2LDIuMzYtMi4zNgoJCWMxLjMwMiwwLDIuMzYsMS4wNTksMi4zNiwyLjM2YzAsMS4xNzktMC44NjksMi4xNTktMiwyLjMzM1Y3LjY2YzEuNTY2LDAuMTY3LDIuODE0LDEuNDE1LDIuOTgxLDIuOTgxSDIzCgkJYzIuNDA0LDAsNC4zNiwxLjk1Niw0LjM2LDQuMzZ2MTFDMjcuMzYsMjguNDA0LDI1LjQwNCwzMC4zNiwyMywzMC4zNnogTTksMTEuMzZjLTIuMDA3LDAtMy42NCwxLjYzMy0zLjY0LDMuNjR2MTEKCQljMCwyLjAwNywxLjYzMywzLjY0LDMuNjQsMy42NGgxNGMyLjAwNywwLDMuNjQtMS42MzMsMy42NC0zLjY0VjE1YzAtMi4wMDctMS42MzMtMy42NC0zLjY0LTMuNjRIOXogTTEzLjM4NCwxMC42NGg1LjIzMQoJCUMxOC40MzksOS4zNTQsMTcuMzM0LDguMzYsMTYsOC4zNkMxNC42NjcsOC4zNiwxMy41NjEsOS4zNTQsMTMuMzg0LDEwLjY0eiBNMTYsMS4zNmMtMC45MDQsMC0xLjY0LDAuNzM2LTEuNjQsMS42NAoJCVMxNS4wOTYsNC42NCwxNiw0LjY0YzAuOTA0LDAsMS42NC0wLjczNiwxLjY0LTEuNjRTMTYuOTA0LDEuMzYsMTYsMS4zNnogTTIwLDI3LjM2aC04Yy0xLjMwMSwwLTIuMzYtMS4wNTktMi4zNi0yLjM2CgkJczEuMDU5LTIuMzYsMi4zNi0yLjM2aDhjMS4zMDIsMCwyLjM2LDEuMDU5LDIuMzYsMi4zNlMyMS4zMDIsMjcuMzYsMjAsMjcuMzZ6IE0xMiwyMy4zNmMtMC45MDQsMC0xLjY0LDAuNzM1LTEuNjQsMS42NAoJCXMwLjczNiwxLjY0LDEuNjQsMS42NGg4YzAuOTA0LDAsMS42NC0wLjczNSwxLjY0LTEuNjRzLTAuNzM1LTEuNjQtMS42NC0xLjY0SDEyeiBNMzEsMjMuODZoLTJjLTAuMTk5LDAtMC4zNi0wLjE2MS0wLjM2LTAuMzZWMTUKCQljMC0wLjE5OSwwLjE2MS0wLjM2LDAuMzYtMC4zNmgyYzAuMTk5LDAsMC4zNiwwLjE2MSwwLjM2LDAuMzZ2OC41QzMxLjM2LDIzLjY5OSwzMS4xOTksMjMuODYsMzEsMjMuODZ6IE0yOS4zNiwyMy4xNGgxLjI3OXYtNy43OAoJCUgyOS4zNlYyMy4xNHogTTMsMjMuODZIMWMtMC4xOTksMC0wLjM2LTAuMTYxLTAuMzYtMC4zNlYxNWMwLTAuMTk5LDAuMTYxLTAuMzYsMC4zNi0wLjM2aDJjMC4xOTksMCwwLjM2LDAuMTYxLDAuMzYsMC4zNnY4LjUKCQlDMy4zNiwyMy42OTksMy4xOTksMjMuODYsMywyMy44NnogTTEuMzYsMjMuMTRoMS4yOHYtNy43OEgxLjM2VjIzLjE0eiBNMjAsMjAuMzZjLTEuMzAyLDAtMi4zNi0xLjA1OS0yLjM2LTIuMzYKCQlzMS4wNTktMi4zNiwyLjM2LTIuMzZzMi4zNiwxLjA1OSwyLjM2LDIuMzZDMjIuMzYsMTkuMzAyLDIxLjMwMiwyMC4zNiwyMCwyMC4zNnogTTIwLDE2LjM2Yy0wLjkwNCwwLTEuNjQsMC43MzYtMS42NCwxLjY0CgkJczAuNzM1LDEuNjQsMS42NCwxLjY0czEuNjQtMC43MzUsMS42NC0xLjY0UzIwLjkwNCwxNi4zNiwyMCwxNi4zNnogTTEyLDIwLjM2Yy0xLjMwMSwwLTIuMzYtMS4wNTktMi4zNi0yLjM2czEuMDU5LTIuMzYsMi4zNi0yLjM2CgkJczIuMzYsMS4wNTksMi4zNiwyLjM2QzE0LjM2LDE5LjMwMiwxMy4zMDEsMjAuMzYsMTIsMjAuMzZ6IE0xMiwxNi4zNmMtMC45MDQsMC0xLjY0LDAuNzM2LTEuNjQsMS42NHMwLjczNiwxLjY0LDEuNjQsMS42NAoJCXMxLjY0LTAuNzM1LDEuNjQtMS42NFMxMi45MDQsMTYuMzYsMTIsMTYuMzZ6Ii8+Cgk8cmVjdCBzdHlsZT0iZmlsbDpub25lOyIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIi8+Cjwvc3ZnPg==",avatarUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAAD6CAMAAAC/MqoPAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAADNQTFRF////9vX18vLy/Pz86enp4+Li2tnZ1tbWzczM+fn57Ozs4N/f09LS0M/P5uXl7+/v3dzcwtncCAAAAAFiS0dEAIgFHUgAAAAJcEhZcwAAAEgAAABIAEbJaz4AAAZNSURBVHja7d3bdtsqEABQYABZSLH9/3+ZpnUsIcF5iOM6PfElNoMHMfPQdq3GmL0GkLhEUqLaUExnOtOZznSmM53pTGc605nOdKYznelMZzrTmV4LXSqllKyJDkob26xWq8Zae/iH0QoWTm9d1xur4WuypQJtTd+5dqn0VjcxzNO5/57mEBvdLo8Oron6aseWOjYOFkVvjQs3DmgyONMuht52EfztP+4hdu0i6LCO808/M8c1lE/fuPGej41uUzgdtoO/75N+2ELJ9I3b3//hPXbiMenm3pR/Jt4USgcLBIp4Bh10gqKVhvLo0klCxeSky96nKcj3siw6pJIL4XsoiQ7apyvMY/V3HHrSRioLopvEhSpTCn2TPEuwKYMOIX0tAxRBf/Hpa+lfSqBv9gi1FPsNfTrMAiVmIE/vJhz61FGnQxRIEYE4vfNYdN8Rp6MlHaHotHTn8ejekaZPAjEmyvQWdZFTtYTpXqCGJ0zvcek9Yfoel76nS0ffv1NMp1ca+pkgyfRCGind4L7OWWc605l+cxjsyhqy9AGbPpClc1/nvl5VX0c/3Alk6RU3+Am7shNZ+h6bvidLr7jBB+zKBrL0irOOudmIUDzTmf5gIP+iEuXtRuTVaEmY/oZLfyNMrzjryPc0gerMTdpVg0tvjJUU6bLPcGOoUv46SLL6Wi8yhLf06C7TUyekI0efRaaYqdFltkeNpPumRPSMDxgBYvSM035FrKAmH72hRW99PrpvSdEHkTEGUvSsK3yKVDkuJ92RohcZaehzzirPpOg+J92Tolfc4Cumx5xVXpGiZ34+ICX6W84qv5GiR5NPbiIpOv6BCoSvSkTX+eiaGP092zINvBOj4x8mSf9FqejvNo/cvpOji19ZbmviL0GPLsYMFzgzCor0+Bv/ePDvSJKOb9dJ5UlnbnEHiHgzv6cdTpJOWuc/u3FEucLDOL75xGtBiefrcwgoC9NDSH/jkH6pAuXmBqPQ9HSUPVdZBH1GGOrMXAQdYxcKZfxAoK+KKBKFLosoEoX+u4giUehz8jlcnAuhp78I46yDYNAd+QLR6K+pr+yvxdBTHyVDubQh0UfSxaHSd0lbvNkVRE87JGOtc+PQd2QLQ6fHhJkKsSh6yg13tO08JPprsgrrXWH0dJd2vH1MLPprot4eXoujpzrdhngiD40ek2y92lggPcnWa8qN1Yz0BFuvZhRl0uOfR0v4Ewuli/Bg4Qr3lArqGdndQ3UPO1EunXYwnelMZzrTmc50pjOd6UxnOtOZznSmM53pTGf6kuj6oedFKV0s3fX6sX1S3bsi6a4PD7+/YAqYeBw6pIB/4qEgOqxdSPbGiim4NRRCbzs3Jj0L4UfXtQXQVRfn5IdA/Bw7RZzurEV6EtdsLeGXkIPuA+K1UoVeA0l62zmN/LqfSSft9KkepmoRuvi3nd5uKNFB9zbbXEANqdr941XO0NJx2v2jdJenpf+/3bvn0ts16ph+sd6hX7dPo2+2cZzE02Ia43bzDHqr+2Evnhz74ZHU30ffbKOeng1/NPV30Ns1gYQnSP2P6e65Pfxc6h02XZqXQCjhJ6kPL6bFo4NrGvAU4UII4SE2P1vQuZkuOxckVfehisF1MjUddN/MZBN+kvq5uf0O/xa66gyNS9ktMWlz44rO1Z8C19i5FPdHzPamXn+F3hryPfxMr78+4F+kq22kO6Rf6fUQt+puuustyWv4rbG3l/duztFB96GYoe1cTBdXMr+nw9qVM6ZfxOvzezff0nXi/ZOndvrR6Zvpm0c3h6nhdb+5iS7tsIim/qXZD9+97/Jf+rpZ5BET1ayv0GUzLhEuhBBjIy/RdVPgndutIRt9nt7p5cKFEEJ3Z+jQFDZL+XnMDXxHB73gxn5s9Kc3d3/pFciFkN/QTSXHJpX5l66gDrkQoP6hL3xsPw39la4qOiV8tH78XeSbue6N9mvWa6J/ybpc1CT1Wnh5Qq9meP8IOKH3ddH7E/ri1iYux/SXDrXR4UiPdck/wUpU+FtPf6/orja6O9KL3l56LOvVxe5Ib2qjN0d6Vbex4ghWlU3bPqI90If66MNng680FNpbJijH6kCvaF3uMzQ3+IrpFerV4Y9dffQdN3im10ivbuImhD3Qq5u4HdZkua8znelMZ/pS4z9CPVKkxowNxgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNy0wMy0yN1QxNTo0NToxNSswMDowMN1xSg4AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTctMDMtMjdUMTU6NDU6MTUrMDA6MDCsLPKyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==";class AvatarEl{static applyCustomStylesToElements(e,t,s){Object.assign(e.style,s.container),Object.assign(t.style,s.avatar)}static applyCustomStyles(e,t,s,n){var i,r,o;null!=(i=s.default)&&i.styles&&AvatarEl.applyCustomStylesToElements(e,t,s.default.styles),n?null!=(r=s.ai)&&r.styles&&AvatarEl.applyCustomStylesToElements(e,t,s.ai.styles):null!=(o=s.user)&&o.styles&&AvatarEl.applyCustomStylesToElements(e,t,s.user.styles)}static createAvatar(e,t){var s,n,i,r;const o=document.createElement("img");o.src=e?(null==(s=null==t?void 0:t.ai)?void 0:s.src)||(null==(n=null==t?void 0:t.default)?void 0:n.src)||aiLogoUrl:(null==(i=null==t?void 0:t.user)?void 0:i.src)||(null==(r=null==t?void 0:t.default)?void 0:r.src)||avatarUrl,o.classList.add("avatar");const a=document.createElement("div");return a.classList.add("avatar-container"),a.appendChild(o),t&&AvatarEl.applyCustomStyles(a,o,t,e),a}static getPosition(e,t){var s,n,i,r,o,a;let l=e?null==(n=null==(s=null==t?void 0:t.ai)?void 0:s.styles)?void 0:n.position:null==(r=null==(i=null==t?void 0:t.user)?void 0:i.styles)?void 0:r.position;return l??(l=null==(a=null==(o=null==t?void 0:t.default)?void 0:o.styles)?void 0:a.position),l??(l=e?"left":"right"),l}static add(e,t,s){const n="boolean"==typeof s?void 0:s,i=AvatarEl.createAvatar(t,n),r=AvatarEl.getPosition(t,n);i.classList.add("left"===r?"left-item-position":"right-item-position"),e.insertAdjacentElement("left"===r?"beforebegin":"afterend",i)}}class Name{static getPosition(e,t){var s,n,i;let r=e?null==(s=null==t?void 0:t.ai)?void 0:s.position:null==(n=null==t?void 0:t.user)?void 0:n.position;return r||(r=null==(i=null==t?void 0:t.default)?void 0:i.position),r||(r=e?"left":"right"),r}static applyStyle(e,t,s){var n,i,r;Object.assign(e.style,null==(n=s.default)?void 0:n.style,t?null==(i=s.ai)?void 0:i.style:null==(r=s.user)?void 0:r.style)}static getNameText(e,t){var s,n,i,r;return e?(null==(s=t.ai)?void 0:s.text)||(null==(n=t.default)?void 0:n.text)||"AI":(null==(i=t.user)?void 0:i.text)||(null==(r=t.default)?void 0:r.text)||"User"}static createName(e,t){const s=document.createElement("div");return s.classList.add("name"),s.textContent=Name.getNameText(e,t),Name.applyStyle(s,e,t),s}static add(e,t,s){const n="boolean"==typeof s?{}:s,i=Name.createName(t,n),r=Name.getPosition(t,n);i.classList.add("left"===r?"left-item-position":"right-item-position"),e.insertAdjacentElement("left"===r?"beforebegin":"afterend",i)}}class Messages{constructor(e,t,s){var n,i;this._messageElementRefs=[],this._streamedText="",this.messages=[];const{permittedErrorPrefixes:r,introPanelMarkUp:o,demo:a}=t;this._remarkable=RemarkableConfig.createNew(),this.elementRef=Messages.createContainerElement(),this.messageStyles=e.messageStyles,this._avatars=e.avatars,this._names=e.names,this._errorMessageOverrides=null==(n=e.errorMessages)?void 0:n.overrides,this._onNewMessage=FireEvents.onNewMessage.bind(this,e),this._displayLoadingMessage=Messages.getDisplayLoadingMessage(e,t),this._permittedErrorPrefixes=r,this.populateIntroPanel(s,o,e.introPanelStyle),e.introMessage&&this.addIntroductoryMessage(e.introMessage),e.initialMessages&&this.populateInitialMessages(e.initialMessages),this.displayServiceErrorMessages=null==(i=e.errorMessages)?void 0:i.displayServiceErrorMessages,e.getMessages=()=>JSON.parse(JSON.stringify(this.messages)),e.refreshMessages=this.refreshTextMessages.bind(this),a&&this.prepareDemo(a),e.textToSpeech&&TextToSpeech.processConfig(e.textToSpeech,(e=>{this._textToSpeech=e}))}static getDisplayLoadingMessage(e,t){return!t.websocket&&(e.displayLoadingBubble??!0)}prepareDemo(e){"object"==typeof e&&(e.response&&(this.customDemoResponse=e.response),e.displayErrors&&(e.displayErrors.default&&this.addNewErrorMessage("",""),e.displayErrors.service&&this.addNewErrorMessage("service",""),e.displayErrors.speechToText&&this.addNewErrorMessage("speechToText","")),e.displayLoadingBubble&&this.addLoadingMessage())}static createContainerElement(){const e=document.createElement("div");return e.id="messages",e}addIntroductoryMessage(e){var t;const s=this.createAndAppendNewMessageElement(e,!0);this.applyCustomStyles(s,!0,!1,null==(t=this.messageStyles)?void 0:t.intro)}populateInitialMessages(e){e.forEach((e=>{e.text?this.addNewMessage({text:e.text},"ai"===e.role,!0,!0):e.file&&this.addNewMessage({files:[e.file]},"ai"===e.role,!0,!0)})),setTimeout((()=>this.elementRef.scrollTop=this.elementRef.scrollHeight))}applyCustomStyles(e,t,s,n){this.messageStyles&&MessageStyleUtils.applyCustomStyles(this.messageStyles,e,t,s,n)}addInnerContainerElements(e,t,s){return e.classList.add("message-bubble",s?"ai-message-text":"user-message-text"),e.innerHTML=this._remarkable.render(t),0===e.innerText.trim().length&&(e.innerText=t),this._avatars&&AvatarEl.add(e,s,this._avatars),this._names&&Name.add(e,s,this._names),{bubbleElement:e}}static createMessageContent(e,t,s){return s?{role:e?"ai":"user",file:s}:{role:e?"ai":"user",text:t||""}}static createBaseElements(){const e=document.createElement("div"),t=document.createElement("div");t.classList.add("inner-message-container"),e.appendChild(t),e.classList.add("outer-message-container");const s=document.createElement("div");return s.classList.add("message-bubble"),t.appendChild(s),{outerContainer:e,innerContainer:t,bubbleElement:s}}createMessageElements(e,t){const s=Messages.createBaseElements(),{outerContainer:n,innerContainer:i,bubbleElement:r}=s;return n.appendChild(i),this.addInnerContainerElements(r,e,t),this._messageElementRefs.push(s),s}createNewMessageElement(e,t){var s;null==(s=this._introPanel)||s.hide();const n=this._messageElementRefs[this._messageElementRefs.length-1];return null!=n&&n.bubbleElement.classList.contains("loading-message-text")&&(n.outerContainer.remove(),this._messageElementRefs.pop()),this.createMessageElements(e,t)}createAndAppendNewMessageElement(e,t){const s=this.createNewMessageElement(e,t);return this.elementRef.appendChild(s.outerContainer),this.elementRef.scrollTop=this.elementRef.scrollHeight,s}static editEmptyMessageElement(e){e.textContent=".",e.style.color="#00000000"}addNewTextMessage(e,t,s,n=!1){const i=this.createAndAppendNewMessageElement(e,t);this.applyCustomStyles(i,t,!1);const r=Messages.createMessageContent(t,e);return 0===e.trim().length&&Messages.editEmptyMessageElement(i.bubbleElement),this.messages.push(r),s&&this.sendClientUpdate(r,n),i}addNewMessage(e,t,s,n=!1){void 0!==e.text&&null!==e.text?(this.addNewTextMessage(e.text,t,s,n),!n&&this._textToSpeech&&t&&TextToSpeech.speak(e.text,this._textToSpeech)):e.files&&e.files.forEach((e=>{var s,i;"audio"===e.type||null!=(s=e.src)&&s.startsWith("data:audio")?FileMessages.addNewAudioMessage(this,e,t,n):"image"===e.type||"gif"===e.type||null!=(i=e.src)&&i.startsWith("data:image")?FileMessages.addNewImageMessage(this,e,t,n):FileMessages.addNewAnyFileMessage(this,e,t,n)}))}sendClientUpdate(e,t=!1){var s;null==(s=this._onNewMessage)||s.call(this,e,t)}removeMessageOnError(){var e;const t=null==(e=this._messageElementRefs[this._messageElementRefs.length-1])?void 0:e.bubbleElement;(null!=t&&t.classList.contains("streamed-message")&&""===t.textContent||null!=t&&t.classList.contains("loading-message-text"))&&(t.remove(),this._messageElementRefs.pop())}addNewErrorMessage(e,t){var s,n,i,r;this.removeMessageOnError();const o=Messages.createBaseElements(),{outerContainer:a,bubbleElement:l}=o;l.classList.add("error-message-text");const c=this.getPermittedMessage(t)||(null==(s=this._errorMessageOverrides)?void 0:s[e])||(null==(n=this._errorMessageOverrides)?void 0:n.default)||"Error, please try again.";l.innerHTML=c;const d=MessageStyleUtils.extractParticularSharedStyles(["fontSize","fontFamily"],null==(i=this.messageStyles)?void 0:i.default);MessageStyleUtils.applyCustomStylesToElements(o,!1,d),MessageStyleUtils.applyCustomStylesToElements(o,!1,null==(r=this.messageStyles)?void 0:r.error),this.elementRef.appendChild(a),this.elementRef.scrollTop=this.elementRef.scrollHeight,this._textToSpeech&&TextToSpeech.speak(c,this._textToSpeech),this._streamedText=""}static checkPermittedErrorPrefixes(e,t){for(let s=0;s<e.length;s+=1)if(t.startsWith(e[s]))return t}getPermittedMessage(e){if(e){if(this.displayServiceErrorMessages)return e;if("string"==typeof e&&this._permittedErrorPrefixes){const t=Messages.checkPermittedErrorPrefixes(this._permittedErrorPrefixes,e);if(t)return t}else if(Array.isArray(e)&&this._permittedErrorPrefixes)for(let t=0;t<e.length;t+=1){const s=Messages.checkPermittedErrorPrefixes(this._permittedErrorPrefixes,e[t]);if(s)return s}}}isLastMessageError(){var e,t,s,n,i;return null==(i=null==(n=null==(s=null==(t=null==(e=this.elementRef.children[this.elementRef.children.length-1])?void 0:e.children)?void 0:t[0])?void 0:s.children)?void 0:n[0])?void 0:i.classList.contains("error-message-text")}addLoadingMessage(){var e;if(!this._displayLoadingMessage)return;const t=this.createMessageElements("",!0),{outerContainer:s,bubbleElement:n}=t;n.classList.add("loading-message-text");const i=document.createElement("div");i.classList.add("dots-flashing"),n.appendChild(i),this.applyCustomStyles(t,!0,!1,null==(e=this.messageStyles)?void 0:e.loading),LoadingMessageDotsStyle.set(n,this.messageStyles),this.elementRef.appendChild(s),this.elementRef.scrollTop=this.elementRef.scrollHeight}addNewStreamedMessage(){const{bubbleElement:e}=this.addNewTextMessage("",!0,!1);return e.classList.add("streamed-message"),this.elementRef.scrollTop=this.elementRef.scrollHeight,e}updateStreamedMessage(e,t){var s,n,i,r,o;const a=ElementUtils.isScrollbarAtBottomOfElement(this.elementRef);if(0!==e.trim().length){const e=null==(s=this.messageStyles)?void 0:s.default;t.style.color=(null==(i=null==(n=null==e?void 0:e.ai)?void 0:n.bubble)?void 0:i.color)||(null==(o=null==(r=null==e?void 0:e.shared)?void 0:r.bubble)?void 0:o.color)||""}this._streamedText+=e,t.innerHTML=this._remarkable.render(this._streamedText),a&&(this.elementRef.scrollTop=this.elementRef.scrollHeight)}finaliseStreamedMessage(){this.messages[this.messages.length-1].text=this._streamedText,this.sendClientUpdate(Messages.createMessageContent(!0,this._streamedText),!1),this._textToSpeech&&TextToSpeech.speak(this._streamedText,this._textToSpeech),this._streamedText=""}populateIntroPanel(e,t,s){(e||t)&&(this._introPanel=new IntroPanel(e,t,s),this._introPanel._elementRef&&this.elementRef.appendChild(this._introPanel._elementRef))}async addMultipleFiles(e){return Promise.all((e||[]).map((e=>new Promise((t=>{if(e.type&&"any"!==e.type){const s=new FileReader;s.readAsDataURL(e.file),s.onload=()=>{this.addNewMessage({files:[{src:s.result,type:e.type}]},!1,!0),t(!0)}}else{const s=e.file.name||FileMessageUtils.DEFAULT_FILE_NAME;this.addNewMessage({files:[{name:s,type:"any"}]},!1,!0),t(!0)}})))))}refreshTextMessages(){this._remarkable=RemarkableConfig.createNew(),this.messages.forEach(((e,t)=>{e.text&&(this._messageElementRefs[t].bubbleElement.innerHTML=this._remarkable.render(e.text))}))}}const _InputButtonStyleAdjustments=class{static adjustInputPadding(e,t){t["inside-left"].length>0&&e.classList.add("text-input-inner-left-adjustment"),t["inside-right"].length>0&&e.classList.add("text-input-inner-right-adjustment")}static adjustForOutsideButton(e,t,s){0===s["outside-right"].length&&s["outside-left"].length>0?(e[0].classList.add(_InputButtonStyleAdjustments.INPUT_OUTSIDE_LEFT_SMALL_ADJUSTMENT_CLASS),t.classList.add(_InputButtonStyleAdjustments.INPUT_OUTSIDE_LEFT_SMALL_ADJUSTMENT_CLASS)):0===s["outside-left"].length&&s["outside-right"].length>0&&(e[3].classList.add(_InputButtonStyleAdjustments.INPUT_OUTSIDE_RIGHT_SMALL_ADJUSTMENT_CLASS),t.classList.add(_InputButtonStyleAdjustments.INPUT_OUTSIDE_RIGHT_SMALL_ADJUSTMENT_CLASS))}static adjustOutsideSubmit(e,t,s){if(!(s["inside-left"].length>0||s["inside-right"].length>0)){if(0===s["outside-right"].length&&s["outside-left"].length>0)return e[0].classList.add(_InputButtonStyleAdjustments.INPUT_OUTSIDE_LEFT_ADJUSTMENT_CLASS),t.classList.add(_InputButtonStyleAdjustments.INPUT_OUTSIDE_LEFT_ADJUSTMENT_CLASS),s["outside-left"].map((e=>e.button.elementRef.classList.add("submit-button-enlarged")));if(0===s["outside-left"].length&&s["outside-right"].length>0)return e[3].classList.add(_InputButtonStyleAdjustments.INPUT_OUTSIDE_RIGHT_ADJUSTMENT_CLASS),t.classList.add(_InputButtonStyleAdjustments.INPUT_OUTSIDE_RIGHT_ADJUSTMENT_CLASS),s["outside-right"].map((e=>e.button.elementRef.classList.add("submit-button-enlarged")))}}static set(e,t,s,n){!!_InputButtonStyleAdjustments.adjustOutsideSubmit(t,s,n)||_InputButtonStyleAdjustments.adjustForOutsideButton(t,s,n),_InputButtonStyleAdjustments.adjustInputPadding(e,n)}};let InputButtonStyleAdjustments=_InputButtonStyleAdjustments;InputButtonStyleAdjustments.INPUT_OUTSIDE_LEFT_ADJUSTMENT_CLASS="text-input-container-left-adjustment",InputButtonStyleAdjustments.INPUT_OUTSIDE_RIGHT_ADJUSTMENT_CLASS="text-input-container-right-adjustment",InputButtonStyleAdjustments.INPUT_OUTSIDE_LEFT_SMALL_ADJUSTMENT_CLASS="text-input-container-left-small-adjustment",InputButtonStyleAdjustments.INPUT_OUTSIDE_RIGHT_SMALL_ADJUSTMENT_CLASS="text-input-container-right-small-adjustment";class ButtonContainers{static create(){return Array.from({length:4}).map(((e,t)=>{const s=document.createElement("div");return s.classList.add("input-button-container"),(0===t||3===t)&&s.classList.add("outer-button-container"),(1===t||2===t)&&s.classList.add("inner-button-container"),s}))}static add(e,t){e.insertBefore(t[1],e.firstChild),e.insertBefore(t[0],e.firstChild),e.appendChild(t[2]),e.appendChild(t[3])}static getContainerIndex(e){return"outside-left"===e?0:"inside-left"===e?1:"inside-right"===e?2:3}static addButton(e,t,s){t.classList.add(s);const n=ButtonContainers.getContainerIndex(s);e[n].appendChild(t),3===n&&t.classList.add("outside-right")}}const BUTTON_ORDER=["camera","gifs","images","audio","mixedFiles","submit","microphone"];class CustomButtonInnerElements{static createTextElement(e){const t=document.createElement("div");return t.classList.add("text-button"),t.innerText=e,t}static createElement(e,t){return t?CustomButtonInnerElements.createTextElement(e):SVGIconUtils.createSVGElement(e)}static createCustomElement(e,t){var s,n,i,r;const o=e[t];return null!=(s=null==o?void 0:o.text)&&s.content?CustomButtonInnerElements.createElement(null==(n=null==o?void 0:o.text)?void 0:n.content,!0):null!=(i=null==o?void 0:o.svg)&&i.content?CustomButtonInnerElements.createElement(null==(r=null==o?void 0:o.svg)?void 0:r.content,!1):void 0}static processElement(e,t){null!=t&&t.classList.contains("text-button")||e.classList.add("input-button-svg")}static createSpecificStateElement(e,t,s){let n;return s&&(n=CustomButtonInnerElements.createCustomElement(s,t)),CustomButtonInnerElements.processElement(e,n),n}static create(e,t,s){const n={};if(!s)return CustomButtonInnerElements.processElement(e),n;const i=CustomButtonInnerElements.createSpecificStateElement(e,t[0],s);n[t[0]]=i;let r=i;return t.slice(1).forEach((e=>{r=CustomButtonInnerElements.createCustomElement(s,e)||r,n[e]=r})),n}}const PLUS_ICON_STRING='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">\n    <path d="M16 0c-8.836 0-16 7.163-16 16s7.163 16 16 16c8.837 0 16-7.163 16-16s-7.163-16-16-16zM16 30.032c-7.72 0-14-6.312-14-14.032s6.28-14 14-14 14 6.28 14 14-6.28 14.032-14 14.032zM23 15h-6v-6c0-0.552-0.448-1-1-1s-1 0.448-1 1v6h-6c-0.552 0-1 0.448-1 1s0.448 1 1 1h6v6c0 0.552 0.448 1 1 1s1-0.448 1-1v-6h6c0.552 0 1-0.448 1-1s-0.448-1-1-1z"></path>\n</svg>';class ButtonCSS{static unsetAllCSS(e,t){var s,n;t.container&&StyleUtils.unsetAllCSSMouseStates(e,t.container),null!=(s=t.svg)&&s.styles&&StyleUtils.unsetAllCSSMouseStates(e.children[0],t.svg.styles),null!=(n=t.text)&&n.styles&&StyleUtils.unsetAllCSSMouseStates(e.children[0],t.text.styles)}static unsetActionCSS(e,t){var s,n;t.container&&StyleUtils.unsetActivityCSSMouseStates(e,t.container),null!=(s=t.svg)&&s.styles&&StyleUtils.unsetActivityCSSMouseStates(e.children[0],t.svg.styles),null!=(n=t.text)&&n.styles&&StyleUtils.unsetActivityCSSMouseStates(e.children[0],t.text.styles)}static setElementsCSS(e,t,s){var n,i,r,o,a;Object.assign(e.style,null==(n=t.container)?void 0:n[s]),Object.assign(e.children[0].style,null==(r=null==(i=t.svg)?void 0:i.styles)?void 0:r[s]),Object.assign(e.children[0].style,null==(a=null==(o=t.text)?void 0:o.styles)?void 0:a[s])}static setElementCssUpToState(e,t,s){ButtonCSS.setElementsCSS(e,t,"default"),"default"!==s&&(ButtonCSS.setElementsCSS(e,t,"hover"),"hover"!==s&&ButtonCSS.setElementsCSS(e,t,"click"))}}class InputButton{constructor(e,t,s,n){this._mouseState={state:"default"},this.elementRef=e,this._customStyles=s,this.position=t,this.dropupText=n}buttonMouseLeave(e){this._mouseState.state="default",e&&(ButtonCSS.unsetAllCSS(this.elementRef,e),ButtonCSS.setElementsCSS(this.elementRef,e,"default"))}buttonMouseEnter(e){this._mouseState.state="hover",e&&ButtonCSS.setElementsCSS(this.elementRef,e,"hover")}buttonMouseUp(e){e&&ButtonCSS.unsetActionCSS(this.elementRef,e),this.buttonMouseEnter(e)}buttonMouseDown(e){this._mouseState.state="click",e&&ButtonCSS.setElementsCSS(this.elementRef,e,"click")}setEvents(e){this.elementRef.onmousedown=this.buttonMouseDown.bind(this,e),this.elementRef.onmouseup=this.buttonMouseUp.bind(this,e),this.elementRef.onmouseenter=this.buttonMouseEnter.bind(this,e),this.elementRef.onmouseleave=this.buttonMouseLeave.bind(this,e)}unsetCustomStateStyles(e){if(this._customStyles)for(let t=0;t<e.length;t+=1){const s=e[t],n=s&&this._customStyles[s];n&&ButtonCSS.unsetActionCSS(this.elementRef,n)}}reapplyStateStyle(e,t){if(!this._customStyles)return;t&&this.unsetCustomStateStyles(t);const s=this._customStyles[e];s&&ButtonCSS.setElementCssUpToState(this.elementRef,s,this._mouseState.state),this.setEvents(s)}}class DropupItemNavigation{static focusItemWhenOnEdge(e,t){const s=t?e.children[0]:e.children[e.children.length-1];DropupItemNavigation.focusSiblingItem(s,e,t,!0)}static focusSiblingItem(e,t,s,n=!1){const i=n?e:e[s?"nextSibling":"previousSibling"];i?(e.dispatchEvent(new MouseEvent("mouseleave")),i.dispatchEvent(new MouseEvent("mouseenter"))):(e.dispatchEvent(new MouseEvent("mouseleave")),DropupItemNavigation.focusItemWhenOnEdge(t,s))}}class StatefulEvents{static mouseUp(e,t){const s=t.target;StyleUtils.unsetAllCSSMouseStates(s,e),Object.assign(s.style,e.default),Object.assign(s.style,e.hover)}static mouseDown(e,t){const s=t.target;Object.assign(s.style,e.click)}static mouseLeave(e,t){const s=t.target;StyleUtils.unsetAllCSSMouseStates(s,e),Object.assign(s.style,e.default)}static mouseEnter(e,t){const s=t.target;Object.assign(s.style,e.hover)}static add(e,t){e.addEventListener("mouseenter",StatefulEvents.mouseEnter.bind(this,t)),e.addEventListener("mouseleave",StatefulEvents.mouseLeave.bind(this,t)),e.addEventListener("mousedown",StatefulEvents.mouseDown.bind(this,t)),e.addEventListener("mouseup",StatefulEvents.mouseUp.bind(this,t))}}class DropupItem{static addItemEvents(e,t,s,n){StatefulEvents.add(t,n),t.addEventListener("click",(()=>{s.click()})),t.addEventListener("mouseenter",(t=>{e.highlightedItem=t.target})),t.addEventListener("mouseleave",(()=>{e.highlightedItem=void 0}))}static createItemText(e,t){const s=document.createElement("div");return Object.assign(s.style,t),s.classList.add("dropup-menu-item-text"),s.textContent=e||"File",s}static createItemIcon(e,t){const s=document.createElement("div");return Object.assign(s.style,t),s.classList.add("dropup-menu-item-icon"),s.appendChild(e.children[0]),s}static populateItem(e,t,s,n){const i=e.children[0];i.classList.contains("text-button")?t.appendChild(DropupItem.createItemText(i.textContent,null==n?void 0:n.text)):(t.appendChild(DropupItem.createItemIcon(e,null==n?void 0:n.iconContainer)),t.appendChild(DropupItem.createItemText(s,null==n?void 0:n.text)))}static createItem(e,t,s){var n;const{elementRef:i,dropupText:r}=t,o=document.createElement("div");Object.assign(o.style,null==(n=null==s?void 0:s.item)?void 0:n.default),DropupItem.populateItem(i,o,r,s),o.classList.add("dropup-menu-item");const a=StyleUtils.generateStateful((null==s?void 0:s.item)||{},{backgroundColor:"#f3f3f3"},{backgroundColor:"#ebebeb"});return DropupItem.addItemEvents(e,o,i,a),o}}class DropupMenu{constructor(e,t){var s;this._isOpen=!0,this._styles=t,this.elementRef=DropupMenu.createElement(null==(s=this._styles)?void 0:s.container),this.close(),setTimeout((()=>this.addWindowEvents(e)))}static createElement(e){const t=document.createElement("div");return t.id="dropup-menu",Object.assign(t.style,e),t}open(){this.elementRef.style.display="block",this._isOpen=!0}close(){this._isOpen&&(this.elementRef.style.display="none",this._isOpen=!1)}toggle(){this._isOpen?this.close():this.open()}addItem(e){const t=DropupItem.createItem(this,e,this._styles);this.elementRef.appendChild(t)}addWindowEvents(e){window.addEventListener("click",(t=>{var s;e.parentElement!==(null==(s=t.target.shadowRoot)?void 0:s.children[0])&&this.close()})),window.addEventListener("keydown",(e=>{var t,s,n;this._isOpen&&(e.key===KEYBOARD_KEY.ESCAPE?(this.close(),null==(t=this.highlightedItem)||t.dispatchEvent(new MouseEvent("mouseleave"))):e.key===KEYBOARD_KEY.ENTER?(null==(s=this.highlightedItem)||s.click(),null==(n=this.highlightedItem)||n.dispatchEvent(new MouseEvent("mouseleave"))):e.key===KEYBOARD_KEY.ARROW_DOWN?DropupItemNavigation.focusSiblingItem(this.highlightedItem||this.elementRef.children[this.elementRef.children.length-1],this.elementRef,!0):e.key===KEYBOARD_KEY.ARROW_UP&&DropupItemNavigation.focusSiblingItem(this.highlightedItem||this.elementRef.children[0],this.elementRef,!1))}))}}class Dropup extends InputButton{constructor(e,t){var s;super(Dropup.createButtonElement(),void 0,{styles:null==(s=null==t?void 0:t.button)?void 0:s.styles});const n=this.createInnerElements(this._customStyles);this._menu=new DropupMenu(e,null==t?void 0:t.menu),this.addClickEvent(),this.buttonContainer=Dropup.createButtonContainer(),this.elementRef.appendChild(n.styles),this.buttonContainer.appendChild(this.elementRef),this.elementRef.classList.add("dropup-icon","upload-file-button"),this.buttonContainer.appendChild(this._menu.elementRef),this.reapplyStateStyle("styles"),this.addContainerEvents(e)}static createButtonElement(){const e=document.createElement("div");return e.classList.add("input-button"),e}createInnerElements(e){return{styles:this.createInnerElement(Dropup.createSVGIconElement(),"styles",e)}}createInnerElement(e,t,s){return CustomButtonInnerElements.createSpecificStateElement(this.elementRef,t,s)||e}static createSVGIconElement(){const e=SVGIconUtils.createSVGElement(PLUS_ICON_STRING);return e.id="dropup-icon",e}addClickEvent(){this.elementRef.onclick=this._menu.toggle.bind(this._menu)}static createButtonContainer(){const e=document.createElement("div");return e.id="dropup-container",e}addItem(e){this._menu.addItem(e)}addContainerEvents(e){e.addEventListener("click",(e=>{e.target.classList.contains("dropup-icon")||this._menu.close()}))}static getPosition(e,t){var s,n;return null!=(s=null==t?void 0:t.button)&&s.position?null==(n=null==t?void 0:t.button)?void 0:n.position:e["outside-left"].length>0&&0===e["outside-right"].length?"outside-right":"outside-left"}}class InputButtonPositions{static addToDropup(e,t,s,n){const i=new Dropup(s,n);BUTTON_ORDER.forEach((e=>{const s=t["dropup-menu"].findIndex((t=>t.buttonType===e)),n=t["dropup-menu"][s];n&&(i.addItem(n.button),t["dropup-menu"].splice(s,1))}));const r=Dropup.getPosition(t,n);ButtonContainers.addButton(e,i.buttonContainer,r),t[r].push({})}static addToSideContainer(e,t){["inside-left","inside-right","outside-left","outside-right"].forEach((s=>{const n=s;t[n].forEach((t=>{ButtonContainers.addButton(e,t.button.elementRef,n)}))}))}static setPosition(e,t,s){const n={...e[t],buttonType:t};s.push(n),delete e[t]}static createPositionsObj(){return{"dropup-menu":[],"outside-left":[],"inside-left":[],"inside-right":[],"outside-right":[]}}static generatePositions(e){const t=InputButtonPositions.createPositionsObj();Object.keys(e).forEach((s=>{var n;const i=null==(n=e[s])?void 0:n.button.position;i&&InputButtonPositions.setPosition(e,s,t[i])})),0===t["inside-right"].length&&e.submit&&InputButtonPositions.setPosition(e,"submit",t["inside-right"]),0===t["outside-right"].length&&(e.submit?InputButtonPositions.setPosition(e,"submit",t["outside-right"]):e.microphone?InputButtonPositions.setPosition(e,"microphone",t["outside-right"]):e.camera&&InputButtonPositions.setPosition(e,"camera",t["outside-right"])),e.submit&&InputButtonPositions.setPosition(e,"submit",0===t["outside-left"].length?t["outside-left"]:t["inside-right"]),e.microphone&&InputButtonPositions.setPosition(e,"microphone",0===t["outside-left"].length?t["outside-left"]:t["inside-right"]);const s=Object.keys(e);return s.length>1||t["dropup-menu"].length>0?BUTTON_ORDER.forEach((s=>{e[s]&&t["dropup-menu"].push({...e[s],buttonType:s})})):1===s.length&&InputButtonPositions.setPosition(e,s[0],0===t["outside-right"].length?t["outside-right"]:t["outside-left"]),t}static addButtons(e,t,s,n){const i=InputButtonPositions.generatePositions(t);return InputButtonPositions.addToSideContainer(e,i),i["dropup-menu"].length>0&&InputButtonPositions.addToDropup(e,i,s,n),i}}const MIXED_FILES_ICON_STRING='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<title>file</title>\n<path d="M20 10.9696L11.9628 18.5497C10.9782 19.4783 9.64274 20 8.25028 20C6.85782 20 5.52239 19.4783 4.53777 18.5497C3.55315 17.6211 3 16.3616 3 15.0483C3 13.7351 3.55315 12.4756 4.53777 11.547L12.575 3.96687C13.2314 3.34779 14.1217 3 15.05 3C15.9783 3 16.8686 3.34779 17.525 3.96687C18.1814 4.58595 18.5502 5.4256 18.5502 6.30111C18.5502 7.17662 18.1814 8.01628 17.525 8.63535L9.47904 16.2154C9.15083 16.525 8.70569 16.6989 8.24154 16.6989C7.77738 16.6989 7.33224 16.525 7.00403 16.2154C6.67583 15.9059 6.49144 15.4861 6.49144 15.0483C6.49144 14.6106 6.67583 14.1907 7.00403 13.8812L14.429 6.88674" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>',IMAGE_ICON_STRING='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n  <path d="M20,15.2928932 L20,5.5 C20,4.67157288 19.3284271,4 18.5,4 L5.5,4 C4.67157288,4 4,4.67157288 4,5.5 L4,12.2928932 L7.14644661,9.14644661 C7.34170876,8.95118446 7.65829124,8.95118446 7.85355339,9.14644661 L13.5,14.7928932 L16.1464466,12.1464466 C16.3417088,11.9511845 16.6582912,11.9511845 16.8535534,12.1464466 L20,15.2928932 Z M20,16.7071068 L16.5,13.2071068 L13.8535534,15.8535534 C13.6582912,16.0488155 13.3417088,16.0488155 13.1464466,15.8535534 L7.5,10.2071068 L4,13.7071068 L4,18.5 C4,19.3284271 4.67157288,20 5.5,20 L18.5,20 C19.3284271,20 20,19.3284271 20,18.5 L20,16.7071068 Z M3,5.5 C3,4.11928813 4.11928813,3 5.5,3 L18.5,3 C19.8807119,3 21,4.11928813 21,5.5 L21,18.5 C21,19.8807119 19.8807119,21 18.5,21 L5.5,21 C4.11928813,21 3,19.8807119 3,18.5 L3,5.5 Z M15,6 L17,6 C17.5522847,6 18,6.44771525 18,7 L18,9 C18,9.55228475 17.5522847,10 17,10 L15,10 C14.4477153,10 14,9.55228475 14,9 L14,7 C14,6.44771525 14.4477153,6 15,6 Z M15,7 L15,9 L17,9 L17,7 L15,7 Z"/>\n</svg>\n',AUDIO_ICON_STRING='<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="-49.49 -49.49 593.87 593.87" stroke-width="3.95908" transform="rotate(0)">\n  <g stroke-width="0"></g>\n  <g stroke-linecap="round" stroke-linejoin="round" stroke-width="0.98977"></g>\n  <g>\n    <g>\n      <g>\n        <path d="M163.205,76.413v293.301c-3.434-3.058-7.241-5.867-11.486-8.339c-21.38-12.452-49.663-15.298-77.567-7.846 c-49.038,13.096-80.904,54.519-71.038,92.337c4.019,15.404,14.188,28.221,29.404,37.087c13.553,7.894,29.87,11.933,47.115,11.933 c9.962,0,20.231-1.356,30.447-4.087c42.74-11.406,72.411-44.344,72.807-77.654h0.011v-0.162c0.002-0.166,0-0.331,0-0.496V187.072 l290.971-67.3v178.082c-3.433-3.055-7.238-5.863-11.481-8.334c-21.385-12.452-49.654-15.308-77.567-7.846 c-49.038,13.087-80.904,54.519-71.038,92.356c4.019,15.385,14.183,28.212,29.404,37.067c13.548,7.894,29.875,11.933,47.115,11.933 c9.962,0,20.231-1.356,30.452-4.087c42.74-11.413,72.411-44.346,72.804-77.654h0.004v-0.065c0.003-0.236,0.001-0.469,0-0.704V0 L163.205,76.413z M104.999,471.779c-22.543,6.038-45.942,3.846-62.572-5.846c-10.587-6.163-17.591-14.817-20.255-25.038 c-7.144-27.375,18.452-58.029,57.062-68.346c8.409-2.25,16.938-3.346,25.188-3.346c13.87,0,26.962,3.115,37.389,9.192 c10.587,6.163,17.591,14.817,20.255,25.029c0.809,3.102,1.142,6.248,1.139,9.4v0.321h0.014 C162.99,437.714,139.082,462.678,104.999,471.779z M182.898,166.853V92.067l290.971-67.298v74.784L182.898,166.853z M415.677,399.923c-22.558,6.038-45.942,3.837-62.587-5.846c-10.587-6.163-17.587-14.817-20.25-25.019 c-7.144-27.385,18.452-58.058,57.058-68.365c8.414-2.25,16.942-3.346,25.192-3.346c13.875,0,26.962,3.115,37.385,9.192 c10.596,6.163,17.596,14.817,20.26,25.029v0.01c0.796,3.05,1.124,6.144,1.135,9.244v0.468h0.02 C473.668,365.851,449.763,390.814,415.677,399.923z">\n        </path>\n      </g>\n    </g>\n  </g>\n</svg>',GIF_ICON_STRING='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 5.9266752 5.6408391" height="21.31971" width="22.4">\n  <g>\n    <path d="m 5.2564627,1.548212 c -3.1136005,-0.4796804 -1.5568006,-0.2398402 0,0 z M 2.0001198,2.0922063 c 0.1556781,0 0.2657489,0.020893 0.3917849,0.080366 0.081154,0.038347 0.1153492,0.134065 0.076377,0.2138602 -0.038973,0.07979 -0.1363527,0.1134129 -0.2175069,0.075091 -0.078199,-0.036919 -0.1407455,-0.048792 -0.250655,-0.048792 -0.2260486,0 -0.3921482,0.2042182 -0.3921482,0.4801409 0,0.2761822 0.1663188,0.4810688 0.3921482,0.4810688 0.1117901,0 0.2064255,-0.046133 0.255659,-0.1284198 l 0.00162,-0.00389 V 3.0534032 l -0.098011,1.75e-4 c -0.081844,0 -0.1495979,-0.059305 -0.1612403,-0.1365887 l -0.00175,-0.023683 c 0,-0.08047 0.060311,-0.1470874 0.1389194,-0.1585331 l 0.024085,-0.00195 h 0.2612303 c 0.081842,0 0.149598,0.059305 0.1612404,0.1365891 l 0.00175,0.023683 -3.398e-4,0.3968809 v 0 l -0.00168,0.014211 v 0 l -0.00553,0.023034 v 0 l -0.00532,0.014145 c -0.098178,0.22826 -0.3236506,0.3528713 -0.5706303,0.3528713 -0.4240855,0 -0.7181621,-0.3622714 -0.7181621,-0.8016063 0,-0.4391857 0.2940275,-0.8006848 0.7181621,-0.8006848 z m 1.2034759,0.031275 c 0.081843,0 0.1495977,0.059305 0.1612403,0.1365891 l 0.00175,0.023683 v 1.2211775 c 0,0.088516 -0.07298,0.1602721 -0.1630073,0.1602721 -0.081841,0 -0.1495972,-0.059305 -0.1612397,-0.1365892 L 3.040589,3.5049308 V 2.2837527 c 0,-0.088516 0.07298,-0.1602721 0.1630067,-0.1602714 z m 0.7813442,0 0.5209469,0.00195 c 0.090025,3.048e-4 0.1627543,0.072306 0.1624458,0.1608234 -2.809e-4,0.08047 -0.06083,0.1468798 -0.1394772,0.158066 l -0.024092,0.00195 -0.3575326,-0.0013 v 0.4497782 l 0.2928918,2.27e-4 c 0.081842,0 0.1495979,0.059305 0.1612403,0.136589 l 0.00175,0.023683 c 0,0.080469 -0.06031,0.1470871 -0.1389193,0.1585393 l -0.024092,0.00195 -0.2928919,-2.336e-4 1.563e-4,0.2860316 c 0,0.080471 -0.06031,0.1470873 -0.1389193,0.1585395 l -0.024085,0.00195 c -0.081843,0 -0.1495979,-0.059305 -0.1612403,-0.1365826 l -0.00175,-0.023691 V 2.2841354 c 2.798e-4,-0.08047 0.060829,-0.1468797 0.1394758,-0.1580594 z"/>\n    <path d="m 5.0894191,1.0943261 c 0,-0.21918999 -0.177687,-0.39686999 -0.396876,-0.39686999 h -3.43959 c -0.2191879,0 -0.391262,0.1777519 -0.3968759,0.39686999 l -0.027082,3.4379266 c 0.040152,0.2939927 0.4235456,0.409415 0.4235456,0.409415 l 3.4785583,-0.00851 c 0,0 0.3008506,-0.1402998 0.3236271,-0.4201576 0.042911,-0.5272495 0.034693,-1.6106146 0.034693,-3.4186761 z m -4.49792494,0 c 0,-0.36530999 0.29614504,-0.66145999 0.66145894,-0.66145999 h 3.43959 c 0.365314,0 0.66146,0.29615 0.66146,0.66145999 v 3.43959 c 0,0.36532 -0.296146,0.66146 -0.66146,0.66146 h -3.43959 c -0.3653139,0 -0.66145894,-0.29614 -0.66145894,-0.66146 z"/>\n  </g>\n</svg>\n',FILE_TYPE_BUTTON_ICONS={images:{id:"upload-images-icon",svgString:IMAGE_ICON_STRING,dropupText:"Image"},gifs:{id:"upload-gifs-icon",svgString:GIF_ICON_STRING,dropupText:"GIF"},audio:{id:"upload-audio-icon",svgString:AUDIO_ICON_STRING,dropupText:"Audio"},mixedFiles:{id:"upload-mixed-files-icon",svgString:MIXED_FILES_ICON_STRING,dropupText:"File"}};class FileAttachmentsType{constructor(e,t,s){this._attachments=[],this._fileCountLimit=99,this._acceptedFormat="",e.maxNumberOfFiles&&(this._fileCountLimit=e.maxNumberOfFiles),this._toggleContainerDisplay=t,this._fileAttachmentsContainerRef=s,e.acceptedFormats&&(this._acceptedFormat=e.acceptedFormats)}attemptAddFile(e,t){return!!FileAttachmentsType.isFileTypeValid(e,this._acceptedFormat)&&(this.addAttachmentBasedOnType(e,t,!0),!0)}static isFileTypeValid(e,t){if(""===t)return!0;const s=t.split(",");for(let n=0;n<s.length;n++){const t=s[n].trim();if(e.type===t)return!0;if(t.startsWith(".")){const s=t.slice(1);if(e.name.endsWith(s))return!0}else{if(e.name.endsWith(t))return!0;if(t.endsWith("/*")&&e.type.startsWith(t.slice(0,-2)))return!0}}return!1}addAttachmentBasedOnType(e,t,s){if(e.type.startsWith("image")){const n=FileAttachmentsType.createImageAttachment(t);this.addFileAttachment(e,"image",n,s)}else if(e.type.startsWith("audio")){const n=AudioFileAttachmentType.createAudioAttachment(t);this.addFileAttachment(e,"audio",n,s)}else{const t=FileAttachmentsType.createAnyFileAttachment(e.name);this.addFileAttachment(e,"any",t,s)}}static createImageAttachment(e){const t=new Image;return t.src=e,t.classList.add("image-attachment"),t}static createAnyFileAttachment(e){const t=document.createElement("div");t.classList.add("border-bound-attachment"),Browser$1.IS_SAFARI&&t.classList.add("border-bound-attachment-safari");const s=document.createElement("div");s.classList.add("any-file-attachment-text");const n=document.createElement("div");return n.classList.add("file-attachment-text-container"),n.appendChild(s),s.textContent=e,t.appendChild(n),t}addFileAttachment(e,t,s,n){const i=FileAttachmentsType.createContainer(s);if(this._attachments.length>=this._fileCountLimit){const e=this._attachments[this._attachments.length-1].removeButton;null==e||e.click();const t=this._fileAttachmentsContainerRef.children;this._fileAttachmentsContainerRef.insertBefore(i,t[0])}else this._fileAttachmentsContainerRef.appendChild(i);const r={file:e,attachmentContainerElement:i,fileType:t};return n&&(r.removeButton=this.createRemoveAttachmentButton(r),i.appendChild(r.removeButton)),this._toggleContainerDisplay(!0),this._attachments.push(r),this._fileAttachmentsContainerRef.scrollTop=this._fileAttachmentsContainerRef.scrollHeight,r}static createContainer(e){const t=document.createElement("div");return t.classList.add("file-attachment"),t.appendChild(e),t}createRemoveAttachmentButton(e){const t=document.createElement("div");t.classList.add("remove-file-attachment-button"),t.onclick=this.removeAttachment.bind(this,e);const s=document.createElement("div");return s.classList.add("x-icon"),s.innerText="\xd7",t.appendChild(s),t}removeAttachment(e){const t=this._attachments.findIndex((t=>t===e)),s=this._attachments[t].attachmentContainerElement;this._attachments.splice(t,1),AudioFileAttachmentType.stopAttachmentPlayback(s),s.remove(),this._toggleContainerDisplay(!1)}getFiles(){return Array.from(this._attachments).map((e=>({file:e.file,type:e.fileType})))}removeAllAttachments(){this._attachments.forEach((e=>{setTimeout((()=>{var t;return null==(t=e.removeButton)?void 0:t.click()}))}))}}const PLAY_ICON_STRING='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">\n  <title>play</title>\n  <path d="M5.92 24.096q0 1.088 0.928 1.728 0.512 0.288 1.088 0.288 0.448 0 0.896-0.224l16.16-8.064q0.48-0.256 0.8-0.736t0.288-1.088-0.288-1.056-0.8-0.736l-16.16-8.064q-0.448-0.224-0.896-0.224-0.544 0-1.088 0.288-0.928 0.608-0.928 1.728v16.16z"></path>\n</svg>',STOP_ICON_STRING='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">\n<title>stop</title>\n<path d="M5.92 24.096q0 0.832 0.576 1.408t1.44 0.608h16.128q0.832 0 1.44-0.608t0.576-1.408v-16.16q0-0.832-0.576-1.44t-1.44-0.576h-16.128q-0.832 0-1.44 0.576t-0.576 1.44v16.16z"></path>\n</svg>',_AudioFileAttachmentType=class extends FileAttachmentsType{constructor(e,t,s){super(e,t,s)}static createAudioContainer(){const e=document.createElement("div");return e.classList.add("border-bound-attachment","audio-attachment-icon-container"),Browser$1.IS_SAFARI&&e.classList.add("border-bound-attachment-safari"),e}static addAudioElements(e,t){const s=e.parentElement?ElementUtils.cloneElement(e):e,n=document.createElement("audio");n.src=t;const i=SVGIconUtils.createSVGElement(PLAY_ICON_STRING);i.classList.add("attachment-icon","play-icon");const r=SVGIconUtils.createSVGElement(STOP_ICON_STRING);r.classList.add("attachment-icon","stop-icon"),s.replaceChildren(i),n.onplay=()=>{s.replaceChildren(r)},n.onpause=()=>{s.replaceChildren(i),n.currentTime=0},n.onended=()=>{s.replaceChildren(i)},s.onclick=()=>{n.paused?n.play():n.pause()}}static createAudioAttachment(e){const t=_AudioFileAttachmentType.createAudioContainer();return _AudioFileAttachmentType.addAudioElements(t,e),t}createTimer(e,t){let s=0;const n=void 0!==t&&t<_AudioFileAttachmentType.TIMER_LIMIT_S?t:_AudioFileAttachmentType.TIMER_LIMIT_S;return setInterval((()=>{var t;s+=1,s===n&&(null==(t=this.stopPlaceholderCallback)||t.call(this),this.clearTimer()),600===s&&e.classList.add("audio-placeholder-text-4-digits");const i=Math.floor(s/60),r=(s%60).toString().padStart(2,"0");e.textContent=`${i}:${r}`}),1e3)}createPlaceholderAudioAttachment(e){const t=_AudioFileAttachmentType.createAudioContainer(),s=document.createElement("div");s.classList.add("audio-placeholder-text-3-digits");const n=document.createElement("div");n.classList.add("file-attachment-text-container","audio-placeholder-text-3-digits-container"),n.appendChild(s);const i=SVGIconUtils.createSVGElement(STOP_ICON_STRING);return i.classList.add("attachment-icon","stop-icon","not-removable-attachment-icon"),s.textContent="0:00",this._activePlaceholderTimer=this.createTimer(s,e),t.appendChild(n),this.addPlaceholderAudioAttachmentEvents(t,i,n),t}addPlaceholderAudioAttachmentEvents(e,t,s){e.addEventListener("mouseenter",(()=>e.replaceChildren(t)));e.addEventListener("mouseleave",(()=>e.replaceChildren(s)));e.addEventListener("click",(()=>{var e;return null==(e=this.stopPlaceholderCallback)?void 0:e.call(this)}))}addPlaceholderAttachment(e,t){const s=this.createPlaceholderAudioAttachment(t);this._activePlaceholderAttachment=this.addFileAttachment(new File([],""),"audio",s,!1),this.stopPlaceholderCallback=e}completePlaceholderAttachment(e,t){const s=this._activePlaceholderAttachment;s&&(s.file=e,_AudioFileAttachmentType.addAudioElements(s.attachmentContainerElement.children[0],t),s.removeButton=this.createRemoveAttachmentButton(s),s.attachmentContainerElement.appendChild(s.removeButton),this._activePlaceholderAttachment=void 0,this.clearTimer())}removePlaceholderAttachment(){this._activePlaceholderAttachment&&(this.removeAttachment(this._activePlaceholderAttachment),this._activePlaceholderAttachment=void 0,this.clearTimer())}clearTimer(){void 0!==this._activePlaceholderTimer&&(clearInterval(this._activePlaceholderTimer),this._activePlaceholderTimer=void 0,this.stopPlaceholderCallback=void 0)}static stopAttachmentPlayback(e){var t,s,n;null!=(n=null==(s=null==(t=e.children[0])?void 0:t.children)?void 0:s[0])&&n.classList.contains("stop-icon")&&e.children[0].click()}};let AudioFileAttachmentType=_AudioFileAttachmentType;AudioFileAttachmentType.TIMER_LIMIT_S=5999;class FileAttachmentTypeFactory{static create(e,t,s,n){return"audio"===n?new AudioFileAttachmentType(e,t,s):new FileAttachmentsType(e,t,s)}}class FileAttachments{constructor(e,t,s){this._fileAttachmentsTypes=[],this.elementRef=this.createAttachmentContainer();const n="object"==typeof s&&!!s.displayFileAttachmentContainer;this.toggleContainerDisplay(n),e.appendChild(this.elementRef),t&&Object.assign(this.elementRef.style,t)}addType(e,t){const s=FileAttachmentTypeFactory.create(e,this.toggleContainerDisplay.bind(this),this.elementRef,t);return this._fileAttachmentsTypes.push(s),s}createAttachmentContainer(){const e=document.createElement("div");return e.id="file-attachment-container",e}toggleContainerDisplay(e){e?this.elementRef.style.display="block":0===this.elementRef.children.length&&(this.elementRef.style.display="none")}getAllFileData(){const e=this._fileAttachmentsTypes.map((e=>e.getFiles())).flat();return e.length>0?e:void 0}async completePlaceholders(){await Promise.all(this._fileAttachmentsTypes.map((async e=>{var t;return null==(t=e.stopPlaceholderCallback)?void 0:t.call(e)})))}static addFilesToType(e,t){e.forEach((e=>{const s=new FileReader;s.readAsDataURL(e),s.onload=s=>{for(let n=0;n<t.length&&!t[n].attemptAddFile(e,s.target.result);n+=1);}}))}addFilesToAnyType(e){FileAttachments.addFilesToType(e,this._fileAttachmentsTypes)}removeAllFiles(){this._fileAttachmentsTypes.forEach((e=>e.removeAllAttachments())),this.elementRef.replaceChildren(),this.toggleContainerDisplay(!1)}getNumberOfTypes(){return this._fileAttachmentsTypes.length}}const _Modal=class{constructor(e,t,s){this._isOpen=!1,this._contentRef=_Modal.createModalContent(t,null==s?void 0:s.backgroundColor),this._buttonPanel=_Modal.createButtonPanel(null==s?void 0:s.backgroundColor),this._elementRef=_Modal.createContainer(this._contentRef,s),this._elementRef.appendChild(this._buttonPanel),e.appendChild(this._elementRef),this._backgroundPanelRef=_Modal.createDarkBackgroundPanel(),e.appendChild(this._backgroundPanelRef),this.addWindowEvents()}isOpen(){return this._isOpen}static createContainer(e,t){const s=document.createElement("div");return s.classList.add("modal"),s.appendChild(e),t&&delete t.backgroundColor,Object.assign(s.style,t),s}static createModalContent(e,t){const s=document.createElement("div");return s.classList.add(...e),t&&(s.style.backgroundColor=t),document.createElement("div").appendChild(s),s}static createButtonPanel(e){const t=document.createElement("div");return t.classList.add("modal-button-panel"),e&&(t.style.backgroundColor=e),t}static createDarkBackgroundPanel(){const e=document.createElement("div");return e.id="modal-background-panel",e}addButtons(...e){e.forEach((e=>this._buttonPanel.appendChild(e)))}static createTextButton(e){const t=document.createElement("div");return t.classList.add("modal-button"),t.textContent=e,t}static createSVGButton(e){const t=document.createElement("div");t.classList.add("modal-button","modal-svg-button");const s=SVGIconUtils.createSVGElement(e);return s.classList.add("modal-svg-button-icon"),t.appendChild(s),t}close(){this._elementRef.classList.remove("show-modal"),this._elementRef.classList.add("hide-modal"),this._backgroundPanelRef.classList.remove("show-modal-background"),this._backgroundPanelRef.classList.add("hide-modal-background"),this._isOpen=!1,setTimeout((()=>{this._elementRef.style.display="none",this._backgroundPanelRef.style.display="none"}),_Modal.MODAL_CLOSE_TIMEOUT_MS)}displayModalElements(){this._elementRef.style.display="flex",this._elementRef.classList.remove("hide-modal"),this._elementRef.classList.add("show-modal"),this._backgroundPanelRef.style.display="block",this._backgroundPanelRef.classList.remove("hide-modal-background"),this._backgroundPanelRef.classList.add("show-modal-background"),this._isOpen=!0}openTextModal(e){this._contentRef.innerHTML=e,this.displayModalElements()}addCloseButton(e,t,s){const n=t?_Modal.createSVGButton(e):_Modal.createTextButton(e);return this.addButtons(n),n.onclick=()=>{this.close(),setTimeout((()=>{null==s||s()}),140)},n}static createTextModalFunc(e,t,s){var n;if("object"==typeof t&&null!=(n=t.files)&&n.infoModal){const n=new _Modal(e,["modal-content"],t.files.infoModal.containerStyle);return n.addCloseButton("OK",!1,s),n.openTextModal.bind(n,t.infoModalTextMarkUp||"")}}addWindowEvents(){window.addEventListener("keydown",(e=>{var t,s;this._isOpen&&(e.key===KEYBOARD_KEY.ESCAPE?(this.close(),null==(t=this.extensionCloseCallback)||t.call(this)):e.key===KEYBOARD_KEY.ENTER&&(this.close(),null==(s=this.extensionCloseCallback)||s.call(this)))}))}};let Modal=_Modal;Modal.MODAL_CLOSE_TIMEOUT_MS=190;class UploadFileButton extends InputButton{constructor(e,t,s,n,i,r){var o,a,l,c,d,u;super(UploadFileButton.createButtonElement(),null==(o=s.button)?void 0:o.position,s.button,r);const p=this.createInnerElements(n,i,this._customStyles);this._inputElement=UploadFileButton.createInputElement(null==(a=null==s?void 0:s.files)?void 0:a.acceptedFormats),this.addClickEvent(e,s),this.elementRef.replaceChildren(p.styles),this.reapplyStateStyle("styles"),this._fileAttachmentsType=t,this._openModalOnce=!1===(null==(c=null==(l=s.files)?void 0:l.infoModal)?void 0:c.openModalOnce)||null==(u=null==(d=s.files)?void 0:d.infoModal)?void 0:u.openModalOnce}createInnerElements(e,t,s){const n=UploadFileButton.createSVGIconElement(e,t);return{styles:this.createInnerElement(n,"styles",s)}}triggerImportPrompt(e){e.onchange=this.import.bind(this,e),e.click()}import(e){FileAttachments.addFilesToType(Array.from(e.files||[]),[this._fileAttachmentsType]),e.value=""}static createInputElement(e){const t=document.createElement("input");return t.type="file",t.accept=e||"",t.hidden=!0,t.multiple=!0,t}createInnerElement(e,t,s){return CustomButtonInnerElements.createSpecificStateElement(this.elementRef,t,s)||e}static createButtonElement(){const e=document.createElement("div");return e.classList.add("input-button","upload-file-button"),e}static createSVGIconElement(e,t){const s=SVGIconUtils.createSVGElement(t);return s.id=e,s}addClickEvent(e,t){const s=this.triggerImportPrompt.bind(this,this._inputElement),n=Modal.createTextModalFunc(e,t,s);this.elementRef.onclick=this.click.bind(this,n)}click(e){!e||void 0!==this._openModalOnce&&!0!==this._openModalOnce?this.triggerImportPrompt(this._inputElement):(e(),!0===this._openModalOnce&&(this._openModalOnce=!1))}}class DragAndDrop{static create(e,t,s){const n=DragAndDrop.createElement(s);DragAndDrop.addEvents(n,e,t),e.appendChild(n)}static createElement(e){const t=document.createElement("div");return t.id="drag-and-drop","object"==typeof e&&Object.assign(t.style,e),t}static addEvents(e,t,s){t.ondragenter=t=>{t.preventDefault(),DragAndDrop.display(e)},e.ondragleave=t=>{t.preventDefault(),DragAndDrop.hide(e)},e.ondragover=e=>{e.preventDefault()},e.ondrop=t=>{t.preventDefault(),DragAndDrop.uploadFile(s,t),DragAndDrop.hide(e)}}static uploadFile(e,t){var s;const n=null==(s=t.dataTransfer)?void 0:s.files;n&&e.addFilesToAnyType(Array.from(n))}static display(e){e.style.display="block"}static hide(e){e.style.display="none"}static isEnabled(e,t){return(void 0===t||!1!==t)&&(!!t||e.getNumberOfTypes()>0)}}const MICROPHONE_ICON_STRING='<?xml version="1.0" encoding="iso-8859-1"?>\n<svg height="1.4em" width="1.4em" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n\t viewBox="0 0 490.9 490.9" xml:space="preserve">\n\t<g>\n\t\t<g>\n\t\t\t<path d="M245.5,322.9c53,0,96.2-43.2,96.2-96.2V96.2c0-53-43.2-96.2-96.2-96.2s-96.2,43.2-96.2,96.2v130.5\n\t\t\t\tC149.3,279.8,192.5,322.9,245.5,322.9z M173.8,96.2c0-39.5,32.2-71.7,71.7-71.7s71.7,32.2,71.7,71.7v130.5\n\t\t\t\tc0,39.5-32.2,71.7-71.7,71.7s-71.7-32.2-71.7-71.7V96.2z"/>\n\t\t\t<path d="M94.4,214.5c-6.8,0-12.3,5.5-12.3,12.3c0,85.9,66.7,156.6,151.1,162.8v76.7h-63.9c-6.8,0-12.3,5.5-12.3,12.3\n\t\t\t\ts5.5,12.3,12.3,12.3h152.3c6.8,0,12.3-5.5,12.3-12.3s-5.5-12.3-12.3-12.3h-63.9v-76.7c84.4-6.3,151.1-76.9,151.1-162.8\n\t\t\t\tc0-6.8-5.5-12.3-12.3-12.3s-12.3,5.5-12.3,12.3c0,76.6-62.3,138.9-138.9,138.9s-138.9-62.3-138.9-138.9\n\t\t\t\tC106.6,220,101.2,214.5,94.4,214.5z"/>\n\t\t</g>\n\t</g>\n</svg>\n';class MicrophoneButton extends InputButton{constructor(e){"dropup-menu"===(null==e?void 0:e.position)&&(e.position="outside-right"),super(MicrophoneButton.createMicrophoneElement(),null==e?void 0:e.position,e),this.isActive=!1,this._innerElements=this.createInnerElements(this._customStyles),this.changeToDefault()}createInnerElements(e){const t=MicrophoneButton.createSVGIconElement();return{default:this.createInnerElement(t,"default",e),active:this.createInnerElement(t,"active",e),unsupported:this.createInnerElement(t,"unsupported",e),commandMode:this.createInnerElement(t,"commandMode",e)}}createInnerElement(e,t,s){return CustomButtonInnerElements.createSpecificStateElement(this.elementRef,t,s)||e}static createMicrophoneElement(){const e=document.createElement("div");return e.id="microphone-button",e.classList.add("input-button"),e}static createSVGIconElement(){const e=SVGIconUtils.createSVGElement(MICROPHONE_ICON_STRING);return e.id="microphone-icon",e}changeToActive(){this.elementRef.replaceChildren(this._innerElements.active),this.toggleIconFilter("active"),this.reapplyStateStyle("active",["default","commandMode"]),this.isActive=!0}changeToDefault(){this.elementRef.replaceChildren(this._innerElements.default),this.toggleIconFilter("default"),this.reapplyStateStyle("default",["active","commandMode"]),this.isActive=!1}changeToCommandMode(){this.elementRef.replaceChildren(this._innerElements.unsupported),this.toggleIconFilter("command"),this.reapplyStateStyle("commandMode",["active"])}changeToUnsupported(){this.elementRef.replaceChildren(this._innerElements.unsupported),this.elementRef.classList.add("unsupported-microphone"),this.reapplyStateStyle("unsupported",["active"])}toggleIconFilter(e){const t=this.elementRef.children[0];if("svg"===t.tagName.toLocaleLowerCase())switch(e){case"default":t.classList.remove("active-microphone-icon","command-microphone-icon"),t.classList.add("default-microphone-icon");break;case"active":t.classList.remove("default-microphone-icon","command-microphone-icon"),t.classList.add("active-microphone-icon");break;case"command":t.classList.remove("active-microphone-icon","default-microphone-icon"),t.classList.add("command-microphone-icon")}}}var dist={},webSpeech={},webSpeechTranscript={},translate={},text={};Object.defineProperty(text,"__esModule",{value:!0}),text.Text=void 0;class Text{static capitalize(e){return e.replace(Text.FIRST_CHAR_REGEX,(e=>e.toUpperCase()))}static lineBreak(e){return e.replace(Text.DOUBLE_LINE,"<p></p>").replace(Text.ONE_LINE,"<br>")}static isCharDefined(e){return void 0!==e&&"\xa0"!==e&&" "!==e&&"\n"!==e&&""!==e}static breakupIntoWordsArr(e){return e.split(/(\W+)/)}}text.Text=Text,Text.FIRST_CHAR_REGEX=/\S/,Text.DOUBLE_LINE=/\n\n/g,Text.ONE_LINE=/\n/g,Object.defineProperty(translate,"__esModule",{value:!0}),translate.Translate=void 0;const text_1$3=text;class Translate{static translate(e,t){const s=text_1$3.Text.breakupIntoWordsArr(e);for(let n=0;n<s.length;n+=1)t[s[n]]&&(s[n]=t[s[n]]);return s.join("")}}translate.Translate=Translate,Object.defineProperty(webSpeechTranscript,"__esModule",{value:!0}),webSpeechTranscript.WebSpeechTranscript=void 0;const translate_1$1=translate;class WebSpeechTranscript{static extract(e,t,s){let n="";for(let i=e.resultIndex;i<e.results.length;++i){let r=e.results[i][0].transcript;s&&(r=translate_1$1.Translate.translate(r,s)),e.results[i].isFinal?t+=r:n+=r}return{interimTranscript:n,finalTranscript:t,newText:n||t}}static extractSafari(e,t,s){let n="";for(let i=e.resultIndex;i<e.results.length;++i){let t=e.results[i][0].transcript;s&&(t=translate_1$1.Translate.translate(t,s)),n+=t}return{interimTranscript:"",finalTranscript:n,newText:n}}}webSpeechTranscript.WebSpeechTranscript=WebSpeechTranscript;var browser={};Object.defineProperty(browser,"__esModule",{value:!0}),browser.Browser=void 0;class Browser{}browser.Browser=Browser,Browser.IS_SAFARI=()=>(void 0===Browser._IS_SAFARI&&(Browser._IS_SAFARI=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),Browser._IS_SAFARI);var speech={},eventListeners={};Object.defineProperty(eventListeners,"__esModule",{value:!0}),eventListeners.EventListeners=void 0;class EventListeners{static getElementIfFocusedOnAvailable(e,t){return Array.isArray(e)?e.find((e=>t===e)):t===e?e:void 0}static keyDownWindow(e){e.element&&EventListeners.getElementIfFocusedOnAvailable(e.element,document.activeElement)&&(null!==EventListeners.KEY_DOWN_TIMEOUT&&clearTimeout(EventListeners.KEY_DOWN_TIMEOUT),EventListeners.KEY_DOWN_TIMEOUT=setTimeout((()=>{EventListeners.KEY_DOWN_TIMEOUT=null,this.resetRecording(e)}),500))}static mouseDownWindow(e,t){this.mouseDownElement=EventListeners.getElementIfFocusedOnAvailable(e,t.target)}static mouseUpWindow(e){this.mouseDownElement&&this.resetRecording(e),this.mouseDownElement=void 0}static add(e,t){const s=void 0===(null==t?void 0:t.insertInCursorLocation)||(null==t?void 0:t.insertInCursorLocation);null!=t&&t.element&&s&&(e.mouseDownEvent=EventListeners.mouseDownWindow.bind(e,t.element),document.addEventListener("mousedown",e.mouseDownEvent),e.mouseUpEvent=EventListeners.mouseUpWindow.bind(e,t),document.addEventListener("mouseup",e.mouseUpEvent),e.keyDownEvent=EventListeners.keyDownWindow.bind(e,t),document.addEventListener("keydown",e.keyDownEvent))}static remove(e){document.removeEventListener("mousedown",e.mouseDownEvent),document.removeEventListener("mouseup",e.mouseUpEvent),document.removeEventListener("keydown",e.keyDownEvent)}}eventListeners.EventListeners=EventListeners,EventListeners.KEY_DOWN_TIMEOUT=null;var preResultUtils={};Object.defineProperty(preResultUtils,"__esModule",{value:!0}),preResultUtils.PreResultUtils=void 0;class PreResultUtils{static process(e,t,s,n,i){const r=null==n?void 0:n(t,s);return!!r&&(setTimeout((()=>{r.restart?e.resetRecording(i):r.stop&&e.stop()})),(r.stop||r.restart)&&r.removeNewText)}}preResultUtils.PreResultUtils=PreResultUtils;var commandUtils={},autoScroll={};Object.defineProperty(autoScroll,"__esModule",{value:!0}),autoScroll.AutoScroll=void 0;class AutoScroll{static changeStateIfNeeded(e,t){t&&!e.isCursorAtEnd&&(e.endPadding="",e.scrollingSpan.innerHTML="&nbsp;")}static scrollGeneric(e,t){e.isCursorAtEnd?t.scrollTop=t.scrollHeight:e.scrollingSpan.scrollIntoView({block:"nearest"})}static scrollSafariPrimitiveToEnd(e){e.scrollLeft=e.scrollWidth,e.scrollTop=e.scrollHeight}static isElementOverflown(e){return e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth}static isRequired(e,t){return e&&AutoScroll.isElementOverflown(t)}}autoScroll.AutoScroll=AutoScroll;var elements={};Object.defineProperty(elements,"__esModule",{value:!0}),elements.Elements=void 0;class Elements{static isPrimitiveElement(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName}static createInterimSpan(){const e=document.createElement("span");return e.style.color="grey",e.style.pointerEvents="none",e}static createGenericSpan(){const e=document.createElement("span");return e.style.pointerEvents="none",e}static appendSpans(e,t){if(e.spansPopulated=!0,e.insertInCursorLocation&&document.activeElement===t){const t=window.getSelection();if(null!=t&&t.focusNode){const s=t.getRangeAt(0);return s.insertNode(e.scrollingSpan),s.insertNode(e.interimSpan),s.insertNode(e.finalSpan),s.collapse(!1),t.removeAllRanges(),void t.addRange(s)}}t.appendChild(e.finalSpan),t.appendChild(e.interimSpan),t.appendChild(e.scrollingSpan)}static applyCustomColors(e,t){t.interim&&(e.interimSpan.style.color=t.interim),t.final&&(e.finalSpan.style.color=t.final)}static isInsideShadowDOM(e){return e.getRootNode()instanceof ShadowRoot}}elements.Elements=Elements;var cursor={};Object.defineProperty(cursor,"__esModule",{value:!0}),cursor.Cursor=void 0;class Cursor{static setOffsetForGeneric(e,t,s=0){let n=0;for(let i=0;i<e.childNodes.length;i+=1){const r=e.childNodes[i];if(r.childNodes.length>0){const e=Cursor.setOffsetForGeneric(r,t,s);if(-1===e)return-1;s+=e}else if(null!==r.textContent){if(s+r.textContent.length>t){const n=document.createRange();n.setStart(r,t-s),n.collapse(!0);const i=window.getSelection();return null==i||i.removeAllRanges(),null==i||i.addRange(n),e.focus(),-1}s+=r.textContent.length,n+=r.textContent.length}}return n}static focusEndOfGeneric(e){const t=document.createRange();t.selectNodeContents(e),t.collapse(!1);const s=window.getSelection();s&&(s.removeAllRanges(),s.addRange(t))}static setOffsetForSafariGeneric(e,t){const s=window.getSelection();if(s){const n=Cursor.getGenericElementCursorOffset(e,s,!0);console.log(n),setTimeout((()=>{}),100),Cursor.setOffsetForGeneric(e,n+t)}}static setOffsetForPrimitive(e,t,s){s&&e.blur(),e.setSelectionRange(t,t),e.focus()}static getGenericElementCursorOffset(e,t,s){let n=0;if(t.rangeCount>0){const i=t.getRangeAt(0),r=i.cloneRange();r.selectNodeContents(e),s?r.setEnd(i.startContainer,i.startOffset):r.setEnd(i.endContainer,i.endOffset),n=r.toString().length}return n}}cursor.Cursor=Cursor,Object.defineProperty(commandUtils,"__esModule",{value:!0}),commandUtils.CommandUtils=void 0;const autoScroll_1$1=autoScroll,elements_1$3=elements,browser_1$2=browser,cursor_1$3=cursor,text_1$2=text;class CommandUtils{static processCommand(e,t){return(!t||!t.caseSensitive)&&(e=e.toLowerCase()),!1===(null==t?void 0:t.substrings)?text_1$2.Text.breakupIntoWordsArr(e):e}static process(e){var t;return!0===(null===(t=e.settings)||void 0===t?void 0:t.caseSensitive)?e:Object.keys(e).reduce(((t,s)=>{const n=e[s];return t[s]="string"==typeof n?CommandUtils.processCommand(n,e.settings):n,t}),{})}static toggleCommandModeOn(e){var t;e.isWaitingForCommand=!0,null===(t=e.onCommandModeTrigger)||void 0===t||t.call(e,!0)}static toggleCommandModeOff(e){var t;e.isWaitingForCommand&&(null===(t=e.onCommandModeTrigger)||void 0===t||t.call(e,!1),e.isWaitingForCommand=!1)}static setText(e,t,s,n){CommandUtils.toggleCommandModeOff(e),elements_1$3.Elements.isPrimitiveElement(n)?(n.value=s,e.isTargetInShadow||cursor_1$3.Cursor.setOffsetForPrimitive(n,s.length,!0),browser_1$2.Browser.IS_SAFARI()&&e.autoScroll&&autoScroll_1$1.AutoScroll.scrollSafariPrimitiveToEnd(n)):(n.textContent=s,e.isTargetInShadow||cursor_1$3.Cursor.focusEndOfGeneric(n),setTimeout((()=>autoScroll_1$1.AutoScroll.scrollGeneric(e,n)))),e.resetRecording(t)}static checkIfMatchesSubstring(e,t){return t.includes(e)}static checkIfMatchesWord(e,t,s){const n=e;for(let i=s.length-1;i>=0;i-=1){let e=i,t=n.length-1;for(;s[e]===n[t]&&t>=0;)e-=1,t-=1;if(t<0)return!0}return!1}static execCommand(e,t,s,n,i){var r,o,a;const l=e.commands;if(!l||!n||!s)return;const c=!0===(null===(r=l.settings)||void 0===r?void 0:r.caseSensitive)?t:t.toLowerCase(),d=text_1$2.Text.breakupIntoWordsArr(c),u=!1===(null===(o=l.settings)||void 0===o?void 0:o.substrings)?CommandUtils.checkIfMatchesWord:CommandUtils.checkIfMatchesSubstring;if(l.commandMode&&u(l.commandMode,c,d))return e.setInterimColorToFinal(),setTimeout((()=>CommandUtils.toggleCommandModeOn(e))),{doNotProcessTranscription:!1};if(!l.commandMode||e.isWaitingForCommand){if(l.stop&&u(l.stop,c,d))return CommandUtils.toggleCommandModeOff(e),setTimeout((()=>e.stop())),{doNotProcessTranscription:!1};if(l.pause&&u(l.pause,c,d))return CommandUtils.toggleCommandModeOff(e),e.setInterimColorToFinal(),setTimeout((()=>{var t;e.isPaused=!0,null===(t=e.onPauseTrigger)||void 0===t||t.call(e,!0)})),{doNotProcessTranscription:!1};if(l.resume&&u(l.resume,c,d))return e.isPaused=!1,null===(a=e.onPauseTrigger)||void 0===a||a.call(e,!1),CommandUtils.toggleCommandModeOff(e),e.resetRecording(s),{doNotProcessTranscription:!0};if(l.reset&&u(l.reset,c,d))return void 0!==i&&CommandUtils.setText(e,s,i,n),{doNotProcessTranscription:!0};if(l.removeAllText&&u(l.removeAllText,c,d))return CommandUtils.setText(e,s,"",n),{doNotProcessTranscription:!0}}}}commandUtils.CommandUtils=CommandUtils;var highlight={};Object.defineProperty(highlight,"__esModule",{value:!0}),highlight.Highlight=void 0;const elements_1$2=elements,cursor_1$2=cursor;class Highlight{static setStateForPrimitive(e,t){let s,n;null!==t.selectionStart&&(s=t.selectionStart),null!==t.selectionEnd&&(n=t.selectionEnd),e.isHighlighted=s!==n}static setStateForGeneric(e,t){const s=window.getSelection();if(null!=s&&s.focusNode){const n=cursor_1$2.Cursor.getGenericElementCursorOffset(t,s,!0),i=cursor_1$2.Cursor.getGenericElementCursorOffset(t,s,!1);e.isHighlighted=n!==i}}static setState(e,t){document.activeElement===t&&(elements_1$2.Elements.isPrimitiveElement(t)?Highlight.setStateForPrimitive(e,t):Highlight.setStateForGeneric(e,t))}static removeForGeneric(e,t){const s=window.getSelection();if(s){const n=cursor_1$2.Cursor.getGenericElementCursorOffset(t,s,!0);s.deleteFromDocument(),cursor_1$2.Cursor.setOffsetForGeneric(t,n),e.isHighlighted=!1}}static removeForPrimitive(e,t){const s=t.selectionStart,n=t.selectionEnd,i=t.value;if(s&&n){const r=i.substring(0,s)+i.substring(n);t.value=r,cursor_1$2.Cursor.setOffsetForPrimitive(t,s,e.autoScroll)}e.isHighlighted=!1}}highlight.Highlight=Highlight;var padding={};Object.defineProperty(padding,"__esModule",{value:!0}),padding.Padding=void 0;const elements_1$1=elements,cursor_1$1=cursor,text_1$1=text;class Padding{static setStateForPrimitiveElement(e,t){if(document.activeElement===t&&null!==t.selectionStart){const s=t.selectionStart,n=t.value[s-1],i=null===t.selectionEnd?s:t.selectionEnd,r=t.value[i];return text_1$1.Text.isCharDefined(n)&&(e.startPadding=" ",e.numberOfSpacesBeforeNewText=1),text_1$1.Text.isCharDefined(r)&&(e.endPadding=" ",e.numberOfSpacesAfterNewText=1),void(e.isCursorAtEnd=t.value.length===i)}const s=t.value[t.value.length-1];text_1$1.Text.isCharDefined(s)&&(e.startPadding=" ",e.numberOfSpacesBeforeNewText=1),e.isCursorAtEnd=!0}static setStateForGenericElement(e,t){var s,n,i;if(document.activeElement===t){const r=window.getSelection();if(null!=r&&r.focusNode){const o=cursor_1$1.Cursor.getGenericElementCursorOffset(t,r,!0),a=null===(s=t.textContent)||void 0===s?void 0:s[o-1],l=cursor_1$1.Cursor.getGenericElementCursorOffset(t,r,!1),c=null===(n=t.textContent)||void 0===n?void 0:n[l];return text_1$1.Text.isCharDefined(a)&&(e.startPadding=" "),text_1$1.Text.isCharDefined(c)&&(e.endPadding=" "),void(e.isCursorAtEnd=(null===(i=t.textContent)||void 0===i?void 0:i.length)===l)}}const r=t.innerText.charAt(t.innerText.length-1);text_1$1.Text.isCharDefined(r)&&(e.startPadding=" "),e.isCursorAtEnd=!0}static setState(e,t){elements_1$1.Elements.isPrimitiveElement(t)?Padding.setStateForPrimitiveElement(e,t):Padding.setStateForGenericElement(e,t)}static adjustStateAfterRecodingPrimitiveElement(e,t){e.primitiveTextRecorded=!0,e.insertInCursorLocation&&document.activeElement===t&&(null!==t.selectionEnd&&(e.endPadding=e.endPadding+t.value.slice(t.selectionEnd)),null!==t.selectionStart)?e.startPadding=t.value.slice(0,t.selectionStart)+e.startPadding:e.startPadding=t.value+e.startPadding}static adjustSateForNoTextPrimitiveElement(e){1===e.numberOfSpacesBeforeNewText&&(e.startPadding=e.startPadding.substring(0,e.startPadding.length-1),e.numberOfSpacesBeforeNewText=0),1===e.numberOfSpacesAfterNewText&&(e.endPadding=e.endPadding.substring(1),e.numberOfSpacesAfterNewText=0)}}padding.Padding=Padding,Object.defineProperty(speech,"__esModule",{value:!0}),speech.Speech=void 0;const eventListeners_1=eventListeners,preResultUtils_1=preResultUtils,commandUtils_1$1=commandUtils,autoScroll_1=autoScroll,highlight_1=highlight,elements_1=elements,padding_1=padding,browser_1$1=browser,cursor_1=cursor,text_1=text;class Speech{constructor(){this.finalTranscript="",this.interimSpan=elements_1.Elements.createInterimSpan(),this.finalSpan=elements_1.Elements.createGenericSpan(),this.scrollingSpan=elements_1.Elements.createGenericSpan(),this.isCursorAtEnd=!1,this.spansPopulated=!1,this.startPadding="",this.endPadding="",this.numberOfSpacesBeforeNewText=0,this.numberOfSpacesAfterNewText=0,this.isHighlighted=!1,this.primitiveTextRecorded=!1,this.recognizing=!1,this._displayInterimResults=!0,this.insertInCursorLocation=!0,this.autoScroll=!0,this.isRestarting=!1,this.isPaused=!1,this.isWaitingForCommand=!1,this.isTargetInShadow=!1,this.cannotBeStopped=!1,this.resetState()}prepareBeforeStart(e){var t,s;if(null!=e&&e.element)if(eventListeners_1.EventListeners.add(this,e),Array.isArray(e.element)){const t=e.element.find((e=>e===document.activeElement))||e.element[0];if(!t)return;this.prepare(t)}else this.prepare(e.element);void 0!==(null==e?void 0:e.displayInterimResults)&&(this._displayInterimResults=e.displayInterimResults),null!=e&&e.textColor&&(this._finalTextColor=null===(t=null==e?void 0:e.textColor)||void 0===t?void 0:t.final,elements_1.Elements.applyCustomColors(this,e.textColor)),void 0!==(null==e?void 0:e.insertInCursorLocation)&&(this.insertInCursorLocation=e.insertInCursorLocation),void 0!==(null==e?void 0:e.autoScroll)&&(this.autoScroll=e.autoScroll),this._onResult=null==e?void 0:e.onResult,this._onPreResult=null==e?void 0:e.onPreResult,this._onStart=null==e?void 0:e.onStart,this._onStop=null==e?void 0:e.onStop,this._onError=null==e?void 0:e.onError,this.onCommandModeTrigger=null==e?void 0:e.onCommandModeTrigger,this.onPauseTrigger=null==e?void 0:e.onPauseTrigger,this._options=e,null!==(s=this._options)&&void 0!==s&&s.commands&&(this.commands=commandUtils_1$1.CommandUtils.process(this._options.commands))}prepare(e){padding_1.Padding.setState(this,e),highlight_1.Highlight.setState(this,e),this.isTargetInShadow=elements_1.Elements.isInsideShadowDOM(e),elements_1.Elements.isPrimitiveElement(e)?(this._primitiveElement=e,this._originalText=this._primitiveElement.value):(this._genericElement=e,this._originalText=this._genericElement.textContent)}resetRecording(e){this.isRestarting=!0,this.stop(!0),this.resetState(!0),this.start(e,!0)}updateElements(e,t,s){var n;const i=text_1.Text.capitalize(t);if(this.finalTranscript===i&&""===e)return;preResultUtils_1.PreResultUtils.process(this,s,""===e,this._onPreResult,this._options)&&(e="",s="");const r=this.commands&&commandUtils_1$1.CommandUtils.execCommand(this,s,this._options,this._primitiveElement||this._genericElement,this._originalText);if(r){if(r.doNotProcessTranscription)return;e="",s=""}if(this.isPaused||this.isWaitingForCommand)return;null===(n=this._onResult)||void 0===n||n.call(this,s,""===e),this.finalTranscript=i,this._displayInterimResults||(e="");const o=""===this.finalTranscript&&""===e;this._primitiveElement?this.updatePrimitiveElement(this._primitiveElement,e,o):this._genericElement&&this.updateGenericElement(this._genericElement,e,o)}updatePrimitiveElement(e,t,s){this.isHighlighted&&highlight_1.Highlight.removeForPrimitive(this,e),this.primitiveTextRecorded||padding_1.Padding.adjustStateAfterRecodingPrimitiveElement(this,e),s&&padding_1.Padding.adjustSateForNoTextPrimitiveElement(this);const n=this.startPadding+this.finalTranscript+t;if(e.value=n+this.endPadding,!this.isTargetInShadow){const t=n.length+this.numberOfSpacesAfterNewText;cursor_1.Cursor.setOffsetForPrimitive(e,t,this.autoScroll)}this.autoScroll&&browser_1$1.Browser.IS_SAFARI()&&this.isCursorAtEnd&&autoScroll_1.AutoScroll.scrollSafariPrimitiveToEnd(e)}updateGenericElement(e,t,s){this.isHighlighted&&highlight_1.Highlight.removeForGeneric(this,e),this.spansPopulated||elements_1.Elements.appendSpans(this,e);const n=(s?"":this.startPadding)+text_1.Text.lineBreak(this.finalTranscript);this.finalSpan.innerHTML=n;const i=autoScroll_1.AutoScroll.isRequired(this.autoScroll,e);autoScroll_1.AutoScroll.changeStateIfNeeded(this,i);const r=text_1.Text.lineBreak(t)+(s?"":this.endPadding);this.interimSpan.innerHTML=r,browser_1$1.Browser.IS_SAFARI()&&this.insertInCursorLocation&&cursor_1.Cursor.setOffsetForSafariGeneric(e,n.length+r.length),i&&autoScroll_1.AutoScroll.scrollGeneric(this,e),s&&(this.scrollingSpan.innerHTML="")}finalise(e){this._genericElement&&(e?(this.finalSpan=elements_1.Elements.createGenericSpan(),this.setInterimColorToFinal(),this.interimSpan=elements_1.Elements.createInterimSpan(),this.scrollingSpan=elements_1.Elements.createGenericSpan()):this._genericElement.textContent=this._genericElement.textContent,this.spansPopulated=!1),eventListeners_1.EventListeners.remove(this)}setInterimColorToFinal(){this.interimSpan.style.color=this._finalTextColor||"black"}resetState(e){this._primitiveElement=void 0,this._genericElement=void 0,this.finalTranscript="",this.finalSpan.innerHTML="",this.interimSpan.innerHTML="",this.scrollingSpan.innerHTML="",this.startPadding="",this.endPadding="",this.isHighlighted=!1,this.primitiveTextRecorded=!1,this.numberOfSpacesBeforeNewText=0,this.numberOfSpacesAfterNewText=0,e||(this.stopTimeout=void 0)}setStateOnStart(){var e;this.recognizing=!0,this.isRestarting?this.isRestarting=!1:null===(e=this._onStart)||void 0===e||e.call(this)}setStateOnStop(){var e;this.recognizing=!1,this.isRestarting||null===(e=this._onStop)||void 0===e||e.call(this)}setStateOnError(e){var t;null===(t=this._onError)||void 0===t||t.call(this,e),this.recognizing=!1}}speech.Speech=Speech,Object.defineProperty(webSpeech,"__esModule",{value:!0}),webSpeech.WebSpeech=void 0;const webSpeechTranscript_1=webSpeechTranscript,browser_1=browser,speech_1$1=speech;class WebSpeech extends speech_1$1.Speech{constructor(){super()}start(e){var t;void 0===this._extractText&&(this._extractText=browser_1.Browser.IS_SAFARI()?webSpeechTranscript_1.WebSpeechTranscript.extractSafari:webSpeechTranscript_1.WebSpeechTranscript.extract),this.validate()&&(this.prepareBeforeStart(e),this.instantiateService(e),null===(t=this._service)||void 0===t||t.start(),this._translations=null==e?void 0:e.translations)}validate(){return!!WebSpeech.getAPI()||(this.error("Speech Recognition is unsupported"),!1)}instantiateService(e){var t,s;const n=WebSpeech.getAPI();this._service=new n,this._service.continuous=!0,this._service.interimResults=null===(t=null==e?void 0:e.displayInterimResults)||void 0===t||t,this._service.lang=(null===(s=null==e?void 0:e.language)||void 0===s?void 0:s.trim())||"en-US",this.setEvents()}setEvents(){this._service&&(this._service.onstart=()=>{this.setStateOnStart()},this._service.onerror=e=>{browser_1.Browser.IS_SAFARI()&&"Another request is started"===e.message||"aborted"===e.error&&this.isRestarting||"no-speech"!==e.error&&this.error(e.message||e.error)},this._service.onaudioend=()=>{this.setStateOnStop()},this._service.onend=()=>{this._stopping=!1},this._service.onresult=e=>{if(typeof e.results>"u"&&this._service)this._service.onend=null,this._service.stop();else if(this._extractText&&!this._stopping){const{interimTranscript:t,finalTranscript:s,newText:n}=this._extractText(e,this.finalTranscript,this._translations);this.updateElements(t,s,n)}})}stop(e){var t;this._stopping=!0,null===(t=this._service)||void 0===t||t.stop(),this.finalise(e)}static getAPI(){return window.webkitSpeechRecognition||window.SpeechRecognition}error(e){console.error(e),this.setStateOnError(e),this.stop()}}webSpeech.WebSpeech=WebSpeech;var globalState={};Object.defineProperty(globalState,"__esModule",{value:!0}),globalState.GlobalState=void 0;class GlobalState{static doubleClickDetector(){return!!GlobalState.doubleClickPending||(GlobalState.doubleClickPending=!0,setTimeout((()=>{GlobalState.doubleClickPending=!1}),300),!1)}}globalState.GlobalState=GlobalState,GlobalState.doubleClickPending=!1;var azure={},preventConnectionStop={};Object.defineProperty(preventConnectionStop,"__esModule",{value:!0}),preventConnectionStop.PreventConnectionStop=void 0;class PreventConnectionStop{static applyPrevention(e){clearTimeout(e._manualConnectionStopPrevention),e.cannotBeStopped=!0,e._manualConnectionStopPrevention=setTimeout((()=>{e.cannotBeStopped=!1}),800)}static clearPrevention(e){clearTimeout(e._manualConnectionStopPrevention),e.cannotBeStopped=!1}}preventConnectionStop.PreventConnectionStop=PreventConnectionStop;var azureSpeechConfig={},readme={};Object.defineProperty(readme,"__esModule",{value:!0}),readme.README_URL=void 0,readme.README_URL="https://github.com/OvidijusParsiunas/speech-to-element",Object.defineProperty(azureSpeechConfig,"__esModule",{value:!0}),azureSpeechConfig.AzureSpeechConfig=void 0;const readme_1=readme;class AzureSpeechConfig{static validateOptions(e,t){return t?t.subscriptionKey||t.token||t.retrieveToken?!!t.region||(e(`Please define a 'region' property - more info: ${readme_1.README_URL}`),!1):(e(`Please define a 'subscriptionKey', 'token' or 'retrieveToken' property - more info: ${readme_1.README_URL}`),!1):(e(`Please provide subscription details - more info: ${readme_1.README_URL}`),!1)}static async getNewSpeechConfig(e,t){if(t.region)return t.subscriptionKey?e.fromSubscription(t.subscriptionKey.trim(),t.region.trim()):t.token?e.fromAuthorizationToken(t.token.trim(),t.region.trim()):t.retrieveToken?t.retrieveToken().then((s=>t.region?e.fromAuthorizationToken((null==s?void 0:s.trim())||"",t.region.trim()):null)).catch((e=>(console.error(e),null))):null}static process(e,t){t.language&&(e.speechRecognitionLanguage=t.language.trim())}static async get(e,t){const s=await AzureSpeechConfig.getNewSpeechConfig(e,t);return s&&AzureSpeechConfig.process(s,t),s}}azureSpeechConfig.AzureSpeechConfig=AzureSpeechConfig;var stopTimeout={};Object.defineProperty(stopTimeout,"__esModule",{value:!0}),stopTimeout.StopTimeout=void 0;class StopTimeout{static set(e){e.stopTimeout=setTimeout((()=>e.stop()),e.stopTimeoutMS)}static reset(e,t){e.stopTimeoutMS=t||StopTimeout.DEFAULT_MS,e.stopTimeout&&clearTimeout(e.stopTimeout),StopTimeout.set(e)}}stopTimeout.StopTimeout=StopTimeout,StopTimeout.DEFAULT_MS=2e4;var azureTranscript={};Object.defineProperty(azureTranscript,"__esModule",{value:!0}),azureTranscript.AzureTranscript=void 0;const translate_1=translate;class AzureTranscript{static extract(e,t,s,n){return n&&(e=translate_1.Translate.translate(e,n)),s?{interimTranscript:"",finalTranscript:t+e,newText:e}:{interimTranscript:e,finalTranscript:t,newText:e}}}azureTranscript.AzureTranscript=AzureTranscript,Object.defineProperty(azure,"__esModule",{value:!0}),azure.Azure=void 0;const preventConnectionStop_1=preventConnectionStop,azureSpeechConfig_1=azureSpeechConfig,stopTimeout_1=stopTimeout,azureTranscript_1=azureTranscript,speech_1=speech;class Azure extends speech_1.Speech{constructor(){super(...arguments),this._newTextPadding=""}start(e,t){this._newTextPadding="",void 0===this.stopTimeout&&stopTimeout_1.StopTimeout.reset(this,null==e?void 0:e.stopAfterSilenceMs),this.prepareBeforeStart(e),this.startAsync(e),t||preventConnectionStop_1.PreventConnectionStop.applyPrevention(this)}async startAsync(e){var t;this.validate(e)&&(await this.instantiateService(e),this._translations=null==e?void 0:e.translations,null===(t=this._service)||void 0===t||t.startContinuousRecognitionAsync((()=>{}),this.error))}validate(e){return Azure.getAPI()?azureSpeechConfig_1.AzureSpeechConfig.validateOptions(this.error.bind(this),e):(this.moduleNotFound(),!1)}async instantiateService(e){const t=Azure.getAPI(),s=t.AudioConfig.fromDefaultMicrophoneInput(),n=await azureSpeechConfig_1.AzureSpeechConfig.get(t.SpeechConfig,e);if(n){const i=new t.SpeechRecognizer(n,s);this.setEvents(i),this._service=i,e.retrieveToken&&this.retrieveTokenInterval(e.retrieveToken)}else this.error("Unable to contact Azure server")}setEvents(e){e.recognizing=this.onRecognizing.bind(this),e.recognized=this.onRecognized.bind(this),e.sessionStarted=this.onSessionStarted.bind(this),e.canceled=this.onCanceled.bind(this),e.sessionStopped=this.onSessionStopped.bind(this)}onRecognizing(e,t){if(this._stopping)return;const{interimTranscript:s,finalTranscript:n,newText:i}=azureTranscript_1.AzureTranscript.extract(this._newTextPadding+t.result.text,this.finalTranscript,!1,this._translations);stopTimeout_1.StopTimeout.reset(this,this.stopTimeoutMS),this.updateElements(s,n,i)}onRecognized(e,t){const s=t.result;switch(s.reason){case window.SpeechSDK.ResultReason.Canceled:break;case window.SpeechSDK.ResultReason.RecognizedSpeech:if(s.text&&!this._stopping){const{interimTranscript:e,finalTranscript:t,newText:n}=azureTranscript_1.AzureTranscript.extract(this._newTextPadding+s.text,this.finalTranscript,!0,this._translations);stopTimeout_1.StopTimeout.reset(this,this.stopTimeoutMS),this.updateElements(e,t,n),""!==t&&(this._newTextPadding=" ")}}}onCanceled(e,t){t.reason===window.SpeechSDK.CancellationReason.Error&&this.error(t.errorDetails)}onSessionStarted(){preventConnectionStop_1.PreventConnectionStop.clearPrevention(this),this.setStateOnStart()}onSessionStopped(){this._retrieveTokenInterval||clearInterval(this._retrieveTokenInterval),this._stopping=!1,this.setStateOnStop()}retrieveTokenInterval(e){this._retrieveTokenInterval=setInterval((()=>{null==e||e().then((e=>{this._service&&(this._service.authorizationToken=(null==e?void 0:e.trim())||"")})).catch((e=>{this.error(e)}))}),1e4)}stop(e){var t;!e&&this._retrieveTokenInterval&&clearInterval(this._retrieveTokenInterval),this._stopping=!0,null===(t=this._service)||void 0===t||t.stopContinuousRecognitionAsync(),this.finalise(e)}static getAPI(){return window.SpeechSDK}moduleNotFound(){console.error("speech recognition module not found:"),console.error("please install the 'microsoft-cognitiveservices-speech-sdk' npm package or add a script tag: <script src=\"https://aka.ms/csspeech/jsbrowserpackageraw\"><\/script>"),this.setStateOnError("speech recognition module not found")}error(e){this._retrieveTokenInterval&&clearInterval(this._retrieveTokenInterval),console.error(e),this.setStateOnError(e),this.stop()}}azure.Azure=Azure,Object.defineProperty(dist,"__esModule",{value:!0});const webSpeech_1=webSpeech,commandUtils_1=commandUtils,globalState_1=globalState,azure_1=azure;class SpeechToElement{static toggle(e,t){var s,n;const i=e.toLocaleLowerCase().trim();null!==(s=globalState_1.GlobalState.service)&&void 0!==s&&s.recognizing?this.stop():"webspeech"===i?SpeechToElement.startWebSpeech(t):"azure"===i?SpeechToElement.startAzure(t):(console.error("service not found - must be either 'webspeech' or 'azure'"),null===(n=null==t?void 0:t.onError)||void 0===n||n.call(t,"service not found - must be either 'webspeech' or 'azure'"))}static startWebSpeech(e){SpeechToElement.stop()||(globalState_1.GlobalState.service=new webSpeech_1.WebSpeech,globalState_1.GlobalState.service.start(e))}static isWebSpeechSupported(){return!!webSpeech_1.WebSpeech.getAPI()}static startAzure(e){var t;SpeechToElement.stop()||null!==(t=globalState_1.GlobalState.service)&&void 0!==t&&t.cannotBeStopped||(globalState_1.GlobalState.service=new azure_1.Azure,globalState_1.GlobalState.service.start(e))}static stop(){var e;return!!globalState_1.GlobalState.doubleClickDetector()||(!(null===(e=globalState_1.GlobalState.service)||void 0===e)&&e.recognizing&&globalState_1.GlobalState.service.stop(),!1)}static endCommandMode(){globalState_1.GlobalState.service&&commandUtils_1.CommandUtils.toggleCommandModeOff(globalState_1.GlobalState.service)}}var _default=dist.default=SpeechToElement;class SpeechToText extends MicrophoneButton{constructor(e,t,s){var n;super("object"==typeof e.speechToText?null==(n=e.speechToText)?void 0:n.button:{});const{serviceName:i,processedConfig:r}=SpeechToText.processConfiguration(t,e.speechToText);if(this._addErrorMessage=s,"webspeech"!==i||_default.isWebSpeechSupported()){const s=!e.textInput||!e.textInput.disabled;this.elementRef.onclick=this.buttonClick.bind(this,t,s,i,r)}else this.changeToUnsupported()}static processConfiguration(e,t){var s;const n="object"==typeof t?t:{},i="object"==typeof n.webSpeech?n.webSpeech:{},r=n.azure||{},o={displayInterimResults:n.displayInterimResults??void 0,textColor:n.textColor??void 0,translations:n.translations??void 0,commands:n.commands??void 0,...i,...r},a=null==(s=n.commands)?void 0:s.submit;return a&&(o.onPreResult=t=>t.toLowerCase().includes(a)?(setTimeout((()=>{var t;return null==(t=e.submit)?void 0:t.call(e)})),_default.endCommandMode(),{restart:!0,removeNewText:!0}):null),{serviceName:SpeechToText.getServiceName(n),processedConfig:o}}static getServiceName(e){return e.webSpeech?"webspeech":e.azure?"azure":"webspeech"}buttonClick(e,t,s,n){e.removeTextIfPlaceholder(),_default.toggle(s,{insertInCursorLocation:!1,element:t?e.inputElementRef:void 0,onError:this.onError.bind(this),onStart:this.changeToActive.bind(this),onStop:this.changeToDefault.bind(this),onCommandModeTrigger:this.onCommandModeTrigger.bind(this),...n})}onCommandModeTrigger(e){e?this.changeToCommandMode():this.changeToActive()}onError(){this._addErrorMessage("speechToText","speech input error")}}class NewFileName{static getFileName(e,t){const s=new Date;return`${e}-${String(s.getHours()).padStart(2,"0")}-${String(s.getMinutes()).padStart(2,"0")}-${String(s.getSeconds()).padStart(2,"0")}.${t}`}}class RecordAudio extends MicrophoneButton{constructor(e,t){var s,n;super(t.button),this._waitingForBrowserApproval=!1,this._audioType=e,this._extension=(null==(s=t.files)?void 0:s.format)||"mp3",this._maxDurationSeconds=null==(n=t.files)?void 0:n.maxDurationSeconds,this.elementRef.onclick=this.buttonClick.bind(this)}buttonClick(){this._waitingForBrowserApproval||(this.isActive?this.stop():(this._waitingForBrowserApproval=!0,this.record()))}stop(){return new Promise((e=>{var t,s;this.changeToDefault(),null==(t=this._mediaRecorder)||t.stop(),null==(s=this._mediaStream)||s.getTracks().forEach((e=>e.stop())),setTimeout((()=>{e()}),10)}))}record(){navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{this.changeToActive(),this._mediaRecorder=new MediaRecorder(e),this._audioType.addPlaceholderAttachment(this.stop.bind(this),this._maxDurationSeconds),this._mediaStream=e,this._mediaRecorder.addEventListener("dataavailable",(e=>{this.createFile(e)})),this._mediaRecorder.start()})).catch((e=>{console.error(e),this.stop()})).finally((()=>{this._waitingForBrowserApproval=!1}))}createFile(e){const t=new Blob([e.data],{type:`audio/${this._extension}`}),s=NewFileName.getFileName(this._newFilePrefix||"audio",this._extension),n=new File([t],s,{type:t.type}),i=new FileReader;i.readAsDataURL(n),i.onload=e=>{this._audioType.completePlaceholderAttachment(n,e.target.result)}}}const SUBMIT_ICON_STRING='<?xml version="1.0" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.0//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">\n<svg xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="none" stroke-width="1" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">\n  <line x1="22" y1="2" x2="11" y2="14"></line>\n  <polygon points="22 2 15 22 11 14 2 10 22 2"></polygon>\n</svg>\n';class SubmitButtonStateStyle{static resetSubmit(e,t){t?e.unsetCustomStateStyles(["loading","submit"]):e.unsetCustomStateStyles(["stop","loading","submit"]),e.reapplyStateStyle("submit")}}class SubmitButton extends InputButton{constructor(e,t,s,n,i){var r;super(SubmitButton.createButtonContainerElement(),null==(r=e.submitButtonStyles)?void 0:r.position,e.submitButtonStyles),this._isRequestInProgress=!1,this._isLoadingActive=!1,this._isSVGLoadingIconOverriden=!1,this._messages=s,this._inputElementRef=t,this._fileAttachments=i,this._innerElements=this.createInnerElements(),this._abortStream=new AbortController,this._serviceIO=n,this.attemptOverwriteLoadingStyle(e),this.changeToSubmitIcon(),this.assignHandlers()}createInnerElements(){const{submit:e,loading:t,stop:s}=CustomButtonInnerElements.create(this.elementRef,["submit","loading","stop"],this._customStyles);return{submit:e||SubmitButton.createSubmitIconElement(),loading:t||SubmitButton.createLoadingIconElement(),stop:s||SubmitButton.createStopIconElement()}}static createButtonContainerElement(){const e=document.createElement("div");return e.classList.add("input-button"),e}static createSubmitIconElement(){const e=SVGIconUtils.createSVGElement(SUBMIT_ICON_STRING);return e.id="submit-icon",e}static createLoadingIconElement(){const e=document.createElement("div");return e.classList.add("dots-jumping"),e}static createStopIconElement(){const e=document.createElement("div");return e.id="stop-icon",e}attemptOverwriteLoadingStyle(e){var t,s,n,i,r,o,a,l,c;if(!(null!=(s=null==(t=this._customStyles)?void 0:t.submit)&&s.svg||null!=(r=null==(i=null==(n=this._customStyles)?void 0:n.loading)?void 0:i.svg)&&r.content||null!=(l=null==(a=null==(o=this._customStyles)?void 0:o.loading)?void 0:a.text)&&l.content||void 0!==e.displayLoadingBubble&&!0!==e.displayLoadingBubble)){const t=document.createElement("style");t.textContent="\n        .loading-button > * {\n          filter: brightness(0) saturate(100%) invert(72%) sepia(0%) saturate(3044%) hue-rotate(322deg) brightness(100%)\n            contrast(96%) !important;\n        }",null==(c=e.shadowRoot)||c.appendChild(t),this._isSVGLoadingIconOverriden=!0}}assignHandlers(){this._serviceIO.completionsHandlers={onFinish:this.changeToSubmitIcon.bind(this)},this._serviceIO.streamHandlers={onOpen:this.changeToStopIcon.bind(this),onClose:this.changeToSubmitIcon.bind(this),abortStream:this._abortStream}}submitFromInput(){var e;if(this._inputElementRef.classList.contains("text-input-placeholder"))this.submit(!1,"");else{const t=null==(e=this._inputElementRef.textContent)?void 0:e.trim();this.submit(!1,t)}}async submit(e,t){var s,n;let i,r;e||(await this._fileAttachments.completePlaceholders(),i=this._fileAttachments.getAllFileData(),r=null==i?void 0:i.map((e=>e.file)));const o=""===t?void 0:t;if(this._isRequestInProgress)return;if(null!=(s=this._serviceIO.deepChat)&&s.validateMessageBeforeSending){if(!this._serviceIO.deepChat.validateMessageBeforeSending(o,r))return}else if(!this._serviceIO.canSendMessage(o,r))return;this.changeToLoadingIcon(),""!==t&&this._messages.addNewMessage({text:t},!1,!0),i&&await this._messages.addMultipleFiles(i),this._messages.addLoadingMessage(),e||TextInputEl.clear(this._inputElementRef);const a={text:o,files:r};this._serviceIO.callAPI(a,this._messages),e||null==(n=this._fileAttachments)||n.removeAllFiles()}stopStream(){this._abortStream.abort(),this.changeToSubmitIcon()}changeToStopIcon(){this.elementRef.classList.remove("loading-button"),this.elementRef.replaceChildren(this._innerElements.stop),this.reapplyStateStyle("stop",["loading","submit"]),this.elementRef.onclick=this.stopStream.bind(this),this._isLoadingActive=!1}changeToLoadingIcon(){this._serviceIO.websocket||(this._isSVGLoadingIconOverriden||this.elementRef.replaceChildren(this._innerElements.loading),this.elementRef.classList.add("loading-button"),this.reapplyStateStyle("loading",["submit"]),this.elementRef.onclick=()=>{},this._isRequestInProgress=!0,this._isLoadingActive=!0)}changeToSubmitIcon(){this.elementRef.classList.remove("loading-button"),this.elementRef.replaceChildren(this._innerElements.submit),SubmitButtonStateStyle.resetSubmit(this,this._isLoadingActive),this.elementRef.onclick=this.submitFromInput.bind(this),this._isRequestInProgress=!1,this._isLoadingActive=!1}}const REFRESH_ICON_STRING='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">\n  <path d="M27.1 14.313V5.396L24.158 8.34c-2.33-2.325-5.033-3.503-8.11-3.503C9.902 4.837 4.901 9.847 4.899 16c.001 6.152 5.003 11.158 11.15 11.16 4.276 0 9.369-2.227 10.836-8.478l.028-.122h-3.23l-.022.068c-1.078 3.242-4.138 5.421-7.613 5.421a8 8 0 0 1-5.691-2.359A7.993 7.993 0 0 1 8 16.001c0-4.438 3.611-8.049 8.05-8.049 2.069 0 3.638.58 5.924 2.573l-3.792 3.789H27.1z"/>\n</svg>\n',CAPTURE_ICON_STRING='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">\n  <title>capture</title>\n  <path d="M0 16q0 3.264 1.28 6.208t3.392 5.12 5.12 3.424 6.208 1.248 6.208-1.248 5.12-3.424 3.392-5.12 1.28-6.208-1.28-6.208-3.392-5.12-5.088-3.392-6.24-1.28q-3.264 0-6.208 1.28t-5.12 3.392-3.392 5.12-1.28 6.208zM4 16q0-3.264 1.6-6.016t4.384-4.352 6.016-1.632 6.016 1.632 4.384 4.352 1.6 6.016-1.6 6.048-4.384 4.352-6.016 1.6-6.016-1.6-4.384-4.352-1.6-6.048z"></path>\n</svg>\n',CLOSE_ICON_STRING='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">\n  <path d="M195.2 195.2a64 64 0 0 1 90.496 0L512 421.504 738.304 195.2a64 64 0 0 1 90.496 90.496L602.496 512 828.8 738.304a64 64 0 0 1-90.496 90.496L512 602.496 285.696 828.8a64 64 0 0 1-90.496-90.496L421.504 512 195.2 285.696a64 64 0 0 1 0-90.496z"/>\n</svg>',TICK_ICON_STRING='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M4.89163 13.2687L9.16582 17.5427L18.7085 8" stroke="#000000" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>';class CameraModal extends Modal{constructor(e,t,s,n){super(e,["modal-content","modal-camera-content"],s),this._stopped=!1,this._format="image/png",this._canvas=document.createElement("canvas"),this._canvas.classList.add("camera-modal-canvas");const{captureButton:i,submitButton:r}=this.addButtonsAndTheirEvents(t);this._captureButton=i,this._submitButton=r,this._captureIcon=this._captureButton.children[0],this._refreshIcon=SVGIconUtils.createSVGElement(REFRESH_ICON_STRING),this._refreshIcon.classList.add("modal-svg-button-icon","modal-svg-refresh-icon"),"jpeg"===(null==n?void 0:n.format)&&(this._format="image/jpeg"),null!=n&&n.dimensions&&(this._dimensions=n.dimensions),this._contentRef.appendChild(this._canvas),this.extensionCloseCallback=this.stop}addButtonsAndTheirEvents(e){const t=Modal.createSVGButton(CAPTURE_ICON_STRING);t.classList.add("modal-svg-camera-button"),t.children[0].classList.add("modal-svg-camera-icon");const s=this.addCloseButton(CLOSE_ICON_STRING,!0);s.classList.add("modal-svg-close-button"),s.children[0].classList.add("modal-svg-close-icon");const n=Modal.createSVGButton(TICK_ICON_STRING);return n.classList.add("modal-svg-submit-button"),this.addButtons(t,n),this.addButtonEvents(t,s,n,e),{captureButton:t,submitButton:n}}addButtonEvents(e,t,s,n){e.onclick=()=>{this.capture()},t.addEventListener("click",this.stop.bind(this)),s.onclick=()=>{const e=this.getFile();e&&FileAttachments.addFilesToType([e],[n]),this.stop(),this.close()}}stop(){this._mediaStream&&this._mediaStream.getTracks().forEach((e=>e.stop())),this._stopped=!0,setTimeout((()=>{this._captureButton.replaceChildren(this._captureIcon),this._captureButton.classList.replace("modal-svg-refresh-button","modal-svg-camera-button");const e=this._canvas.getContext("2d");null==e||e.clearRect(0,0,this._canvas.width,this._canvas.height)}),Modal.MODAL_CLOSE_TIMEOUT_MS)}start(){this._dataURL=void 0,this._submitButton.classList.add("modal-svg-submit-disabled"),this._stopped=!1,navigator.mediaDevices.getUserMedia({video:this._dimensions||!0}).then((e=>{if(this._mediaStream=e,!this.isOpen())return this.stop();const t=document.createElement("video");t.srcObject=e,t.play(),requestAnimationFrame(this.updateCanvas.bind(this,t,this._canvas))})).catch((e=>{console.error(e),this.stop(),this.close()}))}capture(){this._dataURL?(this._captureButton.replaceChildren(this._captureIcon),this._captureButton.classList.replace("modal-svg-refresh-button","modal-svg-camera-button"),this._submitButton.classList.add("modal-svg-submit-disabled"),this._dataURL=void 0):(this._captureButton.replaceChildren(this._refreshIcon),this._captureButton.classList.replace("modal-svg-camera-button","modal-svg-refresh-button"),this._submitButton.classList.remove("modal-svg-submit-disabled"),this._dataURL=this._canvas.toDataURL())}getFile(){if(this._dataURL){const e=atob(this._dataURL.split(",")[1]),t=new Array(e.length);for(let o=0;o<e.length;o++)t[o]=e.charCodeAt(o);const s=new Uint8Array(t),n=new Blob([s],{type:this._format}),i="image/jpeg"===this._format?"jpeg":"png",r=NewFileName.getFileName(this._newFilePrefix||"photo",i);return new File([n],r,{type:n.type})}}updateCanvas(e,t){if(!this._stopped){if(!this._dataURL){t.width=e.videoWidth,t.height=e.videoHeight;const s=t.getContext("2d");null==s||s.drawImage(e,0,0,t.width,t.height)}requestAnimationFrame(this.updateCanvas.bind(this,e,t))}}openCameraModal(e){this.displayModalElements(),e.start()}static createCameraModalFunc(e,t,s,n){const i=new CameraModal(e,t,s,n);return i.openCameraModal.bind(i,i)}}const CAMERA_ICON_STRING='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">\n  <path d="M29 7h-4.599l-2.401-4h-12l-2.4 4h-4.6c-1 0-3 1-3 2.969v16.031c0 1.657 1.5 3 2.792 3h26.271c1.313 0 2.938-1.406 2.938-2.968v-16.032c0-1-1-3-3-3zM30 26.032c0 0.395-0.639 0.947-0.937 0.969h-26.265c-0.232-0.019-0.797-0.47-0.797-1v-16.031c0-0.634 0.851-0.953 1-0.969h5.732l2.4-4h9.802l1.785 3.030 0.55 0.97h5.731c0.705 0 0.99 0.921 1 1v16.032zM16 10c-3.866 0-7 3.134-7 7s3.134 7 7 7 7-3.134 7-7-3.134-7-7-7zM16 22c-2.757 0-5-2.243-5-5s2.243-5 5-5 5 2.243 5 5-2.243 5-5 5z"></path>\n</svg>';class CameraButton extends InputButton{constructor(e,t,s){var n;super(CameraButton.createButtonElement(),null==(n=null==s?void 0:s.button)?void 0:n.position,(null==s?void 0:s.button)||{},"Photo");const i=this.createInnerElements(this._customStyles);s&&this.addClickEvent(e,t,s.modalContainerStyle,s.files),this.elementRef.classList.add("upload-file-button"),this.elementRef.appendChild(i.styles),this.reapplyStateStyle("styles")}createInnerElements(e){return{styles:this.createInnerElement(CameraButton.createSVGIconElement(),"styles",e)}}createInnerElement(e,t,s){return CustomButtonInnerElements.createSpecificStateElement(this.elementRef,t,s)||e}static createButtonElement(){const e=document.createElement("div");return e.classList.add("input-button"),e}static createSVGIconElement(){const e=SVGIconUtils.createSVGElement(CAMERA_ICON_STRING);return e.id="camera-icon",e}addClickEvent(e,t,s,n){const i=CameraModal.createCameraModalFunc(e,t,s,n);this.elementRef.onclick=i}}class Input{constructor(e,t,s,n){this.elementRef=Input.createPanelElement(e.inputAreaStyle);const i=new TextInputEl(s,e.textInput),r={},o=this.createFileUploadComponents(e,s,n,r);e.speechToText&&!r.microphone&&(r.microphone={button:new SpeechToText(e,i,t.addNewErrorMessage.bind(t))});const a=new SubmitButton(e,i.inputElementRef,t,s,o);i.submit=a.submitFromInput.bind(a),e.submitUserMessage=a.submit.bind(a,!0),r.submit={button:a},Input.addElements(this.elementRef,i,r,n,o,e.dropupStyles)}static createPanelElement(e){const t=document.createElement("div");return t.id="input",Object.assign(t.style,e),t}createFileUploadComponents(e,t,s,n){var i,r,o,a;const l=new FileAttachments(this.elementRef,e.attachmentContainerStyle,t.demo);if(Input.createUploadButtons(t.fileTypes||{},l,s,n),null!=(i=t.camera)&&i.files){const e=(null==(r=n.images)?void 0:r.fileType)||l.addType(t.camera.files,"images");n.camera={button:new CameraButton(s,e,t.camera)}}if(null!=(o=t.recordAudio)&&o.files){const e=(null==(a=n.audio)?void 0:a.fileType)||l.addType(t.recordAudio.files,"audio");n.microphone={button:new RecordAudio(e,t.recordAudio)}}return DragAndDrop.isEnabled(l,e.dragAndDrop)&&DragAndDrop.create(s,l,e.dragAndDrop),l}static createUploadButtons(e,t,s,n){Object.keys(e).forEach((i=>{const r=i,o=e[r];if(o.files){const e=t.addType(o.files,r),{id:i,svgString:a,dropupText:l}=FILE_TYPE_BUTTON_ICONS[r],c=new UploadFileButton(s,e,o,i,a,l);n[r]={button:c,fileType:e}}}))}static addElements(e,t,s,n,i,r){ElementUtils.addElements(e,t.elementRef);const o=ButtonContainers.create(),a=InputButtonPositions.addButtons(o,s,n,r);InputButtonStyleAdjustments.set(t.inputElementRef,o,i.elementRef,a),ButtonContainers.add(e,o)}}class ChatView{static createElements(e,t,s){const n=document.createElement("div");n.id="chat-view";const i=new Messages(e,t,s);t.websocket&&Websocket.assignListeners(t,i);const r=new Input(e,i,t,n);return ElementUtils.addElements(n,i.elementRef,r.elementRef),n}static render(e,t,s,n){const i=ChatView.createElements(e,s,n);t.replaceChildren(i)}}const style='#validate-property-key-view{height:100%;position:relative;display:flex;justify-content:center;align-items:center;padding:8px}#large-loading-ring{display:inline-block;width:50px;height:50px}#large-loading-ring:after{content:" ";display:block;width:38px;height:38px;margin:1px;border-radius:50%;border:5px solid #5fb2ff;border-color:#5fb2ff transparent #5fb2ff transparent;animation:large-loading-ring 1.4s linear infinite}@keyframes large-loading-ring{0%{transform:rotate(0)}to{transform:rotate(360deg)}}#insert-key-view{height:100%;position:relative}#insert-key-contents{text-align:center;position:absolute;top:44%;left:50%;transform:translate(-50%,-50%);width:82%;display:flex;max-width:700px}#insert-key-title{margin-bottom:15px}#insert-key-input-container{margin-right:2.7em;width:calc(100% - 80px)}#insert-key-input{padding:.3em 1.7em .3em .3em;border-width:1px;border-style:solid;border-radius:3px;width:100%;font-size:inherit}.insert-key-input-valid{border-color:gray}.insert-key-input-invalid{border-color:red}#visibility-icon-container{position:relative;float:right;cursor:pointer;user-select:none}.visibility-icon{filter:brightness(0) saturate(100%) invert(63%) sepia(1%) saturate(9%) hue-rotate(43deg) brightness(98%) contrast(92%);position:absolute;right:-1.7em;top:-1.43em}#visible-icon{top:-1.4em}.visibility-icon:hover{filter:unset}.visibility-icon>*{pointer-events:none}#start-button{border:1px solid grey;color:#454545;border-radius:4px;width:3em;display:flex;justify-content:center;align-items:center;cursor:pointer;padding:.28em .3em;user-select:none;background-color:#fff}#start-button:hover{background-color:#f2f2f2}#start-button:active{background-color:#d2d2d2}#insert-key-help-text-container{width:100%;position:absolute;margin-top:32px;margin-bottom:20px}#insert-key-help-text-contents{width:100%;position:absolute}#insert-key-input-invalid-text{display:block;margin-top:1em;margin-bottom:.5em;color:red}.insert-key-input-help-text{display:block;margin-top:16px}#loading-ring{display:inline-block;width:16px;height:16px}#loading-ring:after{content:" ";display:block;width:11px;height:11px;margin:1px;border-radius:50%;border:2px solid #0084ff;border-color:#0084ff transparent #0084ff transparent;animation:loading-ring 1.2s linear infinite}@keyframes loading-ring{0%{transform:rotate(0)}to{transform:rotate(360deg)}}#error-view{color:red;font-size:1.2em;line-height:1.3em;margin-top:-5px;text-align:center;height:100%;display:flex;justify-content:center;align-items:center;padding-left:8px;padding-right:8px}.intro-panel{position:absolute;display:flex;justify-content:center;inset:0px;margin:auto;height:fit-content;top:-2.5em}#internal-intro-panel{width:250px;height:min-content;display:block;border-radius:5px;overflow:auto;border:1px solid rgb(203,203,203);padding:10px;max-height:calc(100% - 6.8em)}#internal-intro-panel>p{margin-block-start:.8em;margin-block-end:.8em}pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}/*!\n  Theme: a11y-dark\n  Author: @ericwbailey\n  Maintainer: @ericwbailey\n\n  Based on the Tomorrow Night Eighties theme: https://github.com/isagalaev/highlight.js/blob/master/src/styles/tomorrow-night-eighties.css\n*/.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast: active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}#messages{overflow:auto}.outer-message-container:last-child{margin-bottom:5px}.inner-message-container{display:flex;width:90%;margin-left:auto;margin-right:auto;max-width:100%}.message-bubble{margin-top:10px;word-wrap:break-word;width:fit-content;max-width:60%;border-radius:10px;padding:.42em .55em;height:fit-content}.user-message-text{color:#fff;background-color:#0084ff;margin-right:0;margin-left:auto}.ai-message-text{color:#000;background-color:#e4e6eb;margin-left:0;margin-right:auto}.error-message-text{margin:14px auto 10px;background-color:#f4c0c0;color:#474747;text-align:center;max-width:95%}.loading-message-text{width:1em;padding:.6em .75em .6em 1.3em}.message-bubble>p{line-height:1.26em}.message-bubble>p:first-child{margin-top:0}.message-bubble>p:last-child{margin-bottom:0}pre{overflow:auto;display:block;word-break:break-all;word-wrap:break-word;border-radius:7px;background:#2b2b2b;color:#f8f8f2;margin-top:.8em;margin-bottom:.8em;padding:.6em;font-size:.9em;line-height:1.5em}.image-message{padding:0;display:flex;background-color:#ddd}.image-message>*,.image-message>*>*{width:100%;border-radius:8px;display:flex}.audio-message{width:60%;max-width:300px;height:2.2em;max-height:54px;padding:0;background-color:unset}.audio-player{width:100%;height:100%}.audio-player-safari{height:fit-content;width:40px}.audio-player-safari-left{float:left}.audio-player-safari-right{float:right}.any-file-message-bubble{padding:1px}.any-file-message-contents{display:flex}.any-file-message-icon-container{width:1.3em;min-width:1.3em;position:relative;border-radius:4px;margin-left:6px;margin-right:2px}.any-file-message-icon{background-color:#fff;border-radius:4px;position:absolute;width:1em;height:1.25em;padding:1px;margin-top:auto;margin-bottom:auto;top:0;bottom:0}.any-file-message-text{padding-top:5px;overflow-wrap:anywhere;padding-bottom:5px;padding-right:7px}.message-bubble>a{color:inherit}.left-item-position{margin-right:10px}.right-item-position{margin-left:10px}.avatar{padding-top:5px;width:1.5em;height:1.5em;border-radius:1px}.avatar-container{margin-top:9px}.name{margin-top:16px;font-size:15px}#drag-and-drop{position:absolute;display:none;z-index:10;height:calc(100% - 10px);width:calc(100% - 10px);background-color:#70c6ff4d;border:5px dashed #6dafff}#file-attachment-container{position:absolute;height:3.6em;width:calc(80% - 4px);top:-2.5em;border-radius:5px;overflow:auto;text-align:left;background-color:#d7d7d73b;padding-left:4px}.file-attachment{width:2.85em;height:2.85em;display:inline-flex;margin-right:.6em;margin-bottom:.44em;margin-top:4px;position:relative;background-color:#fff;border-radius:5px}.image-attachment{width:100%;height:100%;object-fit:cover;border-radius:5px}.border-bound-attachment{width:calc(100% - 2px);height:calc(100% - 2px);border:1px solid #c3c3c3;border-radius:5px;overflow:hidden}.border-bound-attachment-safari{width:calc(100% - 1px);height:calc(100% - 1px)}.audio-attachment-icon-container{cursor:pointer}.audio-attachment-icon-container:hover{background-color:#f8f8f8}.attachment-icon{left:0;right:0;bottom:0;top:2px;margin:auto;position:absolute;width:25px;user-select:none}.not-removable-attachment-icon{inset:0}.play-icon{filter:brightness(0) saturate(100%) invert(17%) sepia(0%) saturate(1392%) hue-rotate(67deg) brightness(98%) contrast(97%)}.stop-icon{filter:brightness(0) saturate(100%) invert(29%) sepia(90%) saturate(1228%) hue-rotate(198deg) brightness(93%) contrast(98%)}.audio-placeholder-text-3-digits{padding-left:.26rem}.audio-placeholder-text-4-digits{padding-left:.1rem}.any-file-attachment{padding:2px 0}.file-attachment-text-container{position:absolute;width:inherit;display:flex;align-items:center;height:100%;top:-1px}.audio-placeholder-text-3-digits-container{padding-top:1px;cursor:default}.any-file-attachment-text{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;padding-left:.13em;margin-left:auto;margin-right:auto}.remove-file-attachment-button{height:1.25em;width:1.25em;border:1px solid #cfcfcf;border-radius:25px;background-color:#fff;top:-4px;right:-5px;position:absolute;display:flex;justify-content:center;cursor:pointer;user-select:none}.remove-file-attachment-button:hover{background-color:#e4e4e4}.remove-file-attachment-button:active{background-color:#d7d7d7}.x-icon{color:#4e4e4e;top:-.075em;position:relative;font-size:1.05em}.modal{display:none;flex-direction:column;align-items:center;justify-content:center;position:absolute;width:80%;max-width:420px;max-height:80%;margin:auto;inset:0;z-index:2}.modal-content{border-top:1px solid rgb(217,217,217);border-left:1px solid rgb(217,217,217);border-right:1px solid rgb(217,217,217);border-top-left-radius:inherit;border-top-right-radius:inherit;background-color:#fff;overflow-y:auto;height:fit-content;max-height:calc(100% - 3.3em);width:100%}.modal-content>p{margin-left:1em;margin-right:1em}.modal-content>ul{margin-right:1em}.modal-button-panel{height:3.3em;border:1px solid;border-color:rgb(223,223,223) rgb(217,217,217) rgb(217,217,217);border-bottom-left-radius:inherit;border-bottom-right-radius:inherit;background-color:#fff;text-align:center;justify-content:center;display:flex;width:100%}.modal-button{min-width:2.5em;text-align:center;color:#fff;border-radius:5px;padding:.4em .4em .3em;height:1.25em;background-color:#3279b2;top:0;bottom:0;cursor:pointer;user-select:none;margin:auto .31em}.modal-button:hover{background-color:#276da7}.modal-button:active{background-color:#1b5687}.modal-svg-button{padding:0 0 2px;width:2em;height:1.8em}.modal-svg-button-icon{width:100%;height:100%;filter:brightness(0) saturate(100%) invert(100%) sepia(15%) saturate(4%) hue-rotate(346deg) brightness(101%) contrast(102%)}#modal-background-panel{position:absolute;width:100%;height:100%;background-color:#00000042;z-index:1;display:none}.show-modal-background{animation:fadeInBackground .3s ease-in-out}@keyframes fadeInBackground{0%{opacity:0}to{opacity:1}}.show-modal{animation:fadeInModal .3s ease-in-out}@keyframes fadeInModal{0%{opacity:0;scale:.95}to{opacity:1;scale:1}}.hide-modal-background{animation:fadeOutBackground .2s ease-in-out}@keyframes fadeOutBackground{0%{opacity:1}to{opacity:0}}.hide-modal{animation:fadeOutModal .2s ease-in-out}@keyframes fadeOutModal{0%{opacity:1;scale:1}to{opacity:0;scale:.95}}.modal-camera-content{overflow:hidden;text-align:center;border:unset;height:100%;background-color:#2a2a2a;display:flex;justify-content:center}.camera-modal-canvas{max-width:100%;max-height:100%;margin-top:auto;margin-bottom:auto}.modal-svg-submit-button{background-color:green}.modal-svg-submit-button:hover{background-color:#007500}.modal-svg-submit-button:active{background-color:#006500}.modal-svg-submit-disabled{pointer-events:none;background-color:#747474}.modal-svg-close-button{height:1.56em;padding-top:.37em;padding-bottom:0;background-color:#c13e3e}.modal-svg-close-button:hover{background-color:#b43434}.modal-svg-close-button:active{background-color:#972929}.modal-svg-close-icon{width:80%;height:80%}.modal-svg-camera-button{height:1.6em;padding-top:.38em;padding-bottom:0}.modal-svg-camera-icon{height:76%}.modal-svg-refresh-icon{height:105%}.modal-svg-refresh-button{height:1.66em;padding-top:.11em;padding-bottom:.21em}.input-button-container{position:relative;z-index:1}.inside-right{position:absolute;right:calc(10% + .35em);bottom:.85em}.inside-left{position:absolute;left:calc(10% + .35em);bottom:.85em}.outside-left{position:absolute;right:calc(11px - .55em);bottom:.88em}.outside-right{position:absolute;left:calc(11px - .55em);bottom:.88em}#upload-images-icon{position:absolute;pointer-events:none;width:1.45em;height:1.45em;left:.11em;bottom:.08em;filter:brightness(0) saturate(100%) invert(43%) sepia(0%) saturate(740%) hue-rotate(77deg) brightness(99%) contrast(92%)}#upload-gifs-icon{position:absolute;pointer-events:none;width:1.5em;height:1.48em;left:.07em;bottom:.08em;filter:brightness(0) saturate(100%) invert(49%) sepia(0%) saturate(2586%) hue-rotate(12deg) brightness(93%) contrast(90%)}#upload-audio-icon{position:absolute;pointer-events:none;width:1.21em;height:1.21em;left:.17em;bottom:.2em;filter:brightness(0) saturate(100%) invert(15%) sepia(0%) saturate(337%) hue-rotate(125deg) brightness(91%) contrast(94%);transform:scaleX(.95)}#camera-icon{position:absolute;pointer-events:none;width:1.21em;height:1.21em;left:.23em;bottom:.2em;filter:brightness(0) saturate(100%) invert(52%) sepia(0%) saturate(161%) hue-rotate(164deg) brightness(91%) contrast(92%);transform:scaleX(.95)}#upload-mixed-files-icon{position:absolute;pointer-events:none;width:1.21em;height:1.21em;left:.25em;bottom:.2em;filter:brightness(0) saturate(100%) invert(53%) sepia(0%) saturate(36%) hue-rotate(74deg) brightness(98%) contrast(93%);transform:scaleX(.95)}#interim-text{color:gray}#microphone-button{padding-top:.5px}.outer-button-container>#microphone-button{padding-bottom:1px}#microphone-icon{position:absolute;pointer-events:none;width:1.21em;height:1.21em;left:.25em;bottom:.25em}.default-microphone-icon{filter:brightness(0) saturate(100%) invert(32%) sepia(0%) saturate(924%) hue-rotate(46deg) brightness(95%) contrast(99%)}.active-microphone-icon{filter:brightness(0) saturate(100%) invert(10%) sepia(97%) saturate(7495%) hue-rotate(0deg) brightness(101%) contrast(107%);border-radius:10px}.command-microphone-icon{filter:brightness(0) saturate(100%) invert(42%) sepia(96%) saturate(1067%) hue-rotate(77deg) brightness(99%) contrast(102%)}.unsupported-microphone{display:none}#submit-icon{height:100%;filter:brightness(0) saturate(100%) invert(32%) sepia(0%) saturate(924%) hue-rotate(46deg) brightness(95%) contrast(99%);width:1.21em}#stop-icon{background-color:#acacac;position:absolute;width:.95em;height:.95em;left:.35em;bottom:.35em;border-radius:2px}.submit-button-enlarged{scale:1.1;margin-right:.3em;margin-left:.3em}.dots-jumping{position:relative;left:calc(-9990px + .275em);width:.22em;height:.22em;border-radius:5px;background-color:#848484;color:#848484;box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484;animation:dots-jumping 1.5s infinite linear;bottom:-.7em}@keyframes dots-jumping{0%{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}16.667%{box-shadow:9990px -6px #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}33.333%{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}50%{box-shadow:9990px 0 #848484,calc(9990px + .44em) -6px 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}66.667%{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}83.333%{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) -6px 0 0 #848484}to{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}}.dots-flashing{position:relative;width:.45em;height:.45em;border-radius:5px;background-color:var(--message-dots-color);color:var(--message-dots-color);animation:dots-flashing 1s infinite linear alternate;animation-delay:.5s}.dots-flashing:before,.dots-flashing:after{content:"";display:inline-block;position:absolute;top:0}.dots-flashing:before{left:-.7em;width:.45em;height:.45em;border-radius:5px;background-color:var(--message-dots-color);color:var(--message-dots-color);animation:dots-flashing 1s infinite alternate;animation-delay:0s}.dots-flashing:after{left:.7em;width:.45em;height:.45em;border-radius:5px;background-color:var(--message-dots-color);color:var(--message-dots-color);animation:dots-flashing 1s infinite alternate;animation-delay:1s}@keyframes dots-flashing{0%{background-color:var(--message-dots-color)}50%,to{background-color:var(--message-dots-color-fade)}}.input-button{border-radius:4px;cursor:pointer;margin-bottom:.2em;user-select:none}.input-button-svg{width:1.65em;height:1.65em}.input-button:hover{background-color:#9c9c9c2e}.input-button:active{background-color:#9c9c9c5e}.loading-button{background-color:#fff;cursor:auto}.loading-button:hover,.loading-button:active{background-color:#fff}.text-button{filter:unset!important;display:flex;justify-content:center;align-items:center;margin-left:4px;margin-right:4px;height:1.6em}#text-input-container{background-color:#fff;width:80%;display:flex;border:1px solid #0000001a;border-radius:5px;margin-top:.8em;margin-bottom:.8em;box-shadow:#959da533 0 1px 12px;overflow-y:auto;max-height:200px;position:relative}.text-input-container-left-adjustment{margin-left:1.5em}.text-input-container-right-adjustment{margin-right:1.5em}.text-input-container-left-small-adjustment{margin-left:1.1em}.text-input-container-left-small-adjustment>.outside-left{right:calc(14px - .55em)}.text-input-container-right-small-adjustment{margin-right:1.1em}.text-input-container-right-small-adjustment>.outside-right{left:calc(14px - .55em)}#text-input{text-align:left;outline:none;word-wrap:break-word;line-break:auto}.text-input-styling{padding:.4em .5em;overflow:overlay;width:100%}.text-input-inner-left-adjustment{padding-left:2.2em}.text-input-inner-right-adjustment{padding-right:2em}.text-input-disabled{pointer-events:none;user-select:none}.text-input-placeholder{color:gray}.outside-right>#dropup-menu,.inside-right>#dropup-menu{right:0px}#dropup-icon{position:absolute;pointer-events:none;width:1.16em;height:1.2em;left:.265em;bottom:.43em;filter:brightness(0) saturate(100%) invert(54%) sepia(0%) saturate(724%) hue-rotate(6deg) brightness(92%) contrast(90%)}#dropup-menu{background-color:#fff;position:absolute;transform:translateY(-100%);border-radius:5px;z-index:1;top:-.49em;box-shadow:#0003 -1px 2px 10px,#0000001a 0 2px 4px;cursor:pointer;user-select:none}.dropup-menu-item{height:1.4em;padding:.28em .84em .28em .35em;display:flex;position:relative}.dropup-menu-item>*{pointer-events:none}.dropup-menu-item:first-child{padding-top:.49em;border-top-left-radius:inherit;border-top-right-radius:inherit}.dropup-menu-item:last-child{padding-bottom:.45em;border-bottom-left-radius:inherit;border-bottom-right-radius:inherit}.dropup-menu-item-icon{width:1.39em;position:relative;margin-right:.56em}.dropup-menu-item-icon>svg{bottom:0!important;top:0!important;margin-bottom:auto;margin-top:auto}.dropup-menu-item-text{margin-top:.08em;width:max-content}#input{width:100%;display:inline-flex;text-align:center;margin-left:auto;margin-right:auto;margin-top:auto;position:relative;justify-content:center}#chat-view{height:100%;display:grid;grid-template-columns:100%}::-webkit-scrollbar{width:9px;height:9px}::-webkit-scrollbar-thumb{background-color:#d0d0d0;border-radius:5px}::-webkit-scrollbar-track{background-color:#f2f2f2}:host{all:initial;display:table-cell}#container{height:350px;width:320px;border:1px solid #cacaca;font-family:Inter,sans-serif,Avenir,Helvetica,Arial;font-size:.9rem;background-color:#fff;position:relative;overflow:hidden}\n';var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__decorateClass=(e,t,s,n)=>{for(var i,r=n>1?void 0:n?__getOwnPropDesc(t,s):t,o=e.length-1;o>=0;o--)(i=e[o])&&(r=(n?i(t,s,r):i(r))||r);return n&&r&&__defProp(t,s,r),r};class DeepChat extends InternalHTML{constructor(){super(),this.getMessages=()=>[],this.submitUserMessage=()=>console.warn("submitUserMessage failed - please wait for chat view to render before calling this property."),this.focusInput=()=>{FocusUtils.focusFromParentElement(this._elementRef)},this.refreshMessages=()=>{},this.onNewMessage=()=>{},this.onComponentRender=()=>{},this._hasBeenRendered=!1,this._auxiliaryStyleApplied=!1,GoogleFont.appendStyleSheetToHead(),this._elementRef=document.createElement("div"),this._elementRef.id="container",this.attachShadow({mode:"open"}).appendChild(this._elementRef),WebComponentStyleUtils.apply(style,this.shadowRoot),setTimeout((()=>{this._hasBeenRendered||this.onRender()}),20)}changeToChatView(){this._activeService&&(this._activeService.validateConfigKey=!1),this.onRender()}onRender(){var e,t;this._activeService??(this._activeService=ServiceIOFactory.create(this)),this._activeService&&(this.auxiliaryStyle&&!this._auxiliaryStyleApplied&&(WebComponentStyleUtils.apply(this.auxiliaryStyle,this.shadowRoot),this._auxiliaryStyleApplied=!0),Object.assign(this._elementRef.style,this.containerStyle),this._activeService.key&&this._activeService.validateConfigKey?ValidateKeyPropertyView.render(this._elementRef,this.changeToChatView.bind(this),this._activeService):this._activeService instanceof DirectServiceIO&&this._activeService.key||null!=(e=this.request)&&e.url||null!=(t=this.directConnection)&&t.demo?(this._childElement??(this._childElement=this.children[0]),ChatView.render(this,this._elementRef,this._activeService,this._childElement)):this._activeService instanceof DirectServiceIO?InsertKeyView.render(this._elementRef,this.changeToChatView.bind(this),this._activeService):ErrorView.render(this._elementRef,'Please define "request" with a "url"'),this._hasBeenRendered=!0,FireEvents.onRender(this))}}__decorateClass([Property("object")],DeepChat.prototype,"directConnection",2),__decorateClass([Property("object")],DeepChat.prototype,"request",2),__decorateClass([Property("boolean")],DeepChat.prototype,"stream",2),__decorateClass([Property("object")],DeepChat.prototype,"requestBodyLimits",2),__decorateClass([Property("function")],DeepChat.prototype,"requestInterceptor",2),__decorateClass([Property("function")],DeepChat.prototype,"responseInterceptor",2),__decorateClass([Property("function")],DeepChat.prototype,"validateMessageBeforeSending",2),__decorateClass([Property("object")],DeepChat.prototype,"containerStyle",2),__decorateClass([Property("object")],DeepChat.prototype,"attachmentContainerStyle",2),__decorateClass([Property("object")],DeepChat.prototype,"dropupStyles",2),__decorateClass([Property("object")],DeepChat.prototype,"inputAreaStyle",2),__decorateClass([Property("object")],DeepChat.prototype,"textInput",2),__decorateClass([Property("object")],DeepChat.prototype,"submitButtonStyles",2),__decorateClass([Property("string")],DeepChat.prototype,"auxiliaryStyle",2),__decorateClass([Property("array")],DeepChat.prototype,"initialMessages",2),__decorateClass([Property("string")],DeepChat.prototype,"introMessage",2),__decorateClass([Property("object")],DeepChat.prototype,"avatars",2),__decorateClass([Property("object")],DeepChat.prototype,"names",2),__decorateClass([Property("boolean")],DeepChat.prototype,"displayLoadingBubble",2),__decorateClass([Property("object")],DeepChat.prototype,"errorMessages",2),__decorateClass([Property("object")],DeepChat.prototype,"messageStyles",2),__decorateClass([Property("object")],DeepChat.prototype,"textToSpeech",2),__decorateClass([Property("object")],DeepChat.prototype,"speechToText",2),__decorateClass([Property("object")],DeepChat.prototype,"images",2),__decorateClass([Property("object")],DeepChat.prototype,"gifs",2),__decorateClass([Property("object")],DeepChat.prototype,"camera",2),__decorateClass([Property("object")],DeepChat.prototype,"audio",2),__decorateClass([Property("object")],DeepChat.prototype,"microphone",2),__decorateClass([Property("object")],DeepChat.prototype,"mixedFiles",2),__decorateClass([Property("object")],DeepChat.prototype,"dragAndDrop",2),__decorateClass([Property("object")],DeepChat.prototype,"introPanelStyle",2),__decorateClass([Property("function")],DeepChat.prototype,"onNewMessage",2),__decorateClass([Property("function")],DeepChat.prototype,"onComponentRender",2),customElements.define("deep-chat",DeepChat)}}]);